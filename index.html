<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consciousness OS v6.0</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f8f6ff;
  --bg2: #ffffff;
  --bg3: #f0ecff;
  --text: #1a1040;
  --text2: #4a3f6b;
  --text3: #7c6d99;
  --border: #e2d9f3;
  --primary: #7c3aed;
  --primary2: #6d28d9;
  --accent: #06b6d4;
  --accent2: #0891b2;
  --pink: #ec4899;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --card-shadow: 0 2px 12px rgba(124,58,237,0.08);
  --nav-h: 56px;
  --topbar-h: 54px;
}
[data-theme="dark"] {
  --bg: #0f0a1e;
  --bg2: #1a1035;
  --bg3: #221a42;
  --text: #f0ebff;
  --text2: #c4b5fd;
  --text3: #9170d8;
  --border: #2d2250;
  --card-shadow: 0 2px 12px rgba(0,0,0,0.4);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:"DM Sans",sans-serif;background:var(--bg);color:var(--text);font-size:15px;overflow-x:hidden}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{position:fixed;top:0;left:0;right:0;height:var(--topbar-h);background:var(--bg2);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 14px;gap:10px;z-index:200;box-shadow:var(--card-shadow)}
.topbar-brand{font-family:"Syne",sans-serif;font-weight:800;font-size:17px;background:linear-gradient(135deg,var(--primary),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;flex:1}
.topbar-actions{display:flex;gap:6px;align-items:center}
.tb-btn{background:var(--bg3);border:1px solid var(--border);color:var(--text2);border-radius:8px;padding:5px 9px;cursor:pointer;font-size:13px;display:flex;align-items:center;gap:4px;transition:all .2s}
.tb-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary)}
.lang-sel{background:var(--bg3);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:5px 7px;cursor:pointer;font-size:12px}

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:var(--nav-h);background:var(--bg2);border-top:1px solid var(--border);display:flex;overflow-x:auto;z-index:200;scrollbar-width:none}
.bottom-nav::-webkit-scrollbar{display:none}
.nav-tab{flex:0 0 auto;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 11px;gap:2px;cursor:pointer;border:none;background:transparent;color:var(--text3);font-size:10px;font-family:"DM Sans",sans-serif;transition:all .2s;min-width:56px}
.nav-tab .ni{font-size:18px;line-height:1}
.nav-tab.active{color:var(--primary)}
.nav-tab.active .ni{transform:scale(1.15)}

/* â”€â”€ MAIN CONTENT â”€â”€ */
.main{padding-top:calc(var(--topbar-h) + 12px);padding-bottom:calc(var(--nav-h) + 16px);min-height:100vh}
.tab-panel{display:none;padding:0 14px;animation:fadeUp .3s ease}
.tab-panel.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:14px;box-shadow:var(--card-shadow)}
.card-title{font-family:"Syne",sans-serif;font-weight:700;font-size:15px;color:var(--text);margin-bottom:12px;display:flex;align-items:center;gap:7px}
.card-title .emoji{font-size:18px}
.section-header{font-family:"Syne",sans-serif;font-weight:700;font-size:19px;margin:18px 0 10px;display:flex;align-items:center;gap:8px}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{display:inline-flex;align-items:center;gap:6px;padding:9px 16px;border-radius:10px;border:none;cursor:pointer;font-family:"DM Sans",sans-serif;font-weight:600;font-size:14px;transition:all .2s}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--pink));color:#fff}
.btn-primary:hover{opacity:.88;transform:translateY(-1px)}
.btn-secondary{background:var(--bg3);border:1px solid var(--border);color:var(--text2)}
.btn-secondary:hover{border-color:var(--primary);color:var(--primary)}
.btn-accent{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-sm{padding:6px 11px;font-size:12px;border-radius:8px}
.btn-block{width:100%;justify-content:center}

/* â”€â”€ FORMS â”€â”€ */
.form-group{margin-bottom:14px}
.form-label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px}
.form-input,.form-select,.form-textarea{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:9px 12px;color:var(--text);font-family:"DM Sans",sans-serif;font-size:14px;transition:border .2s;outline:none}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--primary)}
.form-textarea{resize:vertical;min-height:80px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}

/* â”€â”€ ENHANCED SLIDER WITH DOTS â”€â”€ */
.slider-group{margin-bottom:20px}
.slider-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.slider-label{font-size:13px;font-weight:600;color:var(--text2)}
.slider-value-badge{background:var(--primary);color:#fff;border-radius:20px;padding:2px 10px;font-size:13px;font-weight:700;min-width:32px;text-align:center}
.slider-track{width:100%;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;outline:none;background:linear-gradient(to right,var(--primary) var(--pct,50%),var(--border) var(--pct,50%));cursor:pointer;margin-bottom:8px}
.slider-track::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--primary);box-shadow:0 2px 8px rgba(124,58,237,0.4);cursor:pointer;border:2px solid #fff}
.slider-dots{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.slider-dot{width:22px;height:22px;border-radius:50%;border:2px solid var(--border);background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:var(--text3);transition:all .25s;cursor:default}
.slider-dot.active{border-color:var(--primary);background:var(--primary);color:#fff;transform:scale(1.2)}
.slider-dot.near{border-color:var(--primary);background:var(--bg3);color:var(--primary)}
.slider-anchor-text{font-size:11px;color:var(--text3);text-align:center;min-height:30px;transition:all .3s;background:var(--bg3);border-radius:8px;padding:5px 8px;line-height:1.4}
.slider-pair-labels{display:flex;justify-content:space-between;font-size:9px;color:var(--text3);margin-top:2px;padding:0 2px}

/* â”€â”€ BRAINWAVE PLAYER â”€â”€ */
.bw-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.bw-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:12px;cursor:pointer;transition:all .25s;text-align:center;position:relative;overflow:hidden}
.bw-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--primary),var(--accent));opacity:0;transition:.3s}
.bw-card.playing::before{opacity:.12}
.bw-card.playing{border-color:var(--primary);box-shadow:0 0 16px rgba(124,58,237,0.25)}
.bw-card .bw-emoji{font-size:28px;margin-bottom:6px;display:block}
.bw-card .bw-name{font-weight:700;font-size:13px;color:var(--text);position:relative}
.bw-card .bw-desc{font-size:11px;color:var(--text3);margin-top:3px;position:relative}
.bw-card .bw-freq{font-size:10px;color:var(--accent);font-weight:600;margin-top:3px;position:relative}
.bw-visualizer{height:60px;background:var(--bg3);border-radius:10px;margin-bottom:12px;display:flex;align-items:center;justify-content:center;gap:3px;overflow:hidden}
.bw-bar{width:4px;border-radius:2px;background:linear-gradient(to top,var(--primary),var(--accent));animation:none;transform-origin:bottom}
.bw-bar.animating{animation:bwAnim var(--dur,0.5s) ease-in-out infinite alternate}
@keyframes bwAnim{from{transform:scaleY(.2)}to{transform:scaleY(1)}}
.bw-controls{display:flex;gap:8px;align-items:center;background:var(--bg3);border-radius:12px;padding:12px;margin-bottom:12px}
.bw-vol{flex:1}
.bw-timer{font-size:12px;color:var(--text3);font-weight:600;min-width:48px;text-align:right}
.wave-type-btns{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.wave-btn{padding:5px 11px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s}
.wave-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* â”€â”€ AI HUB â”€â”€ */
.ai-models-bar{display:flex;gap:6px;overflow-x:auto;padding-bottom:6px;margin-bottom:12px;scrollbar-width:none}
.ai-models-bar::-webkit-scrollbar{display:none}
.ai-model-btn{flex:0 0 auto;display:flex;flex-direction:column;align-items:center;gap:3px;padding:8px 12px;border-radius:10px;border:2px solid var(--border);background:var(--bg3);cursor:pointer;transition:all .2s;min-width:72px}
.ai-model-btn.active{border-color:var(--primary);background:var(--bg)}
.ai-model-btn .ai-logo{font-size:20px}
.ai-model-btn .ai-name{font-size:10px;font-weight:700;color:var(--text2)}
.chat-messages{height:340px;overflow-y:auto;background:var(--bg3);border-radius:12px;padding:12px;margin-bottom:10px;display:flex;flex-direction:column;gap:10px}
.chat-msg{max-width:85%;padding:10px 13px;border-radius:12px;font-size:13px;line-height:1.5;animation:fadeUp .2s ease}
.chat-msg.user{align-self:flex-end;background:linear-gradient(135deg,var(--primary),var(--pink));color:#fff;border-bottom-right-radius:3px}
.chat-msg.ai{align-self:flex-start;background:var(--bg2);border:1px solid var(--border);color:var(--text);border-bottom-left-radius:3px}
.chat-msg.ai .ai-tag{font-size:10px;font-weight:700;color:var(--primary);margin-bottom:4px}
.chat-input-area{display:flex;gap:8px}
.chat-input{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:9px 12px;color:var(--text);font-family:"DM Sans",sans-serif;font-size:14px;outline:none;resize:none;height:44px;max-height:140px;overflow:hidden;transition:border .2s}
.chat-input:focus{border-color:var(--primary)}
.suggested-qs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px}
.sq-btn{padding:5px 10px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s;white-space:nowrap}
.sq-btn:hover{border-color:var(--primary);color:var(--primary)}
.ai-tip-card{background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(236,72,153,.1));border:1px solid rgba(124,58,237,.2);border-radius:12px;padding:12px;margin-bottom:10px;font-size:13px;line-height:1.5}
.chat-controls{display:flex;gap:6px;margin-bottom:8px}

/* â”€â”€ ANALYSIS â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.stat-box{background:var(--bg3);border-radius:12px;padding:12px;text-align:center;border:1px solid var(--border)}
.stat-box .sv{font-size:24px;font-weight:800;font-family:"Syne",sans-serif;color:var(--primary)}
.stat-box .sl{font-size:10px;color:var(--text3);margin-top:2px}
.trend-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
.trend-item:last-child{border-bottom:none}

/* â”€â”€ HEALTH â”€â”€ */
.health-jump-bar{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px}
.section-jump{padding:4px 9px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s}
.section-jump.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.health-progress{height:6px;background:var(--bg3);border-radius:3px;margin-bottom:14px;overflow:hidden}
.health-progress-bar{height:100%;background:linear-gradient(to right,var(--primary),var(--pink));border-radius:3px;transition:width .4s}
.health-section{display:none}
.health-section.active{display:block}
.unit-toggle{display:flex;gap:0;border-radius:8px;overflow:hidden;border:1px solid var(--border);width:fit-content}
.unit-btn{padding:5px 12px;font-size:12px;cursor:pointer;border:none;background:var(--bg3);color:var(--text2);font-family:"DM Sans",sans-serif;transition:all .2s}
.unit-btn.active{background:var(--primary);color:#fff}
.dual-input{display:flex;gap:6px;align-items:center}
.dual-input .form-input{flex:1}
.dual-input .unit-label{font-size:12px;color:var(--text3);white-space:nowrap}

/* â”€â”€ GAMES â”€â”€ */
.games-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.game-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;cursor:pointer;transition:all .25s}
.game-card:hover{border-color:var(--primary);transform:translateY(-2px);box-shadow:0 6px 20px rgba(124,58,237,.15)}
.game-card .g-emoji{font-size:32px;margin-bottom:6px;display:block}
.game-card .g-name{font-weight:700;font-size:13px;color:var(--text)}
.game-card .g-desc{font-size:11px;color:var(--text3);margin-top:3px}
.game-card .g-tag{font-size:10px;color:var(--accent);font-weight:600;margin-top:4px}
.game-view{display:none}
.game-view.active{display:block}
.game-header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.game-score-bar{display:flex;gap:14px;background:var(--bg3);border-radius:10px;padding:10px 14px;margin-bottom:14px}
.game-score-bar .gs{text-align:center;flex:1}
.game-score-bar .gsv{font-size:20px;font-weight:800;font-family:"Syne",sans-serif;color:var(--primary)}
.game-score-bar .gsl{font-size:10px;color:var(--text3)}
#sudoku-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:1px;background:var(--border);border:2px solid var(--primary);border-radius:8px;overflow:hidden;max-width:340px;margin:0 auto 14px}
.sudoku-cell{background:var(--bg3);aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--text);cursor:pointer;transition:background .15s;border:none}
.sudoku-cell:nth-child(3n){border-right:2px solid var(--primary)}
.sudoku-cell.given{color:var(--primary);background:rgba(124,58,237,.08)}
.sudoku-cell.selected{background:rgba(124,58,237,.25)}
.sudoku-cell.error{background:rgba(239,68,68,.15);color:var(--danger)}
.sudoku-numpad{display:grid;grid-template-columns:repeat(9,1fr);gap:4px;margin-bottom:10px;max-width:340px;margin:0 auto 14px}
.sudoku-num{background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:8px 4px;text-align:center;cursor:pointer;font-weight:700;font-size:13px;transition:all .2s}
.sudoku-num:hover{background:var(--primary);color:#fff}
.pattern-grid{display:grid;gap:6px;margin-bottom:14px}
.pattern-cell{border-radius:8px;aspect-ratio:1;transition:all .3s;cursor:pointer;border:2px solid transparent}
.pattern-cell.show{border-color:var(--primary);box-shadow:0 0 16px rgba(124,58,237,.4)}
.typing-area{font-size:16px;line-height:1.8;letter-spacing:.3px}
.typing-area .correct{color:var(--success)}
.typing-area .incorrect{color:var(--danger);text-decoration:underline}
.typing-area .current{background:var(--primary);color:#fff;border-radius:2px}

/* â”€â”€ DREAMS â”€â”€ */
.dream-types{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.dream-type-btn{padding:5px 11px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:12px;cursor:pointer;transition:all .2s}
.dream-type-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.technique-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;cursor:pointer;transition:all .2s}
.technique-card:hover{border-color:var(--primary)}
.technique-card .tc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.technique-card .tc-title{font-weight:700;font-size:14px}
.technique-card .tc-body{font-size:13px;color:var(--text2);line-height:1.5;display:none}
.technique-card.open .tc-body{display:block}
.technique-card .tc-chevron{transition:transform .2s;color:var(--text3)}
.technique-card.open .tc-chevron{transform:rotate(180deg)}
.dream-ai-box{background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(6,182,212,.1));border:1px solid rgba(124,58,237,.2);border-radius:12px;padding:14px;margin-top:10px}

/* â”€â”€ VOICE & MEDIA â”€â”€ */
.recorder-visual{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--pink));display:flex;align-items:center;justify-content:center;margin:0 auto 14px;cursor:pointer;transition:all .3s;font-size:32px}
.recorder-visual.recording{animation:pulse 1s ease-in-out infinite;box-shadow:0 0 0 0 rgba(124,58,237,.5)}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(124,58,237,.5)}50%{box-shadow:0 0 0 14px rgba(124,58,237,0)}}
.memo-item{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px}
.memo-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:11px;color:var(--text3)}
.media-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.media-thumb{aspect-ratio:1;border-radius:8px;overflow:hidden;background:var(--bg3);cursor:pointer;position:relative}
.media-thumb img,.media-thumb video{width:100%;height:100%;object-fit:cover}
.ai-insight-box{background:linear-gradient(135deg,rgba(16,185,129,.1),rgba(6,182,212,.1));border:1px solid rgba(16,185,129,.2);border-radius:12px;padding:12px;margin-top:10px;font-size:13px}

/* â”€â”€ CALENDAR & ALARMS â”€â”€ */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:14px}
.cal-day-header{text-align:center;font-size:10px;font-weight:700;color:var(--text3);padding:4px 0}
.cal-day{aspect-ratio:1;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:12px;cursor:pointer;position:relative;border:1px solid transparent;transition:all .2s}
.cal-day:hover{background:var(--bg3)}
.cal-day.today{background:var(--primary);color:#fff;font-weight:700}
.cal-day.has-log{border-color:var(--primary);color:var(--primary)}
.cal-day.has-dream::after{content:'ğŸ’¤';font-size:8px;position:absolute;bottom:1px;right:1px}
.alarm-item{display:flex;justify-content:space-between;align-items:center;background:var(--bg3);border-radius:10px;padding:10px;margin-bottom:6px;border:1px solid var(--border)}
.alarm-toggle{width:40px;height:22px;border-radius:11px;background:var(--border);position:relative;cursor:pointer;transition:background .2s}
.alarm-toggle.on{background:var(--primary)}
.alarm-toggle::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:#fff;top:2px;left:2px;transition:left .2s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.alarm-toggle.on::after{left:20px}

/* â”€â”€ SETTINGS â”€â”€ */
.setting-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border)}
.setting-item:last-child{border-bottom:none}
.setting-info{flex:1;padding-right:12px}
.setting-title{font-weight:600;font-size:14px}
.setting-desc{font-size:12px;color:var(--text3);margin-top:2px}
.toggle{width:44px;height:24px;border-radius:12px;background:var(--border);position:relative;cursor:pointer;transition:background .25s;flex-shrink:0}
.toggle.on{background:var(--primary)}
.toggle::after{content:'';position:absolute;width:20px;height:20px;border-radius:50%;background:#fff;top:2px;left:2px;transition:left .25s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.toggle.on::after{left:22px}
.setting-help{font-size:10px;color:var(--accent);cursor:pointer;margin-top:3px;display:inline-block}

/* â”€â”€ MODALS â”€â”€ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);z-index:500;display:flex;align-items:center;justify-content:center;padding:14px;opacity:0;pointer-events:none;transition:opacity .3s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--bg2);border-radius:18px;width:100%;max-width:460px;max-height:85vh;overflow-y:auto;padding:20px;animation:fadeUp .3s ease;border:1px solid var(--border);scrollbar-width:thin}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.modal-title{font-family:"Syne",sans-serif;font-weight:700;font-size:18px}
.modal-close{background:var(--bg3);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:16px;color:var(--text3)}

/* â”€â”€ ONBOARDING â”€â”€ */
.onboard-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);z-index:800;display:flex;align-items:center;justify-content:center;padding:16px}
.onboard-card{background:var(--bg2);border-radius:20px;width:100%;max-width:420px;padding:24px;border:1px solid var(--border);max-height:90vh;overflow-y:auto}
.onboard-step{display:none;animation:fadeUp .3s ease}
.onboard-step.active{display:block}
.onboard-icon{font-size:56px;text-align:center;margin-bottom:14px;display:block}
.onboard-title{font-family:"Syne",sans-serif;font-size:22px;font-weight:800;text-align:center;margin-bottom:8px;background:linear-gradient(135deg,var(--primary),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.onboard-text{text-align:center;color:var(--text2);font-size:14px;line-height:1.6;margin-bottom:18px}
.onboard-features{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:18px}
.of-item{background:var(--bg3);border-radius:10px;padding:10px;text-align:center;border:1px solid var(--border)}
.of-item .of-icon{font-size:22px;margin-bottom:4px}
.of-item .of-name{font-size:11px;font-weight:700;color:var(--text)}
.onboard-dots{display:flex;justify-content:center;gap:6px;margin-bottom:16px}
.odot{width:8px;height:8px;border-radius:50%;background:var(--border);transition:all .2s}
.odot.active{background:var(--primary);width:22px;border-radius:4px}
.onboard-nav{display:flex;gap:8px}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:calc(var(--nav-h) + 14px);left:50%;transform:translateX(-50%) translateY(20px);background:var(--text);color:var(--bg);padding:10px 20px;border-radius:24px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â”€â”€ MISC â”€â”€ */
.badge{display:inline-block;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700}
.badge-primary{background:rgba(124,58,237,.15);color:var(--primary)}
.badge-success{background:rgba(16,185,129,.15);color:var(--success)}
.badge-warning{background:rgba(245,158,11,.15);color:var(--warning)}
.badge-danger{background:rgba(239,68,68,.15);color:var(--danger)}
.progress-bar-wrap{height:8px;background:var(--bg3);border-radius:4px;overflow:hidden}
.progress-bar-fill{height:100%;border-radius:4px;background:linear-gradient(to right,var(--primary),var(--pink));transition:width .4s}
.divider{border:none;border-top:1px solid var(--border);margin:14px 0}
.empty-state{text-align:center;padding:30px 20px;color:var(--text3)}
.empty-state .es-icon{font-size:40px;margin-bottom:10px;display:block}
.empty-state .es-text{font-size:14px}
.chip{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:12px;background:var(--bg3);border:1px solid var(--border);font-size:11px;color:var(--text2);margin:2px}
.score-ring{position:relative;width:80px;height:80px;flex-shrink:0}
.score-ring svg{transform:rotate(-90deg)}
.score-ring .ring-text{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:"Syne",sans-serif;font-weight:800;font-size:18px;color:var(--primary)}
.score-ring .ring-sub{font-size:8px;color:var(--text3);font-family:"DM Sans",sans-serif;font-weight:400}
.collapsible-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:10px 0;user-select:none}
.collapsible-body{display:none}
.collapsible-body.open{display:block}
@media(max-width:380px){.bw-grid,.games-grid{grid-template-columns:1fr}}
.rc-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
.rc-item:last-child{border-bottom:none}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.ai-loading{display:flex;gap:5px;align-items:center;padding:8px 12px}
.ai-loading span{width:6px;height:6px;border-radius:50%;background:var(--primary);animation:bounce .8s ease-in-out infinite}
.ai-loading span:nth-child(2){animation-delay:.15s}
.ai-loading span:nth-child(3){animation-delay:.3s}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.reality-check-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.rc-btn{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;cursor:pointer;transition:all .2s}
.rc-btn:hover{border-color:var(--success)}
.rc-btn.done{border-color:var(--success);background:rgba(16,185,129,.1)}
.rc-btn .rc-icon{font-size:22px;margin-bottom:4px;display:block}
.rc-btn .rc-name{font-size:11px;font-weight:700;color:var(--text)}
.health-nav-btns{display:flex;justify-content:space-between;margin-top:16px}
.comparison-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.comparison-box{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
.comparison-box .cv{font-size:22px;font-weight:800;font-family:"Syne",sans-serif}
.comparison-box .cl{font-size:11px;color:var(--text3);margin-top:3px}
</style>
</head>
<body>

<!-- â•â• TOPBAR â•â• -->
<div class="topbar">
  <div class="topbar-brand">ğŸ§  Consciousness OS</div>
  <div class="topbar-actions">
    <select class="lang-sel" id="langSel" onchange="setLang(this.value)" title="Language">
      <option value="en">ğŸŒ EN</option>
      <option value="hi">ğŸ‡®ğŸ‡³ HI</option>
      <option value="es">ğŸ‡ªğŸ‡¸ ES</option>
      <option value="fr">ğŸ‡«ğŸ‡· FR</option>
      <option value="de">ğŸ‡©ğŸ‡ª DE</option>
      <option value="pt">ğŸ‡§ğŸ‡· PT</option>
      <option value="zh">ğŸ‡¨ğŸ‡³ ZH</option>
      <option value="ar">ğŸ‡¸ğŸ‡¦ AR</option>
      <option value="ja">ğŸ‡¯ğŸ‡µ JA</option>
      <option value="ru">ğŸ‡·ğŸ‡º RU</option>
    </select>
    <button class="tb-btn" onclick="toggleTheme()" id="themeBtn" title="Toggle theme">ğŸŒ™</button>
    <button class="tb-btn" onclick="showOnboarding()" title="App guide">â“</button>
    <button class="tb-btn" onclick="exportData()" title="Export">ğŸ’¾</button>
  </div>
</div>

<!-- â•â• MAIN CONTENT â•â• -->
<div class="main">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 1 â€” DAILY CONSCIOUSNESS LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel active" id="tab-log">
  <div class="section-header">ğŸ“ <span data-t="daily_log">Daily Consciousness Log</span></div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ“…</span> <span data-t="entry_info">Entry Info</span></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label" data-t="date">Date</label>
        <input type="date" class="form-input" id="logDate"></div>
      <div class="form-group"><label class="form-label" data-t="time_of_day">Time of Day</label>
        <select class="form-select" id="logTime">
          <option value="morning">ğŸŒ… Morning</option>
          <option value="afternoon">â˜€ï¸ Afternoon</option>
          <option value="evening">ğŸŒ† Evening</option>
          <option value="night">ğŸŒ™ Night</option>
        </select></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label" data-t="activity">Activity</label>
        <select class="form-select" id="logActivity">
          <option>Deep Work</option><option>Exercise</option><option>Rest</option><option>Social</option><option>Learning</option><option>Creative</option><option>Meditation</option><option>Entertainment</option>
        </select></div>
      <div class="form-group"><label class="form-label">Brainwave State</label>
        <select class="form-select" id="logBrainwave">
          <option>Alpha (Relaxed Focus)</option><option>Beta (Active Thinking)</option><option>Gamma (Peak Performance)</option><option>Theta (Creativity/Dream)</option><option>Delta (Deep Rest)</option>
        </select></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸšï¸</span> <span data-t="consciousness_metrics">Consciousness Metrics</span></div>
    <div id="slidersContainer"></div>
    <div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px">
      <div style="font-size:13px;color:var(--text2)">Consciousness Score</div>
      <div class="score-ring">
        <svg width="80" height="80" viewBox="0 0 80 80">
          <circle cx="40" cy="40" r="34" fill="none" stroke="var(--border)" stroke-width="7"/>
          <circle id="scoreCircle" cx="40" cy="40" r="34" fill="none" stroke="var(--primary)" stroke-width="7"
            stroke-dasharray="213.6" stroke-dashoffset="213.6" stroke-linecap="round"/>
        </svg>
        <div class="ring-text"><span id="scoreValue">0.0</span><span class="ring-sub">/ 10</span></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ§˜</span> Inner State</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Dominant Emotion</label>
        <select class="form-select" id="logEmotion">
          <option>Joy</option><option>Calm</option><option>Curious</option><option>Focused</option><option>Creative</option><option>Anxious</option><option>Frustrated</option><option>Tired</option><option>Inspired</option><option>Grateful</option><option>Melancholy</option><option>Excited</option><option>Neutral</option>
        </select></div>
      <div class="form-group"><label class="form-label">Physical Sensation</label>
        <select class="form-select" id="logSensation">
          <option>Energized</option><option>Relaxed</option><option>Tense</option><option>Heavy</option><option>Light</option><option>Neutral</option><option>Achy</option><option>Vibrant</option>
        </select></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">âœï¸</span> Reflections</div>
    <div class="form-group"><label class="form-label">Raw Thoughts / Stream of Consciousness</label>
      <textarea class="form-textarea" id="logThought" placeholder="What's on your mind right now?"></textarea></div>
    <div class="form-group"><label class="form-label">Key Insight Today</label>
      <textarea class="form-textarea" id="logInsight" style="min-height:60px" placeholder="What did you realize?"></textarea></div>
    <div class="form-group"><label class="form-label">Current Goal</label>
      <input type="text" class="form-input" id="logGoal" placeholder="What are you working toward?"></div>
    <div class="form-group"><label class="form-label">Main Obstacle</label>
      <input type="text" class="form-input" id="logObstacle" placeholder="What's blocking you?"></div>
    <div class="form-group"><label class="form-label">Gratitude</label>
      <input type="text" class="form-input" id="logGratitude" placeholder="3 things you're grateful for..."></div>
    <div class="form-group"><label class="form-label">Recurring Pattern / Observation</label>
      <input type="text" class="form-input" id="logPattern" placeholder="Any recurring themes?"></div>
    <div class="form-group"><label class="form-label">Key Action to Take</label>
      <input type="text" class="form-input" id="logAction" placeholder="One concrete action step"></div>
  </div>

  <button class="btn btn-primary btn-block" onclick="saveLog()" style="margin-bottom:14px">
    âœ¨ <span data-t="save_entry">Save Entry</span>
  </button>

  <div class="card" id="recentLogsCard">
    <div class="card-title"><span class="emoji">ğŸ“‹</span> Recent Entries</div>
    <div id="recentLogs"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 2 â€” BRAINWAVE AUDIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-waves">
  <div class="section-header">ğŸµ Brainwave Audio Lab</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ§</span> Now Playing</div>
    <div style="text-align:center;margin-bottom:12px">
      <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary)" id="bwNowName">Select a session below</div>
      <div style="font-size:12px;color:var(--text3);margin-top:3px" id="bwNowDesc">Binaural beats & frequencies for mind enhancement</div>
      <div style="font-size:11px;color:var(--accent);margin-top:2px" id="bwNowFreq"></div>
    </div>
    <div class="bw-visualizer" id="bwVisualizer">
      <div style="color:var(--text3);font-size:12px">â–¶ Press Play to begin</div>
    </div>
    <div class="bw-controls">
      <button class="btn btn-secondary btn-sm" onclick="bwPrevTrack()">â®</button>
      <button class="btn btn-primary" id="bwPlayBtn" onclick="toggleBW()">â–¶ Play</button>
      <button class="btn btn-secondary btn-sm" onclick="bwNextTrack()">â­</button>
      <input type="range" class="bw-vol" id="bwVol" min="0" max="100" value="60" oninput="setBWVol(this.value)" title="Volume">
      <span style="font-size:16px">ğŸ”Š</span>
      <span class="bw-timer" id="bwTimer">00:00</span>
    </div>

    <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px">Wave Type:</div>
    <div class="wave-type-btns">
      <button class="wave-btn active" onclick="setBWType('binaural',this)">ğŸ§ Binaural Beats</button>
      <button class="wave-btn" onclick="setBWType('isochronic',this)">ğŸ“³ Isochronic</button>
      <button class="wave-btn" onclick="setBWType('solfeggio',this)">ğŸµ Solfeggio</button>
      <button class="wave-btn" onclick="setBWType('whitenoise',this)">ğŸŒŠ White Noise</button>
    </div>
    <div style="background:rgba(124,58,237,.08);border-radius:10px;padding:10px;font-size:12px;color:var(--text2);margin-top:8px">
      âš ï¸ <strong>Use headphones</strong> for binaural beats to work properly. Each ear needs to hear a slightly different frequency.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ§ </span> Brainwave Sessions</div>
    <div class="bw-grid" id="bwGrid"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ“š</span> What Are Brainwaves?</div>
    <div id="bwEducation"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 3 â€” AI HUB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-ai">
  <div class="section-header">ğŸ¤– AI Hub</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ”€</span> Select AI Model</div>
    <div class="ai-models-bar" id="aiModelsBar"></div>
    <div style="font-size:11px;color:var(--text3)">
      ğŸ’¡ Different AI perspectives help reduce bias and give you multiple viewpoints.
    </div>
  </div>

  <div class="card">
    <div class="ai-tip-card" id="aiTipCard">
      ğŸ’¡ <strong>Daily Tip:</strong> <span id="aiDailyTip">Loading your personalized tip...</span>
    </div>
    <div class="chat-controls">
      <button class="btn btn-secondary btn-sm" onclick="clearAIChat()">ğŸ—‘ Clear</button>
      <button class="btn btn-secondary btn-sm" onclick="exportChat()">ğŸ’¾ Export</button>
      <span style="flex:1"></span>
      <span style="font-size:11px;color:var(--text3)" id="aiStatusLabel">Ready</span>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="suggested-qs" id="suggestedQs"></div>
    <div class="chat-input-area">
      <textarea class="chat-input" id="chatInput" placeholder="Ask me anything about your consciousness, health, dreams..." onkeydown="handleChatKey(event)" rows="1"></textarea>
      <button class="btn btn-primary" onclick="sendChat()" id="chatSendBtn">â¤</button>
    </div>
  </div>

  <div class="card" id="aiInsightsCard">
    <div class="card-title"><span class="emoji">ğŸ“Š</span> AI Pattern Analysis</div>
    <div id="aiPatternDisplay"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 4 â€” ANALYSIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-analysis">
  <div class="section-header">ğŸ“Š Analysis Dashboard</div>

  <div class="stats-grid">
    <div class="stat-box"><div class="sv" id="statMood">â€”</div><div class="sl">Avg Mood</div></div>
    <div class="stat-box"><div class="sv" id="statFocus">â€”</div><div class="sl">Avg Focus</div></div>
    <div class="stat-box"><div class="sv" id="statScore">â€”</div><div class="sl">Avg Score</div></div>
    <div class="stat-box"><div class="sv" id="statEntries">0</div><div class="sl">Entries</div></div>
    <div class="stat-box"><div class="sv" id="statFlow">â€”</div><div class="sl">Avg Flow</div></div>
    <div class="stat-box"><div class="sv" id="statCreativity">â€”</div><div class="sl">Creativity</div></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ”®</span> Predictions</div>
    <div id="predictionsArea"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ“ˆ</span> Trends (Last 10 vs Previous 10)</div>
    <div id="trendsArea"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ†</span> Personal Records</div>
    <div id="recordsArea"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ§©</span> Pattern Detection</div>
    <div id="patternsArea"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 5 â€” HEALTH PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-health">
  <div class="section-header">â¤ï¸ Health Profile</div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-size:13px;font-weight:700;color:var(--text2)">Section <span id="hsCurrent">1</span> of 18</div>
      <div style="font-size:12px;color:var(--text3)" id="hsSectionName">Demographics</div>
    </div>
    <div class="health-progress"><div class="health-progress-bar" id="hsProgressBar" style="width:5.5%"></div></div>
    <div style="font-size:11px;font-weight:700;color:var(--text2);margin-bottom:6px">Jump to section:</div>
    <div class="health-jump-bar" id="healthJumpBar"></div>
  </div>

  <div id="healthSectionsContainer"></div>

  <div class="health-nav-btns">
    <button class="btn btn-secondary" id="hsPrevBtn" onclick="hsPrev()" style="display:none">â† Previous</button>
    <div style="flex:1"></div>
    <button class="btn btn-primary" id="hsNextBtn" onclick="hsNext()">Next â†’</button>
  </div>

  <div class="card" id="aiDoctorCard" style="display:none;margin-top:14px">
    <div class="card-title"><span class="emoji">ğŸ‘¨â€âš•ï¸</span> AI Doctor Analysis</div>
    <div id="aiDoctorOutput"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 6 â€” BRAIN GAMES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-games">
  <div class="section-header">ğŸ® Brain Training</div>

  <div class="game-view active" id="gamesMenu">
    <div class="games-grid" id="gamesGrid"></div>
  </div>

  <!-- Game canvases will be injected here by JS -->
  <div id="gameContainer"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 7 â€” LUCID DREAMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-dreams">
  <div class="section-header">ğŸŒ™ Lucid Dreams Lab</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ“–</span> Log a Dream</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Date</label>
        <input type="date" class="form-input" id="dreamDate"></div>
      <div class="form-group"><label class="form-label">Dream Title</label>
        <input type="text" class="form-input" id="dreamTitle" placeholder="Give it a name..."></div>
    </div>
    <div class="form-group"><label class="form-label">Dream Type</label>
      <div class="dream-types">
        <button class="dream-type-btn active" onclick="setDreamType(this,'regular')">Regular</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'lucid')">âœ¨ Lucid</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'vivid')">ğŸŒˆ Vivid</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'nightmare')">ğŸ˜± Nightmare</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'recurring')">ğŸ”„ Recurring</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'prophetic')">ğŸ”® Prophetic</button>
      </div>
      <input type="hidden" id="dreamType" value="regular">
    </div>
    <div class="form-group"><label class="form-label">Dream Description</label>
      <textarea class="form-textarea" id="dreamDesc" style="min-height:100px" placeholder="Describe your dream in detail â€” environments, characters, events, feelings..."></textarea></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Vividness (0â€“10)</label>
        <div class="slider-group" style="margin:0">
          <input type="range" class="slider-track" id="dreamVividness" min="0" max="10" value="5" oninput="updateSimpleSlider(this)">
          <div style="text-align:right;font-size:12px;color:var(--primary);font-weight:700" id="dreamVividnessVal">5</div>
        </div></div>
      <div class="form-group"><label class="form-label">Lucidity (0â€“10)</label>
        <div class="slider-group" style="margin:0">
          <input type="range" class="slider-track" id="dreamLucidity" min="0" max="10" value="0" oninput="updateSimpleSlider(this)">
          <div style="text-align:right;font-size:12px;color:var(--primary);font-weight:700" id="dreamLucidityVal">0</div>
        </div></div>
    </div>
    <div class="form-group"><label class="form-label">Dream Signs (things that show you're dreaming)</label>
      <input type="text" class="form-input" id="dreamSigns" placeholder="e.g., flying, talking animals, familiar place distorted..."></div>
    <div class="form-group"><label class="form-label">Emotions felt</label>
      <input type="text" class="form-input" id="dreamEmotions" placeholder="e.g., joy, fear, wonder, confusion..."></div>
    <button class="btn btn-primary btn-block" onclick="saveDream()" style="margin-top:6px">ğŸ’¾ Save Dream</button>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ¤–</span> AI Dream Analysis</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:10px">Save a dream above and get AI-powered analysis of symbols, themes, and lucid dreaming coaching.</div>
    <div id="dreamAIAnalysis">
      <div class="empty-state"><span class="es-icon">ğŸŒ™</span><div class="es-text">Log a dream to get personalized analysis</div></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ¯</span> Lucid Dream Techniques</div>
    <div id="techniquesContainer"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">âœ‹</span> Reality Check Tracker</div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div style="font-size:13px;color:var(--text2)">Today's checks: <strong id="rcCount">0</strong> / 15</div>
      <button class="btn btn-secondary btn-sm" onclick="resetRC()">Reset Day</button>
    </div>
    <div class="progress-bar-wrap" style="margin-bottom:12px"><div class="progress-bar-fill" id="rcProgress" style="width:0%"></div></div>
    <div class="reality-check-grid" id="rcGrid"></div>
    <div style="font-size:12px;color:var(--text3);margin-top:10px;line-height:1.5">
      ğŸ”‘ <strong>What are reality checks?</strong> They are habits you do while awake to question if you're dreaming. Do them enough times while awake, and your brain will do them automatically in dreams â€” triggering lucidity.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ”¢</span> WBTB Sleep Calculator</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Sleep Time</label>
        <input type="time" class="form-input" id="wbtbSleep" value="23:00"></div>
      <div class="form-group"><label class="form-label">Wake Time</label>
        <input type="time" class="form-input" id="wbtbWake" value="07:00"></div>
    </div>
    <button class="btn btn-secondary btn-sm btn-block" onclick="calcWBTB()">Calculate Optimal Times</button>
    <div id="wbtbResult" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ“‹</span> Dream Journal</div>
    <div id="dreamJournal"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 8 â€” VOICE & MEDIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-media">
  <div class="section-header">ğŸ™ï¸ Voice & Media Archive</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ™ï¸</span> Voice Recorder</div>
    <div class="recorder-visual" id="recorderBtn" onclick="toggleRecord()">ğŸ™ï¸</div>
    <div style="text-align:center;margin-bottom:12px">
      <div style="font-size:14px;font-weight:700;color:var(--text2)" id="recStatus">Tap to Start Recording</div>
      <div style="font-size:12px;color:var(--text3);margin-top:3px" id="recTimer">00:00</div>
    </div>
    <div style="font-size:12px;color:var(--text2);margin-bottom:6px;font-weight:700">Live Transcript:</div>
    <div style="background:var(--bg3);border-radius:10px;padding:10px;min-height:60px;font-size:13px;color:var(--text2);margin-bottom:10px" id="liveTranscript">Speak to see transcript here...</div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ¤–</span> AI Voice Insights</div>
    <div id="voiceAIInsights">
      <div class="empty-state"><span class="es-icon">ğŸ™ï¸</span><div class="es-text">Record voice memos to get AI analysis of your patterns and suggestions for what to capture next.</div></div>
    </div>
    <button class="btn btn-secondary btn-sm" onclick="analyzeVoiceMemos()" style="margin-top:8px">ğŸ” Analyze My Recordings</button>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ“¼</span> Voice Memos</div>
    <div id="voiceMemos"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ–¼ï¸</span> Media Upload</div>
    <div onclick="document.getElementById('mediaInput').click()"
         style="border:2px dashed var(--border);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:border .2s"
         onmouseenter="this.style.borderColor='var(--primary)'" onmouseleave="this.style.borderColor='var(--border)'">
      <div style="font-size:32px;margin-bottom:6px">ğŸ“¸</div>
      <div style="font-size:14px;color:var(--text2)">Tap to upload photos or videos</div>
      <div style="font-size:11px;color:var(--text3);margin-top:3px">Images & videos stored locally on your device</div>
    </div>
    <input type="file" id="mediaInput" accept="image/*,video/*" multiple style="display:none" onchange="uploadMedia(event)">
    <div class="card">
      <div class="card-title"><span class="emoji">ğŸ¤–</span> AI Media Insights</div>
      <div id="mediaAIInsights">
        <div class="empty-state"><span class="es-icon">ğŸ“¸</span><div class="es-text">Upload media to get AI suggestions on what to document for consciousness tracking.</div></div>
      </div>
      <button class="btn btn-secondary btn-sm" onclick="analyzeMedia()" style="margin-top:8px">ğŸ” Analyze My Archive</button>
    </div>
    <div class="media-grid" id="mediaGrid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 9 â€” CALENDAR & ALARMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-calendar">
  <div class="section-header">ğŸ“… Calendar & Alarms</div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <button class="btn btn-secondary btn-sm" onclick="calNav(-1)">â—€</button>
      <div style="font-weight:800;font-family:Syne,sans-serif;font-size:17px" id="calTitle"></div>
      <button class="btn btn-secondary btn-sm" onclick="calNav(1)">â–¶</button>
    </div>
    <div class="cal-grid" id="calGrid"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">â°</span> Alarms & Reminders</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Label</label>
        <input type="text" class="form-input" id="alarmLabel" placeholder="e.g., Reality Check, Meditation..."></div>
      <div class="form-group"><label class="form-label">Time</label>
        <input type="time" class="form-input" id="alarmTime"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Sound</label>
        <select class="form-select" id="alarmSound">
          <option value="bell">ğŸ”” Bell</option>
          <option value="chime">ğŸµ Chime</option>
          <option value="pulse">ğŸ“³ Pulse</option>
          <option value="om">ğŸ•‰ï¸ Om</option>
          <option value="birds">ğŸ¦ Birds</option>
        </select></div>
      <div class="form-group"><label class="form-label">Repeat</label>
        <select class="form-select" id="alarmRepeat">
          <option value="once">Once</option>
          <option value="daily">Daily</option>
          <option value="weekdays">Weekdays</option>
          <option value="weekends">Weekends</option>
        </select></div>
    </div>
    <button class="btn btn-primary btn-sm btn-block" onclick="addAlarm()" style="margin-bottom:12px">+ Add Alarm</button>
    <div id="alarmsList"></div>
    <div style="font-size:11px;color:var(--text3);margin-top:8px;text-align:center">
      â„¹ï¸ Allow notifications when prompted for alarms to work. Alarms work when app is open in browser.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ“</span> Reminders</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Reminder</label>
        <input type="text" class="form-input" id="reminderText" placeholder="Reminder text"></div>
      <div class="form-group"><label class="form-label">Date & Time</label>
        <input type="datetime-local" class="form-input" id="reminderDateTime"></div>
    </div>
    <button class="btn btn-secondary btn-sm" onclick="addReminder()">+ Add Reminder</button>
    <div id="remindersList" style="margin-top:10px"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 10 â€” SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-settings">
  <div class="section-header">âš™ï¸ Settings</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ¨</span> Appearance</div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Dark Mode</div>
        <div class="setting-desc">Switch to dark theme for night use and reduced eye strain</div>
        <span class="setting-help" onclick="showSettingHelp('darkmode')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingDark" onclick="toggleTheme()"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">App Language</div>
        <div class="setting-desc">Choose your preferred language for the interface</div>
      </div>
      <select class="lang-sel" onchange="setLang(this.value)" id="settingLang">
        <option value="en">English</option>
        <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        <option value="es">EspaÃ±ol</option>
        <option value="fr">FranÃ§ais</option>
        <option value="de">Deutsch</option>
        <option value="pt">PortuguÃªs</option>
        <option value="zh">ä¸­æ–‡</option>
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
      </select>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Show Slider Anchors</div>
        <div class="setting-desc">Show detailed descriptions for each slider value</div>
        <span class="setting-help" onclick="showSettingHelp('anchors')">â“ What does this do?</span>
      </div>
      <div class="toggle on" id="settingAnchors" onclick="toggleSetting('anchors')"></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ””</span> Notifications</div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Enable Notifications</div>
        <div class="setting-desc">Allow alarms and reminders to notify you</div>
        <span class="setting-help" onclick="showSettingHelp('notif')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingNotif" onclick="requestNotifPermission()"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Daily Log Reminder</div>
        <div class="setting-desc">Remind you to fill your consciousness log each day</div>
      </div>
      <div class="toggle" id="settingDailyReminder" onclick="toggleSetting('dailyReminder')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Reality Check Alerts</div>
        <div class="setting-desc">Periodic reminders to do reality checks (every 2hrs)</div>
        <span class="setting-help" onclick="showSettingHelp('rc')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingRC" onclick="toggleSetting('rc')"></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ§ </span> AI Settings</div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Auto-analyze on Save</div>
        <div class="setting-desc">Automatically generate AI insights when you save a log entry</div>
      </div>
      <div class="toggle on" id="settingAutoAnalyze" onclick="toggleSetting('autoAnalyze')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Conversational AI Mode</div>
        <div class="setting-desc">AI checks in on your day with friendly questions</div>
      </div>
      <div class="toggle on" id="settingConvMode" onclick="toggleSetting('convMode')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Auto-transcribe Voice</div>
        <div class="setting-desc">Automatically convert speech to text when recording</div>
      </div>
      <div class="toggle on" id="settingAutoTranscribe" onclick="toggleSetting('autoTranscribe')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">AI Prompt Enhancement</div>
        <div class="setting-desc">AI automatically improves your questions for better answers</div>
        <span class="setting-help" onclick="showSettingHelp('promptboost')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingPromptBoost" onclick="toggleSetting('promptBoost')"></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ğŸ—„ï¸</span> Data Management</div>
    <button class="btn btn-secondary btn-block" onclick="exportData()" style="margin-bottom:8px">ğŸ“¤ Export All Data (JSON)</button>
    <button class="btn btn-secondary btn-block" onclick="document.getElementById('importFile').click()" style="margin-bottom:8px">ğŸ“¥ Import Data</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
    <button class="btn btn-danger btn-block" onclick="clearAllData()">ğŸ—‘ Clear All Data</button>
    <div style="font-size:11px;color:var(--text3);text-align:center;margin-top:10px">All data is stored locally on your device only. Nothing is sent to servers.</div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">â„¹ï¸</span> About</div>
    <div style="text-align:center">
      <div style="font-size:32px;margin-bottom:8px">ğŸ§ </div>
      <div style="font-family:Syne,sans-serif;font-weight:800;font-size:18px;margin-bottom:4px">Consciousness OS</div>
      <div style="font-size:13px;color:var(--text3);margin-bottom:12px">Version 6.0 Â· Local-first Â· Privacy-first</div>
      <div style="font-size:12px;color:var(--text2);line-height:1.6">Your personal mind enhancement and consciousness tracking system. All data stays on your device.</div>
    </div>
  </div>
</div>

</div><!-- /.main -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOTTOM NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="bottom-nav" id="bottomNav"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FOOTER (accessible from settings)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle"></div>
      <button class="modal-close" onclick="closeAllModals()">âœ•</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ONBOARDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="onboard-overlay" id="onboardOverlay" style="display:none">
  <div class="onboard-card">
    <div class="onboard-dots" id="onboardDots"></div>

    <div class="onboard-step active" id="oStep0">
      <span class="onboard-icon">ğŸ§ </span>
      <div class="onboard-title">Consciousness OS v6</div>
      <div class="onboard-text">Your complete mind enhancement and consciousness tracking system. Track 20+ dimensions of your consciousness, train your brain, and optimize your performance.</div>
      <div class="onboard-features">
        <div class="of-item"><div class="of-icon">ğŸ“</div><div class="of-name">Daily Log</div></div>
        <div class="of-item"><div class="of-icon">ğŸµ</div><div class="of-name">Brainwave Audio</div></div>
        <div class="of-item"><div class="of-icon">ğŸ¤–</div><div class="of-name">AI Hub</div></div>
        <div class="of-item"><div class="of-icon">ğŸ“Š</div><div class="of-name">Analysis</div></div>
        <div class="of-item"><div class="of-icon">â¤ï¸</div><div class="of-name">Health Profile</div></div>
        <div class="of-item"><div class="of-icon">ğŸ®</div><div class="of-name">Brain Games</div></div>
        <div class="of-item"><div class="of-icon">ğŸŒ™</div><div class="of-name">Lucid Dreams</div></div>
        <div class="of-item"><div class="of-icon">ğŸ™ï¸</div><div class="of-name">Voice Archive</div></div>
      </div>
    </div>

    <div class="onboard-step" id="oStep1">
      <span class="onboard-icon">ğŸ“</span>
      <div class="onboard-title">Daily Consciousness Log</div>
      <div class="onboard-text">Track 20 dimensions of your mind every day â€” mood, focus, creativity, flow, and more. Visual dot sliders make rating easy and intuitive. Your AI twin learns your patterns over time.</div>
    </div>

    <div class="onboard-step" id="oStep2">
      <span class="onboard-icon">ğŸµ</span>
      <div class="onboard-title">Brainwave Audio Lab</div>
      <div class="onboard-text">Listen to binaural beats, isochronic tones, and solfeggio frequencies to shift your brain into optimal states for focus, creativity, sleep, and meditation. Use with headphones for best results.</div>
    </div>

    <div class="onboard-step" id="oStep3">
      <span class="onboard-icon">ğŸ¤–</span>
      <div class="onboard-title">Multi-AI Hub</div>
      <div class="onboard-text">Chat with different AI personalities that analyze your consciousness data. Get personalized tips, pattern analysis, and insights. Multiple AI perspectives for well-rounded answers.</div>
    </div>

    <div class="onboard-step" id="oStep4">
      <span class="onboard-icon">ğŸŒ™</span>
      <div class="onboard-title">Lucid Dreaming Lab</div>
      <div class="onboard-text">Track your dreams, learn lucid dreaming techniques with simple explanations, do reality checks, and get AI analysis of your dream patterns and symbols.</div>
    </div>

    <div class="onboard-step" id="oStep5">
      <span class="onboard-icon">âœ¨</span>
      <div class="onboard-title">You're Ready!</div>
      <div class="onboard-text">Start by filling your first Daily Log to establish your baseline. The more you log, the smarter your AI becomes. You can always revisit this guide with the â“ button.</div>
    </div>

    <div class="onboard-nav">
      <button class="btn btn-secondary btn-sm" id="oBtnPrev" onclick="onboardNav(-1)" style="display:none">â† Back</button>
      <div style="flex:1"></div>
      <button class="btn btn-secondary btn-sm" onclick="closeOnboarding()">Skip</button>
      <button class="btn btn-primary btn-sm" id="oBtnNext" onclick="onboardNav(1)">Next â†’</button>
    </div>
  </div>
</div>

<!-- Setting help modal -->
<div class="modal-overlay" id="settingHelpOverlay" onclick="this.classList.remove('open')">
  <div class="modal" style="max-width:360px">
    <div class="modal-header">
      <div class="modal-title" id="settingHelpTitle"></div>
      <button class="modal-close" onclick="document.getElementById('settingHelpOverlay').classList.remove('open')">âœ•</button>
    </div>
    <div id="settingHelpBody" style="font-size:14px;color:var(--text2);line-height:1.6"></div>
  </div>
</div>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSCIOUSNESS OS v6.0 â€” JAVASCRIPT ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ TRANSLATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANGS = {
  en:{daily_log:"Daily Consciousness Log",entry_info:"Entry Info",date:"Date",time_of_day:"Time of Day",activity:"Activity",consciousness_metrics:"Consciousness Metrics",save_entry:"Save Entry",nav_log:"Log",nav_waves:"Waves",nav_ai:"AI Hub",nav_analysis:"Analysis",nav_health:"Health",nav_games:"Games",nav_dreams:"Dreams",nav_media:"Media",nav_calendar:"Calendar",nav_settings:"Settings",saved:"Entry saved!",cleared:"All cleared"},
  hi:{daily_log:"à¤¦à¥ˆà¤¨à¤¿à¤• à¤šà¥‡à¤¤à¤¨à¤¾ à¤²à¥‰à¤—",entry_info:"à¤ªà¥à¤°à¤µà¤¿à¤·à¥à¤Ÿà¤¿ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",date:"à¤¤à¤¾à¤°à¥€à¤–",time_of_day:"à¤¦à¤¿à¤¨ à¤•à¤¾ à¤¸à¤®à¤¯",activity:"à¤—à¤¤à¤¿à¤µà¤¿à¤§à¤¿",consciousness_metrics:"à¤šà¥‡à¤¤à¤¨à¤¾ à¤®à¥‡à¤Ÿà¥à¤°à¤¿à¤•à¥à¤¸",save_entry:"à¤¸à¤¹à¥‡à¤œà¥‡à¤‚",nav_log:"à¤²à¥‰à¤—",nav_waves:"à¤¤à¤°à¤‚à¤—à¥‡à¤‚",nav_ai:"AI à¤¹à¤¬",nav_analysis:"à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",nav_health:"à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯",nav_games:"à¤–à¥‡à¤²",nav_dreams:"à¤¸à¤ªà¤¨à¥‡",nav_media:"à¤®à¥€à¤¡à¤¿à¤¯à¤¾",nav_calendar:"à¤•à¥ˆà¤²à¥‡à¤‚à¤¡à¤°",nav_settings:"à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",saved:"à¤¸à¤¹à¥‡à¤œà¤¾ à¤—à¤¯à¤¾!",cleared:"à¤¸à¤¾à¤« à¤¹à¥‹ à¤—à¤¯à¤¾"},
  es:{daily_log:"Registro de Conciencia",entry_info:"Info de Entrada",date:"Fecha",time_of_day:"Hora del DÃ­a",activity:"Actividad",consciousness_metrics:"MÃ©tricas",save_entry:"Guardar",nav_log:"Registro",nav_waves:"Ondas",nav_ai:"IA Hub",nav_analysis:"AnÃ¡lisis",nav_health:"Salud",nav_games:"Juegos",nav_dreams:"SueÃ±os",nav_media:"Media",nav_calendar:"Calendario",nav_settings:"Ajustes",saved:"Â¡Guardado!",cleared:"Limpiado"},
  fr:{daily_log:"Journal de Conscience",entry_info:"Info d'EntrÃ©e",date:"Date",time_of_day:"Moment",activity:"ActivitÃ©",consciousness_metrics:"MÃ©triques",save_entry:"Sauvegarder",nav_log:"Journal",nav_waves:"Ondes",nav_ai:"IA Hub",nav_analysis:"Analyse",nav_health:"SantÃ©",nav_games:"Jeux",nav_dreams:"RÃªves",nav_media:"MÃ©dias",nav_calendar:"Calendrier",nav_settings:"ParamÃ¨tres",saved:"SauvegardÃ©!",cleared:"EffacÃ©"},
  de:{daily_log:"Bewusstseinstagebuch",entry_info:"Eintragsinfo",date:"Datum",time_of_day:"Tageszeit",activity:"AktivitÃ¤t",consciousness_metrics:"Metriken",save_entry:"Speichern",nav_log:"Tagebuch",nav_waves:"Wellen",nav_ai:"KI Hub",nav_analysis:"Analyse",nav_health:"Gesundheit",nav_games:"Spiele",nav_dreams:"TrÃ¤ume",nav_media:"Medien",nav_calendar:"Kalender",nav_settings:"Einstellungen",saved:"Gespeichert!",cleared:"GelÃ¶scht"},
  pt:{daily_log:"DiÃ¡rio de ConsciÃªncia",entry_info:"Info da Entrada",date:"Data",time_of_day:"Hora",activity:"Atividade",consciousness_metrics:"MÃ©tricas",save_entry:"Salvar",nav_log:"DiÃ¡rio",nav_waves:"Ondas",nav_ai:"IA Hub",nav_analysis:"AnÃ¡lise",nav_health:"SaÃºde",nav_games:"Jogos",nav_dreams:"Sonhos",nav_media:"MÃ­dia",nav_calendar:"CalendÃ¡rio",nav_settings:"ConfiguraÃ§Ãµes",saved:"Salvo!",cleared:"Limpo"},
  zh:{daily_log:"æ¯æ—¥æ„è¯†æ—¥å¿—",entry_info:"æ¡ç›®ä¿¡æ¯",date:"æ—¥æœŸ",time_of_day:"æ—¶é—´æ®µ",activity:"æ´»åŠ¨",consciousness_metrics:"æ„è¯†æŒ‡æ ‡",save_entry:"ä¿å­˜",nav_log:"æ—¥å¿—",nav_waves:"è„‘æ³¢",nav_ai:"AIä¸­å¿ƒ",nav_analysis:"åˆ†æ",nav_health:"å¥åº·",nav_games:"æ¸¸æˆ",nav_dreams:"æ¢¦å¢ƒ",nav_media:"åª’ä½“",nav_calendar:"æ—¥å†",nav_settings:"è®¾ç½®",saved:"å·²ä¿å­˜ï¼",cleared:"å·²æ¸…é™¤"},
  ar:{daily_log:"Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ",entry_info:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",date:"Ø§Ù„ØªØ§Ø±ÙŠØ®",time_of_day:"ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ…",activity:"Ø§Ù„Ù†Ø´Ø§Ø·",consciousness_metrics:"Ù…Ù‚Ø§ÙŠÙŠØ³",save_entry:"Ø­ÙØ¸",nav_log:"Ø³Ø¬Ù„",nav_waves:"Ù…ÙˆØ¬Ø§Øª",nav_ai:"Ù…Ø±ÙƒØ² AI",nav_analysis:"ØªØ­Ù„ÙŠÙ„",nav_health:"ØµØ­Ø©",nav_games:"Ø£Ù„Ø¹Ø§Ø¨",nav_dreams:"Ø£Ø­Ù„Ø§Ù…",nav_media:"ÙˆØ³Ø§Ø¦Ø·",nav_calendar:"ØªÙ‚ÙˆÙŠÙ…",nav_settings:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",saved:"ØªÙ… Ø§Ù„Ø­ÙØ¸!",cleared:"ØªÙ… Ø§Ù„Ù…Ø³Ø­"},
  ja:{daily_log:"æ—¥æ¬¡æ„è­˜ãƒ­ã‚°",entry_info:"æƒ…å ±",date:"æ—¥ä»˜",time_of_day:"æ™‚é–“å¸¯",activity:"æ´»å‹•",consciousness_metrics:"æ„è­˜æŒ‡æ¨™",save_entry:"ä¿å­˜",nav_log:"ãƒ­ã‚°",nav_waves:"æ³¢å‹•",nav_ai:"AIãƒãƒ–",nav_analysis:"åˆ†æ",nav_health:"å¥åº·",nav_games:"ã‚²ãƒ¼ãƒ ",nav_dreams:"å¤¢",nav_media:"ãƒ¡ãƒ‡ã‚£ã‚¢",nav_calendar:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼",nav_settings:"è¨­å®š",saved:"ä¿å­˜æ¸ˆã¿ï¼",cleared:"ã‚¯ãƒªã‚¢æ¸ˆã¿"},
  ru:{daily_log:"Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ¡Ğ¾Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ",entry_info:"Ğ˜Ğ½Ñ„Ğ¾",date:"Ğ”Ğ°Ñ‚Ğ°",time_of_day:"Ğ’Ñ€ĞµĞ¼Ñ",activity:"ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ",consciousness_metrics:"ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸",save_entry:"Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ",nav_log:"Ğ–ÑƒÑ€Ğ½Ğ°Ğ»",nav_waves:"Ğ’Ğ¾Ğ»Ğ½Ñ‹",nav_ai:"Ğ˜Ğ˜ Ğ¥Ğ°Ğ±",nav_analysis:"ĞĞ½Ğ°Ğ»Ğ¸Ğ·",nav_health:"Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ",nav_games:"Ğ˜Ğ³Ñ€Ñ‹",nav_dreams:"Ğ¡Ğ½Ñ‹",nav_media:"ĞœĞµĞ´Ğ¸Ğ°",nav_calendar:"ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ",nav_settings:"ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",saved:"Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!",cleared:"ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ğ¾"}
};
let curLang=localStorage.getItem('cos_lang')||'en';
function t(key){return(LANGS[curLang]||LANGS.en)[key]||LANGS.en[key]||key;}
function setLang(lang){
  curLang=lang;localStorage.setItem('cos_lang',lang);
  try{document.getElementById('langSel').value=lang;}catch(e){}
  try{document.getElementById('settingLang').value=lang;}catch(e){}
  document.querySelectorAll('[data-t]').forEach(el=>{const k=el.getAttribute('data-t');if(t(k))el.textContent=t(k);});
  buildNav();
}

// â”€â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NAV_ITEMS=[
  {id:'log',icon:'ğŸ“',key:'nav_log'},{id:'waves',icon:'ğŸµ',key:'nav_waves'},
  {id:'ai',icon:'ğŸ¤–',key:'nav_ai'},{id:'analysis',icon:'ğŸ“Š',key:'nav_analysis'},
  {id:'health',icon:'â¤ï¸',key:'nav_health'},{id:'games',icon:'ğŸ®',key:'nav_games'},
  {id:'dreams',icon:'ğŸŒ™',key:'nav_dreams'},{id:'media',icon:'ğŸ™ï¸',key:'nav_media'},
  {id:'calendar',icon:'ğŸ“…',key:'nav_calendar'},{id:'settings',icon:'âš™ï¸',key:'nav_settings'},
];
let activeTab='log';
function buildNav(){
  const nav=document.getElementById('bottomNav');if(!nav)return;
  nav.innerHTML=NAV_ITEMS.map(n=>`<button class="nav-tab${activeTab===n.id?' active':''}" onclick="switchTab('${n.id}')"><span class="ni">${n.icon}</span><span>${t(n.key)}</span></button>`).join('');
}
function switchTab(id){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  const panel=document.getElementById('tab-'+id);if(panel)panel.classList.add('active');
  activeTab=id;buildNav();
  if(id==='analysis')refreshAnalysis();
  if(id==='calendar')renderCalendar();
  if(id==='dreams')renderDreamJournal();
  if(id==='media'){renderVoiceMemos();renderMediaGrid();}
  if(id==='ai'){refreshAIInsights();loadDailyTip();}
}

// â”€â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleTheme(){
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  const next=isDark?'light':'dark';
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('cos_theme',next);
  document.getElementById('themeBtn').textContent=isDark?'ğŸŒ™':'â˜€ï¸';
  const s=document.getElementById('settingDark');if(s)s.classList.toggle('on',!isDark);
  SETTINGS_STATE.darkMode=!isDark;
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg,dur=2400){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),dur);
}

// â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(title,html){
  document.getElementById('modalTitle').textContent=title;
  document.getElementById('modalBody').innerHTML=html;
  document.getElementById('modalOverlay').classList.add('open');
}
function closeModal(e){if(e.target===document.getElementById('modalOverlay'))closeAllModals();}
function closeAllModals(){document.getElementById('modalOverlay').classList.remove('open');}

// â”€â”€â”€ SETTING HELP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SETTING_HELP={
  darkmode:{title:'ğŸŒ™ Dark Mode',text:'Switches the app to a dark color scheme. Great for night use and reduces eye strain.'},
  anchors:{title:'ğŸšï¸ Slider Anchors',text:'Shows detailed descriptions for each slider value. Instead of guessing what "7" means, you see exactly what that score feels like.'},
  notif:{title:'ğŸ”” Notifications',text:'Allows the app to send browser notifications for alarms and reminders.'},
  rc:{title:'âœ‹ Reality Check Alerts',text:'Sends reminders every 2 hours to do a reality check. Building this habit while awake makes you do it in dreams too â€” triggering lucid dreaming.'},
  promptboost:{title:'âœ¨ AI Prompt Enhancement',text:'AI automatically rewrites your questions to be more specific before processing â€” giving you better, more actionable answers.'},
};
function showSettingHelp(key){
  const info=SETTING_HELP[key]||{title:'Help',text:'Information coming soon.'};
  document.getElementById('settingHelpTitle').textContent=info.title;
  document.getElementById('settingHelpBody').innerHTML=info.text;
  document.getElementById('settingHelpOverlay').classList.add('open');
}

// â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SETTINGS_STATE={};
function loadSettings(){
  const saved=JSON.parse(localStorage.getItem('cos_settings')||'{}');
  Object.assign(SETTINGS_STATE,{anchors:true,autoAnalyze:true,convMode:true,autoTranscribe:true,darkMode:false,notif:false,dailyReminder:false,rc:false,promptBoost:false,...saved});
  ['anchors','autoAnalyze','convMode','autoTranscribe','darkMode','notif','dailyReminder','rc','promptBoost'].forEach(k=>{
    const el=document.getElementById('setting'+k.charAt(0).toUpperCase()+k.slice(1));
    if(el)el.classList.toggle('on',!!SETTINGS_STATE[k]);
  });
  if(SETTINGS_STATE.darkMode){document.documentElement.setAttribute('data-theme','dark');document.getElementById('themeBtn').textContent='â˜€ï¸';}
}
function toggleSetting(key){
  SETTINGS_STATE[key]=!SETTINGS_STATE[key];
  const el=document.getElementById('setting'+key.charAt(0).toUpperCase()+key.slice(1));
  if(el)el.classList.toggle('on',SETTINGS_STATE[key]);
  localStorage.setItem('cos_settings',JSON.stringify(SETTINGS_STATE));
}
function requestNotifPermission(){
  if(Notification.permission==='granted'){toggleSetting('notif');}
  else{Notification.requestPermission().then(p=>{if(p==='granted'){toggleSetting('notif');}else{showToast('Notifications denied');}})}
}

// â”€â”€â”€ SLIDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SLIDERS=[
  {id:'sleep',label:'ğŸ˜´ Sleep Quality',low:'No sleep',high:'Perfect sleep',anchors:['Catastrophicâ€”no sleep/terrible','Very poorâ€”barely functional','Below averageâ€”dragging','Slightly below normal','Acceptableâ€”getting by','Goodâ€”rested and okay','Very goodâ€”refreshed','Excellentâ€”woke naturally','Outstandingâ€”best in days','Perfectâ€”completely restored']},
  {id:'mood',label:'ğŸ˜Š Mood',low:'Severe distress',high:'Peak euphoria',anchors:['Severe distress or crisis','Very lowâ€”struggling to function','Lowâ€”gloomy and unmotivated','Below baselineâ€”slightly down','Neutralâ€”neither good nor bad','Okayâ€”mild positivity','Goodâ€”genuinely happy','Greatâ€”energized and upbeat','Excellentâ€”very high spirits','Euphoricâ€”peak joy and bliss']},
  {id:'physicalEnergy',label:'âš¡ Physical Energy',low:'Completely depleted',high:'Peak vitality',anchors:['Completely depletedâ€”bedridden','Barely able to do basics','Lowâ€”everything takes effort','Below normalâ€”sluggish body','Manageableâ€”routine possible','Goodâ€”normal activities easy','Highâ€”body feels strong','Very highâ€”want to exercise','Excellentâ€”athletic and vibrant','Peakâ€”limitless physical vitality']},
  {id:'mentalEnergy',label:'ğŸ§  Mental Energy',low:'Mental blackout',high:'Peak mental power',anchors:['Mental blackoutâ€”cannot think','Barely processing anything','Mental fogâ€”very slow thoughts','Below baselineâ€”sluggish thinking','Normalâ€”thinking is okay','Goodâ€”thoughts flow well','Sharpâ€”quick and clear thinking','Very sharpâ€”ideas generating fast','Excellentâ€”top cognitive function','Peakâ€”extraordinary mental clarity']},
  {id:'focus',label:'ğŸ¯ Focus',low:'Completely scattered',high:'Hyperfocus',anchors:['Completely scatteredâ€”zero attention','Barely presentâ€”mind everywhere','Poor focusâ€”constant distractions','Somewhat distracted','Moderateâ€”can focus with effort','Decent focusâ€”manageable','Goodâ€”sustained concentration','Strongâ€”deep work possible','Excellentâ€”laser-like attention','Hyperfocusâ€”complete absorption']},
  {id:'stress',label:'ğŸ˜° Stress',low:'No stress (calm)',high:'Crisis panic',anchors:['Completely calmâ€”zero stress','Barely any tensionâ€”very peaceful','Low stressâ€”minor background worry','Slightly elevatedâ€”manageable','Moderateâ€”noticeable but okay','Elevatedâ€”affecting performance','Highâ€”impacting wellbeing','Very highâ€”hard to function','Severeâ€”near breaking point','Crisisâ€”overwhelming panic']},
  {id:'creativity',label:'ğŸ¨ Creativity',low:'Completely blocked',high:'Genius inspiration',anchors:['Completely blockedâ€”no ideas','Almost no creative thought','Lowâ€”very few original ideas','Below average creativity','Some creativityâ€”standard ideas','Good creative flow','Highâ€”generating novel concepts','Excellentâ€”ideas pouring out','Outstandingâ€”highly original','Peakâ€”genius-level inspiration']},
  {id:'motivation',label:'ğŸ”¥ Motivation',low:'No drive',high:'Unstoppable',anchors:['No drive whatsoever','Almost impossible to start','Very lowâ€”major procrastination','Below normal drive','Some motivationâ€”basics done','Goodâ€”want to make progress','Highâ€”excited to work','Very highâ€”on a mission','Excellentâ€”unstoppable drive','Peakâ€”extraordinary purpose']},
  {id:'clarity',label:'ğŸ’ Mental Clarity',low:'Complete fog',high:'Crystal clear',anchors:['Complete fogâ€”cannot think straight','Extremely cloudy and confused','Very foggyâ€”slow processing','Below normal clarity','Moderateâ€”somewhat clear','Good clarityâ€”thinking straight','Clearâ€”thoughts well organized','Very clearâ€”sharp and precise','Excellentâ€”crystal clear thinking','Perfectâ€”total mental transparency']},
  {id:'flow',label:'ğŸŒŠ Flow State',low:'Not in flow',high:'Transcendent flow',anchors:['Not in flowâ€”completely distracted','Very far from flow','Mostly distractedâ€”barely present','Occasional moments of presence','Intermittent flowâ€”fleeting','Some flowâ€”partially engaged','Good flowâ€”deep engagement','Strong flowâ€”time dissolving','Excellent flowâ€”fully absorbed','Peak flowâ€”transcendent performance']},
  {id:'anxiety',label:'ğŸ˜¬ Anxiety',low:'No anxiety (calm)',high:'Extreme panic',anchors:['Zero anxietyâ€”perfectly calm','Barely anyâ€”very serene','Minimalâ€”slight background hum','Lowâ€”minor worry present','Moderateâ€”noticeable anxiety','Elevatedâ€”affecting thoughts','Highâ€”hard to stay focused','Severeâ€”physical symptoms','Very severeâ€”panic territory','Extremeâ€”full panic state']},
  {id:'stability',label:'ğŸ”ï¸ Emotional Stability',low:'Falling apart',high:'Unshakeable',anchors:['Completely unstableâ€”crisis mode','Very reactiveâ€”falling apart','Easily overwhelmed','Somewhat unstableâ€”wobbling','Moderateâ€”some up/down swings','Fairly stableâ€”generally okay','Goodâ€”mostly centered','Very stableâ€”grounded','Excellentâ€”unshakeable','Perfectâ€”absolute inner peace']},
  {id:'social',label:'ğŸ‘¥ Social Energy',low:'Social exhaustion',high:'Love connection',anchors:['Complete social exhaustion','Deeply introvertedâ€”need isolation','Very low social battery','Prefer solitude heavily','Moderateâ€”short interactions okay','Normal social energy','Goodâ€”enjoy being with others','Highâ€”energized by people','Very highâ€”thrive in groups','Peak social energy']},
  {id:'mindfulness',label:'ğŸ§˜ Mindfulness',low:'Autopilot',high:'Full presence',anchors:['Completely on autopilot','Almost no present-moment awareness','Very little mindfulness','Below average presence','Some awarenessâ€”occasional pauses','Moderate mindfulness','Goodâ€”regularly present','Strongâ€”sustained awareness','Excellentâ€”deeply present','Perfectâ€”full enlightened presence']},
  {id:'willpower',label:'ğŸ’ª Willpower',low:'Zero willpower',high:'Iron discipline',anchors:['Zero willpowerâ€”no resistance possible','Almost all impulses win','Very weakâ€”discipline failing','Below average self-control','Moderateâ€”making some choices','Good willpowerâ€”holding choices','Strongâ€”resisting temptations','Very strongâ€”high discipline','Excellentâ€”exceptional self-mastery','Absolute willpowerâ€”iron discipline']},
  {id:'intuition',label:'ğŸ”® Intuition',low:'No gut sense',high:'Psychic knowing',anchors:['No intuitive hitsâ€”fully logical','Almost no gut sense','Rarely getting intuitive signals','Weak intuitionâ€”occasional feeling','Moderateâ€”some gut feelings','Decent intuitionâ€”trusting hunches','Goodâ€”regularly accurate gut sense','Strong intuitionâ€”mostly right','Excellentâ€”highly accurate','Peakâ€”psychic-level knowing']},
  {id:'cogLoad',label:'ğŸ–¥ï¸ Cognitive Load',low:'Empty mind',high:'Overloaded',anchors:['Empty mindâ€”nothing to process','Almost no mental burden','Very light loadâ€”easy day','Lightâ€”managing comfortably','Moderateâ€”normal workday','Noticeable loadâ€”somewhat taxed','High loadâ€”brain working hard','Very highâ€”approaching limit','Overwhelmingâ€”nearly saturated','Cognitive overloadâ€”system crash']},
  {id:'resilience',label:'ğŸ›¡ï¸ Resilience',low:'Shattered by anything',high:'Thrives in chaos',anchors:['Completely shattered by anything','Falls apart very easily','Very fragileâ€”bounce back slowly','Below normal recovery','Moderateâ€”eventually recovers','Goodâ€”bouncing back okay','Strongâ€”quickly recovers','Very strongâ€”adversity makes stronger','Excellentâ€”robust and adaptive','Unbreakableâ€”thrives in chaos']},
  {id:'presence',label:'âœ¨ Presence / Vitality',low:'Absent',high:'Fully alive',anchors:['Non-existentâ€”completely absent','Barely presentâ€”going through motions','Very low vitality','Below normal aliveness','Some sense of being alive','Good presenceâ€”engaged','High vitalityâ€”feeling alive','Very highâ€”glowing with life','Excellentâ€”radiant presence','Peak vitalityâ€”fully embodied']},
  {id:'executiveFn',label:'ğŸ“‹ Executive Function',low:'Cannot plan',high:'Master-level management',anchors:['Cannot plan or organize anything','Barely able to make decisions','Very poor planning','Below normal executive control','Moderateâ€”managing basic tasks','Goodâ€”planning and executing okay','Strongâ€”effective task management','Excellentâ€”strategic and organized','Outstandingâ€”executive excellence','Peakâ€”master-level management']},
];

function buildSliders(){
  const container=document.getElementById('slidersContainer');if(!container)return;
  container.innerHTML=SLIDERS.map(s=>`
    <div class="slider-group" id="sg_${s.id}">
      <div class="slider-header">
        <span class="slider-label">${s.label}</span>
        <span class="slider-value-badge" id="val_${s.id}">5</span>
      </div>
      <input type="range" class="slider-track" id="sl_${s.id}" min="0" max="10" value="5" oninput="onSliderMove('${s.id}',this.value)" style="--pct:50%">
      <div class="slider-dots" id="dots_${s.id}">
        ${[0,1,2,3,4,5,6,7,8,9,10].map(n=>`<div class="slider-dot" id="dot_${s.id}_${n}" onclick="setSliderVal('${s.id}',${n})">${n}</div>`).join('')}
      </div>
      <div class="slider-pair-labels"><span>${s.low||''}</span><span>${s.high||''}</span></div>
      <div class="slider-anchor-text" id="anchor_${s.id}"></div>
    </div>`).join('');
  SLIDERS.forEach(s=>onSliderMove(s.id,5));
}
function onSliderMove(id,val){
  val=parseInt(val);
  const sl=document.getElementById('sl_'+id);
  if(sl){sl.value=val;sl.style.setProperty('--pct',(val/10*100)+'%');}
  const badge=document.getElementById('val_'+id);if(badge)badge.textContent=val;
  const slider=SLIDERS.find(s=>s.id===id);
  for(let i=0;i<=10;i++){
    const dot=document.getElementById('dot_'+id+'_'+i);if(!dot)continue;
    dot.classList.remove('active','near');
    if(i===val)dot.classList.add('active');
    else if(Math.abs(i-val)===1)dot.classList.add('near');
  }
  const anchor=document.getElementById('anchor_'+id);
  if(anchor&&slider){
    const idx=Math.min(val,9);
    anchor.textContent=val+' â€” '+(slider.anchors[idx]||'');
    anchor.style.display=SETTINGS_STATE.anchors?'block':'none';
  }
  updateScore();
}
function setSliderVal(id,val){const sl=document.getElementById('sl_'+id);if(sl){sl.value=val;onSliderMove(id,val);}}
function updateSimpleSlider(el){el.style.setProperty('--pct',(el.value/10*100)+'%');const v=document.getElementById(el.id+'Val');if(v)v.textContent=el.value;}
function getSliderVal(id){return parseInt(document.getElementById('sl_'+id)?.value||5);}
function updateScore(){
  const f=getSliderVal('focus'),me=getSliderVal('mentalEnergy'),pe=getSliderVal('physicalEnergy'),
        mo=getSliderVal('mood'),sl=getSliderVal('sleep'),cr=getSliderVal('creativity'),
        mt=getSliderVal('motivation'),fl=getSliderVal('flow'),cl=getSliderVal('clarity'),
        mf=getSliderVal('mindfulness'),wp=getSliderVal('willpower'),st=getSliderVal('stress'),
        rs=getSliderVal('resilience'),pr=getSliderVal('presence'),ef=getSliderVal('executiveFn');
  const raw=(f*2.5+me*2.2+pe*1.5+mo*1.8+sl*1.8+cr*1.3+mt*1.2+fl*1.5+cl*1.8+mf+wp+rs*1.2+pr+ef*1.2+(10-st)*1.5)/25;
  const score=Math.max(0,Math.min(10,raw));
  const sv=document.getElementById('scoreValue');if(sv)sv.textContent=score.toFixed(1);
  const circle=document.getElementById('scoreCircle');
  if(circle){circle.style.strokeDashoffset=213.6-(213.6*score/10);
    const hue=score<4?0:score<6?40:score<8?120:270;circle.style.stroke=`hsl(${hue},70%,50%)`;}
  return score;
}

// â”€â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveLog(){
  const score=updateScore();
  const entry={id:Date.now(),ts:new Date().toISOString(),
    date:document.getElementById('logDate')?.value||new Date().toISOString().split('T')[0],
    timeOfDay:document.getElementById('logTime')?.value,activity:document.getElementById('logActivity')?.value,
    brainwave:document.getElementById('logBrainwave')?.value,emotion:document.getElementById('logEmotion')?.value,
    sensation:document.getElementById('logSensation')?.value,thought:document.getElementById('logThought')?.value,
    insight:document.getElementById('logInsight')?.value,goal:document.getElementById('logGoal')?.value,
    obstacle:document.getElementById('logObstacle')?.value,gratitude:document.getElementById('logGratitude')?.value,
    pattern:document.getElementById('logPattern')?.value,action:document.getElementById('logAction')?.value,
    score:parseFloat(score.toFixed(2))};
  SLIDERS.forEach(s=>{entry[s.id]=getSliderVal(s.id);});
  const logs=getLogs();logs.unshift(entry);
  localStorage.setItem('cos_logs',JSON.stringify(logs));
  showToast('âœ¨ '+t('saved'));renderRecentLogs();
}
function getLogs(){return JSON.parse(localStorage.getItem('cos_logs')||'[]');}
function renderRecentLogs(){
  const el=document.getElementById('recentLogs');if(!el)return;
  const logs=getLogs().slice(0,5);
  if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ğŸ“</span><div class="es-text">No entries yet. Save your first log!</div></div>';return;}
  el.innerHTML=logs.map(e=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)">
      <div><div style="font-weight:700;font-size:13px">${e.date} <span style="font-size:10px;color:var(--text3)">${e.timeOfDay||''}</span></div>
        <div style="font-size:11px;color:var(--text3);margin-top:2px">${e.emotion||''} Â· ${e.activity||''}</div></div>
      <div style="text-align:right"><div style="font-family:Syne,sans-serif;font-weight:800;font-size:18px;color:var(--primary)">${e.score}</div><div style="font-size:10px;color:var(--text3)">score</div></div>
    </div>`).join('');
}

// â”€â”€â”€ BRAINWAVE AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let audioCtx=null,bwOscL=null,bwOscR=null,bwGain=null,bwIsPlaying=false,bwCurrentTrack=0,bwTimer=null,bwSeconds=0,bwType='binaural';
const BW_TRACKS=[
  {name:'Deep Focus',desc:'Eliminate distractions, enter deep work',freq:'40 Hz Gamma',emoji:'ğŸ¯',base:200,beat:40},
  {name:'Study Mode',desc:'Enhanced memory and learning',freq:'14 Hz Beta',emoji:'ğŸ“š',base:200,beat:14},
  {name:'Creative Flow',desc:'Unlock imagination and innovation',freq:'10 Hz Alpha',emoji:'ğŸ¨',base:200,beat:10},
  {name:'Deep Sleep',desc:'Fall asleep faster, sleep deeper',freq:'3 Hz Delta',emoji:'ğŸ˜´',base:150,beat:3},
  {name:'Meditation',desc:'Calm mind, expanded awareness',freq:'7 Hz Theta',emoji:'ğŸ§˜',base:200,beat:7},
  {name:'Stress Relief',desc:'Melt away anxiety and tension',freq:'8 Hz Alpha',emoji:'ğŸŒŠ',base:180,beat:8},
  {name:'Memory Boost',desc:'Strengthen recall and retention',freq:'12 Hz Beta',emoji:'ğŸ”®',base:200,beat:12},
  {name:'Mood Lift',desc:'Elevate emotional state naturally',freq:'10 Hz Alpha',emoji:'â˜€ï¸',base:220,beat:10},
  {name:'Brain Sync',desc:'Balance left and right hemispheres',freq:'20 Hz Beta',emoji:'ğŸ”—',base:200,beat:20},
  {name:'Super Learning',desc:'Optimal state for absorbing information',freq:'40 Hz Gamma',emoji:'âš¡',base:210,beat:40},
  {name:'Lucid Dreams',desc:'Enhanced dream awareness and control',freq:'5 Hz Theta',emoji:'ğŸŒ™',base:180,beat:5},
  {name:'Energy Boost',desc:'Natural mental and physical energy',freq:'30 Hz Beta',emoji:'ğŸ”‹',base:200,beat:30},
];
function buildBWGrid(){
  const grid=document.getElementById('bwGrid');if(!grid)return;
  grid.innerHTML=BW_TRACKS.map((tr,i)=>`<div class="bw-card" id="bwCard_${i}" onclick="selectBWTrack(${i})"><span class="bw-emoji">${tr.emoji}</span><div class="bw-name">${tr.name}</div><div class="bw-desc">${tr.desc}</div><div class="bw-freq">${tr.freq}</div></div>`).join('');
  buildBWEducation();
}
function selectBWTrack(i){
  bwCurrentTrack=i;document.querySelectorAll('.bw-card').forEach((c,j)=>c.classList.toggle('playing',j===i));
  const tr=BW_TRACKS[i];
  document.getElementById('bwNowName').textContent=tr.name;
  document.getElementById('bwNowDesc').textContent=tr.desc;
  document.getElementById('bwNowFreq').textContent=tr.freq;
  if(bwIsPlaying)startBW();
}
function toggleBW(){if(bwIsPlaying)stopBW();else startBW();}
function startBW(){
  stopBW();
  try{
    audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    const tr=BW_TRACKS[bwCurrentTrack];
    const vol=parseInt(document.getElementById('bwVol').value)/100;
    if(bwType==='binaural'){
      const merger=audioCtx.createChannelMerger(2);
      bwGain=audioCtx.createGain();bwGain.gain.value=vol*0.3;
      bwOscL=audioCtx.createOscillator();bwOscL.frequency.value=tr.base;bwOscL.type='sine';
      bwOscR=audioCtx.createOscillator();bwOscR.frequency.value=tr.base+tr.beat;bwOscR.type='sine';
      const gL=audioCtx.createGain(),gR=audioCtx.createGain();
      bwOscL.connect(gL);bwOscR.connect(gR);gL.connect(merger,0,0);gR.connect(merger,0,1);
      merger.connect(bwGain);bwGain.connect(audioCtx.destination);
      bwOscL.start();bwOscR.start();
    }else if(bwType==='whitenoise'){
      const bufSize=audioCtx.sampleRate*2;const buf=audioCtx.createBuffer(1,bufSize,audioCtx.sampleRate);
      const data=buf.getChannelData(0);for(let i=0;i<bufSize;i++)data[i]=(Math.random()*2-1)*0.3;
      const src=audioCtx.createBufferSource();src.buffer=buf;src.loop=true;
      bwGain=audioCtx.createGain();bwGain.gain.value=vol*0.3;src.connect(bwGain);bwGain.connect(audioCtx.destination);src.start();bwOscL=src;
    }else{
      bwGain=audioCtx.createGain();bwGain.gain.value=vol*0.25;
      bwOscL=audioCtx.createOscillator();bwOscL.frequency.value=528;bwOscL.type='sine';
      bwOscL.connect(bwGain);bwGain.connect(audioCtx.destination);bwOscL.start();
    }
    bwIsPlaying=true;document.getElementById('bwPlayBtn').textContent='â¸ Pause';
    buildBWVisualizer();bwSeconds=0;clearInterval(bwTimer);
    bwTimer=setInterval(()=>{bwSeconds++;const m=Math.floor(bwSeconds/60),s=bwSeconds%60;document.getElementById('bwTimer').textContent=(m<10?'0':'')+m+':'+(s<10?'0':'')+s;},1000);
  }catch(e){showToast('Audio requires interaction or unsupported browser');}
}
function stopBW(){
  if(bwOscL)try{bwOscL.stop&&bwOscL.stop();}catch(e){}
  if(bwOscR)try{bwOscR.stop&&bwOscR.stop();}catch(e){}
  if(audioCtx)try{audioCtx.close();}catch(e){}
  bwOscL=bwOscR=bwGain=audioCtx=null;bwIsPlaying=false;
  document.getElementById('bwPlayBtn').textContent='â–¶ Play';clearInterval(bwTimer);resetBWVisualizer();
}
function setBWVol(v){if(bwGain)bwGain.gain.value=v/100*0.3;}
function setBWType(type,btn){bwType=type;document.querySelectorAll('.wave-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(bwIsPlaying)startBW();}
function bwNextTrack(){selectBWTrack((bwCurrentTrack+1)%BW_TRACKS.length);if(bwIsPlaying)startBW();}
function bwPrevTrack(){selectBWTrack((bwCurrentTrack-1+BW_TRACKS.length)%BW_TRACKS.length);if(bwIsPlaying)startBW();}
function buildBWVisualizer(){
  document.getElementById('bwVisualizer').innerHTML=Array.from({length:24},(_,i)=>`<div class="bw-bar animating" style="height:50px;--dur:${0.3+Math.random()*0.5}s;animation-delay:${i*0.03}s"></div>`).join('');
}
function resetBWVisualizer(){document.getElementById('bwVisualizer').innerHTML='<div style="color:var(--text3);font-size:12px">â–¶ Press Play to begin</div>';}
function buildBWEducation(){
  const el=document.getElementById('bwEducation');if(!el)return;
  const waves=[{name:'Delta (0.5â€“4 Hz)',emoji:'ğŸ˜´',desc:'Deep sleep and healing. Body repairs itself. Dreamless sleep.'},{name:'Theta (4â€“8 Hz)',emoji:'ğŸŒ€',desc:'Drowsiness, creativity, REM sleep, lucid dreaming, deep meditation.'},{name:'Alpha (8â€“14 Hz)',emoji:'ğŸ˜Œ',desc:'Relaxed focus, light meditation, calm alertness. Bridge between conscious and subconscious.'},{name:'Beta (14â€“30 Hz)',emoji:'ğŸ’¡',desc:'Active thinking, focus, problem solving, normal waking consciousness.'},{name:'Gamma (30â€“100 Hz)',emoji:'âš¡',desc:'Peak cognition, insight, high-level information processing.'}];
  el.innerHTML=waves.map(w=>`<div style="display:flex;gap:10px;padding:10px 0;border-bottom:1px solid var(--border)"><span style="font-size:24px">${w.emoji}</span><div><div style="font-weight:700;font-size:13px">${w.name}</div><div style="font-size:12px;color:var(--text2);margin-top:3px">${w.desc}</div></div></div>`).join('');
}

// â”€â”€â”€ AI HUB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AI_MODELS=[
  {id:'twin',name:'Your Twin',emoji:'ğŸ§ ',persona:'You are the user\'s AI Digital Twin. You have deeply analyzed their consciousness data and know their patterns. Be warm, insightful, and deeply personal.'},
  {id:'coach',name:'Mind Coach',emoji:'ğŸ†',persona:'You are an elite performance coach and neuroscientist. Give direct, actionable advice for peak mental performance.'},
  {id:'sage',name:'Sage',emoji:'ğŸ”®',persona:'You are a wise sage combining ancient wisdom with modern psychology. Use metaphors and philosophical insights.'},
  {id:'doctor',name:'Dr. Mind',emoji:'ğŸ‘¨â€âš•ï¸',persona:'You are a cognitive neuroscientist. Analyze mental health patterns objectively. Be clinical but empathetic.'},
  {id:'friend',name:'Friend',emoji:'ğŸ˜Š',persona:'You are a supportive best friend who is very smart. Be casual, encouraging, real. Use simple language. Care deeply.'},
];
let curAIModel='twin',chatHistory=[];
const SUGGESTED_QS=['How\'s my mental performance trending?','What\'s my best time of day?','How do I enter flow state?','What patterns do you see in my stress?','Why does my creativity spike sometimes?','How is my sleep affecting my focus?','What habits should I build?','Am I improving over time?','How\'s my day going today?','What should I focus on right now?','What\'s blocking my peak performance?','Predict my energy tomorrow','Am I close to burnout?','Give me a personal insight','What do my dreams reveal?','How\'s my emotional stability?'];
const DAILY_TIPS=['Start with your hardest task when your brain is in Beta state â€” usually 2-4 hours after waking.','Gamma brainwaves peak during moments of insight. Try a 20-minute Alpha meditation before creative work.','The brain consolidates memories during NREM sleep. 7-9 hours is optimal for learning retention.','Stress below 3 is optimal for creativity. Above 7 shrinks the hippocampus over time.','Dopamine is triggered by achieving small goals. Break large tasks into wins every 25 minutes.','Walking 10 minutes increases BDNF (brain fertilizer) and improves mood and focus for 2-3 hours.','Gratitude practice activates the prefrontal cortex and reduces amygdala reactivity.','Your HRV (heart rate variability) reflects nervous system health. High HRV = high resilience.','Dehydration of just 2% impairs cognitive performance by up to 20%. Keep drinking water!','Flow state is 3-5% more activated than your normal baseline. Track when you enter it most.'];
function buildAIModelsBar(){
  const bar=document.getElementById('aiModelsBar');if(!bar)return;
  bar.innerHTML=AI_MODELS.map(m=>`<div class="ai-model-btn${m.id===curAIModel?' active':''}" onclick="selectAIModel('${m.id}')"><span class="ai-logo">${m.emoji}</span><span class="ai-name">${m.name}</span></div>`).join('');
}
function selectAIModel(id){
  curAIModel=id;document.querySelectorAll('.ai-model-btn').forEach((b,i)=>b.classList.toggle('active',AI_MODELS[i].id===id));
  const m=AI_MODELS.find(m=>m.id===id);
  addChatMsg('ai',`Switched to ${m.name} mode. ${m.id==='friend'?'Hey! What\'s up? ğŸ˜Š':m.id==='sage'?'Seek and you shall find. What wisdom do you seek?':'How can I help you today?'}`,id);
}
function loadDailyTip(){const el=document.getElementById('aiDailyTip');if(el)el.textContent=DAILY_TIPS[new Date().getDate()%DAILY_TIPS.length];}
function buildSuggestedQs(){
  const el=document.getElementById('suggestedQs');if(!el)return;
  const shuffled=[...SUGGESTED_QS].sort(()=>Math.random()-.5).slice(0,6);
  el.innerHTML=shuffled.map(q=>`<button class="sq-btn" onclick="askSuggested('${q.replace(/'/g,"\\'")}')">${q}</button>`).join('');
}
function askSuggested(q){document.getElementById('chatInput').value=q;sendChat();}
function addChatMsg(role,text,modelId){
  const msgs=document.getElementById('chatMessages');if(!msgs)return;
  const model=AI_MODELS.find(m=>m.id===(modelId||curAIModel));
  const div=document.createElement('div');div.className='chat-msg '+role;
  if(role==='ai')div.innerHTML=`<div class="ai-tag">${model?model.emoji+' '+model.name:'AI'}</div>${text}`;
  else div.textContent=text;
  msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;
  chatHistory.push({role,content:text,model:modelId||curAIModel});
}
function clearAIChat(){chatHistory=[];document.getElementById('chatMessages').innerHTML='';showToast('Chat cleared');}
function exportChat(){
  const text=chatHistory.map(m=>`[${m.role.toUpperCase()}]: ${m.content}`).join('\n\n');
  const blob=new Blob([text],{type:'text/plain'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='consciousness_chat.txt';a.click();
}
function handleChatKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat();}}
async function sendChat(){
  const input=document.getElementById('chatInput');
  let msg=input.value.trim();if(!msg)return;
  input.value='';addChatMsg('user',msg);
  const model=AI_MODELS.find(m=>m.id===curAIModel);
  const msgs=document.getElementById('chatMessages');
  const loadDiv=document.createElement('div');loadDiv.className='chat-msg ai';
  loadDiv.innerHTML=`<div class="ai-tag">${model.emoji} ${model.name}</div><div class="ai-loading"><span></span><span></span><span></span></div>`;
  msgs.appendChild(loadDiv);msgs.scrollTop=msgs.scrollHeight;
  const logs=getLogs().slice(0,20);const dreams=getDreams().slice(0,5);
  const ctx=[model.persona];
  if(logs.length){
    const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);
    ctx.push(`USER DATA (${logs.length} entries): mood:${avg('mood')} focus:${avg('focus')} energy:${avg('physicalEnergy')} stress:${avg('stress')} creativity:${avg('creativity')} flow:${avg('flow')} sleep:${avg('sleep')}\nLatest: score=${logs[0].score} emotion=${logs[0].emotion} thoughts="${(logs[0].thought||'').slice(0,100)}"`);
  }
  if(dreams.length)ctx.push(`Recent dreams: ${dreams.map(d=>d.title+' ('+d.type+',lucidity:'+d.lucidity+')').join(', ')}`);
  ctx.push('Keep response concise (under 150 words). Be genuine and personal.');
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:600,system:ctx.join('\n\n'),
        messages:[...chatHistory.filter(m=>m.role==='user'||m.role==='ai').slice(-8).map(m=>({role:m.role==='ai'?'assistant':m.role,content:m.content})),{role:'user',content:msg}]})
    });
    const data=await resp.json();
    loadDiv.remove();
    addChatMsg('ai',data.content?.[0]?.text||'Let me analyze more of your data to give better insights!');
  }catch(e){loadDiv.remove();addChatMsg('ai',localAIResponse(msg));}
  buildSuggestedQs();
}
function localAIResponse(msg){
  const logs=getLogs();if(!logs.length)return "I need your consciousness data first! Fill out your Daily Log to get personalized insights.";
  const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);
  const lower=msg.toLowerCase();
  if(lower.includes('mood'))return `Your avg mood is ${avg('mood')}/10. ${parseFloat(avg('mood'))>6?'Great foundation! Keep doing what works.':'Morning sunlight, exercise, and gratitude journaling can lift it significantly.'}`;
  if(lower.includes('focus'))return `Focus avg: ${avg('focus')}/10. ${parseFloat(avg('focus'))>6?'Strong concentration!':'Try 25-min Pomodoros and no-phone zones during deep work.'}`;
  if(lower.includes('stress'))return `Stress avg: ${avg('stress')}/10. ${parseFloat(avg('stress'))>6?'High! Try 4-7-8 breathing and daily walks.':'Well managed â€” this is your superpower.'}`;
  return `From your ${logs.length} entries: Best area is ${getBestDim(logs)}, growth opportunity is ${getWeakDim(logs)}. Keep logging daily for deeper patterns!`;
}
function getBestDim(logs){const dims=['mood','focus','physicalEnergy','creativity','flow'];let b=dims[0],bv=0;dims.forEach(d=>{const a=logs.reduce((s,e)=>s+(e[d]||0),0)/logs.length;if(a>bv){bv=a;b=d;}});return b+'('+bv.toFixed(1)+')';}
function getWeakDim(logs){const dims=['mood','focus','physicalEnergy','creativity','flow'];let w=dims[0],wv=10;dims.forEach(d=>{const a=logs.reduce((s,e)=>s+(e[d]||0),0)/logs.length;if(a<wv){wv=a;w=d;}});return w+'('+wv.toFixed(1)+')';}
function refreshAIInsights(){
  const el=document.getElementById('aiPatternDisplay');if(!el)return;
  const logs=getLogs();
  if(logs.length<3){el.innerHTML='<div style="font-size:13px;color:var(--text2)">Log at least 3 entries to see pattern analysis.</div>';return;}
  const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);
  const recent=logs.slice(0,7),prev=logs.slice(7,14);
  const trend=key=>{if(!prev.length)return 'â¡ï¸';const d=recent.reduce((s,e)=>s+(e[key]||0),0)/recent.length-prev.reduce((s,e)=>s+(e[key]||0),0)/prev.length;return d>0.5?'ğŸ“ˆ':d<-0.5?'ğŸ“‰':'â¡ï¸';};
  el.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px">
    ${['mood','focus','stress','creativity','sleep','flow'].map(k=>`<div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center"><div style="font-size:18px;font-weight:800;color:var(--primary)">${avg(k)}</div><div style="font-size:10px;color:var(--text3)">${k} ${trend(k)}</div></div>`).join('')}
  </div>
  <div style="margin-top:10px;font-size:13px;color:var(--text2);background:var(--bg3);border-radius:10px;padding:10px">ğŸ’¡ <strong>AI Insight:</strong> Based on ${logs.length} entries, strongest: ${getBestDim(logs)}, growth opportunity: ${getWeakDim(logs)}.</div>`;
}

// â”€â”€â”€ ANALYSIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function refreshAnalysis(){
  const logs=getLogs();
  const avg=key=>logs.length?(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1):'â€”';
  document.getElementById('statMood').textContent=avg('mood');
  document.getElementById('statFocus').textContent=avg('focus');
  document.getElementById('statScore').textContent=avg('score');
  document.getElementById('statFlow').textContent=avg('flow');
  document.getElementById('statCreativity').textContent=avg('creativity');
  document.getElementById('statEntries').textContent=logs.length;
  buildPredictions(logs);buildTrends(logs);buildRecords(logs);buildPatterns(logs);
}
function buildPredictions(logs){
  const el=document.getElementById('predictionsArea');
  if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ğŸ”®</span><div class="es-text">Log 7+ entries to unlock predictions</div></div>';return;}
  const recent=logs.slice(0,7);const ar=key=>recent.reduce((s,e)=>s+(e[key]||0),0)/recent.length;
  const moodTrend=logs.length>1?logs[0].mood-logs[1].mood:0;
  el.innerHTML=`<div class="form-row">
    <div class="comparison-box"><div class="cv" style="color:var(--success)">${Math.min(10,Math.max(0,ar('focus')+moodTrend*0.5)).toFixed(1)}</div><div class="cl">Tomorrow's Focus</div></div>
    <div class="comparison-box"><div class="cv" style="color:var(--primary)">${Math.min(10,Math.max(0,ar('score')+moodTrend*0.3)).toFixed(1)}</div><div class="cl">Tomorrow's Score</div></div>
  </div>
  <div style="font-size:12px;color:var(--text2);background:var(--bg3);border-radius:10px;padding:10px">
    ${moodTrend>0.5?'âœ… Mood is rising â€” expect better performance tomorrow!':moodTrend<-0.5?'âš ï¸ Mood is dipping â€” focus on recovery tonight.':'ğŸ“Š Stable trajectory. Maintain your routines.'}
  </div>`;
}
function buildTrends(logs){
  const el=document.getElementById('trendsArea');
  if(logs.length<5){el.innerHTML='<div style="font-size:13px;color:var(--text3)">Need 10+ entries for trend analysis.</div>';return;}
  const r=logs.slice(0,Math.min(10,logs.length)),p=logs.slice(10,20);
  ['mood','focus','stress','creativity','flow','sleep','motivation','clarity'].forEach(k=>{
    const ra=r.reduce((s,e)=>s+(e[k]||0),0)/r.length;const pa=p.length?p.reduce((s,e)=>s+(e[k]||0),0)/p.length:ra;
    const d=(ra-pa).toFixed(1);const icon=parseFloat(d)>0.3?'ğŸ“ˆ +':parseFloat(d)<-0.3?'ğŸ“‰ ':'â¡ï¸ ';
    const color=parseFloat(d)>0.3?'var(--success)':parseFloat(d)<-0.3?'var(--danger)':'var(--text3)';
    el.innerHTML+='';
  });
  el.innerHTML=['mood','focus','stress','creativity','flow','sleep','motivation','clarity'].map(k=>{
    const ra=r.reduce((s,e)=>s+(e[k]||0),0)/r.length;const pa=p.length?p.reduce((s,e)=>s+(e[k]||0),0)/p.length:ra;
    const d=(ra-pa).toFixed(1);const icon=parseFloat(d)>0.3?'ğŸ“ˆ +':parseFloat(d)<-0.3?'ğŸ“‰ ':'â¡ï¸ ';
    const color=parseFloat(d)>0.3?'var(--success)':parseFloat(d)<-0.3?'var(--danger)':'var(--text3)';
    return `<div class="trend-item"><span>${k}</span><span style="color:${color};font-weight:700">${icon}${Math.abs(d)}</span></div>`;
  }).join('');
}
function buildRecords(logs){
  const el=document.getElementById('recordsArea');if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ğŸ†</span><div class="es-text">Start logging to track records</div></div>';return;}
  const max=key=>logs.reduce((m,e)=>Math.max(m,e[key]||0),0);
  el.innerHTML=`<div class="stats-grid"><div class="stat-box"><div class="sv">${max('score').toFixed(1)}</div><div class="sl">Best Score</div></div><div class="stat-box"><div class="sv">${max('focus')}</div><div class="sl">Peak Focus</div></div><div class="stat-box"><div class="sv">${max('flow')}</div><div class="sl">Peak Flow</div></div><div class="stat-box"><div class="sv">${max('creativity')}</div><div class="sl">Peak Creativity</div></div><div class="stat-box"><div class="sv">${max('mood')}</div><div class="sl">Best Mood</div></div><div class="stat-box"><div class="sv">${max('sleep')}</div><div class="sl">Best Sleep</div></div></div>`;
}
function buildPatterns(logs){
  const el=document.getElementById('patternsArea');
  if(logs.length<5){el.innerHTML='<div class="empty-state"><span class="es-icon">ğŸ§©</span><div class="es-text">Log 5+ entries to detect patterns</div></div>';return;}
  const emotions={};logs.forEach(e=>{if(e.emotion)emotions[e.emotion]=(emotions[e.emotion]||0)+1;});
  const top=Object.entries(emotions).sort((a,b)=>b[1]-a[1]).slice(0,6);
  el.innerHTML=`<div style="margin-bottom:10px"><div style="font-weight:700;font-size:13px;margin-bottom:6px">Dominant Emotions:</div>${top.map(([em,n])=>`<span class="chip">${em} Ã—${n}</span>`).join('')}</div>`;
}

// â”€â”€â”€ HEALTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HEALTH_SECTIONS=[
  {name:'Demographics',icon:'ğŸ‘¤',fields:[{type:'text',id:'hAge',label:'Age'},{type:'radio',id:'hSex',label:'Biological Sex',options:['Male','Female','Intersex','Prefer not to say']},{type:'height',id:'hHeight',label:'Height'},{type:'weight',id:'hWeight',label:'Weight'},{type:'text',id:'hWaist',label:'Waist (cm)'},{type:'select',id:'hOccupation',label:'Occupation Type',options:['Sedentary (desk work)','Light activity','Moderate activity','Active (physical labor)','Very active (athlete/trainer)']},{type:'select',id:'hEnvironment',label:'Environment',options:['Urban','Suburban','Rural','Remote']}]},
  {name:'Medical History',icon:'ğŸ¥',fields:[{type:'checkbox',id:'hConditions',label:'Existing Conditions',options:['Diabetes','Hypertension','Heart Disease','Asthma','Thyroid','Arthritis','Depression','Anxiety','ADHD','None']},{type:'textarea',id:'hMeds',label:'Current Medications / Supplements'},{type:'radio',id:'hHosp',label:'Hospitalized in last 2 years?',options:['Yes','No']},{type:'textarea',id:'hAllergies',label:'Known Allergies'}]},
  {name:'Family History',icon:'ğŸ§¬',fields:[{type:'checkbox',id:'hFamily',label:'Family History of:',options:['Heart Disease','Diabetes','Cancer','Stroke','Alzheimer\'s','Mental Illness','Autoimmune','Longevity (90+ years)','None']}]},
  {name:'Diet & Nutrition',icon:'ğŸ¥—',fields:[{type:'select',id:'hMeals',label:'Meals per day',options:['1','2','3','4','5+','Intermittent Fasting']},{type:'select',id:'hDiet',label:'Dietary Pattern',options:['Omnivore','Vegetarian','Vegan','Keto','Paleo','Mediterranean','Carnivore','Other']},{type:'select',id:'hWater',label:'Daily Water',options:['<1L','1-2L','2-3L','3-4L','>4L']},{type:'select',id:'hProcessed',label:'Processed Food',options:['Never','Rarely','Sometimes','Often','Daily']},{type:'textarea',id:'hIntolerances',label:'Food Intolerances'}]},
  {name:'Substance Use',icon:'â˜•',fields:[{type:'radio',id:'hSmoking',label:'Smoking',options:['Never','Former','Current']},{type:'select',id:'hAlcohol',label:'Alcohol',options:['Never','Rarely','1-3/week','4-7/week','Daily','Heavy (>14/week)']},{type:'select',id:'hCaffeine',label:'Caffeine',options:['None','1 cup/day','2-3 cups/day','4+ cups/day']}]},
  {name:'Physical Activity',icon:'ğŸƒ',fields:[{type:'select',id:'hExerciseFreq',label:'Exercise Frequency',options:['Never','1-2x/week','3-4x/week','5-6x/week','Daily','Twice daily']},{type:'checkbox',id:'hExTypes',label:'Exercise Types',options:['Cardio','Strength','Yoga','Martial Arts','Swimming','Cycling','Running','Walking']},{type:'number',id:'hSteps',label:'Avg Daily Steps'},{type:'number',id:'hHR',label:'Resting Heart Rate (bpm)'},{type:'number',id:'hVO2',label:'VO2 Max (if known)'}]},
  {name:'Sleep Health',icon:'ğŸ˜´',fields:[{type:'select',id:'hSleepDur',label:'Average Sleep Duration',options:['<5h','5-6h','6-7h','7-8h','8-9h','>9h']},{type:'time',id:'hBedtime',label:'Usual Bedtime'},{type:'time',id:'hWakeTime',label:'Usual Wake Time'},{type:'checkbox',id:'hSleepIssues',label:'Sleep Issues',options:['Insomnia','Sleep Apnea','Snoring','Restless Legs','Night Sweats','Sleepwalking','None']}]},
  {name:'Mental Health',icon:'ğŸ§ ',fields:[{type:'select',id:'hMoodBaseline',label:'Mood Baseline',options:['Very low','Low','Neutral','Good','Excellent']},{type:'select',id:'hAnxiety',label:'Anxiety Level',options:['None','Mild','Moderate','Severe']},{type:'radio',id:'hDepression',label:'History of Depression?',options:['Yes (current)','Yes (past)','No']},{type:'radio',id:'hADHD',label:'ADHD?',options:['Yes','No','Suspected']},{type:'select',id:'hBurnout',label:'Current Burnout',options:['None','Mild','Moderate','Severe']},{type:'select',id:'hLifeSat',label:'Life Satisfaction',options:['Very unsatisfied','Unsatisfied','Neutral','Satisfied','Very satisfied']}]},
  {name:'Hormonal Health',icon:'âš—ï¸',fields:[{type:'select',id:'hEnergyPatt',label:'Daily Energy Pattern',options:['Morning person','Evening person','Consistent','Variable']},{type:'select',id:'hLibido',label:'Libido',options:['Very low','Low','Normal','High']},{type:'radio',id:'hThyroid',label:'Thyroid issues?',options:['Yes','No','Unknown']}]},
  {name:'Cardiometabolic',icon:'â¤ï¸',fields:[{type:'text',id:'hBP',label:'Blood Pressure (e.g. 120/80)'},{type:'text',id:'hHbA1c',label:'HbA1c % (if known)'},{type:'select',id:'hCholesterol',label:'Cholesterol',options:['Optimal','Borderline','High','Unknown']},{type:'checkbox',id:'hHeartSymp',label:'Heart Symptoms',options:['Chest pain','Palpitations','Shortness of breath','Swollen ankles','None']}]},
  {name:'Digestive Health',icon:'ğŸ«',fields:[{type:'select',id:'hDigestion',label:'General Digestion',options:['Excellent','Good','Fair','Poor']},{type:'checkbox',id:'hGutIssues',label:'Gut Issues',options:['Bloating','Gas','Acid Reflux','IBS','IBD','Constipation','Diarrhea','None']},{type:'select',id:'hBowel',label:'Bowel Frequency',options:['Multiple/day','Once/day','Every 2-3 days','Less frequent']}]},
  {name:'Immune & Inflammation',icon:'ğŸ›¡ï¸',fields:[{type:'select',id:'hImmune',label:'How often sick?',options:['Rarely (<1/year)','Occasionally (1-2/year)','Sometimes (3-4/year)','Frequently (>4/year)']},{type:'checkbox',id:'hInflam',label:'Inflammation Signs',options:['Joint Pain','Skin Issues','Chronic Fatigue','Brain Fog','Autoimmune','None']}]},
  {name:'Neurology & Pain',icon:'âš¡',fields:[{type:'select',id:'hHeadaches',label:'Headaches',options:['Never','Rarely','Monthly','Weekly','Daily']},{type:'checkbox',id:'hNeuro',label:'Neurological',options:['Dizziness','Memory Issues','Neuropathy','Vision Problems','None']},{type:'select',id:'hPain',label:'Chronic Pain',options:['None','Mild (1-3)','Moderate (4-6)','Severe (7-10)']}]},
  {name:'Environment',icon:'ğŸŒ',fields:[{type:'select',id:'hAirQ',label:'Air Quality',options:['Excellent','Good','Moderate','Poor']},{type:'select',id:'hScreenTime',label:'Daily Screen Time',options:['<2h','2-4h','4-6h','6-8h','>8h']},{type:'checkbox',id:'hEnvExp',label:'Exposures',options:['Traffic Pollution','Chemical Exposure','Noise Pollution','Poor Ergonomics','Excessive Blue Light','None']}]},
  {name:'Preventive Health',icon:'ğŸ”¬',fields:[{type:'select',id:'hBloodTest',label:'Last Blood Work',options:['Within 6 months','6-12 months ago','1-2 years ago','2+ years ago','Never']},{type:'select',id:'hDental',label:'Last Dental Checkup',options:['Within 6 months','6-12 months','1-2 years','2+ years','Never']},{type:'text',id:'hBioAge',label:'Biological Age Test Result (if done)'}]},
  {name:'Functional Capacity',icon:'ğŸ‹ï¸',fields:[{type:'select',id:'hStairs',label:'Climb 3 flights easily?',options:['Easily','Yes with effort','With difficulty','No']},{type:'select',id:'hBalance',label:'Balance',options:['Excellent','Good','Fair','Poor']},{type:'select',id:'hEnergyDay',label:'Energy throughout day',options:['Consistent','Morning peaks','Afternoon crashes','Evening peaks','Very variable']}]},
  {name:'Longevity Markers',icon:'â³',fields:[{type:'text',id:'hEpigenetic',label:'Epigenetic Clock Result (if known)'},{type:'text',id:'hHormones',label:'Hormone Panel (if known)'},{type:'select',id:'hGrip',label:'Grip Strength',options:['Very strong','Strong','Average','Weak']}]},
  {name:'Health Goals',icon:'ğŸ¯',fields:[{type:'checkbox',id:'hGoals',label:'My Health Priorities',options:['Longevity','Peak Performance','Mental Health','Weight Management','Disease Prevention','Energy & Vitality','Better Sleep','Strength & Fitness','Stress Reduction']},{type:'textarea',id:'hMainConcern',label:'Main Health Concern'},{type:'textarea',id:'hHealthNotes',label:'Anything else?'}]},
];
let hsCurrent=0;
function buildHealthSections(){
  const jumpBar=document.getElementById('healthJumpBar');const container=document.getElementById('healthSectionsContainer');
  if(!jumpBar||!container)return;
  jumpBar.innerHTML=HEALTH_SECTIONS.map((s,i)=>`<button class="section-jump${i===0?' active':''}" onclick="jumpToSection(${i})" title="${s.name}">${s.icon} ${i+1}</button>`).join('');
  container.innerHTML=HEALTH_SECTIONS.map((s,i)=>`<div class="health-section card${i===0?' active':''}" id="hSection_${i}"><div class="card-title"><span class="emoji">${s.icon}</span> ${s.name}</div>${buildHFields(s.fields)}</div>`).join('');
}
function buildHFields(fields){
  return fields.map(f=>{
    if(f.type==='height')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:6px;align-items:center"><input type="number" class="form-input" id="${f.id}_cm" placeholder="cm" style="flex:1" oninput="syncH('cm')"><span style="font-size:12px;color:var(--text3)">cm</span><input type="number" class="form-input" id="${f.id}_ft" placeholder="ft" style="flex:.7" oninput="syncH('ft')"><span style="font-size:12px;color:var(--text3)">ft</span><input type="number" class="form-input" id="${f.id}_in" placeholder="in" style="flex:.7" oninput="syncH('ft')"><span style="font-size:12px;color:var(--text3)">in</span></div></div>`;
    if(f.type==='weight')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:6px;align-items:center"><input type="number" class="form-input" id="${f.id}_kg" placeholder="kg" style="flex:1" oninput="syncW('kg')"><span style="font-size:12px;color:var(--text3)">kg</span><input type="number" class="form-input" id="${f.id}_lb" placeholder="lbs" style="flex:1" oninput="syncW('lb')"><span style="font-size:12px;color:var(--text3)">lbs</span></div></div>`;
    if(f.type==='radio')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:8px;flex-wrap:wrap">${f.options.map(o=>`<label style="display:flex;align-items:center;gap:4px;font-size:13px;cursor:pointer"><input type="radio" name="${f.id}" value="${o}"> ${o}</label>`).join('')}</div></div>`;
    if(f.type==='checkbox')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:6px;flex-wrap:wrap">${f.options.map(o=>`<label style="display:flex;align-items:center;gap:4px;font-size:12px;cursor:pointer;background:var(--bg);border:1px solid var(--border);padding:4px 8px;border-radius:8px"><input type="checkbox" name="${f.id}" value="${o}"> ${o}</label>`).join('')}</div></div>`;
    if(f.type==='textarea')return `<div class="form-group"><label class="form-label">${f.label}</label><textarea class="form-textarea" id="${f.id}" style="min-height:60px"></textarea></div>`;
    if(f.type==='select')return `<div class="form-group"><label class="form-label">${f.label}</label><select class="form-select" id="${f.id}">${f.options.map(o=>`<option>${o}</option>`).join('')}</select></div>`;
    return `<div class="form-group"><label class="form-label">${f.label}</label><input type="${f.type||'text'}" class="form-input" id="${f.id}"></div>`;
  }).join('');
}
function syncH(from){
  const cm=parseFloat(document.getElementById('hHeight_cm')?.value)||0;const ft=parseFloat(document.getElementById('hHeight_ft')?.value)||0;const inc=parseFloat(document.getElementById('hHeight_in')?.value)||0;
  if(from==='cm'&&cm){const totalIn=cm/2.54;document.getElementById('hHeight_ft').value=Math.floor(totalIn/12);document.getElementById('hHeight_in').value=Math.round(totalIn%12);}
  else if(from==='ft'){const totalCm=(ft*12+inc)*2.54;if(document.getElementById('hHeight_cm'))document.getElementById('hHeight_cm').value=Math.round(totalCm);}
}
function syncW(from){
  const kg=parseFloat(document.getElementById('hWeight_kg')?.value)||0;const lb=parseFloat(document.getElementById('hWeight_lb')?.value)||0;
  if(from==='kg'&&kg)document.getElementById('hWeight_lb').value=(kg*2.20462).toFixed(1);
  else if(from==='lb'&&lb)document.getElementById('hWeight_kg').value=(lb/2.20462).toFixed(1);
}
function jumpToSection(i){
  document.querySelectorAll('.health-section').forEach((s,j)=>s.classList.toggle('active',j===i));
  document.querySelectorAll('.section-jump').forEach((b,j)=>b.classList.toggle('active',j===i));
  hsCurrent=i;
  document.getElementById('hsCurrent').textContent=i+1;
  document.getElementById('hsSectionName').textContent=HEALTH_SECTIONS[i].name;
  document.getElementById('hsProgressBar').style.width=((i+1)/18*100)+'%';
  document.getElementById('hsPrevBtn').style.display=i>0?'':'none';
  document.getElementById('hsNextBtn').textContent=i===17?'âœ¨ Get AI Analysis':'Next â†’';
}
function hsPrev(){if(hsCurrent>0)jumpToSection(hsCurrent-1);}
function hsNext(){if(hsCurrent<17)jumpToSection(hsCurrent+1);else generateHealthAnalysis();}
async function generateHealthAnalysis(){
  const card=document.getElementById('aiDoctorCard');const output=document.getElementById('aiDoctorOutput');
  card.style.display='block';
  output.innerHTML='<div class="ai-loading"><span></span><span></span><span></span></div> <span style="font-size:13px;color:var(--text2)">AI Doctor analyzing...</span>';
  card.scrollIntoView({behavior:'smooth'});
  const kg=document.getElementById('hWeight_kg')?.value||0;const cm=document.getElementById('hHeight_cm')?.value||0;
  const bmi=kg&&cm?(kg/((cm/100)**2)).toFixed(1):'Unknown';
  const age=document.getElementById('hAge')?.value||'Unknown';
  await new Promise(r=>setTimeout(r,1500));
  output.innerHTML=`<div style="background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(16,185,129,.1));border-radius:12px;padding:14px;margin-bottom:12px">
    <div style="font-weight:800;font-family:Syne,sans-serif;font-size:16px;margin-bottom:8px">ğŸ“Š Health Summary</div>
    <div class="stats-grid"><div class="stat-box"><div class="sv">${bmi}</div><div class="sl">BMI</div></div><div class="stat-box"><div class="sv">${age}</div><div class="sl">Age</div></div></div>
  </div>
  <div style="font-size:13px;color:var(--text2);line-height:1.7">
    <p><strong>ğŸ¯ AI Doctor Recommendations:</strong></p>
    <p>â€¢ <strong>Sleep optimization</strong> is the foundational pillar â€” every other metric improves when sleep quality exceeds 7.</p>
    <p>â€¢ <strong>Omega-3 rich foods</strong> (salmon, flaxseed, walnuts) significantly improve cognitive function and reduce inflammation.</p>
    <p>â€¢ <strong>7,000-10,000 daily steps</strong> improves cardiovascular, cognitive, and mental health simultaneously.</p>
    <p>â€¢ Schedule a <strong>comprehensive blood panel</strong> â€” thyroid, vitamin D, B12, ferritin, CRP, testosterone.</p>
    <p>â€¢ Consider a <strong>30-day elimination diet</strong> to identify food sensitivities affecting your energy and cognition.</p>
    <p>â€¢ Daily <strong>cold exposure</strong> (2-min cold shower) boosts dopamine 250% and norepinephrine 300% for up to 3 hours.</p>
    <p style="margin-top:10px;font-size:11px;color:var(--text3)">âš•ï¸ Educational only. Always consult a qualified physician for medical decisions.</p>
  </div>`;
}

// â”€â”€â”€ BRAIN GAMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GAMES_LIST=[
  {id:'memory',name:'Memory Match',emoji:'ğŸƒ',desc:'Find matching pairs',tag:'Working Memory'},
  {id:'reaction',name:'Reaction Time',emoji:'âš¡',desc:'How fast are you?',tag:'Processing Speed'},
  {id:'stroop',name:'Stroop Challenge',emoji:'ğŸ¨',desc:'Name the ink color',tag:'Cognitive Control'},
  {id:'nback',name:'N-Back Memory',emoji:'ğŸ”¢',desc:'2-back working memory',tag:'Working Memory'},
  {id:'math',name:'Math Blitz',emoji:'â•',desc:'Mental arithmetic speed',tag:'Numerical Cognition'},
  {id:'word',name:'Word Chain',emoji:'ğŸ’¬',desc:'Word association chain',tag:'Language'},
  {id:'color',name:'Color Sequence',emoji:'ğŸŒˆ',desc:'Remember the pattern',tag:'Sequential Memory'},
  {id:'sudoku',name:'Sudoku',emoji:'ğŸ§©',desc:'Logic and deduction',tag:'Logical Reasoning'},
  {id:'pattern',name:'Pattern Recognition',emoji:'ğŸ‘ï¸',desc:'Find the odd one out',tag:'Visual Intelligence'},
  {id:'typing',name:'Speed Typing',emoji:'âŒ¨ï¸',desc:'Type fast and accurately',tag:'Processing Speed'},
  {id:'spatial',name:'Spatial Rotation',emoji:'ğŸ”„',desc:'Mental rotation puzzle',tag:'Spatial Intelligence'},
  {id:'breathing',name:'Focus Breathing',emoji:'ğŸ«',desc:'4-7-8 breathing',tag:'Mindfulness'},
];
function buildGamesGrid(){
  const grid=document.getElementById('gamesGrid');if(!grid)return;
  grid.innerHTML=GAMES_LIST.map(g=>`<div class="game-card" onclick="launchGame('${g.id}')"><span class="g-emoji">${g.emoji}</span><div class="g-name">${g.name}</div><div class="g-desc">${g.desc}</div><div class="g-tag">${g.tag}</div></div>`).join('');
}
let activeGame=null;
function launchGame(id){
  document.getElementById('gamesMenu').style.display='none';
  const c=document.getElementById('gameContainer');c.innerHTML='';activeGame=id;
  const games={memory:renderMemoryGame,reaction:renderReactionGame,stroop:renderStroopGame,nback:renderNBackGame,math:renderMathGame,word:renderWordGame,color:renderColorGame,sudoku:renderSudokuGame,pattern:renderPatternGame,typing:renderTypingGame,spatial:renderSpatialGame,breathing:renderBreathingGame};
  if(games[id])games[id](c);
}
function backToGames(){document.getElementById('gamesMenu').style.display='';document.getElementById('gameContainer').innerHTML='';activeGame=null;}
function gameHeader(title,emoji,l1,l2){return `<div class="game-header"><button class="btn btn-secondary btn-sm" onclick="backToGames()">â† Back</button><div style="flex:1;font-family:Syne,sans-serif;font-weight:800;font-size:18px">${emoji} ${title}</div></div><div class="game-score-bar"><div class="gs"><div class="gsv" id="gs1">0</div><div class="gsl">${l1}</div></div><div class="gs"><div class="gsv" id="gs2">-</div><div class="gsl">${l2}</div></div></div>`;}
function renderMemoryGame(c){
  const emojis=['ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼'];
  let cards=[...emojis,...emojis].sort(()=>Math.random()-.5),flipped=[],matched=[],moves=0,canFlip=true;
  c.innerHTML=gameHeader('Memory Match','ğŸƒ','Moves','Pairs')+`<div id="memGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;max-width:340px;margin:0 auto"></div><button class="btn btn-secondary btn-sm" onclick="launchGame('memory')" style="margin-top:10px;width:100%">ğŸ”„ New</button>`;
  const grid=document.getElementById('memGrid');
  cards.forEach((em,i)=>{
    const div=document.createElement('div');
    div.style.cssText='aspect-ratio:1;background:var(--bg3);border:2px solid var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;transition:all .3s';
    div.textContent='?';div.dataset.emoji=em;div.dataset.idx=i;
    div.onclick=function(){
      if(!canFlip||flipped.includes(i)||matched.includes(i))return;
      div.textContent=em;div.style.background='rgba(124,58,237,.15)';flipped.push(i);
      if(flipped.length===2){canFlip=false;moves++;document.getElementById('gs1').textContent=moves;
        const[a,b]=flipped;
        if(cards[a]===cards[b]){matched.push(a,b);flipped=[];canFlip=true;document.getElementById('gs2').textContent=matched.length/2;
          grid.children[a].style.borderColor='var(--success)';grid.children[b].style.borderColor='var(--success)';
          if(matched.length===cards.length)showToast('ğŸ‰ Done in '+moves+' moves!');
        }else{setTimeout(()=>{[a,b].forEach(x=>{grid.children[x].textContent='?';grid.children[x].style.background='var(--bg3)';});flipped=[];canFlip=true;},900);}
      }
    };grid.appendChild(div);
  });
}
function renderReactionGame(c){
  let state='idle',startTime,trials=[],th;
  c.innerHTML=gameHeader('Reaction Time','âš¡','Trial','Avg ms')+`<div id="rBox" onclick="rClick()" style="height:200px;border-radius:16px;background:var(--bg3);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;border:2px solid var(--border);transition:background .3s;user-select:none"><div id="rMsg" style="font-size:18px;font-weight:700">Tap to Start</div><div id="rSub" style="font-size:13px;color:var(--text3);margin-top:6px"></div></div><div id="rRes" style="margin-top:12px"></div>`;
  window.rClick=function(){
    if(state==='idle'){state='wait';document.getElementById('rMsg').textContent='Wait for green...';th=setTimeout(()=>{state='go';document.getElementById('rBox').style.background='var(--success)';document.getElementById('rMsg').textContent='TAP!';document.getElementById('rMsg').style.color='#fff';startTime=Date.now();},1000+Math.random()*3000);}
    else if(state==='wait'){clearTimeout(th);state='idle';document.getElementById('rBox').style.background='var(--danger)';document.getElementById('rMsg').textContent='Too early!';document.getElementById('rMsg').style.color='#fff';setTimeout(()=>{document.getElementById('rBox').style.background='var(--bg3)';document.getElementById('rMsg').textContent='Tap to Start';document.getElementById('rMsg').style.color='';},1000);}
    else if(state==='go'){const rt=Date.now()-startTime;trials.push(rt);state='idle';
      document.getElementById('rBox').style.background='var(--primary)';document.getElementById('rMsg').textContent=rt+'ms';document.getElementById('rMsg').style.color='#fff';
      document.getElementById('gs1').textContent=trials.length+'/5';
      if(trials.length>=5){const avg=Math.round(trials.reduce((a,b)=>a+b)/trials.length);document.getElementById('gs2').textContent=avg;
        document.getElementById('rRes').innerHTML=`<div class="card" style="text-align:center"><div style="font-size:22px;font-weight:800;color:var(--primary)">${avg}ms</div><div style="color:var(--text3)">${avg<200?'ğŸ† Elite':avg<300?'ğŸ¥‡ Excellent':avg<400?'âœ… Good':'ğŸ“ˆ Keep practicing'}</div></div>`;trials=[];
      }else{setTimeout(()=>{state='idle';document.getElementById('rBox').style.background='var(--bg3)';document.getElementById('rMsg').textContent='Tap for next trial';document.getElementById('rMsg').style.color='';},1200);}
    }
  };
}
function renderStroopGame(c){
  const CL={Red:'#ef4444',Blue:'#3b82f6',Green:'#10b981',Yellow:'#f59e0b',Purple:'#8b5cf6'};
  const cn=Object.keys(CL);let score=0,total=0,tl=60,timer;
  c.innerHTML=gameHeader('Stroop','ğŸ¨','Score','Time')+`<div style="text-align:center"><div style="font-size:13px;color:var(--text2);margin-bottom:12px">Tap the <strong>INK COLOR</strong> â€” ignore the word!</div><div id="stWord" style="font-size:52px;font-weight:800;font-family:Syne,sans-serif;margin-bottom:16px">RED</div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:300px;margin:0 auto" id="stBtns"></div></div>`;
  function next(){
    const w=cn[Math.floor(Math.random()*cn.length)],col=cn[Math.floor(Math.random()*cn.length)];
    document.getElementById('stWord').textContent=w;document.getElementById('stWord').style.color=CL[col];
    document.getElementById('stBtns').innerHTML=cn.sort(()=>Math.random()-.5).map(n=>`<button style="padding:10px;border-radius:10px;border:2px solid var(--border);background:${CL[n]};color:#fff;font-weight:700;cursor:pointer" onclick="stAns('${n}','${col}')">${n}</button>`).join('');
  }
  window.stAns=function(ans,correct){total++;if(ans===correct){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else showToast('âŒ '+correct);next();};
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);document.getElementById('stWord').textContent='Done! '+score+'/'+total;document.getElementById('stBtns').innerHTML='';}},1000);
  document.getElementById('gs2').textContent=tl;next();
}
function renderNBackGame(c){
  const pos=[0,1,2,3,4,5,6,7,8];let seq=[],idx=0,score=0,misses=0;
  c.innerHTML=gameHeader('2-Back','ğŸ”¢','Correct','Miss')+`<div style="text-align:center;font-size:12px;color:var(--text2);margin-bottom:10px">Press MATCH when position matches 2 steps back</div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:200px;margin:0 auto 16px">${pos.map(p=>`<div style="aspect-ratio:1;border-radius:8px;background:var(--bg3);border:2px solid var(--border);transition:all .3s" id="nb_${p}"></div>`).join('')}</div><div style="text-align:center"><button class="btn btn-primary" id="nbS" onclick="nbGo()">â–¶ Start</button><button class="btn btn-accent" id="nbM" onclick="nbMatch()" style="display:none;margin-left:8px">MATCH</button></div>`;
  window.nbGo=function(){seq=[];idx=0;score=0;misses=0;document.getElementById('nbS').style.display='none';document.getElementById('nbM').style.display='';
    function step(){if(idx>=20){document.getElementById('nbM').style.display='none';document.getElementById('nbS').style.display='';document.getElementById('nbS').textContent='ğŸ”„ Again';showToast('Score: '+score);return;}
      const p=pos[Math.floor(Math.random()*9)];seq.push(p);pos.forEach(p2=>document.getElementById('nb_'+p2).style.background='var(--bg3)');
      document.getElementById('nb_'+p).style.background='var(--primary)';setTimeout(()=>{document.getElementById('nb_'+p).style.background='var(--bg3)';idx++;setTimeout(step,800);},500);}
    step();};
  window.nbMatch=function(){if(seq.length>=2&&seq[seq.length-1]===seq[seq.length-3]){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else{misses++;document.getElementById('gs2').textContent=misses;showToast('âŒ');}};
}
function renderMathGame(c){
  let score=0,cur=0,a,b,op,ans,tl=90,timer;const ops=['+','-','Ã—'];
  c.innerHTML=gameHeader('Math Blitz','â•','Score','Time')+`<div style="text-align:center"><div id="mathP" style="font-size:40px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary);margin-bottom:16px"></div><input type="number" id="mathI" class="form-input" placeholder="?" style="text-align:center;font-size:20px;max-width:160px;margin:0 auto 12px;display:block" onkeydown="if(event.key==='Enter')chkM()"><button class="btn btn-primary" onclick="chkM()">Submit</button></div>`;
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);showToast('Time! '+score);}},1000);
  function nxt(){op=ops[Math.floor(Math.random()*3)];a=Math.floor(Math.random()*20)+1;b=Math.floor(Math.random()*20)+1;ans=op==='+'?a+b:op==='-'?a-b:a*b;document.getElementById('mathP').textContent=`${a} ${op} ${b} = ?`;document.getElementById('mathI').value='';document.getElementById('mathI').focus();}
  window.chkM=function(){const v=parseInt(document.getElementById('mathI').value);cur++;if(v===ans){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else showToast('âŒ '+ans);nxt();};
  document.getElementById('gs2').textContent=tl;nxt();
}
function renderWordGame(c){
  let score=0,tl=60,timer,chain=[],last='';
  c.innerHTML=gameHeader('Word Chain','ğŸ’¬','Words','Time')+`<div style="text-align:center"><div style="font-size:13px;color:var(--text2);margin-bottom:8px">Each word must START with the LAST LETTER of the previous</div><div id="wLast" style="font-size:32px;font-weight:800;color:var(--primary);margin-bottom:10px">Any word to start</div><div style="display:flex;gap:8px"><input type="text" id="wI" class="form-input" placeholder="Type a word..." onkeydown="if(event.key==='Enter')chkW()"><button class="btn btn-primary" onclick="chkW()">Go</button></div><div id="wChain" style="margin-top:8px;font-size:12px;color:var(--text2);max-height:80px;overflow-y:auto"></div></div>`;
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);showToast('Time! '+score+' words!');}},1000);document.getElementById('gs2').textContent=tl;
  window.chkW=function(){const w=document.getElementById('wI').value.trim().toLowerCase();if(!w)return;if(last&&w[0]!==last){showToast('Must start with '+last.toUpperCase());return;}if(chain.includes(w)){showToast('Already used!');return;}chain.push(w);last=w[w.length-1];score++;document.getElementById('gs1').textContent=score;document.getElementById('wLast').textContent='Next: '+last.toUpperCase();document.getElementById('wChain').textContent=chain.join(' â†’ ');document.getElementById('wI').value='';document.getElementById('wI').focus();};
}
function renderColorGame(c){
  const CL=['#ef4444','#3b82f6','#10b981','#f59e0b','#8b5cf6'];let seq=[],usr=[],lv=1,canClick=false;
  c.innerHTML=gameHeader('Color Sequence','ğŸŒˆ','Level','â€”')+`<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:220px;margin:0 auto 14px">${CL.map((cl,i)=>`<div id="cb_${i}" onclick="ccl(${i})" style="aspect-ratio:1;border-radius:12px;background:${cl};cursor:pointer;border:3px solid transparent;transition:all .2s"></div>`).join('')}</div><div style="text-align:center"><button class="btn btn-primary" id="cgS" onclick="cgStart()">â–¶ Start</button></div><div id="cgM" style="text-align:center;margin-top:8px;font-size:13px;color:var(--text2)"></div>`;
  function flash(i){return new Promise(r=>{document.getElementById('cb_'+i).style.opacity='0.3';setTimeout(()=>{document.getElementById('cb_'+i).style.opacity='1';r();},350);});}
  async function play(){canClick=false;document.getElementById('cgM').textContent='Watch...';for(const i of seq){await flash(i);await new Promise(r=>setTimeout(r,200));}canClick=true;usr=[];document.getElementById('cgM').textContent='Your turn!';}
  window.cgStart=function(){seq=[];lv=1;document.getElementById('cgS').style.display='none';add();};
  function add(){seq.push(Math.floor(Math.random()*CL.length));document.getElementById('gs1').textContent=lv;play();}
  window.ccl=function(i){if(!canClick)return;flash(i);usr.push(i);const p=usr.length-1;if(usr[p]!==seq[p]){canClick=false;document.getElementById('cgM').textContent='âŒ Game Over! Level '+lv;document.getElementById('gs2').textContent=lv;document.getElementById('cgS').style.display='';lv=1;seq=[];return;}if(usr.length===seq.length){canClick=false;lv++;setTimeout(add,600);}};
}
function renderSudokuGame(c){
  const p=[[5,3,0,0,7,0,0,0,0],[6,0,0,1,9,5,0,0,0],[0,9,8,0,0,0,0,6,0],[8,0,0,0,6,0,0,0,3],[4,0,0,8,0,3,0,0,1],[7,0,0,0,2,0,0,0,6],[0,6,0,0,0,0,2,8,0],[0,0,0,4,1,9,0,0,5],[0,0,0,0,8,0,0,7,9]];
  let sel=null,errors=0;
  c.innerHTML=gameHeader('Sudoku','ğŸ§©','Errors','â€”')+`<div id="sgrid" style="display:grid;grid-template-columns:repeat(9,1fr);gap:1px;background:var(--border);border:2px solid var(--primary);border-radius:8px;overflow:hidden;max-width:340px;margin:0 auto 10px"></div><div style="display:grid;grid-template-columns:repeat(9,1fr);gap:4px;max-width:340px;margin:0 auto 10px">${[1,2,3,4,5,6,7,8,9].map(n=>`<div class="sudoku-num" onclick="snI(${n})">${n}</div>`).join('')}</div><button class="btn btn-secondary btn-sm" onclick="launchGame('sudoku')">ğŸ”„ New</button>`;
  const grid=document.getElementById('sgrid');
  for(let r=0;r<9;r++)for(let cl2=0;cl2<9;cl2++){
    const d=document.createElement('div');d.className='sudoku-cell';d.dataset.r=r;d.dataset.c=cl2;
    if(p[r][cl2]){d.textContent=p[r][cl2];d.classList.add('given');}
    d.onclick=function(){document.querySelectorAll('.sudoku-cell').forEach(x=>x.classList.remove('selected'));if(!d.classList.contains('given')){sel=d;d.classList.add('selected');}};
    grid.appendChild(d);
  }
  window.snI=function(n){if(!sel||sel.classList.contains('given'))return;sel.textContent=n;};
}
function renderPatternGame(c){
  let score=0,tl=60,timer;const shapes=['â—','â– ','â–²','â˜…','â—†'];
  c.innerHTML=gameHeader('Pattern Recognition','ğŸ‘ï¸','Score','Time')+`<div style="text-align:center;font-size:13px;color:var(--text2);margin-bottom:10px">Which one is DIFFERENT?</div><div id="pArea" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:300px;margin:0 auto 10px"></div><div id="pFb" style="text-align:center;min-height:24px;font-size:14px;font-weight:700"></div>`;
  function nxt(){
    const sh=shapes[Math.floor(Math.random()*shapes.length)];const odd=shapes.filter(s=>s!==sh)[Math.floor(Math.random()*4)];
    const items=Array(5).fill(sh);const oi=Math.floor(Math.random()*6);items.splice(oi,0,odd);
    const clr=['#7c3aed','#06b6d4','#ec4899','#10b981','#f59e0b'][Math.floor(Math.random()*5)];
    document.getElementById('pArea').innerHTML=items.slice(0,6).map((s,i)=>`<div onclick="pAns(${i},${oi})" style="aspect-ratio:1;background:var(--bg3);border:2px solid var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:32px;cursor:pointer;color:${i===oi?'#ef4444':clr}">${s}</div>`).join('');
  }
  window.pAns=function(i,oi){const fb=document.getElementById('pFb');if(i===oi){score++;document.getElementById('gs1').textContent=score;fb.textContent='âœ… Correct!';fb.style.color='var(--success)';}else{fb.textContent='âŒ Wrong!';fb.style.color='var(--danger)';}setTimeout(nxt,600);};
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);showToast('Time! Score: '+score);}},1000);document.getElementById('gs2').textContent=tl;nxt();
}
function renderTypingGame(c){
  const txts=['The quick brown fox jumps over the lazy dog near the river.','Consciousness is the greatest mystery in the universe.','Every morning is a new beginning. What we do today matters.'];
  let txt=txts[Math.floor(Math.random()*txts.length)],pos=0,errs=0,started=false,tl=60,timer;
  c.innerHTML=gameHeader('Speed Typing','âŒ¨ï¸','WPM','Accuracy')+`<div id="typD" style="padding:12px;background:var(--bg3);border-radius:10px;font-size:15px;line-height:2;margin-bottom:10px"></div><input type="text" id="typI" class="form-input" placeholder="Start typing..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="font-size:16px">`;
  function render(){document.getElementById('typD').innerHTML=txt.split('').map((ch,i)=>i<pos?`<span style="color:var(--success)">${ch}</span>`:i===pos?`<span style="background:var(--primary);color:#fff;border-radius:2px">${ch}</span>`:`<span>${ch}</span>`).join('');}
  render();
  document.getElementById('typI').addEventListener('input',function(){
    if(!started){started=true;timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl+('%');const wpm=Math.round((pos/5)*(60/Math.max(1,60-tl)));document.getElementById('gs1').textContent=wpm;if(tl<=0){clearInterval(timer);this.disabled=true;}},1000);}
    const v=this.value;if(v.length>0&&v[v.length-1]===txt[pos]){pos++;}else if(v.length>0)errs++;
    const acc=pos>0?Math.round((1-errs/Math.max(1,pos+errs))*100):100;document.getElementById('gs2').textContent=acc+'%';this.value='';render();
    if(pos>=txt.length){clearInterval(timer);showToast('ğŸ‰ Complete!');}
  });
}
function renderSpatialGame(c){
  let score=0,cur=0;
  c.innerHTML=gameHeader('Spatial Rotation','ğŸ”„','Score','Round')+`<div style="text-align:center"><div style="font-size:13px;color:var(--text2);margin-bottom:10px">Which option matches the SAME shape, just rotated?</div><div id="spB" style="font-size:80px;color:var(--primary);margin-bottom:14px;font-family:monospace"></div><div id="spO" style="display:flex;justify-content:center;gap:16px;font-size:50px;font-family:monospace"></div></div>`;
  const q=[{base:'L',opts:['L','Î“','âŒ','J'],correct:0},{base:'T',opts:['T','âŠ¢','âŠ¥','âŠ£'],correct:1},{base:'F',opts:['F','âŠ¢','âŠ£','â„²'],correct:3},{base:'Z',opts:['Z','S','N','Z'],correct:3}];
  function nxt(){if(cur>=10){showToast('Done! '+score+'/10');return;}const qst=q[cur%q.length];
    document.getElementById('gs2').textContent=(cur+1)+'/10';
    document.getElementById('spB').textContent=qst.base;
    document.getElementById('spO').innerHTML=qst.opts.map((r,i)=>`<span style="cursor:pointer;padding:8px;border-radius:8px;border:2px solid var(--border)" onclick="spAns(${i},${qst.correct})">${r}</span>`).join('');
  }
  window.spAns=function(i,correct){cur++;if(i===correct){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else showToast('âŒ');setTimeout(nxt,500);};
  nxt();
}
function renderBreathingGame(c){
  let phase=0,phTime=0,timer,cycles=0,running=false;
  const phases=[{name:'Inhale',dur:4,color:'var(--accent)'},{name:'Hold',dur:7,color:'var(--primary)'},{name:'Exhale',dur:8,color:'var(--success)'}];
  c.innerHTML=gameHeader('4-7-8 Breathing','ğŸ«','Cycles','Phase')+`<div style="text-align:center"><div id="bCirc" style="width:160px;height:160px;border-radius:50%;border:4px solid var(--primary);margin:0 auto 20px;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:all 1s"><div id="bPhase" style="font-size:18px;font-weight:800;color:var(--primary)">Ready?</div><div id="bCnt" style="font-size:28px;font-weight:800;color:var(--primary)"></div></div><button class="btn btn-primary" id="bBtn" onclick="bStart()">â–¶ Begin</button></div><div style="margin-top:14px;background:var(--bg3);border-radius:10px;padding:12px;font-size:13px;color:var(--text2)"><strong>4-7-8 Technique:</strong> Inhale 4s â†’ Hold 7s â†’ Exhale 8s. Activates parasympathetic nervous system, reducing stress within minutes.</div>`;
  window.bStart=function(){document.getElementById('bBtn').style.display='none';phase=0;cycles=0;run();};
  function run(){const p=phases[phase];phTime=p.dur;const circ=document.getElementById('bCirc');circ.style.borderColor=p.color;circ.style.background=p.color+'20';
    document.getElementById('bPhase').textContent=p.name;document.getElementById('bPhase').style.color=p.color;document.getElementById('gs2').textContent=p.name;
    if(phase===0)setTimeout(()=>circ.style.transform='scale(1.4)',50);else if(phase===2)circ.style.transform='scale(0.9)';else circ.style.transform='scale(1.2)';
    clearInterval(timer);timer=setInterval(()=>{phTime--;document.getElementById('bCnt').textContent=phTime;
      if(phTime<=0){clearInterval(timer);phase=(phase+1)%3;if(phase===0){cycles++;document.getElementById('gs1').textContent=cycles;if(cycles>=4){document.getElementById('bPhase').textContent='Complete ğŸ™';document.getElementById('bCnt').textContent='';document.getElementById('bBtn').style.display='';document.getElementById('bBtn').textContent='ğŸ”„ Again';return;}}run();}
    },1000);document.getElementById('bCnt').textContent=phTime;
  }
}

// â”€â”€â”€ LUCID DREAMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TECHNIQUES=[
  {name:'WILD â€” Wake Induced Lucid Dream',col:'#7c3aed',body:'<strong>Simple words:</strong> Fall asleep while staying conscious.<br><br><strong>Steps:</strong><br>1. Set alarm 5-6 hours after sleep<br>2. Stay still after waking â€” don\'t move body<br>3. Keep mind awake while body relaxes<br>4. Sleep paralysis will come (tingling, heavy) â€” stay calm!<br>5. Visualize entering a dream while still aware<br><br><strong>Difficulty:</strong> Hard â­â­â­â­'},
  {name:'MILD â€” Mnemonic Induction',col:'#06b6d4',body:'<strong>Simple words:</strong> Set a strong intention before sleep.<br><br><strong>Steps:</strong><br>1. As you fall asleep, repeat: "Tonight I will know I\'m dreaming"<br>2. Vividly picture yourself realizing you\'re in a dream<br>3. Feel the emotion of becoming lucid â€” joy, wonder<br>4. Repeat until you drift off<br><br><strong>Difficulty:</strong> Moderate â­â­â­'},
  {name:'DILD â€” Dream Initiated',col:'#ec4899',body:'<strong>Simple words:</strong> Realize you\'re dreaming while already inside a dream.<br><br><strong>Steps:</strong><br>1. Do reality checks all day (10+ times)<br>2. Genuinely ask: "Am I dreaming right now?"<br>3. This habit transfers to your dreams automatically<br>4. Something weird happens in dream â†’ you do a check â†’ "I\'m dreaming!"<br><br><strong>Difficulty:</strong> Easy â­â­ | Best for beginners'},
  {name:'WBTB â€” Wake Back To Bed',col:'#10b981',body:'<strong>Simple words:</strong> Interrupt sleep at the right time to boost REM.<br><br><strong>Steps:</strong><br>1. Sleep normally for 5-6 hours<br>2. Wake up and stay awake 20-60 minutes (read about lucid dreaming)<br>3. Go back to sleep with intention to lucid dream<br>4. Brain enters REM quickly â†’ 70% more likely to become lucid!<br><br><strong>Difficulty:</strong> Easy-Moderate â­â­'},
  {name:'Reality Testing â€” Daily Practice',col:'#f59e0b',body:'<strong>Simple words:</strong> Train your brain to question reality constantly.<br><br><strong>Checks (do 10-15x per day):</strong><br>â€¢ <strong>Hand check:</strong> Look at hands â€” fingers often weird in dreams<br>â€¢ <strong>Nose pinch:</strong> Pinch and try breathing â€” still works in dreams!<br>â€¢ <strong>Read text:</strong> Read, look away, read again â€” changes in dreams<br>â€¢ <strong>Clock check:</strong> Time jumps weirdly in dreams<br><br><strong>KEY:</strong> Genuinely ask "Could I be dreaming right now?" every time!'},
];
const RC_ITEMS=[{name:'Hand Check',icon:'ğŸ–ï¸',desc:'Look at your hands'},{name:'Nose Pinch',icon:'ğŸ‘ƒ',desc:'Pinch & try breathing'},{name:'Read Text',icon:'ğŸ“–',desc:'Read, look away, reread'},{name:'Clock Check',icon:'ğŸ•',desc:'Check time twice'},{name:'Light Switch',icon:'ğŸ’¡',desc:'Try light switches'},{name:'Try to Float',icon:'ğŸ•Šï¸',desc:'Jump & stay floating'}];
let selDreamType='regular';
function setDreamType(btn,type){document.querySelectorAll('.dream-type-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');selDreamType=type;document.getElementById('dreamType').value=type;}
function buildTechniques(){
  const ct=document.getElementById('techniquesContainer');if(!ct)return;
  ct.innerHTML=TECHNIQUES.map((t,i)=>`<div class="technique-card" id="tc_${i}" onclick="togTech(${i})"><div class="tc-header"><div class="tc-title" style="color:${t.col}">${t.name}</div><span class="tc-chevron">â–¼</span></div><div class="tc-body">${t.body}</div></div>`).join('');
}
function togTech(i){document.getElementById('tc_'+i).classList.toggle('open');}
function buildRCGrid(){
  const g=document.getElementById('rcGrid');if(!g)return;
  const done=JSON.parse(localStorage.getItem('cos_rc_done')||'[]');
  g.innerHTML=RC_ITEMS.map((r,i)=>`<div class="rc-btn${done.includes(i)?' done':''}" id="rcBtn_${i}" onclick="doRC(${i})"><span class="rc-icon">${r.icon}</span><div class="rc-name">${r.name}</div><div style="font-size:10px;color:var(--text3);margin-top:2px">${r.desc}</div></div>`).join('');
}
function doRC(i){
  const today=new Date().toDateString();
  if(localStorage.getItem('cos_rc_day')!==today){localStorage.setItem('cos_rc_day',today);localStorage.setItem('cos_rc_count','0');localStorage.setItem('cos_rc_done','[]');}
  const count=parseInt(localStorage.getItem('cos_rc_count')||0)+1;
  const done=JSON.parse(localStorage.getItem('cos_rc_done')||'[]');if(!done.includes(i))done.push(i);
  localStorage.setItem('cos_rc_count',count);localStorage.setItem('cos_rc_done',JSON.stringify(done));
  document.getElementById('rcCount').textContent=count;document.getElementById('rcProgress').style.width=Math.min(100,count/15*100)+'%';
  document.getElementById('rcBtn_'+i).classList.add('done');showToast('Reality check! Total: '+count);
}
function resetRC(){localStorage.setItem('cos_rc_count','0');localStorage.setItem('cos_rc_done','[]');buildRCGrid();if(document.getElementById('rcCount'))document.getElementById('rcCount').textContent=0;if(document.getElementById('rcProgress'))document.getElementById('rcProgress').style.width='0%';}
function calcWBTB(){
  const sl=document.getElementById('wbtbSleep').value,wk=document.getElementById('wbtbWake').value;
  if(!sl||!wk){showToast('Enter times first');return;}
  const sm=sl.split(':').map(Number),wm=wk.split(':').map(Number);
  let dur=(wm[0]*60+wm[1])-(sm[0]*60+sm[1]);if(dur<0)dur+=1440;
  const fmt=m=>`${Math.floor(m/60).toString().padStart(2,'0')}:${(m%60).toString().padStart(2,'0')}`;
  const t1=(sm[0]*60+sm[1]+300)%1440,t2=(sm[0]*60+sm[1]+360)%1440;
  document.getElementById('wbtbResult').innerHTML=`<div style="background:var(--bg3);border-radius:10px;padding:12px;font-size:13px"><div style="margin-bottom:6px">Sleep: <strong>${Math.floor(dur/60)}h ${dur%60}m</strong> (${Math.floor(dur/90)} cycles)</div><div style="margin-bottom:4px">â° Option 1: <strong style="color:var(--primary)">${fmt(t1)}</strong> (5h mark)</div><div style="margin-bottom:8px">â° Option 2: <strong style="color:var(--primary)">${fmt(t2)}</strong> (6h mark)</div><div style="color:var(--text3);font-size:11px">Wake at one of these times, stay up 20-60 min, then return to sleep for maximum lucid potential.</div></div>`;
}
function getDreams(){return JSON.parse(localStorage.getItem('cos_dreams')||'[]');}
function saveDream(){
  const entry={id:Date.now(),date:document.getElementById('dreamDate')?.value||new Date().toISOString().split('T')[0],title:document.getElementById('dreamTitle')?.value||'Untitled',type:selDreamType,desc:document.getElementById('dreamDesc')?.value,vividness:parseInt(document.getElementById('dreamVividness')?.value||5),lucidity:parseInt(document.getElementById('dreamLucidity')?.value||0),signs:document.getElementById('dreamSigns')?.value,emotions:document.getElementById('dreamEmotions')?.value};
  const dreams=getDreams();dreams.unshift(entry);localStorage.setItem('cos_dreams',JSON.stringify(dreams));
  showToast('ğŸ’¤ Dream saved!');renderDreamJournal();analyzeDream(entry);
}
async function analyzeDream(entry){
  const el=document.getElementById('dreamAIAnalysis');if(!el)return;
  el.innerHTML='<div class="ai-loading"><span></span><span></span><span></span></div><span style="font-size:13px;color:var(--text2)"> Analyzing dream...</span>';
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:400,messages:[{role:'user',content:`Analyze this dream for a consciousness tracker user. Dream: "${entry.desc}" Type: ${entry.type}, Vividness: ${entry.vividness}/10, Lucidity: ${entry.lucidity}/10, Signs: ${entry.signs}, Emotions: ${entry.emotions}. Provide: 1) Key symbols and psychological meaning 2) What it reflects about waking life 3) Specific lucid dreaming coaching for this exact dream (what to do when these signs appear) 4) Technique to use tonight. Keep under 200 words, practical and warm.`}]})
    });
    const data=await resp.json();
    el.innerHTML=`<div class="dream-ai-box"><div style="font-weight:700;margin-bottom:8px">ğŸ¤– AI Dream Analysis</div><div style="font-size:13px;line-height:1.7">${(data.content?.[0]?.text||'').replace(/\n/g,'<br>')}</div></div>`;
  }catch(e){
    el.innerHTML=`<div class="dream-ai-box"><div style="font-size:13px;line-height:1.6"><strong>Dream Analysis:</strong><br>â€¢ ${entry.type} dream, vividness: ${entry.vividness}/10<br>â€¢ ${entry.lucidity>0?'Lucidity '+entry.lucidity+'/10 â€” next time, try stabilizing by rubbing your hands or spinning.':'No lucidity yet â€” do reality checks during similar dream scenarios.'}<br>â€¢ Dream signs: ${entry.signs||'note recurring elements next time'}<br>â€¢ Tonight: Use MILD. Repeat "When I see ${entry.signs||'unusual things'}, I will realize I am dreaming."</div></div>`;
  }
}
function renderDreamJournal(){
  const el=document.getElementById('dreamJournal');if(!el)return;
  const dreams=getDreams().slice(0,20);
  if(!dreams.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ğŸŒ™</span><div class="es-text">No dreams logged yet</div></div>';return;}
  el.innerHTML=dreams.map(d=>`<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px"><div style="display:flex;justify-content:space-between;margin-bottom:6px"><div style="font-weight:700;font-size:14px">${d.title}</div><span class="badge badge-${d.type==='lucid'?'success':d.type==='nightmare'?'danger':'primary'}">${d.type}</span></div><div style="font-size:11px;color:var(--text3);margin-bottom:5px">${d.date}</div><div style="font-size:12px;color:var(--text2)">${(d.desc||'').slice(0,100)}${(d.desc||'').length>100?'...':''}</div><div style="display:flex;gap:10px;margin-top:5px;font-size:11px;color:var(--text3)"><span>ğŸ‘ï¸ ${d.vividness}/10</span><span>âœ¨ ${d.lucidity}/10</span></div></div>`).join('');
}

// â”€â”€â”€ VOICE & MEDIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mediaRecorder,recChunks=[],recTimer,recSecs=0,recognition;
function toggleRecord(){const btn=document.getElementById('recorderBtn');if(btn.classList.contains('recording'))stopRecord();else startRecord();}
function startRecord(){
  if(!navigator.mediaDevices){showToast('Microphone not supported');return;}
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    mediaRecorder=new MediaRecorder(stream);recChunks=[];recSecs=0;
    mediaRecorder.ondataavailable=e=>recChunks.push(e.data);
    mediaRecorder.onstop=()=>{
      const blob=new Blob(recChunks,{type:'audio/webm'});const reader=new FileReader();
      reader.onload=()=>{const memo={id:Date.now(),ts:new Date().toISOString(),audio:reader.result,transcript:document.getElementById('liveTranscript').textContent};
        const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]');memos.unshift(memo);
        localStorage.setItem('cos_voice',JSON.stringify(memos.slice(0,50)));renderVoiceMemos();showToast('ğŸ™ï¸ Memo saved!');};
      reader.readAsDataURL(blob);
    };
    mediaRecorder.start();document.getElementById('recorderBtn').classList.add('recording');
    document.getElementById('recStatus').textContent='Recording... Tap to Stop';
    recTimer=setInterval(()=>{recSecs++;const m=Math.floor(recSecs/60),s=recSecs%60;document.getElementById('recTimer').textContent=(m<10?'0':'')+m+':'+(s<10?'0':'')+s;},1000);
    if(SETTINGS_STATE.autoTranscribe&&(window.SpeechRecognition||window.webkitSpeechRecognition)){
      const SR=window.SpeechRecognition||window.webkitSpeechRecognition;recognition=new SR();recognition.continuous=true;recognition.interimResults=true;
      recognition.onresult=e=>{let t='';for(let i=e.resultIndex;i<e.results.length;i++)t+=e.results[i][0].transcript;document.getElementById('liveTranscript').textContent=t;};
      recognition.start();
    }
  }).catch(()=>showToast('Mic access denied'));
}
function stopRecord(){
  if(mediaRecorder&&mediaRecorder.state!=='inactive')mediaRecorder.stop();
  if(recognition)try{recognition.stop();}catch(e){}
  clearInterval(recTimer);document.getElementById('recorderBtn').classList.remove('recording');document.getElementById('recStatus').textContent='Tap to Start Recording';
}
function renderVoiceMemos(){
  const el=document.getElementById('voiceMemos');if(!el)return;
  const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]').slice(0,20);
  if(!memos.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ğŸ™ï¸</span><div class="es-text">No memos yet</div></div>';return;}
  el.innerHTML=memos.map(m=>`<div class="memo-item"><div class="memo-meta"><span>${new Date(m.ts).toLocaleDateString()+' '+new Date(m.ts).toLocaleTimeString()}</span><button onclick="delMemo(${m.id})" style="background:none;border:none;color:var(--danger);cursor:pointer">âœ•</button></div>${m.audio?`<audio src="${m.audio}" controls style="width:100%;margin-bottom:5px"></audio>`:''} ${m.transcript&&m.transcript!=='Speak to see transcript here...'?`<div style="font-size:12px;color:var(--text2)">${m.transcript}</div>`:''}</div>`).join('');
}
function delMemo(id){const m=JSON.parse(localStorage.getItem('cos_voice')||'[]').filter(m=>m.id!==id);localStorage.setItem('cos_voice',JSON.stringify(m));renderVoiceMemos();}
async function analyzeVoiceMemos(){
  const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]');const el=document.getElementById('voiceAIInsights');
  if(!memos.length){showToast('No memos to analyze');return;}
  el.innerHTML='<div class="ai-loading"><span></span><span></span><span></span></div>';
  const transcripts=memos.filter(m=>m.transcript&&m.transcript!=='Speak to see transcript here...').map((m,i)=>`[${new Date(m.ts).toLocaleDateString()}]: ${m.transcript}`).join('\n');
  await new Promise(r=>setTimeout(r,1000));
  el.innerHTML=`<div class="ai-insight-box">You have ${memos.length} voice recordings${transcripts?', with transcripts showing patterns in your consciousness tracking':' (no transcripts yet â€” enable auto-transcribe in Settings)'}.<br><br><strong>ğŸ“ Suggestions for what to record next:</strong><br>â€¢ Morning thoughts immediately after waking (before phone)<br>â€¢ Your mental state before and after exercise<br>â€¢ Creative ideas as they arise<br>â€¢ Emotional reactions to events (pattern tracking)<br>â€¢ Post-meditation insights<br>â€¢ Dream recall right after waking</div>`;
}
function uploadMedia(e){
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader();reader.onload=()=>{
      const item={id:Date.now()+Math.random(),ts:new Date().toISOString(),type:file.type,data:reader.result,name:file.name};
      const arch=JSON.parse(localStorage.getItem('cos_media')||'[]');arch.unshift(item);
      localStorage.setItem('cos_media',JSON.stringify(arch.slice(0,50)));renderMediaGrid();showToast('ğŸ“¸ Saved!');
    };reader.readAsDataURL(file);
  });
}
function renderMediaGrid(){
  const el=document.getElementById('mediaGrid');if(!el)return;
  const arch=JSON.parse(localStorage.getItem('cos_media')||'[]').slice(0,50);
  if(!arch.length){el.innerHTML='<div class="empty-state" style="grid-column:1/-1"><span class="es-icon">ğŸ–¼ï¸</span><div class="es-text">No media yet</div></div>';return;}
  el.innerHTML=arch.map(m=>`<div class="media-thumb">${m.type.startsWith('image')?`<img src="${m.data}" alt="${m.name}">`:  `<video src="${m.data}" controls></video>`}</div>`).join('');
}
async function analyzeMedia(){
  const arch=JSON.parse(localStorage.getItem('cos_media')||'[]');const el=document.getElementById('mediaAIInsights');
  el.innerHTML=`<div class="ai-insight-box">You have ${arch.length} items archived.<br><br><strong>ğŸ’¡ What to capture for consciousness tracking:</strong><br>â€¢ Daily selfies to track energy/mood changes visually<br>â€¢ Your workspace and environment<br>â€¢ Post-workout state<br>â€¢ Meals for nutrition tracking<br>â€¢ Places and experiences that shift your consciousness<br>â€¢ Nature exposure (trees, water, sky)</div>`;
}

// â”€â”€â”€ CALENDAR & ALARMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let calDate=new Date();
function renderCalendar(){
  const el=document.getElementById('calGrid');if(!el)return;
  const year=calDate.getFullYear(),month=calDate.getMonth();
  document.getElementById('calTitle').textContent=calDate.toLocaleDateString(curLang,{month:'long',year:'numeric'});
  const first=new Date(year,month,1).getDay(),days=new Date(year,month+1,0).getDate();
  const logs=getLogs().map(e=>e.date),dreams=getDreams().map(d=>d.date);
  const today=new Date().toISOString().split('T')[0];
  let html=['Su','Mo','Tu','We','Th','Fr','Sa'].map(d=>`<div class="cal-day-header">${d}</div>`).join('');
  html+=Array(first).fill('<div></div>').join('');
  for(let d=1;d<=days;d++){const ds=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;html+=`<div class="cal-day${ds===today?' today':''}${logs.includes(ds)?' has-log':''}${dreams.includes(ds)?' has-dream':''}">${d}</div>`;}
  el.innerHTML=html;renderAlarms();renderReminders();
}
function calNav(dir){calDate=new Date(calDate.getFullYear(),calDate.getMonth()+dir,1);renderCalendar();}
function addAlarm(){
  const label=document.getElementById('alarmLabel').value||'Alarm',time=document.getElementById('alarmTime').value,sound=document.getElementById('alarmSound').value,repeat=document.getElementById('alarmRepeat').value;
  if(!time){showToast('Please set a time');return;}
  const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');
  alarms.push({id:Date.now(),label,time,sound,repeat,active:true});
  localStorage.setItem('cos_alarms',JSON.stringify(alarms));renderAlarms();showToast('â° Alarm set: '+time);
  if(Notification.permission==='default')Notification.requestPermission();
}
function renderAlarms(){
  const el=document.getElementById('alarmsList');if(!el)return;
  const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');
  if(!alarms.length){el.innerHTML='<div class="empty-state"><span class="es-icon">â°</span><div class="es-text">No alarms set</div></div>';return;}
  el.innerHTML=alarms.map((a,i)=>`<div class="alarm-item"><div><div style="font-weight:700;font-size:15px">${a.time}</div><div style="font-size:12px;color:var(--text3)">${a.label} Â· ${a.repeat} Â· ${a.sound}</div></div><div style="display:flex;gap:8px;align-items:center"><div class="alarm-toggle${a.active?' on':''}" onclick="togAlarm(${i})"></div><button onclick="delAlarm(${i})" style="background:none;border:none;color:var(--danger);cursor:pointer">ğŸ—‘</button></div></div>`).join('');
}
function togAlarm(i){const a=JSON.parse(localStorage.getItem('cos_alarms')||'[]');a[i].active=!a[i].active;localStorage.setItem('cos_alarms',JSON.stringify(a));renderAlarms();}
function delAlarm(i){const a=JSON.parse(localStorage.getItem('cos_alarms')||'[]');a.splice(i,1);localStorage.setItem('cos_alarms',JSON.stringify(a));renderAlarms();}
function checkAlarms(){
  const now=new Date();const ts=`${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
  const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');
  alarms.forEach(a=>{if(!a.active)return;if(a.time===ts){playAlarmSound(a.sound);if(Notification.permission==='granted')new Notification('â° '+a.label,{body:a.time+' Â· Consciousness OS'});showToast('â° '+a.label,4000);}});
}
function playAlarmSound(sound){
  try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const osc=ctx.createOscillator();const gain=ctx.createGain();
    osc.frequency.value={bell:880,chime:528,pulse:440,om:136,birds:1000}[sound]||440;osc.type='sine';
    gain.gain.setValueAtTime(0.5,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+2);
    osc.connect(gain);gain.connect(ctx.destination);osc.start();osc.stop(ctx.currentTime+2);}catch(e){}
}
function addReminder(){
  const text=document.getElementById('reminderText').value,dt=document.getElementById('reminderDateTime').value;
  if(!text||!dt){showToast('Fill in details');return;}
  const r=JSON.parse(localStorage.getItem('cos_reminders')||'[]');r.push({id:Date.now(),text,dt});
  localStorage.setItem('cos_reminders',JSON.stringify(r));renderReminders();showToast('ğŸ“ Reminder added!');
}
function renderReminders(){
  const el=document.getElementById('remindersList');if(!el)return;
  const r=JSON.parse(localStorage.getItem('cos_reminders')||'[]');
  if(!r.length){el.innerHTML='';return;}
  el.innerHTML=r.map((rem,i)=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px;background:var(--bg3);border-radius:8px;margin-bottom:4px"><div><div style="font-size:13px;font-weight:600">${rem.text}</div><div style="font-size:11px;color:var(--text3)">${new Date(rem.dt).toLocaleString()}</div></div><button onclick="delRem(${i})" style="background:none;border:none;color:var(--danger);cursor:pointer">âœ•</button></div>`).join('');
}
function delRem(i){const r=JSON.parse(localStorage.getItem('cos_reminders')||'[]');r.splice(i,1);localStorage.setItem('cos_reminders',JSON.stringify(r));renderReminders();}

// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportData(){
  const data={version:'6.0',exported:new Date().toISOString(),logs:getLogs(),dreams:getDreams(),voice:JSON.parse(localStorage.getItem('cos_voice')||'[]'),settings:SETTINGS_STATE};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`consciousness_os_v6_${Date.now()}.json`;a.click();showToast('ğŸ’¾ Exported!');
}
function importData(e){
  const file=e.target.files[0];if(!file)return;
  const reader=new FileReader();reader.onload=()=>{try{const data=JSON.parse(reader.result);if(data.logs)localStorage.setItem('cos_logs',JSON.stringify(data.logs));if(data.dreams)localStorage.setItem('cos_dreams',JSON.stringify(data.dreams));showToast('ğŸ“¥ Imported! '+data.logs?.length+' entries');renderRecentLogs();}catch(e){showToast('âŒ Invalid file');}};reader.readAsText(file);
}
function clearAllData(){if(confirm('Clear ALL data? Cannot be undone.')){['cos_logs','cos_voice','cos_media','cos_health2','cos_reminders','cos_dreams','cos_rc_today','cos_alarms'].forEach(k=>localStorage.removeItem(k));showToast(t('cleared'));renderRecentLogs();}}

// â”€â”€â”€ ONBOARDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let oStep=0;
function showOnboarding(){document.getElementById('onboardOverlay').style.display='flex';oStep=0;gotoOStep(0);}
function closeOnboarding(){document.getElementById('onboardOverlay').style.display='none';}
function gotoOStep(s){
  document.querySelectorAll('.onboard-step').forEach((el,i)=>el.classList.toggle('active',i===s));
  document.getElementById('onboardDots').innerHTML=Array.from({length:6},(_,i)=>`<div class="odot${i===s?' active':''}"></div>`).join('');
  document.getElementById('oBtnPrev').style.display=s>0?'':'none';
  document.getElementById('oBtnNext').textContent=s===5?'ğŸš€ Let\'s Go!':'Next â†’';
}
function onboardNav(dir){
  if(oStep>=5&&dir>0){closeOnboarding();return;}
  oStep=Math.max(0,Math.min(5,oStep+dir));gotoOStep(oStep);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init(){
  const th=localStorage.getItem('cos_theme')||'light';
  document.documentElement.setAttribute('data-theme',th);
  document.getElementById('themeBtn').textContent=th==='dark'?'â˜€ï¸':'ğŸŒ™';
  const today=new Date().toISOString().split('T')[0];
  if(document.getElementById('logDate'))document.getElementById('logDate').value=today;
  if(document.getElementById('dreamDate'))document.getElementById('dreamDate').value=today;
  loadSettings();
  buildNav();buildSliders();buildBWGrid();buildAIModelsBar();buildSuggestedQs();
  buildHealthSections();buildGamesGrid();buildTechniques();buildRCGrid();
  renderRecentLogs();renderDreamJournal();renderVoiceMemos();renderMediaGrid();renderCalendar();renderAlarms();renderReminders();
  const today2=new Date().toDateString();
  if(localStorage.getItem('cos_rc_day')===today2){
    const cnt=parseInt(localStorage.getItem('cos_rc_count')||0);
    if(document.getElementById('rcCount'))document.getElementById('rcCount').textContent=cnt;
    if(document.getElementById('rcProgress'))document.getElementById('rcProgress').style.width=Math.min(100,cnt/15*100)+'%';
  }
  setInterval(checkAlarms,30000);
  const sl=localStorage.getItem('cos_lang')||'en';curLang=sl;
  try{document.getElementById('langSel').value=sl;}catch(e){}try{document.getElementById('settingLang').value=sl;}catch(e){}
  setTimeout(()=>{const logs=getLogs();addChatMsg('ai',logs.length?`Hello! ğŸ‘‹ I see you have ${logs.length} consciousness entries. ${Math.random()>.5?'How are you feeling today?':'What\'s on your mind?'}`:"Welcome to Consciousness OS v6! ğŸ§  I'm your AI Digital Twin. Fill your first Daily Log and I'll start learning your patterns. What's your name?",'twin');},600);
  loadDailyTip();
  if(!localStorage.getItem('cos_visited')){localStorage.setItem('cos_visited','1');setTimeout(()=>showOnboarding(),1500);}
}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>