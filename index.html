<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consciousness OS Ultimate - Complete Mind System</title>
<meta name="theme-color" content="#0f172a">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
background:radial-gradient(circle at top,#1e1b4b,#020617);
color:#e5e7eb;
padding:20px;
-webkit-font-smoothing:antialiased
}

h1{font-size:24px;margin-bottom:16px;font-weight:800}
h3{font-size:16px;margin-bottom:12px;font-weight:700}

.card{
background:#020617;
border:1px solid #1f2937;
border-radius:16px;
padding:16px;
margin-bottom:16px;
box-shadow:0 4px 12px rgba(0,0,0,0.3)
}

input,textarea,select{
width:100%;
margin:6px 0;
padding:10px;
border-radius:10px;
border:1px solid #374151;
background:#0a0a1f;
color:#e5e7eb;
font-size:14px;
transition:all 0.2s
}

input:focus,textarea:focus,select:focus{
outline:none;
border-color:#8b5cf6;
box-shadow:0 0 0 3px rgba(139,92,246,0.1)
}

textarea{
min-height:80px;
resize:vertical;
font-family:inherit
}

/* Sliders */
.slider-group{
margin:12px 0
}

.slider-header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:8px
}

.slider-label{
font-size:13px;
font-weight:600;
color:#9ca3af
}

.slider-value{
font-size:24px;
font-weight:900;
color:#8b5cf6;
min-width:45px;
text-align:right
}

input[type="range"]{
width:100%;
height:10px;
border-radius:6px;
background:linear-gradient(90deg,#ef4444 0%,#f59e0b 25%,#10b981 50%,#3b82f6 75%,#8b5cf6 100%);
outline:none;
-webkit-appearance:none;
border:none;
padding:0
}

input[type="range"]::-webkit-slider-thumb{
-webkit-appearance:none;
width:24px;
height:24px;
border-radius:50%;
background:#fff;
cursor:pointer;
box-shadow:0 2px 8px rgba(0,0,0,0.3);
border:3px solid #8b5cf6
}

input[type="range"]::-moz-range-thumb{
width:24px;
height:24px;
border-radius:50%;
background:#fff;
cursor:pointer;
box-shadow:0 2px 8px rgba(0,0,0,0.3);
border:3px solid #8b5cf6
}

/* Buttons */
button{
background:linear-gradient(135deg,#8b5cf6,#7c3aed);
border:none;
padding:12px 20px;
border-radius:10px;
color:#fff;
margin-top:8px;
cursor:pointer;
font-weight:700;
font-size:14px;
transition:all 0.2s;
box-shadow:0 4px 12px rgba(139,92,246,0.4)
}

button:hover{
transform:translateY(-2px);
box-shadow:0 6px 16px rgba(139,92,246,0.5)
}

button:active{
transform:translateY(0)
}

button.secondary{
background:#1f2937;
box-shadow:none
}

button.record{
width:70px;
height:70px;
border-radius:50%;
background:#ef4444;
font-size:28px;
margin:16px auto;
display:block
}

button.record.recording{
background:#dc2626;
animation:pulse 1s infinite
}

@keyframes pulse{
0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,0.7)}
50%{box-shadow:0 0 0 20px rgba(239,68,68,0)}
}

/* Score Display */
.score{
font-size:48px;
font-weight:900;
color:#8b5cf6;
text-align:center;
margin:12px 0;
text-shadow:0 0 20px rgba(139,92,246,0.5)
}

.state-label{
text-align:center;
font-size:16px;
font-weight:700;
padding:8px;
background:linear-gradient(135deg,rgba(139,92,246,0.1),rgba(124,58,237,0.1));
border-radius:10px;
margin-top:8px
}

/* Badges */
.badge{
display:inline-block;
padding:6px 12px;
background:#1f2937;
border-radius:8px;
margin:4px;
font-size:12px;
font-weight:600;
border:1px solid #374151
}

.badge.primary{
background:rgba(139,92,246,0.2);
border-color:#8b5cf6;
color:#c4b5fd
}

.badge.success{
background:rgba(16,185,129,0.2);
border-color:#10b981;
color:#6ee7b7
}

.badge.warning{
background:rgba(245,158,11,0.2);
border-color:#f59e0b;
color:#fcd34d
}

/* Timeline */
.timeline-entry{
padding:12px;
margin:8px 0;
background:#0a0a1f;
border-left:4px solid #374151;
border-radius:8px;
font-size:13px
}

.timeline-entry.peak{
border-left-color:#10b981;
background:linear-gradient(90deg,rgba(16,185,129,0.1),transparent)
}

.timeline-entry.low{
border-left-color:#ef4444;
background:linear-gradient(90deg,rgba(239,68,68,0.1),transparent)
}

/* Voice Recorder */
.voice-box{
background:linear-gradient(135deg,#fef3c7,#fde68a);
color:#78350f;
padding:20px;
border-radius:12px;
text-align:center;
margin:12px 0
}

.transcript-box{
min-height:60px;
background:#0a0a1f;
border:1px solid #374151;
border-radius:8px;
padding:12px;
margin-top:12px;
font-size:13px;
color:#e5e7eb
}

/* Media */
.media-grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(100px,1fr));
gap:8px;
margin-top:12px
}

.media-item{
aspect-ratio:1;
border-radius:8px;
overflow:hidden;
background:#1f2937;
cursor:pointer
}

.media-item img,.media-item video{
width:100%;
height:100%;
object-fit:cover
}

.upload-zone{
border:2px dashed #374151;
border-radius:12px;
padding:32px;
text-align:center;
cursor:pointer;
transition:all 0.2s
}

.upload-zone:hover{
border-color:#8b5cf6;
background:rgba(139,92,246,0.05)
}

/* Chat */
.chat-container{
height:400px;
display:flex;
flex-direction:column
}

.chat-messages{
flex:1;
overflow-y:auto;
padding:12px;
background:#0a0a1f;
border-radius:8px;
margin-bottom:12px
}

.chat-msg{
padding:10px 14px;
border-radius:10px;
margin:8px 0;
max-width:85%;
line-height:1.5;
font-size:14px
}

.chat-msg.user{
background:#8b5cf6;
color:#fff;
margin-left:auto;
text-align:right
}

.chat-msg.assistant{
background:#1f2937;
color:#e5e7eb
}

.chat-input-box{
display:flex;
gap:8px
}

.chat-input-box input{
flex:1;
margin:0
}

.chat-input-box button{
margin:0;
padding:12px 20px
}

/* Tabs */
.tabs{
display:flex;
gap:8px;
margin-bottom:16px;
overflow-x:auto
}

.tab{
padding:10px 16px;
background:#1f2937;
border:none;
border-radius:10px;
color:#9ca3af;
cursor:pointer;
font-weight:600;
font-size:13px;
white-space:nowrap;
margin:0
}

.tab.active{
background:linear-gradient(135deg,#8b5cf6,#7c3aed);
color:#fff;
box-shadow:0 4px 12px rgba(139,92,246,0.4)
}

.tab-content{
display:none
}

.tab-content.active{
display:block
}

/* Stats Grid */
.stats-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(100px,1fr));
gap:12px;
margin:12px 0
}

.stat-box{
background:#0a0a1f;
padding:14px;
border-radius:10px;
text-align:center;
border:1px solid #374151
}

.stat-value{
font-size:28px;
font-weight:900;
color:#8b5cf6
}

.stat-label{
font-size:11px;
color:#9ca3af;
margin-top:4px;
text-transform:uppercase;
letter-spacing:0.5px
}

/* Modal */
.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.85);
display:none;
align-items:center;
justify-content:center;
padding:20px;
z-index:1000
}

.modal.show{
display:flex
}

.modal-content{
background:#020617;
border:1px solid #1f2937;
border-radius:16px;
padding:24px;
max-width:600px;
max-height:80vh;
overflow:auto
}

.close-btn{
float:right;
cursor:pointer;
color:#9ca3af;
font-size:24px;
line-height:1;
font-weight:700
}

/* Footer */
footer{
margin-top:40px;
padding-top:20px;
border-top:1px solid #1f2937;
font-size:11px;
color:#6b7280;
text-align:center
}

footer a{
color:#8b5cf6;
text-decoration:none;
cursor:pointer
}

footer a:hover{
text-decoration:underline
}

/* Toast */
.toast{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:#1f2937;
color:#fff;
padding:14px 24px;
border-radius:10px;
box-shadow:0 8px 24px rgba(0,0,0,0.5);
z-index:1001;
display:none;
font-weight:600;
font-size:14px
}

.toast.show{
display:block;
animation:slideUp 0.3s ease
}

@keyframes slideUp{
from{transform:translateX(-50%) translateY(100px);opacity:0}
to{transform:translateX(-50%) translateY(0);opacity:1}
}

/* Responsive */
@media(max-width:600px){
body{padding:12px}
h1{font-size:20px}
.score{font-size:36px}
.stats-grid{grid-template-columns:repeat(3,1fr)}
}
</style>
</head>

<body>

<h1>üß† Consciousness OS Ultimate</h1>

<!-- Tabs -->
<div class="tabs">
<button class="tab active" onclick="switchTab('log')">üìù Log</button>
<button class="tab" onclick="switchTab('voice')">üé§ Voice</button>
<button class="tab" onclick="switchTab('media')">üì∑ Media</button>
<button class="tab" onclick="switchTab('chat')">üí¨ Chat</button>
<button class="tab" onclick="switchTab('analysis')">üß¨ Analysis</button>
<button class="tab" onclick="switchTab('timeline')">üìà Timeline</button>
</div>

<!-- LOG TAB -->
<div id="logTab" class="tab-content active">

<div class="card">
<h3>üìä Core State Metrics</h3>

<div class="slider-group">
<div class="slider-header">
<span class="slider-label">üòä Mood</span>
<span class="slider-value" id="moodVal">5</span>
</div>
<input type="range" id="mood" min="0" max="10" value="5" oninput="updateSlider('mood')">
</div>

<div class="slider-group">
<div class="slider-header">
<span class="slider-label">üí™ Physical Energy</span>
<span class="slider-value" id="energyPhysicalVal">5</span>
</div>
<input type="range" id="energyPhysical" min="0" max="10" value="5" oninput="updateSlider('energyPhysical')">
</div>

<div class="slider-group">
<div class="slider-header">
<span class="slider-label">üß† Mental Energy</span>
<span class="slider-value" id="energyMentalVal">5</span>
</div>
<input type="range" id="energyMental" min="0" max="10" value="5" oninput="updateSlider('energyMental')">
</div>

<div class="slider-group">
<div class="slider-header">
<span class="slider-label">üéØ Focus</span>
<span class="slider-value" id="focusVal">5</span>
</div>
<input type="range" id="focus" min="0" max="10" value="5" oninput="updateSlider('focus')">
</div>

<div class="slider-group">
<div class="slider-header">
<span class="slider-label">üò∞ Stress</span>
<span class="slider-value" id="stressVal">5</span>
</div>
<input type="range" id="stress" min="0" max="10" value="5" oninput="updateSlider('stress')">
</div>

<div class="slider-group">
<div class="slider-header">
<span class="slider-label">üí§ Sleep</span>
<span class="slider-value" id="sleepVal">5</span>
</div>
<input type="range" id="sleep" min="0" max="10" value="5" oninput="updateSlider('sleep')">
</div>
</div>

<div class="card">
<h3>üí≠ Consciousness Deep Dive</h3>
<input id="emotion" placeholder="‚ù§Ô∏è Dominant Emotion (e.g., anxious, calm, excited)">
<input id="sensation" placeholder="üåä Physical Sensation (what you feel in body)">
<input id="pattern" placeholder="üîÑ Recurring Pattern (loops or cycles noticed)">
<input id="action" placeholder="‚ö° Key Decision/Action taken today">
<textarea id="thought" placeholder="üí≠ Raw Unfiltered Thoughts (stream of consciousness)"></textarea>
<input id="goal" placeholder="üéØ Current Goal or Intention">
<input id="obstacle" placeholder="üöß Main Obstacle or Challenge">
<button onclick="saveEntry()">üíæ Save Entry</button>
</div>

<div class="card">
<h3>Cognition Score</h3>
<div class="score" id="score">--</div>
<div class="state-label" id="stateLabel">Initializing...</div>

<div class="stats-grid">
<div class="stat-box">
<div class="stat-value" id="avgMood">--</div>
<div class="stat-label">Mood</div>
</div>
<div class="stat-box">
<div class="stat-value" id="avgFocus">--</div>
<div class="stat-label">Focus</div>
</div>
<div class="stat-box">
<div class="stat-value" id="totalLogs">0</div>
<div class="stat-label">Logs</div>
</div>
</div>
</div>

</div>

<!-- VOICE TAB -->
<div id="voiceTab" class="tab-content">
<div class="voice-box">
<h3>üé§ Voice Memo Recorder</h3>
<p style="font-size:13px;margin-bottom:12px">Real-time transcription powered by browser</p>
<button class="record" id="recordBtn" onclick="toggleRecording()">‚óè</button>
<p id="recordStatus" style="font-weight:600">Tap to start recording</p>
<div class="transcript-box" id="transcriptBox">Transcription will appear here...</div>
</div>

<div class="card">
<h3>üìÅ Voice Memos (<span id="memoCount">0</span>)</h3>
<div id="memosList"></div>
</div>
</div>

<!-- MEDIA TAB -->
<div id="mediaTab" class="tab-content">
<div class="card">
<h3>üì∏ Upload Visual Memories</h3>
<label class="upload-zone" for="mediaInput">
<div style="font-size:42px;margin-bottom:8px">üì∑</div>
<div style="font-weight:700;margin-bottom:4px">Tap to upload photos/videos</div>
<div style="font-size:12px;color:#9ca3af">Preserves visual consciousness states</div>
<input type="file" id="mediaInput" accept="image/*,video/*" onchange="uploadMedia(event)" multiple style="display:none">
</label>
</div>

<div class="card">
<h3>üñºÔ∏è Gallery (<span id="mediaCount">0</span>)</h3>
<div class="media-grid" id="mediaGallery"></div>
</div>
</div>

<!-- CHAT TAB -->
<div id="chatTab" class="tab-content">
<div class="card">
<h3>üí¨ Chat with Your AI Clone</h3>
<div class="chat-container">
<div class="chat-messages" id="chatMessages">
<div class="chat-msg assistant">
üëã I'm your AI consciousness clone! I've analyzed your patterns and can respond as you. Ask me about your mental states, patterns, or predictions.
</div>
</div>
<div class="chat-input-box">
<input type="text" id="chatInput" placeholder="Ask your clone..." onkeypress="if(event.key==='Enter') sendChat()">
<button onclick="sendChat()">Send</button>
</div>
</div>
</div>
</div>

<!-- ANALYSIS TAB -->
<div id="analysisTab" class="tab-content">

<div class="card">
<h3>ü§ñ AI Twin Insights</h3>
<div id="twin">Collecting consciousness data...</div>
</div>

<div class="card">
<h3>üîç Detected Patterns</h3>
<div id="patterns"></div>
</div>

<div class="card">
<h3>üìà Cognitive Trajectory</h3>
<div id="trajectory"></div>
</div>

<div class="card">
<h3>üîÆ Prediction Engine</h3>
<div id="prediction"></div>
</div>

<div class="card">
<h3>‚è±Ô∏è Passive Behavior Tracking</h3>
<div id="passive"></div>
</div>

<div class="card">
<button onclick="runFullAnalysis()">üß¨ Run Deep Analysis</button>
<div id="deepAnalysis"></div>
</div>

</div>

<!-- TIMELINE TAB -->
<div id="timelineTab" class="tab-content">
<div class="card">
<h3>üìä Complete Timeline</h3>
<div id="timeline"></div>
</div>

<div class="card">
<button onclick="exportData()">üì§ Export Data</button>
<button onclick="importData()" class="secondary">üì• Import Data</button>
</div>
</div>

<!-- Legal Modal -->
<div id="legalModal" class="modal">
<div class="modal-content">
<span class="close-btn" onclick="closeLegal()">‚úï</span>
<div id="legalText"></div>
</div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Footer -->
<footer>
¬© 2026 Consciousness OS‚Ñ¢. Complete Mind Preservation System.<br>
<a onclick="openLegal('terms')">Terms</a> |
<a onclick="openLegal('privacy')">Privacy</a> |
<a onclick="openLegal('about')">About</a>
</footer>

<script>

/* ==================== STATE ==================== */

let data = JSON.parse(localStorage.getItem('cos_data')||'[]')
let voiceMemos = JSON.parse(localStorage.getItem('cos_voice')||'[]')
let mediaFiles = JSON.parse(localStorage.getItem('cos_media')||'[]')
let sessionStart = Date.now()
let isRecording = false
let mediaRecorder = null
let audioChunks = []
let recognition = null
let fullTranscript = ''

/* ==================== UTILITIES ==================== */

function avg(arr){return arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : 0}
function last(n){return data.slice(-n)}
function showToast(msg){
toast.textContent=msg
toast.classList.add('show')
setTimeout(()=>toast.classList.remove('show'),3500)
}

/* ==================== TABS ==================== */

function switchTab(name){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'))
document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'))
event.target.classList.add('active')
document.getElementById(name+'Tab').classList.add('active')

if(name==='voice') loadVoiceMemos()
if(name==='media') loadMediaGallery()
if(name==='analysis') renderAnalysis()
if(name==='timeline') renderTimeline()
}

/* ==================== SLIDERS ==================== */

function updateSlider(id){
const slider=document.getElementById(id)
const display=document.getElementById(id+'Val')
if(slider && display) display.textContent=slider.value
}

/* ==================== COGNITION SCORE ==================== */

function cognitionScore(e){
return (
(e.focus*2.5 + 
e.energyMental*2.2 + 
e.energyPhysical*1.3 + 
e.mood*1.5 + 
e.sleep*1.8 + 
e.stress*-1.0) / 9.3
)
}

/* ==================== SESSION TRACKING ==================== */

function getSessionMinutes(){
return Math.round((Date.now()-sessionStart)/60000)
}

function resetSession(){
sessionStart=Date.now()
}

/* ==================== SAVE ENTRY ==================== */

function saveEntry(){
const e={
t:Date.now(),
mood:+document.getElementById('mood').value,
emotion:document.getElementById('emotion').value,
energyPhysical:+document.getElementById('energyPhysical').value,
energyMental:+document.getElementById('energyMental').value,
focus:+document.getElementById('focus').value,
stress:+document.getElementById('stress').value,
sleep:+document.getElementById('sleep').value,
pattern:document.getElementById('pattern').value,
sensation:document.getElementById('sensation').value,
action:document.getElementById('action').value,
thought:document.getElementById('thought').value,
goal:document.getElementById('goal').value,
obstacle:document.getElementById('obstacle').value,
session:getSessionMinutes()
}

e.cognition=cognitionScore(e)
data.push(e)
localStorage.setItem('cos_data',JSON.stringify(data))

resetSession()
document.querySelectorAll('#logTab input,#logTab textarea').forEach(x=>x.value='')
document.querySelectorAll('#logTab input[type="range"]').forEach(s=>{s.value=5;updateSlider(s.id)})

showToast(`‚úÖ Entry saved ‚Ä¢ Score: ${e.cognition.toFixed(1)}`)
renderDashboard()
}

/* ==================== DASHBOARD ==================== */

function renderDashboard(){
const d=last(10)
if(!d.length){
document.getElementById('score').textContent='--'
document.getElementById('stateLabel').textContent='No data yet'
document.getElementById('totalLogs').textContent='0'
return
}

const c=avg(d.map(x=>x.cognition))
document.getElementById('score').textContent=c.toFixed(1)

if(c>7.5) document.getElementById('stateLabel').innerHTML="üöÄ Peak Cognitive Performance"
else if(c>6) document.getElementById('stateLabel').innerHTML="‚ö° High Functional State"
else if(c>4.5) document.getElementById('stateLabel').innerHTML="‚öñÔ∏è Balanced State"
else document.getElementById('stateLabel').innerHTML="üåô Recovery Needed"

const recent=last(7)
document.getElementById('avgMood').textContent=avg(recent.map(x=>x.mood)).toFixed(1)
document.getElementById('avgFocus').textContent=avg(recent.map(x=>x.focus)).toFixed(1)
document.getElementById('totalLogs').textContent=data.length
}

/* ==================== VOICE RECORDING ==================== */

function initSpeechRecognition(){
try{
const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition
if(SpeechRecognition){
recognition=new SpeechRecognition()
recognition.continuous=true
recognition.interimResults=true
recognition.lang='en-US'

recognition.onresult=(event)=>{
let interim=''
let final=''
for(let i=event.resultIndex;i<event.results.length;i++){
const transcript=event.results[i][0].transcript
if(event.results[i].isFinal) final+=transcript+' '
else interim+=transcript
}
fullTranscript+=final
document.getElementById('transcriptBox').textContent=fullTranscript+interim
}

recognition.onerror=(event)=>{
console.error('Speech error:',event.error)
if(event.error==='not-allowed'){
showToast('‚ùå Mic permission denied')
alert('Enable microphone:\n1. Click lock/info icon in address bar\n2. Allow microphone\n3. Refresh page')
}
stopRecording()
}
}
}catch(e){
console.error('Speech init error:',e)
}
}

async function toggleRecording(){
const btn=document.getElementById('recordBtn')
const status=document.getElementById('recordStatus')

if(!isRecording){
try{
const stream=await navigator.mediaDevices.getUserMedia({audio:true})
mediaRecorder=new MediaRecorder(stream)
audioChunks=[]
fullTranscript=''

mediaRecorder.ondataavailable=(e)=>audioChunks.push(e.data)
mediaRecorder.onstop=()=>{
const blob=new Blob(audioChunks,{type:'audio/webm'})
const reader=new FileReader()
reader.onloadend=()=>{
const memo={
id:Date.now(),
timestamp:new Date().toISOString(),
audio:reader.result,
transcript:fullTranscript
}
voiceMemos.unshift(memo)
localStorage.setItem('cos_voice',JSON.stringify(voiceMemos))
loadVoiceMemos()
showToast('‚úÖ Voice memo saved')
}
reader.readAsDataURL(blob)
stream.getTracks().forEach(track=>track.stop())
}

mediaRecorder.start()
if(recognition) recognition.start()

isRecording=true
btn.classList.add('recording')
btn.textContent='‚è∏'
status.textContent='Recording... Tap to stop'
showToast('üé§ Recording started')
}catch(err){
console.error('Recording error:',err)
if(err.name==='NotAllowedError'){
showToast('‚ùå Microphone permission denied')
alert('Enable microphone:\n1. Click lock icon in address bar\n2. Allow microphone\n3. Refresh page')
}else{
showToast('‚ö†Ô∏è Could not access microphone')
}
stopRecording()
}
}else{
stopRecording()
}
}

function stopRecording(){
if(mediaRecorder && mediaRecorder.state!=='inactive') mediaRecorder.stop()
if(recognition) recognition.stop()

isRecording=false
const btn=document.getElementById('recordBtn')
const status=document.getElementById('recordStatus')
btn.classList.remove('recording')
btn.textContent='‚óè'
status.textContent='Tap to start recording'
}

function loadVoiceMemos(){
const container=document.getElementById('memosList')
const count=document.getElementById('memoCount')
count.textContent=voiceMemos.length

if(!voiceMemos.length){
container.innerHTML='<div style="padding:20px;text-align:center;color:#9ca3af">No voice memos yet</div>'
return
}

container.innerHTML=voiceMemos.slice(0,20).map(m=>`
<div style="padding:12px;background:#0a0a1f;border-radius:8px;margin-bottom:8px">
<div style="font-size:11px;color:#9ca3af;margin-bottom:8px">${new Date(m.timestamp).toLocaleString()}</div>
<audio controls src="${m.audio}" style="width:100%;height:36px;margin-bottom:8px"></audio>
${m.transcript?`<div style="font-size:13px;padding:8px;background:#020617;border-radius:6px">${m.transcript}</div>`:''}
</div>
`).join('')
}

/* ==================== MEDIA ==================== */

function uploadMedia(event){
const files=event.target.files
let processed=0

for(let file of files){
const reader=new FileReader()
reader.onload=(e)=>{
const media={
id:Date.now()+Math.random(),
timestamp:new Date().toISOString(),
type:file.type.startsWith('video')?'video':'image',
data:e.target.result,
name:file.name
}
mediaFiles.unshift(media)
processed++

if(processed===files.length){
localStorage.setItem('cos_media',JSON.stringify(mediaFiles))
loadMediaGallery()
showToast(`‚úÖ ${files.length} file(s) uploaded`)
}
}
reader.readAsDataURL(file)
}
event.target.value=''
}

function loadMediaGallery(){
const container=document.getElementById('mediaGallery')
const count=document.getElementById('mediaCount')
count.textContent=mediaFiles.length

if(!mediaFiles.length){
container.innerHTML='<div style="grid-column:1/-1;padding:40px;text-align:center;color:#9ca3af">No media yet</div>'
return
}

container.innerHTML=mediaFiles.slice(0,50).map(m=>`
<div class="media-item" title="${m.name} ‚Ä¢ ${new Date(m.timestamp).toLocaleDateString()}">
${m.type==='image'?`<img src="${m.data}" alt="${m.name}">`:`<video src="${m.data}"></video>`}
</div>
`).join('')
}

/* ==================== CHAT ==================== */

async function sendChat(){
const input=document.getElementById('chatInput')
const message=input.value.trim()
if(!message) return

addChatMsg('user',message)
input.value=''

const response=await getAIResponse(message)
addChatMsg('assistant',response)
}

function addChatMsg(role,content){
const container=document.getElementById('chatMessages')
const div=document.createElement('div')
div.className=`chat-msg ${role}`
div.textContent=content
container.appendChild(div)
container.scrollTop=container.scrollHeight
}

async function getAIResponse(msg){
if(!data.length) return "I don't have any data about you yet. Start logging your consciousness!"

const recent=last(7)
const avgMood=avg(recent.map(x=>x.mood)).toFixed(1)
const avgFocus=avg(recent.map(x=>x.focus)).toFixed(1)
const avgCog=avg(recent.map(x=>x.cognition)).toFixed(1)

if(msg.toLowerCase().includes('mood')||msg.toLowerCase().includes('feel')){
return `Your average mood is ${avgMood}/10 over the past week. ${
avgMood>7?'You\'ve been consistently positive!':
avgMood>5?'You\'re in a balanced state.':
'Things have been challenging. Consider what\'s affecting your mood.'
}`
}

if(msg.toLowerCase().includes('focus')||msg.toLowerCase().includes('concentrate')){
return `Your average focus is ${avgFocus}/10. ${
avgFocus>7?'Excellent concentration!':
avgFocus>5?'Decent but could optimize.':
'Your focus has been scattered. Try minimizing distractions.'
}`
}

if(msg.toLowerCase().includes('pattern')||msg.toLowerCase().includes('insight')){
const highStress=recent.filter(e=>e.stress>7).length
if(highStress>3) return `I've noticed ${highStress} high-stress states recently. This correlates with lower mood scores.`
return `Based on ${data.length} entries: Your cognition (${avgCog}) correlates strongly with sleep and stress levels.`
}

return `I've analyzed ${data.length} entries. Mood: ${avgMood}/10, Focus: ${avgFocus}/10, Cognition: ${avgCog}/10. What would you like to explore?`
}

/* ==================== ANALYSIS ==================== */

function renderAnalysis(){
renderTwin()
renderPatterns()
renderTrajectory()
renderPrediction()
renderPassive()
}

function renderTwin(){
const d=last(30)
const container=document.getElementById('twin')
if(d.length<6){
container.innerHTML='<p style="color:#9ca3af">Learning... Need 6+ entries for insights.</p>'
return
}

const moodAvg=Math.round(avg(d.map(x=>x.mood)))
const focusAvg=Math.round(avg(d.map(x=>x.focus)))
const sessionAvg=Math.round(avg(d.map(x=>x.session)))

container.innerHTML=`
<div class="badge primary">Mood Avg: ${moodAvg}/10</div>
<div class="badge primary">Focus Avg: ${focusAvg}/10</div>
<div class="badge primary">Session Avg: ${sessionAvg}min</div>
<p style="margin-top:12px;line-height:1.6">${passiveInsights()}</p>
`
}

function passiveInsights(){
const d=last(30)
if(d.length<8) return "Learning behavioral patterns..."

const long=d.filter(x=>x.session>5)
const short=d.filter(x=>x.session<=5)

if(!long.length||!short.length) return "Collecting session data..."

const longC=avg(long.map(x=>x.cognition))
const shortC=avg(short.map(x=>x.cognition))

if(longC>shortC+0.5) return "üìä Insight: Long sessions (>5min) boost cognition"
if(shortC>longC+0.5) return "‚ö° Insight: Short bursts boost cognition"
return "‚öñÔ∏è No clear session duration effect detected"
}

function renderPatterns(){
const d=last(30)
const container=document.getElementById('patterns')
if(!d.length){
container.innerHTML='<p style="color:#9ca3af">No patterns yet</p>'
return
}

const freq={}
d.forEach(x=>{if(x.pattern)freq[x.pattern]=(freq[x.pattern]||0)+1})
const top=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,6)

if(!top.length){
container.innerHTML='<p style="color:#9ca3af">No patterns logged yet. Add patterns to your entries!</p>'
return
}

container.innerHTML=top.map(p=>`<span class="badge">${p[0]} (${p[1]}√ó)</span>`).join('')
}

function renderTrajectory(){
const d=last(20)
const container=document.getElementById('trajectory')
if(d.length<10){
container.innerHTML='<p style="color:#9ca3af">Mapping trajectory... Need 10+ entries</p>'
return
}

const early=avg(d.slice(0,5).map(x=>x.cognition))
const recent=avg(d.slice(-5).map(x=>x.cognition))

if(recent>early+0.5)
container.innerHTML='<span class="badge success">üìà Expanding cognition (+'+((recent-early).toFixed(1))+')</span>'
else if(recent<early-0.5)
container.innerHTML='<span class="badge warning">üìâ Declining cognition ('+((recent-early).toFixed(1))+')</span>'
else
container.innerHTML='<span class="badge">‚û°Ô∏è Stable trajectory</span>'
}

function renderPrediction(){
const d=last(10)
const container=document.getElementById('prediction')
if(d.length<6){
container.innerHTML='<p style="color:#9ca3af">Need 6+ entries for predictions</p>'
return
}

const trend=avg(d.slice(-3).map(x=>x.cognition)) - avg(d.slice(0,3).map(x=>x.cognition))

if(trend>0.5)
container.innerHTML='<span class="badge success">üîÆ High cognition likely tomorrow</span>'
else if(trend<-0.5)
container.innerHTML='<span class="badge warning">‚ö†Ô∏è Low focus risk tomorrow</span>'
else
container.innerHTML='<span class="badge">‚û°Ô∏è Stable cognition expected</span>'
}

function renderPassive(){
const d=last(20)
const container=document.getElementById('passive')
if(d.length<6){
container.innerHTML='<p style="color:#9ca3af">Learning behavioral patterns...</p>'
return
}

const avgSession=Math.round(avg(d.map(x=>x.session)))
const totalTime=d.reduce((sum,x)=>sum+x.session,0)

container.innerHTML=`
<div class="badge primary">Avg Session: ${avgSession}min</div>
<div class="badge primary">Total Time: ${totalTime}min</div>
<div class="badge primary">Sessions: ${d.length}</div>
<p style="margin-top:12px;font-size:13px;color:#9ca3af">
Tracking: Time spent per entry, session patterns, cognitive performance vs session length
</p>
`
}

function runFullAnalysis(){
const container=document.getElementById('deepAnalysis')
container.innerHTML='<div style="padding:20px;text-align:center"><div style="font-size:14px;color:#9ca3af">üß¨ Analyzing consciousness patterns...</div></div>'

setTimeout(()=>{
const d=last(30)
if(d.length<5){
container.innerHTML='<div style="margin-top:12px;padding:16px;background:#1f2937;border-radius:10px;color:#9ca3af">Need at least 5 entries for deep analysis. Current: '+d.length+'/5</div>'
return
}

const avgCog=avg(d.map(x=>x.cognition)).toFixed(1)
const avgMood=avg(d.map(x=>x.mood)).toFixed(1)
const avgFocus=avg(d.map(x=>x.focus)).toFixed(1)
const avgStress=avg(d.map(x=>x.stress)).toFixed(1)

let analysis=`<div style="margin-top:12px;padding:16px;background:linear-gradient(135deg,rgba(139,92,246,0.1),rgba(124,58,237,0.1));border:1px solid #8b5cf6;border-radius:10px">
<div style="font-weight:700;margin-bottom:12px">ü§ñ Deep Analysis Results</div>
<div style="line-height:1.8;font-size:14px">

<strong>Overall State:</strong> Based on ${d.length} entries:<br>
‚Ä¢ Cognition Score: ${avgCog}/10 ${avgCog>7?'(Excellent)':avgCog>5?'(Good)':'(Needs attention)'}<br>
‚Ä¢ Mood: ${avgMood}/10<br>
‚Ä¢ Focus: ${avgFocus}/10<br>
‚Ä¢ Stress: ${avgStress}/10 ${avgStress>7?'‚ö†Ô∏è High':'‚úÖ Manageable'}<br><br>

<strong>Insights:</strong><br>`

if(avgCog>7.5) analysis+='‚úÖ You\'re in peak cognitive performance. Maintain current habits.<br>'
else if(avgCog>6) analysis+='‚ö° Strong functional state. Room for optimization.<br>'
else if(avgCog<5) analysis+='‚ö†Ô∏è Below optimal. Prioritize rest, stress management, and sleep.<br>'

if(avgStress>7) analysis+='üî• High stress detected. Consider stress-reduction techniques.<br>'
if(avgFocus<5) analysis+='üéØ Low focus patterns. Try eliminating distractions or time-blocking.<br>'

const burnout=d.filter(e=>e.mood<4 && e.stress>7).length
if(burnout>3) analysis+='‚ö†Ô∏è Burnout risk: '+burnout+' high-stress, low-mood states detected.<br>'

const flow=d.filter(e=>e.focus>7 && e.cognition>7.5).length
if(flow>3) analysis+='üåä Flow states: '+flow+' detected. You\'re accessing peak performance.<br>'

analysis+=`</div></div>`
container.innerHTML=analysis
},1000)
}

/* ==================== TIMELINE ==================== */

function renderTimeline(){
const container=document.getElementById('timeline')
if(!data.length){
container.innerHTML='<div style="padding:40px;text-align:center;color:#9ca3af">No entries yet. Start logging!</div>'
return
}

container.innerHTML=data.slice().reverse().slice(0,50).map(x=>{
const cog=x.cognition
const cls=cog>=8?'peak':cog<4?'low':''

return `
<div class="timeline-entry ${cls}">
<div style="display:flex;justify-content:space-between;margin-bottom:8px">
<span style="font-size:12px;color:#9ca3af">${new Date(x.t).toLocaleString()}</span>
<span style="font-weight:900;color:#8b5cf6">${cog.toFixed(1)}</span>
</div>
<div style="margin-bottom:6px">
${x.emotion?`<span class="badge">${x.emotion}</span>`:''}
<span class="badge">F${x.focus}</span>
<span class="badge">E${x.energyMental}</span>
<span class="badge">S${x.stress}</span>
${x.pattern?`<span class="badge">${x.pattern}</span>`:''}
</div>
${x.thought?`<div style="font-size:13px;color:#d1d5db;margin-top:8px">${x.thought.substring(0,150)}${x.thought.length>150?'...':''}</div>`:''}
</div>
`
}).join('')
}

/* ==================== EXPORT/IMPORT ==================== */

function exportData(){
const exportObj={
version:'4.0-ultimate',
exported:new Date().toISOString(),
entries:data,
voiceMemos:voiceMemos,
media:mediaFiles,
stats:{
total:data.length,
avgCognition:avg(data.map(x=>x.cognition)).toFixed(2)
}
}

const blob=new Blob([JSON.stringify(exportObj,null,2)],{type:'application/json'})
const a=document.createElement('a')
a.href=URL.createObjectURL(blob)
a.download='consciousness-os-'+new Date().toISOString().split('T')[0]+'.json'
a.click()
showToast('üì§ Data exported successfully')
}

function importData(){
const inp=document.createElement('input')
inp.type='file'
inp.accept='.json'
inp.onchange=e=>{
const file=e.target.files[0]
const reader=new FileReader()
reader.onload=ev=>{
try{
const imported=JSON.parse(ev.target.result)
data=imported.entries||imported||[]
voiceMemos=imported.voiceMemos||[]
mediaFiles=imported.media||[]

localStorage.setItem('cos_data',JSON.stringify(data))
localStorage.setItem('cos_voice',JSON.stringify(voiceMemos))
localStorage.setItem('cos_media',JSON.stringify(mediaFiles))

renderDashboard()
renderAnalysis()
renderTimeline()
showToast('‚úÖ Data imported: '+data.length+' entries')
}catch(err){
showToast('‚ùå Import failed: Invalid file')
console.error(err)
}
}
reader.readAsText(file)
}
inp.click()
}

/* ==================== LEGAL ==================== */

function openLegal(type){
const modal=document.getElementById('legalModal')
const content=document.getElementById('legalText')

modal.classList.add('show')

if(type==='terms'){
content.innerHTML=`
<h3>Terms of Use</h3>
<p>Consciousness OS‚Ñ¢ is provided for personal cognitive tracking and self-reflection.</p>
<p>All data remains stored locally unless exported by the user.</p>
<p>The creator provides this software "as-is" without warranty.</p>
<p>Users may not commercially exploit the algorithms or concepts without permission.</p>
`
}else if(type==='privacy'){
content.innerHTML=`
<h3>Privacy Policy</h3>
<p>Consciousness OS‚Ñ¢ does not collect or transmit data to external servers.</p>
<p>All entries are stored locally in your browser.</p>
<p>No third-party analytics or tracking is included.</p>
<p>Users retain full ownership of their data.</p>
`
}else if(type==='about'){
content.innerHTML=`
<h3>About Consciousness OS Ultimate</h3>
<p><strong>Version:</strong> 4.0 Ultimate</p>
<p><strong>Features:</strong></p>
<ul style="line-height:1.8;margin-top:8px">
<li>18-field consciousness logging</li>
<li>Voice recording with real-time transcription</li>
<li>Photo/video memory preservation</li>
<li>AI consciousness clone chatbot</li>
<li>Passive behavior tracking</li>
<li>Pattern detection & analysis</li>
<li>Cognitive trajectory mapping</li>
<li>Predictive insights</li>
<li>Complete data ownership</li>
</ul>
<p style="margin-top:12px">Built for complete mind preservation and consciousness tracking.</p>
`
}
}

function closeLegal(){
document.getElementById('legalModal').classList.remove('show')
}

/* ==================== INIT ==================== */

function init(){
initSpeechRecognition()
renderDashboard()
console.log('‚úÖ Consciousness OS Ultimate loaded')
console.log('üìä Entries:',data.length)
console.log('üé§ Voice memos:',voiceMemos.length)
console.log('üì∑ Media files:',mediaFiles.length)
}

init()

</script>
</body>
</html>
