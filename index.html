<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consciousness OS ‚Äì Mind Enhancement System v5.0</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
/* ===================== CSS VARIABLES ===================== */
:root {
  --bg: #f5f3ff;
  --bg2: #ffffff;
  --bg3: #ede9fe;
  --bg4: #f8f7ff;
  --border: #ddd6fe;
  --text: #1e1040;
  --text2: #7c6db0;
  --text3: #a89ed0;
  --accent: #7c3aed;
  --accent2: #ec4899;
  --accent3: #06b6d4;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --card-shadow: 0 2px 12px rgba(124,58,237,0.08);
  --card-shadow-hover: 0 8px 24px rgba(124,58,237,0.18);
  --radius: 16px;
  --radius-sm: 10px;
  --font-head: 'Syne', sans-serif;
  --font-body: 'DM Sans', sans-serif;
}
[data-theme="dark"] {
  --bg: #080616;
  --bg2: #0e0b1f;
  --bg3: #1a1535;
  --bg4: #120f28;
  --border: #2a2245;
  --text: #e8e3ff;
  --text2: #9e8fd4;
  --text3: #6b5e99;
  --card-shadow: 0 2px 12px rgba(0,0,0,0.5);
  --card-shadow-hover: 0 8px 24px rgba(124,58,237,0.3);
}

/* ===================== RESET & BASE ===================== */
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  font-family:var(--font-body);
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
  transition:background 0.3s, color 0.3s;
  min-height:100vh;
  font-size:15px;
}

/* ===================== LAYOUT ===================== */
.app-shell{display:flex;flex-direction:column;min-height:100vh}
.main-content{flex:1;padding:20px;max-width:900px;margin:0 auto;width:100%;padding-bottom:100px}

/* ===================== HEADER ===================== */
.topbar{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 20px;
  background:var(--bg2);
  border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:100;
  box-shadow:var(--card-shadow);
}
.topbar-brand{
  font-family:var(--font-head);
  font-size:17px;font-weight:800;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.topbar-actions{display:flex;align-items:center;gap:10px}
.theme-btn{
  background:var(--bg3);border:1px solid var(--border);
  border-radius:50%;width:38px;height:38px;cursor:pointer;
  font-size:18px;display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;color:var(--text);
}
.theme-btn:hover{background:var(--accent);color:#fff;border-color:var(--accent)}

/* ===================== NAV TABS ===================== */
.nav-strip{
  display:flex;gap:6px;overflow-x:auto;padding:12px 20px;
  background:var(--bg2);border-bottom:1px solid var(--border);
  scrollbar-width:none;position:sticky;top:61px;z-index:99;
}
.nav-strip::-webkit-scrollbar{display:none}
.nav-tab{
  flex-shrink:0;padding:8px 16px;
  background:transparent;border:1.5px solid var(--border);
  border-radius:100px;color:var(--text2);
  cursor:pointer;font-family:var(--font-body);
  font-size:13px;font-weight:600;white-space:nowrap;
  transition:all 0.2s;
}
.nav-tab.active{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border-color:transparent;color:#fff;
  box-shadow:0 4px 12px rgba(124,58,237,0.35);
}
.nav-tab:hover:not(.active){background:var(--bg3);color:var(--text)}

/* ===================== TAB CONTENT ===================== */
.tab-pane{display:none;animation:fadeUp 0.3s ease}
.tab-pane.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* ===================== CARDS ===================== */
.card{
  background:var(--bg2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px;
  margin-bottom:20px;
  box-shadow:var(--card-shadow);
  transition:box-shadow 0.2s;
}
.card:hover{box-shadow:var(--card-shadow-hover)}
.card-title{
  font-family:var(--font-head);
  font-size:17px;font-weight:700;
  color:var(--accent);margin-bottom:6px;
  display:flex;align-items:center;gap:8px;
}
.card-desc{font-size:13px;color:var(--text2);margin-bottom:16px;line-height:1.6}

/* ===================== SLIDERS ===================== */
.slider-wrap{margin-bottom:28px}
.slider-header{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:10px}
.slider-name{font-size:14px;font-weight:700;color:var(--text)}
.slider-badge{
  font-size:28px;font-weight:800;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  font-family:var(--font-head);line-height:1;
}
input[type="range"]{
  width:100%;height:10px;border-radius:5px;
  outline:none;-webkit-appearance:none;border:none;cursor:pointer;
  background:linear-gradient(90deg,#ef4444 0%,#f59e0b 25%,#eab308 45%,#84cc16 65%,#22c55e 80%,#8b5cf6 100%);
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;width:26px;height:26px;border-radius:50%;
  background:var(--bg2);cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,0.25);
  border:3px solid var(--accent);transition:transform 0.1s;
}
input[type="range"]::-webkit-slider-thumb:hover{transform:scale(1.15)}
input[type="range"]::-moz-range-thumb{
  width:26px;height:26px;border-radius:50%;
  background:var(--bg2);cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,0.25);
  border:3px solid var(--accent);
}
.slider-anchors{
  font-size:11.5px;color:var(--text2);
  margin-top:10px;padding:12px 14px;
  background:var(--bg4);border-radius:10px;
  line-height:1.9;border:1px solid var(--border);
}
.slider-anchors span{font-weight:700;color:var(--accent)}
.anchor-row{margin:2px 0}

/* ===================== INPUTS ===================== */
input[type="text"],input[type="number"],input[type="date"],
input[type="time"],input[type="datetime-local"],textarea,select{
  width:100%;padding:11px 14px;
  margin:6px 0;border-radius:10px;
  border:1.5px solid var(--border);
  background:var(--bg4);color:var(--text);
  font-size:14px;font-family:var(--font-body);
  transition:all 0.2s;
}
input:focus,textarea:focus,select:focus{
  outline:none;border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(124,58,237,0.12);
  background:var(--bg2);
}
textarea{min-height:90px;resize:vertical;line-height:1.6}
.input-label{
  display:block;font-size:12px;font-weight:600;
  color:var(--text2);margin-bottom:4px;margin-top:12px;
  text-transform:uppercase;letter-spacing:0.5px;
}
.input-hint{font-size:11px;color:var(--text3);margin-top:3px;font-style:italic}

/* ===================== BUTTONS ===================== */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:12px 22px;border-radius:12px;border:none;
  font-family:var(--font-body);font-size:14px;font-weight:700;
  cursor:pointer;transition:all 0.2s;text-decoration:none;
}
.btn-primary{
  background:linear-gradient(135deg,var(--accent),#6d28d9);
  color:#fff;width:100%;
  box-shadow:0 4px 14px rgba(124,58,237,0.35);
}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(124,58,237,0.5)}
.btn-secondary{
  background:var(--bg3);color:var(--text2);
  border:1.5px solid var(--border);width:100%;margin-top:10px;
}
.btn-secondary:hover{background:var(--border);color:var(--text)}
.btn-danger{background:#fef2f2;color:#ef4444;border:1.5px solid #fecaca;width:100%;margin-top:10px}
.btn-danger:hover{background:#ef4444;color:#fff}
.btn-sm{padding:8px 16px;font-size:12px;border-radius:8px;width:auto;margin:0}
.btn-success{background:#ecfdf5;color:#10b981;border:1.5px solid #a7f3d0;width:auto;padding:8px 16px;font-size:12px;border-radius:8px;margin:0}
.btn-success:hover{background:#10b981;color:#fff}

/* ===================== SCORE DISPLAY ===================== */
.score-mega{
  font-size:72px;font-weight:900;text-align:center;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  line-height:1;margin:10px 0;font-family:var(--font-head);
}
.score-label{
  text-align:center;font-size:15px;font-weight:700;color:var(--text2);
  padding:10px 20px;background:var(--bg3);border-radius:12px;margin-top:10px;
}

/* ===================== STATS GRID ===================== */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:12px;margin:16px 0}
.stat-box{
  background:var(--bg4);padding:16px;border-radius:12px;
  text-align:center;border:1px solid var(--border);
}
.stat-val{font-size:30px;font-weight:900;color:var(--accent);font-family:var(--font-head)}
.stat-lbl{font-size:10px;color:var(--text2);margin-top:6px;text-transform:uppercase;letter-spacing:0.6px;font-weight:600}

/* ===================== CHAT ===================== */
.chat-box{
  height:460px;display:flex;flex-direction:column;
  background:var(--bg4);border-radius:14px;
  padding:16px;border:1px solid var(--border);
}
.chat-msgs{flex:1;overflow-y:auto;padding-right:4px;margin-bottom:12px}
.chat-msgs::-webkit-scrollbar{width:4px}
.chat-msgs::-webkit-scrollbar-track{background:transparent}
.chat-msgs::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.msg{padding:11px 15px;border-radius:14px;margin:8px 0;max-width:82%;line-height:1.55;font-size:14px}
.msg.user{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;margin-left:auto}
.msg.ai{background:var(--bg2);color:var(--text);border:1px solid var(--border);margin-right:auto}
.chat-input-row{display:flex;gap:10px}
.chat-input-row input{flex:1;margin:0}
.chat-input-row .btn{width:auto;padding:11px 20px}
.twin-indicator{
  display:flex;align-items:center;gap:10px;
  padding:12px 16px;background:var(--bg3);
  border-radius:12px;margin-bottom:14px;
  border:1px solid var(--border);font-size:13px;color:var(--text2);
}
.twin-avatar{
  width:36px;height:36px;border-radius:50%;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;
}
.twin-status{display:flex;flex-direction:column}
.twin-name{font-weight:700;color:var(--text);font-size:14px}
.twin-info{font-size:11px;color:var(--text3)}

/* ===================== GAMES ===================== */
.game-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px}
.game-card{
  background:var(--bg4);border:1.5px solid var(--border);
  border-radius:14px;padding:22px 16px;cursor:pointer;
  transition:all 0.25s;text-align:center;
}
.game-card:hover{transform:translateY(-5px);border-color:var(--accent);box-shadow:var(--card-shadow-hover)}
.game-icon{font-size:44px;margin-bottom:10px}
.game-title{font-size:14px;font-weight:800;margin-bottom:6px;font-family:var(--font-head)}
.game-desc{font-size:11.5px;color:var(--text2);margin-bottom:12px}
.game-badge{
  display:inline-block;padding:3px 10px;border-radius:100px;
  font-size:10px;font-weight:700;
}
.badge-easy{background:#ecfdf5;color:#10b981}
.badge-med{background:#fffbeb;color:#f59e0b}
.badge-hard{background:#fef2f2;color:#ef4444}

/* ===================== GAME ARENA ===================== */
.game-arena{
  min-height:400px;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  background:var(--bg4);border-radius:16px;
  border:1px solid var(--border);padding:30px;
  text-align:center;
}
.game-arena h2{font-family:var(--font-head);font-size:22px;margin-bottom:12px}
.game-score-big{
  font-size:80px;font-weight:900;font-family:var(--font-head);
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1;
}
.memory-grid{
  display:grid;gap:10px;margin:20px 0;
}
.mem-card{
  width:70px;height:70px;border-radius:12px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:28px;user-select:none;transition:all 0.3s;
  box-shadow:0 4px 12px rgba(124,58,237,0.3);
  transform-style:preserve-3d;
}
.mem-card.hidden{background:var(--bg3);box-shadow:none}
.mem-card.matched{background:#10b981;cursor:default}
.reaction-light{
  width:140px;height:140px;border-radius:50%;
  background:var(--bg3);margin:30px auto;
  cursor:pointer;transition:all 0.3s;
  display:flex;align-items:center;justify-content:center;
  font-size:40px;border:4px solid var(--border);
}
.reaction-light.red{background:#ef4444;border-color:#dc2626}
.reaction-light.green{background:#22c55e;border-color:#16a34a;animation:pulse 0.5s ease}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
.stroop-word{
  font-size:64px;font-weight:900;font-family:var(--font-head);
  margin:20px 0;line-height:1;
}
.stroop-options{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:16px 0}
.stroop-btn{
  padding:12px 24px;border-radius:12px;border:2px solid;
  font-size:15px;font-weight:700;cursor:pointer;
  transition:all 0.15s;font-family:var(--font-body);
}
.nback-display{
  width:200px;height:200px;margin:20px auto;
  display:grid;grid-template-columns:repeat(3,1fr);gap:8px;
}
.nback-cell{
  border-radius:8px;background:var(--bg3);
  border:2px solid var(--border);transition:all 0.2s;
}
.nback-cell.active{background:linear-gradient(135deg,var(--accent),var(--accent2))}
.progress-bar-wrap{width:100%;background:var(--bg3);border-radius:100px;height:10px;margin:12px 0;border:1px solid var(--border)}
.progress-bar-fill{height:100%;border-radius:100px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width 0.3s}
.math-problem{font-size:52px;font-weight:900;font-family:var(--font-head);margin:16px 0}
.math-options{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin:16px 0;width:100%;max-width:320px}
.math-btn{
  padding:16px;border-radius:12px;font-size:20px;font-weight:700;
  border:2px solid var(--border);background:var(--bg2);cursor:pointer;
  font-family:var(--font-head);color:var(--text);transition:all 0.15s;
}
.math-btn:hover{border-color:var(--accent);background:var(--bg3)}
.math-btn.correct{background:#ecfdf5;border-color:#10b981;color:#10b981}
.math-btn.wrong{background:#fef2f2;border-color:#ef4444;color:#ef4444}

/* ===================== CALENDAR ===================== */
.cal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.cal-day{
  aspect-ratio:1;display:flex;align-items:center;justify-content:center;
  background:var(--bg4);border-radius:8px;cursor:pointer;
  font-size:13px;font-weight:600;border:1px solid var(--border);
  transition:all 0.15s;
}
.cal-day:hover{background:var(--bg3);border-color:var(--accent)}
.cal-day.today{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border-color:transparent}
.cal-day.has-entry{border-color:var(--accent);color:var(--accent)}
.cal-day-hdr{text-align:center;font-size:11px;font-weight:700;color:var(--text3);padding:6px 0;text-transform:uppercase;letter-spacing:0.5px}

/* ===================== TOGGLE SWITCH ===================== */
.toggle-row{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:var(--bg4);border-radius:12px;margin-bottom:10px;border:1px solid var(--border)}
.toggle-lbl{font-size:14px;font-weight:600;color:var(--text)}
.toggle{position:relative;width:48px;height:26px;cursor:pointer}
.toggle input{display:none}
.toggle-track{
  position:absolute;inset:0;background:var(--border);
  border-radius:13px;transition:0.3s;
}
.toggle input:checked+.toggle-track{background:var(--accent)}
.toggle-thumb{
  position:absolute;width:20px;height:20px;background:#fff;
  border-radius:50%;top:3px;left:3px;transition:0.3s;
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.toggle input:checked~.toggle-thumb{left:25px}

/* ===================== ONBOARDING OVERLAY ===================== */
.onboarding{
  position:fixed;inset:0;background:rgba(8,6,22,0.92);
  z-index:1000;display:flex;align-items:center;justify-content:center;
  padding:20px;
}
.onboarding.hidden{display:none}
.onboard-card{
  background:var(--bg2);border-radius:24px;max-width:560px;width:100%;
  padding:40px;border:1px solid var(--border);
  box-shadow:0 30px 80px rgba(124,58,237,0.3);
  max-height:90vh;overflow-y:auto;
}
.onboard-step{display:none}
.onboard-step.active{display:block;animation:fadeUp 0.35s}
.onboard-progress{display:flex;gap:6px;margin-bottom:28px;justify-content:center}
.onboard-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--border);transition:all 0.3s;cursor:pointer;
}
.onboard-dot.active{background:var(--accent);width:24px;border-radius:4px}
.feature-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:20px 0}
.feature-item{
  padding:16px;background:var(--bg4);border-radius:14px;
  border:1px solid var(--border);text-align:center;
}
.feature-icon{font-size:32px;margin-bottom:8px}
.feature-name{font-size:12px;font-weight:700;color:var(--text);font-family:var(--font-head)}
.feature-tip{font-size:11px;color:var(--text2);margin-top:4px;line-height:1.5}

/* ===================== HEALTH QUESTIONNAIRE ===================== */
.hq-progress{
  display:flex;align-items:center;gap:12px;margin-bottom:20px;
  padding:14px;background:var(--bg4);border-radius:12px;
  border:1px solid var(--border);
}
.hq-step-indicator{
  font-size:12px;font-weight:700;color:var(--text2);white-space:nowrap;
}
.hq-section{display:none}
.hq-section.active{display:block;animation:fadeUp 0.3s}
.hq-label{
  display:block;font-size:12px;font-weight:700;
  color:var(--text2);margin:10px 0 4px;
  text-transform:uppercase;letter-spacing:0.5px;
}
.hq-nav{display:flex;gap:10px;margin-top:18px}
.checkbox-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.check-item{
  display:flex;align-items:center;gap:8px;
  padding:8px 12px;background:var(--bg4);
  border-radius:8px;border:1px solid var(--border);
  cursor:pointer;font-size:13px;color:var(--text);
}
.check-item input{width:16px;height:16px;accent-color:var(--accent);cursor:pointer}
.radio-group{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.radio-btn{
  padding:7px 14px;border-radius:100px;
  border:1.5px solid var(--border);font-size:12px;
  font-weight:600;cursor:pointer;color:var(--text2);
  transition:all 0.2s;background:var(--bg4);
}
.radio-btn.selected{background:var(--accent);color:#fff;border-color:var(--accent)}

/* ===================== DREAMS / LUCID ===================== */
.dream-type-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin:12px 0}
.dream-type{
  padding:14px;text-align:center;border-radius:12px;
  border:1.5px solid var(--border);cursor:pointer;
  background:var(--bg4);transition:all 0.2s;
}
.dream-type:hover,.dream-type.selected{border-color:var(--accent);background:var(--bg3);color:var(--accent)}
.dream-type-icon{font-size:28px;margin-bottom:6px}
.dream-type-name{font-size:12px;font-weight:700}
.technique-card{
  background:var(--bg4);border-radius:14px;border:1px solid var(--border);
  padding:18px;margin-bottom:12px;cursor:pointer;transition:all 0.2s;
}
.technique-card:hover{border-color:var(--accent);background:var(--bg3)}
.technique-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.technique-name{font-size:15px;font-weight:700;font-family:var(--font-head)}
.technique-rating{font-size:11px;color:var(--text2)}
.technique-desc{font-size:13px;color:var(--text2);line-height:1.6}
.lucid-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:16px 0}
.lucid-stat{
  background:var(--bg4);padding:16px;border-radius:12px;
  text-align:center;border:1px solid var(--border);
}
.lucid-stat-val{font-size:28px;font-weight:900;color:var(--accent);font-family:var(--font-head)}
.lucid-stat-lbl{font-size:10px;color:var(--text2);margin-top:4px;text-transform:uppercase;letter-spacing:0.5px}
.reality-check-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
.rc-item{
  padding:14px;background:var(--bg4);border-radius:12px;
  border:1px solid var(--border);text-align:center;cursor:pointer;
  transition:all 0.2s;
}
.rc-item:hover{border-color:var(--accent);transform:translateY(-2px)}
.rc-icon{font-size:30px;margin-bottom:8px}
.rc-name{font-size:12px;font-weight:700;color:var(--text)}
.rc-desc{font-size:10.5px;color:var(--text2);margin-top:4px;line-height:1.4}
.dream-entry{
  padding:14px;background:var(--bg4);border-radius:12px;
  border:1px solid var(--border);margin-bottom:10px;
}
.dream-entry-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.dream-entry-date{font-size:11px;color:var(--text3)}
.dream-entry-badges{display:flex;gap:6px}
.dream-badge{
  display:inline-block;padding:2px 8px;border-radius:100px;font-size:10px;font-weight:700;
}
.badge-lucid{background:#f3e8ff;color:var(--accent)}
.badge-normal{background:var(--bg3);color:var(--text2)}

/* ===================== CONSCIOUSNESS FEATURES ===================== */
.brainwave-selector{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin:12px 0}
.bw-item{
  padding:14px 10px;border-radius:12px;border:2px solid var(--border);
  cursor:pointer;text-align:center;transition:all 0.2s;background:var(--bg4);
}
.bw-item.selected{border-color:var(--accent);background:var(--bg3)}
.bw-icon{font-size:26px;margin-bottom:6px}
.bw-name{font-size:12px;font-weight:700;color:var(--text)}
.bw-hz{font-size:10px;color:var(--text2);margin-top:2px}
.flow-meter{
  position:relative;width:200px;height:200px;margin:20px auto;
}
.flow-circle{
  width:100%;height:100%;border-radius:50%;
  background:conic-gradient(var(--accent) 0deg, var(--bg3) 0deg);
  transition:background 0.5s;
  display:flex;align-items:center;justify-content:center;
  font-size:36px;font-weight:900;color:var(--accent);
  font-family:var(--font-head);box-shadow:0 0 40px rgba(124,58,237,0.2);
}

/* ===================== TOAST ===================== */
.toast{
  position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(120px);
  background:var(--text);color:var(--bg2);padding:14px 24px;
  border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,0.3);
  z-index:9999;font-weight:700;font-size:14px;
  transition:transform 0.35s cubic-bezier(0.34,1.56,0.64,1);
  pointer-events:none;white-space:nowrap;
}
.toast.show{transform:translateX(-50%) translateY(0)}

/* ===================== MODAL ===================== */
.modal{
  position:fixed;inset:0;background:rgba(8,6,22,0.85);
  z-index:500;display:none;align-items:center;justify-content:center;padding:20px;
}
.modal.open{display:flex}
.modal-box{
  background:var(--bg2);border:1px solid var(--border);
  border-radius:20px;padding:28px;max-width:640px;
  max-height:85vh;overflow-y:auto;width:100%;
  box-shadow:0 30px 60px rgba(0,0,0,0.4);
  animation:fadeUp 0.3s;
}
.modal-close{
  float:right;font-size:24px;cursor:pointer;color:var(--text2);
  line-height:1;padding:4px;border-radius:6px;background:var(--bg3);
  width:32px;height:32px;display:flex;align-items:center;justify-content:center;
}
.modal-close:hover{color:var(--text)}

/* ===================== FOOTER ===================== */
.footer{
  background:var(--bg2);border-top:1px solid var(--border);
  padding:28px 20px;text-align:center;
}
.footer-links{display:flex;flex-wrap:wrap;justify-content:center;gap:6px 20px;margin-bottom:14px}
.footer-links a{
  font-size:12px;color:var(--text2);text-decoration:none;
  font-weight:600;transition:color 0.2s;
}
.footer-links a:hover{color:var(--accent)}
.footer-copy{font-size:11px;color:var(--text3)}
.footer-brand{
  font-family:var(--font-head);font-size:14px;font-weight:800;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:12px;
}

/* ===================== SECTION DIVIDER ===================== */
.section-title{
  font-family:var(--font-head);font-size:13px;font-weight:800;
  text-transform:uppercase;letter-spacing:1.2px;color:var(--text3);
  margin:24px 0 12px;padding-bottom:8px;border-bottom:1px solid var(--border);
}

/* ===================== RESPONSIVE ===================== */
@media(max-width:600px){
  .main-content{padding:14px;padding-bottom:90px}
  .score-mega{font-size:56px}
  .feature-grid{grid-template-columns:1fr}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .game-grid{grid-template-columns:1fr 1fr}
  .onboard-card{padding:24px}
  .hq-nav{flex-direction:column}
  .lucid-stats{grid-template-columns:repeat(3,1fr)}
}

/* ===================== MISC ===================== */
.empty-state{text-align:center;padding:40px 20px;color:var(--text3)}
.empty-state .empty-icon{font-size:48px;margin-bottom:12px}
.empty-state p{font-size:14px;line-height:1.6}
.insight-box{
  padding:16px;background:linear-gradient(135deg,rgba(124,58,237,0.08),rgba(236,72,153,0.06));
  border-radius:12px;border:1px solid rgba(124,58,237,0.2);
  margin:10px 0;font-size:13px;line-height:1.7;color:var(--text);
}
.insight-box strong{color:var(--accent)}
.tag{
  display:inline-block;padding:4px 10px;border-radius:100px;
  font-size:11px;font-weight:700;background:var(--bg3);
  color:var(--text2);border:1px solid var(--border);margin:3px;
}
</style>
</head>
<body>

<!-- =================== ONBOARDING OVERLAY =================== -->
<div class="onboarding" id="onboarding">
<div class="onboard-card">
  <div class="onboard-progress" id="onboardProgress"></div>

  <!-- Step 1: Welcome -->
  <div class="onboard-step active" data-step="0">
    <div style="text-align:center;margin-bottom:24px">
      <div style="font-size:56px;margin-bottom:12px">üß†</div>
      <h1 style="font-family:var(--font-head);font-size:26px;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px">Consciousness OS</h1>
      <p style="color:var(--text2);font-size:15px;line-height:1.6">Your complete mind preservation, enhancement &amp; consciousness tracking system. Let's take a quick tour.</p>
    </div>
    <div class="feature-grid">
      <div class="feature-item"><div class="feature-icon">üìù</div><div class="feature-name">Daily Log</div><div class="feature-tip">Track mood, energy, focus &amp; 12+ more dimensions daily</div></div>
      <div class="feature-item"><div class="feature-icon">üß¨</div><div class="feature-name">AI Analysis</div><div class="feature-tip">Discover patterns &amp; trends in your consciousness data</div></div>
      <div class="feature-item"><div class="feature-icon">üéÆ</div><div class="feature-name">Brain Games</div><div class="feature-tip">8 cognitive training games to sharpen your mind</div></div>
      <div class="feature-item"><div class="feature-icon">üí§</div><div class="feature-name">Lucid Dreams</div><div class="feature-tip">Train, track &amp; induce lucid dreaming</div></div>
    </div>
    <button class="btn btn-primary" onclick="nextOnboard()">Let's Begin ‚Üí</button>
  </div>

  <!-- Step 2: Logging -->
  <div class="onboard-step" data-step="1">
    <div style="font-size:40px;margin-bottom:12px">üìù</div>
    <h2 style="font-family:var(--font-head);font-size:22px;font-weight:800;margin-bottom:10px">Daily Consciousness Log</h2>
    <p style="color:var(--text2);font-size:14px;line-height:1.7;margin-bottom:16px">Use the <strong>Log tab</strong> every day to rate 12 dimensions of your mental state including mood, focus, creativity, flow, clarity and more. Each slider has detailed anchor descriptions to guide your rating.</p>
    <div class="insight-box"><strong>üí° Pro tip:</strong> Log 3√ó daily ‚Äî morning, afternoon, night ‚Äî to capture your natural rhythms and find your peak performance windows.</div>
    <div style="margin-top:16px;display:flex;gap:10px">
      <button class="btn btn-secondary" onclick="prevOnboard()">‚Üê Back</button>
      <button class="btn btn-primary" onclick="nextOnboard()">Next ‚Üí</button>
    </div>
  </div>

  <!-- Step 3: AI Twin -->
  <div class="onboard-step" data-step="2">
    <div style="font-size:40px;margin-bottom:12px">üí¨</div>
    <h2 style="font-family:var(--font-head);font-size:22px;font-weight:800;margin-bottom:10px">Your AI Digital Twin</h2>
    <p style="color:var(--text2);font-size:14px;line-height:1.7;margin-bottom:16px">The <strong>AI Twin</strong> learns from every entry you log. The more data you give it, the more accurately it reflects your patterns, predicts your states, and gives personalized insights.</p>
    <div class="insight-box"><strong>üí° Best results:</strong> Ask it things like "What's my best time of day?", "Why do I feel low on Mondays?", or "How do I reach flow state?"</div>
    <div style="margin-top:16px;display:flex;gap:10px">
      <button class="btn btn-secondary" onclick="prevOnboard()">‚Üê Back</button>
      <button class="btn btn-primary" onclick="nextOnboard()">Next ‚Üí</button>
    </div>
  </div>

  <!-- Step 4: Health + Dreams -->
  <div class="onboard-step" data-step="3">
    <div style="font-size:40px;margin-bottom:12px">‚öïÔ∏èüí§</div>
    <h2 style="font-family:var(--font-head);font-size:22px;font-weight:800;margin-bottom:10px">Health Profile &amp; Lucid Dreams</h2>
    <p style="color:var(--text2);font-size:14px;line-height:1.7;margin-bottom:10px">Complete the <strong>18-section Health Questionnaire</strong> for personalized AI health analysis. Then use the <strong>Dreams tab</strong> to train and track lucid dreaming with proven techniques like WILD, DILD, and MILD.</p>
    <div class="insight-box"><strong>üí° Dream tip:</strong> Set reality check reminders every 2 hours during the day. Log all dreams immediately on waking, even fragments.</div>
    <div style="margin-top:16px;display:flex;gap:10px">
      <button class="btn btn-secondary" onclick="prevOnboard()">‚Üê Back</button>
      <button class="btn btn-primary" onclick="nextOnboard()">Next ‚Üí</button>
    </div>
  </div>

  <!-- Step 5: Games + Start -->
  <div class="onboard-step" data-step="4">
    <div style="text-align:center;margin-bottom:20px">
      <div style="font-size:48px;margin-bottom:10px">üöÄ</div>
      <h2 style="font-family:var(--font-head);font-size:22px;font-weight:800;margin-bottom:10px">You're Ready!</h2>
      <p style="color:var(--text2);font-size:14px;line-height:1.7">Start with your first daily log, then explore Brain Games for cognitive training, and build your profile over time. The AI gets smarter with every entry.</p>
    </div>
    <div class="feature-grid" style="grid-template-columns:1fr 1fr 1fr;gap:10px">
      <div class="feature-item"><div class="feature-icon">üéØ</div><div class="feature-name">Log First</div></div>
      <div class="feature-item"><div class="feature-icon">üéÆ</div><div class="feature-name">Play Games</div></div>
      <div class="feature-item"><div class="feature-icon">üìä</div><div class="feature-name">Analyze</div></div>
    </div>
    <button class="btn btn-primary" onclick="closeOnboarding()" style="margin-top:16px;font-size:16px">‚ú® Start Enhancing My Mind</button>
    <button class="btn btn-secondary" onclick="prevOnboard()">‚Üê Back</button>
  </div>
</div>
</div>

<!-- =================== MAIN APP =================== -->
<div class="app-shell">

<!-- Top Bar -->
<div class="topbar">
  <div class="topbar-brand">üß† Consciousness OS</div>
  <div class="topbar-actions">
    <button class="theme-btn" id="themeBtn" onclick="toggleTheme()" title="Toggle dark/light mode">‚òÄÔ∏è</button>
    <button class="theme-btn" onclick="showOnboarding()" title="Show guide">‚ùì</button>
  </div>
</div>

<!-- Navigation -->
<div class="nav-strip" id="navStrip">
  <button class="nav-tab active" data-tab="log" onclick="switchTab('log',this)">üìù Log</button>
  <button class="nav-tab" data-tab="twin" onclick="switchTab('twin',this)">üí¨ AI Twin</button>
  <button class="nav-tab" data-tab="analysis" onclick="switchTab('analysis',this)">üß¨ Analysis</button>
  <button class="nav-tab" data-tab="health" onclick="switchTab('health',this)">‚öïÔ∏è Health</button>
  <button class="nav-tab" data-tab="games" onclick="switchTab('games',this)">üéÆ Games</button>
  <button class="nav-tab" data-tab="dreams" onclick="switchTab('dreams',this)">üí§ Dreams</button>
  <button class="nav-tab" data-tab="voice" onclick="switchTab('voice',this)">üé§ Voice</button>
  <button class="nav-tab" data-tab="media" onclick="switchTab('media',this)">üì∑ Media</button>
  <button class="nav-tab" data-tab="calendar" onclick="switchTab('calendar',this)">üìÖ Calendar</button>
  <button class="nav-tab" data-tab="settings" onclick="switchTab('settings',this)">‚öôÔ∏è Settings</button>
</div>

<div class="main-content">

<!-- =================== LOG TAB =================== -->
<div class="tab-pane active" id="tab-log">
  <div class="card">
    <div class="card-title">üìÖ Context & Time</div>
    <div class="input-label">Date</div>
    <input type="date" id="entryDate">
    <div class="input-label">Time</div>
    <input type="time" id="entryTime">
    <div class="input-label">Time of Day</div>
    <select id="timeOfDay">
      <option>üåÖ Morning (5am‚Äì12pm)</option>
      <option>‚òÄÔ∏è Afternoon (12pm‚Äì5pm)</option>
      <option>üåÜ Evening (5pm‚Äì9pm)</option>
      <option>üåô Night (9pm‚Äì5am)</option>
    </select>
    <div class="input-label">Current Activity</div>
    <select id="activity">
      <option>üíº Working</option><option>üìö Learning</option><option>üòå Resting</option>
      <option>üë• Socializing</option><option>üèÉ Exercising</option><option>üé® Creating</option>
      <option>üßò Meditating</option><option>üéÆ Playing</option><option>üçΩÔ∏è Eating</option>
      <option>üåç Exploring</option><option>üè† Chores</option>
    </select>
  </div>

  <!-- SLIDERS SECTION -->
  <div class="card">
    <div class="card-title">üß† Consciousness Metrics</div>
    <div class="card-desc">Rate each dimension honestly. Use the anchor descriptions below each slider.</div>

    <!-- Sleep -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üò¥ Sleep Quality</span>
        <span class="slider-badge" id="sleepVal">5</span>
      </div>
      <input type="range" id="sleep" min="0" max="10" value="5" oninput="updateSlider('sleep')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Catastrophic ‚Äî barely slept, unable to function, hallucination-level fatigue</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very poor ‚Äî fragmented sleep, heavy grogginess, brain fog all day</div>
        <div class="anchor-row"><span>4‚Äì5</span> Below baseline ‚Äî not restorative, need caffeine to function, sluggish</div>
        <div class="anchor-row"><span>6</span> Acceptable ‚Äî functional but not optimal, slight tiredness mid-day</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî refreshed on waking, stable energy through the day</div>
        <div class="anchor-row"><span>8</span> Very good ‚Äî deep sleep felt, clear-headed, alert all morning</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî fully restored, peak alertness, dreams vivid/positive</div>
        <div class="anchor-row"><span>10</span> Perfect ‚Äî 8‚Äì9 hours uninterrupted, woke naturally, feel superhuman</div>
      </div>
    </div>

    <!-- Mood -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üòä Mood / Emotional Valence</span>
        <span class="slider-badge" id="moodVal">5</span>
      </div>
      <input type="range" id="mood" min="0" max="10" value="5" oninput="updateSlider('mood')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Severe distress ‚Äî despair, hopelessness, emotional crisis, can't cope</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very low ‚Äî sad, heavy, tearful, dread, low self-worth</div>
        <div class="anchor-row"><span>4‚Äì5</span> Below neutral ‚Äî meh, irritable, slightly negative, unmotivated</div>
        <div class="anchor-row"><span>6</span> Neutral ‚Äî okay, stable, not good or bad, just going through the day</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî pleasant, content, light feeling, mild optimism</div>
        <div class="anchor-row"><span>8</span> Great ‚Äî genuinely happy, warm, motivated, positive outlook</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî joyful, inspired, grateful, things feel meaningful</div>
        <div class="anchor-row"><span>10</span> Peak ‚Äî euphoric, blissful, full of love, deeply alive and present</div>
      </div>
    </div>

    <!-- Physical Energy -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üí™ Physical Energy</span>
        <span class="slider-badge" id="physicalEnergyVal">5</span>
      </div>
      <input type="range" id="physicalEnergy" min="0" max="10" value="5" oninput="updateSlider('physicalEnergy')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Bedridden ‚Äî can barely move, extreme physical exhaustion, illness-level</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very low ‚Äî heavy limbs, dragging yourself, even walking feels hard</div>
        <div class="anchor-row"><span>4‚Äì5</span> Below average ‚Äî sluggish, prefer sitting, reluctant to exercise</div>
        <div class="anchor-row"><span>6</span> Moderate ‚Äî can manage daily tasks, not up for intense exercise</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî body feels capable, light exercise feels good</div>
        <div class="anchor-row"><span>8</span> High ‚Äî strong, want to move, body feels alive and responsive</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî vibrant, could run, strong physical presence, almost restless</div>
        <div class="anchor-row"><span>10</span> Peak athlete ‚Äî explosive energy, body feels perfect, want to sprint</div>
      </div>
    </div>

    <!-- Mental Energy -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">‚ö° Mental Energy</span>
        <span class="slider-badge" id="mentalEnergyVal">5</span>
      </div>
      <input type="range" id="mentalEnergy" min="0" max="10" value="5" oninput="updateSlider('mentalEnergy')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Mentally empty ‚Äî can't form thoughts, complete cognitive shutdown</div>
        <div class="anchor-row"><span>2‚Äì3</span> Mental exhaustion ‚Äî slow processing, forgetful, can't hold ideas</div>
        <div class="anchor-row"><span>4‚Äì5</span> Reduced ‚Äî functional but foggy, easier tasks only, making mistakes</div>
        <div class="anchor-row"><span>6</span> Moderate ‚Äî can think clearly enough for routine work, no extra capacity</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî sharp enough for complex tasks, learning feels manageable</div>
        <div class="anchor-row"><span>8</span> High ‚Äî quick thinking, good memory recall, ideas coming easily</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî rapid cognition, holding multiple threads, intellectual spark</div>
        <div class="anchor-row"><span>10</span> Peak cognition ‚Äî hyper-clear, everything clicks, genius-mode thinking</div>
      </div>
    </div>

    <!-- Focus -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üéØ Focus / Concentration</span>
        <span class="slider-badge" id="focusVal">5</span>
      </div>
      <input type="range" id="focus" min="0" max="10" value="5" oninput="updateSlider('focus')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Completely scattered ‚Äî mind jumps every 5 seconds, can't start anything</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very distracted ‚Äî easily pulled away, lose track every few minutes</div>
        <div class="anchor-row"><span>4‚Äì5</span> Below average ‚Äî average distraction, need effort to stay on task</div>
        <div class="anchor-row"><span>6</span> Moderate ‚Äî can sustain focus 20‚Äì30 min with some effort</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî on task mostly, recover quickly from distractions</div>
        <div class="anchor-row"><span>8</span> High ‚Äî hours of sustained attention, distractions barely register</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî tunnel-vision concentration, absorbed for long periods</div>
        <div class="anchor-row"><span>10</span> Laser ‚Äî complete hyperfocus, time dissolves, peak performance zone</div>
      </div>
    </div>

    <!-- Stress -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üò∞ Stress Level</span>
        <span class="slider-badge" id="stressVal">5</span>
      </div>
      <input type="range" id="stress" min="0" max="10" value="5" oninput="updateSlider('stress')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Completely calm ‚Äî no stress at all, pure relaxation, zero pressure</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very low ‚Äî minor background awareness of tasks, but relaxed</div>
        <div class="anchor-row"><span>4‚Äì5</span> Mild-moderate ‚Äî some tension, aware of deadlines, slightly pressed</div>
        <div class="anchor-row"><span>6</span> Moderate ‚Äî noticeable stress, some physical tension, distracted by it</div>
        <div class="anchor-row"><span>7</span> High ‚Äî significant stress, physical symptoms (tight chest, shallow breath)</div>
        <div class="anchor-row"><span>8</span> Very high ‚Äî overwhelmed, reactive, hard to think straight</div>
        <div class="anchor-row"><span>9</span> Severe ‚Äî panic-adjacent, body alarm signals, can't perform well</div>
        <div class="anchor-row"><span>10</span> Crisis ‚Äî full panic, physiological emergency response, needs help</div>
      </div>
    </div>

    <!-- Creativity -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üé® Creativity</span>
        <span class="slider-badge" id="creativityVal">5</span>
      </div>
      <input type="range" id="creativity" min="0" max="10" value="5" oninput="updateSlider('creativity')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Completely blocked ‚Äî blank, no ideas, creative paralysis</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very low ‚Äî forced, mechanical, nothing feels original</div>
        <div class="anchor-row"><span>4‚Äì5</span> Below average ‚Äî can execute existing ideas but not generating new ones</div>
        <div class="anchor-row"><span>6</span> Moderate ‚Äî occasional sparks, but ideas feel ordinary</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî ideas flowing, finding novel connections, enjoying the process</div>
        <div class="anchor-row"><span>8</span> High ‚Äî divergent thinking activated, unexpected insights, playful</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî generative flow, ideas spawning ideas, originality high</div>
        <div class="anchor-row"><span>10</span> Peak ‚Äî inspired genius mode, unprecedented ideas, art-making state</div>
      </div>
    </div>

    <!-- Motivation -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üî• Motivation / Drive</span>
        <span class="slider-badge" id="motivationVal">5</span>
      </div>
      <input type="range" id="motivation" min="0" max="10" value="5" oninput="updateSlider('motivation')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Completely unmotivated ‚Äî can't make yourself do anything, apathy rules</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very low ‚Äî doing only the bare minimum, heavy reluctance</div>
        <div class="anchor-row"><span>4‚Äì5</span> Below average ‚Äî procrastinating, need external pressure to act</div>
        <div class="anchor-row"><span>6</span> Moderate ‚Äî can get going once started, mild intrinsic pull</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî willingly engaged, want to make progress, goals feel real</div>
        <div class="anchor-row"><span>8</span> High ‚Äî proactive, excited to work, ambitious, goal-oriented</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî driven, unstoppable feeling, working ahead of schedule</div>
        <div class="anchor-row"><span>10</span> Obsessed ‚Äî can't stop, intrinsic fire, purpose-driven, full activation</div>
      </div>
    </div>

    <!-- Mental Clarity -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üîÆ Mental Clarity</span>
        <span class="slider-badge" id="clarityVal">5</span>
      </div>
      <input type="range" id="clarity" min="0" max="10" value="5" oninput="updateSlider('clarity')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Severe brain fog ‚Äî thoughts feel like mud, can't complete sentences</div>
        <div class="anchor-row"><span>2‚Äì3</span> Very foggy ‚Äî clouded, confused, slow processing, forgetful</div>
        <div class="anchor-row"><span>4‚Äì5</span> Below average ‚Äî slightly clouded, need to re-read things, minor confusion</div>
        <div class="anchor-row"><span>6</span> Moderate ‚Äî functional clarity, thinking is clear enough for normal tasks</div>
        <div class="anchor-row"><span>7</span> Good ‚Äî clear-headed, things make sense quickly, decisive</div>
        <div class="anchor-row"><span>8</span> High ‚Äî crystal clear thinking, excellent memory, sharp reasoning</div>
        <div class="anchor-row"><span>9</span> Excellent ‚Äî thinking at peak clarity, problem-solving feels effortless</div>
        <div class="anchor-row"><span>10</span> Perfect ‚Äî absolute mental precision, every thought crystalline and true</div>
      </div>
    </div>

    <!-- Flow State -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üåä Flow State</span>
        <span class="slider-badge" id="flowVal">0</span>
      </div>
      <input type="range" id="flow" min="0" max="10" value="0" oninput="updateSlider('flow')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0</span> Not in flow ‚Äî fully self-conscious, struggling, aware of effort</div>
        <div class="anchor-row"><span>1‚Äì3</span> Pre-flow ‚Äî warming up, some engagement but frequent interruptions</div>
        <div class="anchor-row"><span>4‚Äì6</span> Light flow ‚Äî absorbed in task, time passing faster, modest performance boost</div>
        <div class="anchor-row"><span>7‚Äì8</span> Deep flow ‚Äî time disappears, self-consciousness dissolves, effortless mastery</div>
        <div class="anchor-row"><span>9‚Äì10</span> Peak flow ‚Äî complete merging with activity, transcendent performance, pure presence</div>
      </div>
    </div>

    <!-- Anxiety -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üòü Anxiety Level</span>
        <span class="slider-badge" id="anxietyVal">2</span>
      </div>
      <input type="range" id="anxiety" min="0" max="10" value="2" oninput="updateSlider('anxiety')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0</span> No anxiety ‚Äî completely at ease, no worry or apprehension</div>
        <div class="anchor-row"><span>1‚Äì3</span> Low ‚Äî background awareness of concerns, not interfering with life</div>
        <div class="anchor-row"><span>4‚Äì6</span> Moderate ‚Äî noticeable worry, some avoidance, physical tension present</div>
        <div class="anchor-row"><span>7‚Äì8</span> High ‚Äî significant anxiety, intrusive thoughts, avoidance behaviors</div>
        <div class="anchor-row"><span>9‚Äì10</span> Severe ‚Äî panic symptoms, avoidance paralysis, significant impairment</div>
      </div>
    </div>

    <!-- Emotional Stability -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">‚öñÔ∏è Emotional Stability</span>
        <span class="slider-badge" id="stabilityVal">5</span>
      </div>
      <input type="range" id="stability" min="0" max="10" value="5" oninput="updateSlider('stability')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì2</span> Volatile ‚Äî rapid swings, triggered easily, emotional reactivity extreme</div>
        <div class="anchor-row"><span>3‚Äì5</span> Below average ‚Äî some mood swings, reactive to events, inconsistent</div>
        <div class="anchor-row"><span>6‚Äì7</span> Moderate ‚Äî generally stable, minor fluctuations, recovers fairly well</div>
        <div class="anchor-row"><span>8‚Äì9</span> High ‚Äî grounded, not easily rattled, bounces back quickly</div>
        <div class="anchor-row"><span>10</span> Rock solid ‚Äî unshakeable equanimity, calm center through any storm</div>
      </div>
    </div>

    <!-- Social Energy -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üë• Social Energy</span>
        <span class="slider-badge" id="socialVal">5</span>
      </div>
      <input type="range" id="social" min="0" max="10" value="5" oninput="updateSlider('social')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Social withdrawal ‚Äî want complete isolation, all interaction feels draining</div>
        <div class="anchor-row"><span>2‚Äì4</span> Introverted mode ‚Äî prefer solitude, small talk is exhausting</div>
        <div class="anchor-row"><span>5‚Äì6</span> Balanced ‚Äî can enjoy both solitude and company without strain</div>
        <div class="anchor-row"><span>7‚Äì8</span> Social ‚Äî enjoy connecting, conversations feel easy and energizing</div>
        <div class="anchor-row"><span>9‚Äì10</span> Extremely social ‚Äî craving connection, lighting up rooms, deep engagement</div>
      </div>
    </div>

    <!-- Mindfulness -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üßò Mindfulness / Presence</span>
        <span class="slider-badge" id="mindfulnessVal">5</span>
      </div>
      <input type="range" id="mindfulness" min="0" max="10" value="5" oninput="updateSlider('mindfulness')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì1</span> Completely in head ‚Äî lost in thought, unaware of body, on autopilot</div>
        <div class="anchor-row"><span>2‚Äì4</span> Low presence ‚Äî mostly ruminating, past/future focused, fragmented attention</div>
        <div class="anchor-row"><span>5‚Äì6</span> Moderate ‚Äî occasional present moments, some awareness of sensations</div>
        <div class="anchor-row"><span>7‚Äì8</span> High mindfulness ‚Äî genuinely present, sensory-aware, non-reactive</div>
        <div class="anchor-row"><span>9‚Äì10</span> Pure presence ‚Äî meditative awareness, full embodiment, moment-to-moment clarity</div>
      </div>
    </div>

    <!-- Willpower -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üíé Willpower / Self-Control</span>
        <span class="slider-badge" id="willpowerVal">5</span>
      </div>
      <input type="range" id="willpower" min="0" max="10" value="5" oninput="updateSlider('willpower')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì2</span> Depleted ‚Äî no resistance to impulses, ego-depletion, caving to everything</div>
        <div class="anchor-row"><span>3‚Äì4</span> Low ‚Äî struggling to resist distractions, habits controlling you</div>
        <div class="anchor-row"><span>5‚Äì6</span> Moderate ‚Äî can resist some urges with effort, occasional slip-ups</div>
        <div class="anchor-row"><span>7‚Äì8</span> High ‚Äî delayed gratification easy, sticking to plans, resisting well</div>
        <div class="anchor-row"><span>9‚Äì10</span> Iron will ‚Äî pure discipline, long-term thinking dominates, habits locked</div>
      </div>
    </div>

    <!-- Intuition -->
    <div class="slider-wrap">
      <div class="slider-header">
        <span class="slider-name">üîÆ Intuition Strength</span>
        <span class="slider-badge" id="intuitionVal">5</span>
      </div>
      <input type="range" id="intuition" min="0" max="10" value="5" oninput="updateSlider('intuition')">
      <div class="slider-anchors">
        <div class="anchor-row"><span>0‚Äì2</span> Disconnected ‚Äî no gut feelings, purely analytical, ignoring inner signals</div>
        <div class="anchor-row"><span>3‚Äì5</span> Low‚Äìmoderate ‚Äî occasional gut feelings but often uncertain or ignored</div>
        <div class="anchor-row"><span>6‚Äì7</span> Good ‚Äî intuition active, reading situations and people accurately</div>
        <div class="anchor-row"><span>8‚Äì9</span> High ‚Äî strong inner knowing, pattern recognition feels almost psychic</div>
        <div class="anchor-row"><span>10</span> Peak intuition ‚Äî deep gut knowing, accurate predictions, wisdom state</div>
      </div>
    </div>

  </div>

  <!-- Deep Dive Section -->
  <div class="card">
    <div class="card-title">üí≠ Deep Consciousness Dive</div>
    <div class="input-label">Dominant Emotion</div>
    <input type="text" id="emotion" placeholder="e.g., Joy, Anxiety, Excitement, Melancholy, Awe">
    <div class="input-label">Brainwave State</div>
    <select id="brainwave">
      <option value="">‚Äî Select ‚Äî</option>
      <option value="delta">Delta (0.5‚Äì4 Hz) ‚Äî Deep sleep, healing</option>
      <option value="theta">Theta (4‚Äì8 Hz) ‚Äî Dreaming, creativity, meditation</option>
      <option value="alpha">Alpha (8‚Äì13 Hz) ‚Äî Relaxed awareness, calm focus</option>
      <option value="beta">Beta (13‚Äì30 Hz) ‚Äî Active thinking, problem-solving</option>
      <option value="gamma">Gamma (30‚Äì100 Hz) ‚Äî Peak cognition, insight, flow</option>
    </select>
    <div class="input-label">Physical Sensation</div>
    <input type="text" id="sensation" placeholder="e.g., Tension in shoulders, Butterflies in stomach">
    <div class="input-label">Recurring Pattern</div>
    <input type="text" id="pattern" placeholder="e.g., Procrastination loop, Evening anxiety spike">
    <div class="input-label">Key Decision / Action</div>
    <input type="text" id="action" placeholder="e.g., Started new habit, Had difficult conversation">
    <div class="input-label">Raw Unfiltered Thoughts</div>
    <textarea id="thought" placeholder="Stream of consciousness ‚Äî no judgment, just write..."></textarea>
    <div class="input-label">Current Goal</div>
    <input type="text" id="goal" placeholder="e.g., Finish project, Exercise 3x this week">
    <div class="input-label">Main Obstacle</div>
    <input type="text" id="obstacle" placeholder="e.g., Time pressure, Self-doubt, Fatigue">
    <div class="input-label">Gratitude Note</div>
    <input type="text" id="gratitude" placeholder="One thing you appreciate right now...">
    <div class="input-label">Insight / Realization</div>
    <input type="text" id="insight" placeholder="Any insight, idea, or realization from today...">
    <br>
    <button class="btn btn-primary" onclick="saveEntry()">üíæ Save Entry & Analyze</button>
  </div>

  <div class="card">
    <div class="card-title">üéØ Current State Score</div>
    <div class="score-mega" id="currentScore">--</div>
    <div class="score-label" id="currentLabel">Complete your entry to calculate</div>
  </div>
</div>

<!-- =================== AI TWIN TAB =================== -->
<div class="tab-pane" id="tab-twin">
  <div class="card">
    <div class="card-title">üí¨ AI Digital Twin</div>
    <div class="card-desc">Your AI twin learns from every log entry. The more you log, the more it understands you ‚Äî your patterns, rhythms, obstacles, and peak states. Ask it anything about your mind.</div>

    <div class="twin-indicator">
      <div class="twin-avatar">üß¨</div>
      <div class="twin-status">
        <div class="twin-name">Your Digital Twin</div>
        <div class="twin-info" id="twinDataInfo">Analyzing your consciousness data...</div>
      </div>
    </div>

    <div class="chat-box">
      <div class="chat-msgs" id="chatMsgs">
        <div class="msg ai">üëã I'm your AI consciousness twin. I learn from your logged data and reflect your unique mental patterns back to you. I can help you understand your peak states, identify what drains you, predict tomorrow's performance, or explore your emotional patterns.<br><br>What would you like to explore about your mind today?</div>
      </div>
      <div class="chat-input-row">
        <input type="text" id="chatInput" placeholder="Ask your twin anything..." onkeydown="if(event.key==='Enter')sendChat()">
        <button class="btn btn-primary" onclick="sendChat()" style="width:auto">Send</button>
      </div>
    </div>

    <div style="margin-top:16px">
      <div class="section-title">Suggested Questions</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px">
        <button class="btn btn-secondary btn-sm" onclick="askTwin('What is my best time of day for deep work?')">‚è∞ Peak work time</button>
        <button class="btn btn-secondary btn-sm" onclick="askTwin('What patterns do you see in my stress levels?')">üò∞ Stress patterns</button>
        <button class="btn btn-secondary btn-sm" onclick="askTwin('How do I reach my flow state?')">üåä Flow triggers</button>
        <button class="btn btn-secondary btn-sm" onclick="askTwin('What activities correlate with my highest mood?')">üòä Mood boosters</button>
        <button class="btn btn-secondary btn-sm" onclick="askTwin('Predict my performance tomorrow')">üîÆ Tomorrow prediction</button>
        <button class="btn btn-secondary btn-sm" onclick="askTwin('What is my creative peak state?')">üé® Creative peaks</button>
        <button class="btn btn-secondary btn-sm" onclick="askTwin('Am I improving over time?')">üìà Progress check</button>
        <button class="btn btn-secondary btn-sm" onclick="askTwin('What does my cognition score tell you about me?')">üß† Cognition insight</button>
      </div>
    </div>
  </div>
</div>

<!-- =================== ANALYSIS TAB =================== -->
<div class="tab-pane" id="tab-analysis">
  <div class="card">
    <div class="card-title">üìä Consciousness Dashboard</div>
    <div class="stats-grid" id="statsGrid">
      <div class="stat-box"><div class="stat-val" id="sMood">--</div><div class="stat-lbl">Avg Mood</div></div>
      <div class="stat-box"><div class="stat-val" id="sFocus">--</div><div class="stat-lbl">Avg Focus</div></div>
      <div class="stat-box"><div class="stat-val" id="sEnergy">--</div><div class="stat-lbl">Avg Energy</div></div>
      <div class="stat-box"><div class="stat-val" id="sCreativity">--</div><div class="stat-lbl">Creativity</div></div>
      <div class="stat-box"><div class="stat-val" id="sFlow">--</div><div class="stat-lbl">Avg Flow</div></div>
      <div class="stat-box"><div class="stat-val" id="sEntries">0</div><div class="stat-lbl">Total Logs</div></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üîÆ Predictions</div>
    <div id="predictions"><div class="empty-state"><div class="empty-icon">üîÆ</div><p>Log 7+ entries to unlock predictions</p></div></div>
  </div>

  <div class="card">
    <div class="card-title">üìà Trends (Last 20 Entries)</div>
    <div id="trends"><div class="empty-state"><div class="empty-icon">üìà</div><p>Log 10+ entries to see trends</p></div></div>
  </div>

  <div class="card">
    <div class="card-title">üîç Pattern Detection</div>
    <div id="patterns"><div class="empty-state"><div class="empty-icon">üîç</div><p>Patterns appear after several entries</p></div></div>
  </div>

  <div class="card">
    <div class="card-title">üèÜ Personal Records</div>
    <div id="records"><div class="empty-state"><div class="empty-icon">üèÜ</div><p>Records appear as you log</p></div></div>
  </div>

  <div class="card">
    <div class="card-title">üìÖ Recent Entries</div>
    <div id="recentEntries"><div class="empty-state"><div class="empty-icon">üìÖ</div><p>No entries yet</p></div></div>
  </div>
</div>

<!-- =================== HEALTH TAB =================== -->
<div class="tab-pane" id="tab-health">
  <div class="card">
    <div class="card-title">üßæ Comprehensive Health Questionnaire</div>
    <div class="card-desc">Complete this 18-section profile for personalized AI health analysis. Your data is stored locally on your device.</div>

    <div class="hq-progress">
      <div class="hq-step-indicator">Section <span id="hqCurrent">1</span> of 18</div>
      <div style="flex:1"><div class="progress-bar-wrap"><div class="progress-bar-fill" id="hqProgressBar" style="width:5.5%"></div></div></div>
    </div>

    <!-- Section 1 -->
    <div class="hq-section active" id="hqs-1">
      <div class="section-title">1Ô∏è‚É£ Basic Identity & Demographics</div>
      <label class="hq-label">Age</label>
      <input type="number" id="hq-age" placeholder="Your age">
      <label class="hq-label">Sex at birth</label>
      <div class="radio-group" id="hq-sex-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-sex')">Male</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sex')">Female</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sex')">Intersex</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sex')">Prefer not to say</div>
      </div>
      <label class="hq-label">Height (cm)</label>
      <input type="number" id="hq-height" placeholder="e.g., 175">
      <label class="hq-label">Weight (kg)</label>
      <input type="number" id="hq-weight" placeholder="e.g., 70">
      <label class="hq-label">Waist circumference (cm)</label>
      <input type="number" id="hq-waist" placeholder="e.g., 80">
      <label class="hq-label">Occupation / Work Pattern</label>
      <div class="radio-group" id="hq-work-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-work')">Sedentary office</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-work')">Active/physical</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-work')">Shift work</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-work')">Remote/flexible</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-work')">Student</div>
      </div>
      <label class="hq-label">Living environment</label>
      <div class="radio-group" id="hq-env-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-env')">Urban dense</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-env')">Urban suburban</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-env')">Semi-rural</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-env')">Rural</div>
      </div>
    </div>

    <!-- Section 2 -->
    <div class="hq-section" id="hqs-2">
      <div class="section-title">2Ô∏è‚É£ Medical History</div>
      <label class="hq-label">Current diagnosed conditions</label>
      <textarea id="hq-conditions" placeholder="e.g., Diabetes Type 2, Hypertension, Asthma..."></textarea>
      <label class="hq-label">Past major illnesses / hospitalizations</label>
      <textarea id="hq-past" placeholder="e.g., Appendectomy 2015, COVID-19 2021..."></textarea>
      <label class="hq-label">Current medications & supplements</label>
      <textarea id="hq-meds" placeholder="e.g., Metformin 500mg, Vitamin D3, Omega-3..."></textarea>
      <label class="hq-label">Allergies (drug, food, environmental)</label>
      <textarea id="hq-allergies" placeholder="e.g., Penicillin, Peanuts, Pollen..."></textarea>
      <label class="hq-label">Vaccination history (notable)</label>
      <textarea id="hq-vaccines" placeholder="e.g., COVID (3 doses), Flu annual, HPV..."></textarea>
    </div>

    <!-- Section 3 -->
    <div class="hq-section" id="hqs-3">
      <div class="section-title">3Ô∏è‚É£ Family & Genetic Risk</div>
      <div class="card-desc">Check all that apply to close relatives (parents, siblings, grandparents)</div>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="fh-heart"> Heart disease</label>
        <label class="check-item"><input type="checkbox" id="fh-diabetes"> Diabetes</label>
        <label class="check-item"><input type="checkbox" id="fh-cancer"> Cancer</label>
        <label class="check-item"><input type="checkbox" id="fh-stroke"> Stroke</label>
        <label class="check-item"><input type="checkbox" id="fh-mental"> Mental illness</label>
        <label class="check-item"><input type="checkbox" id="fh-auto"> Autoimmune</label>
        <label class="check-item"><input type="checkbox" id="fh-alzheimer"> Alzheimer's</label>
        <label class="check-item"><input type="checkbox" id="fh-obesity"> Obesity</label>
      </div>
      <label class="hq-label">Cancer type(s) in family</label>
      <input type="text" id="hq-cancer-type" placeholder="e.g., Breast, Colon, Prostate...">
      <label class="hq-label">Family longevity (typical age of death)</label>
      <div class="radio-group" id="hq-longevity-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-longevity')">Below 60</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-longevity')">60‚Äì74</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-longevity')">75‚Äì85</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-longevity')">85‚Äì95</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-longevity')">95+</div>
      </div>
      <label class="hq-label">Known genetic test results</label>
      <textarea id="hq-genetics" placeholder="e.g., BRCA1 positive, APOE4 carrier, 23andMe results..."></textarea>
    </div>

    <!-- Section 4 -->
    <div class="hq-section" id="hqs-4">
      <div class="section-title">4Ô∏è‚É£ Diet & Nutrition</div>
      <label class="hq-label">Typical daily meals (describe)</label>
      <textarea id="hq-diet" placeholder="Breakfast: oats + fruit. Lunch: salad + protein. Dinner: rice + vegetables..."></textarea>
      <label class="hq-label">Estimated daily calories</label>
      <div class="radio-group" id="hq-cal-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-cal')">Under 1500</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-cal')">1500‚Äì2000</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-cal')">2000‚Äì2500</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-cal')">2500‚Äì3000</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-cal')">Over 3000</div>
      </div>
      <label class="hq-label">Water intake daily</label>
      <div class="radio-group" id="hq-water-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-water')">Under 1L</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-water')">1‚Äì1.5L</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-water')">1.5‚Äì2.5L</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-water')">2.5‚Äì3.5L</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-water')">Over 3.5L</div>
      </div>
      <label class="hq-label">Dietary pattern</label>
      <div class="radio-group" id="hq-diettype-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-diettype')">Omnivore</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-diettype')">Vegetarian</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-diettype')">Vegan</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-diettype')">Keto</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-diettype')">Paleo</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-diettype')">Mediterranean</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-diettype')">Intermittent fasting</div>
      </div>
      <label class="hq-label">Ultra-processed food frequency</label>
      <div class="radio-group" id="hq-junk-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-junk')">Rarely</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-junk')">1‚Äì2√ó/week</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-junk')">3‚Äì5√ó/week</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-junk')">Daily</div>
      </div>
      <label class="hq-label">Food intolerances / sensitivities</label>
      <input type="text" id="hq-intol" placeholder="e.g., Lactose, Gluten, Fructose...">
    </div>

    <!-- Section 5 -->
    <div class="hq-section" id="hqs-5">
      <div class="section-title">5Ô∏è‚É£ Substance Use</div>
      <label class="hq-label">Smoking status</label>
      <div class="radio-group" id="hq-smoke-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-smoke')">Never smoked</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-smoke')">Ex-smoker</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-smoke')">Occasional</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-smoke')">Daily smoker</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-smoke')">Vaping only</div>
      </div>
      <label class="hq-label">Alcohol consumption</label>
      <div class="radio-group" id="hq-alcohol-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-alcohol')">None</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-alcohol')">Occasional (monthly)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-alcohol')">Social (1‚Äì2√ó/week)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-alcohol')">Regular (3‚Äì5√ó/week)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-alcohol')">Daily</div>
      </div>
      <label class="hq-label">Caffeine intake</label>
      <div class="radio-group" id="hq-caffeine-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-caffeine')">None</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-caffeine')">1 cup/day</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-caffeine')">2‚Äì3 cups/day</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-caffeine')">4+ cups/day</div>
      </div>
      <label class="hq-label">Recreational substances (optional)</label>
      <textarea id="hq-rec" placeholder="Cannabis, psychedelics, other ‚Äî frequency and context..."></textarea>
    </div>

    <!-- Section 6 -->
    <div class="hq-section" id="hqs-6">
      <div class="section-title">6Ô∏è‚É£ Physical Activity & Fitness</div>
      <label class="hq-label">Exercise frequency</label>
      <div class="radio-group" id="hq-ex-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-ex')">Sedentary</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-ex')">1‚Äì2√ó/week</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-ex')">3‚Äì4√ó/week</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-ex')">5‚Äì6√ó/week</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-ex')">Daily</div>
      </div>
      <label class="hq-label">Exercise types (check all that apply)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="ex-cardio"> Cardio / Running</label>
        <label class="check-item"><input type="checkbox" id="ex-strength"> Strength training</label>
        <label class="check-item"><input type="checkbox" id="ex-yoga"> Yoga / Stretching</label>
        <label class="check-item"><input type="checkbox" id="ex-hiit"> HIIT</label>
        <label class="check-item"><input type="checkbox" id="ex-sport"> Team sports</label>
        <label class="check-item"><input type="checkbox" id="ex-swim"> Swimming</label>
        <label class="check-item"><input type="checkbox" id="ex-cycle"> Cycling</label>
        <label class="check-item"><input type="checkbox" id="ex-walk"> Daily walks</label>
      </div>
      <label class="hq-label">Resting heart rate (bpm)</label>
      <input type="number" id="hq-rhr" placeholder="e.g., 60">
      <label class="hq-label">Known VO2 max or fitness level</label>
      <div class="radio-group" id="hq-fit-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-fit')">Poor</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-fit')">Below average</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-fit')">Average</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-fit')">Good</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-fit')">Excellent</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-fit')">Athletic</div>
      </div>
      <label class="hq-label">Daily steps estimate</label>
      <div class="radio-group" id="hq-steps-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-steps')">Under 3k</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-steps')">3‚Äì6k</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-steps')">6‚Äì10k</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-steps')">10‚Äì15k</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-steps')">15k+</div>
      </div>
    </div>

    <!-- Section 7 -->
    <div class="hq-section" id="hqs-7">
      <div class="section-title">7Ô∏è‚É£ Sleep Health</div>
      <label class="hq-label">Average sleep duration</label>
      <div class="radio-group" id="hq-sleepdur-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepdur')">Under 5h</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepdur')">5‚Äì6h</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepdur')">6‚Äì7h</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepdur')">7‚Äì8h</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepdur')">8‚Äì9h</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepdur')">9h+</div>
      </div>
      <label class="hq-label">Usual bedtime</label>
      <input type="time" id="hq-bedtime">
      <label class="hq-label">Usual wake time</label>
      <input type="time" id="hq-waketime">
      <label class="hq-label">Sleep symptoms (check all that apply)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="sl-insomnia"> Insomnia</label>
        <label class="check-item"><input type="checkbox" id="sl-snoring"> Snoring</label>
        <label class="check-item"><input type="checkbox" id="sl-apnea"> Sleep apnea</label>
        <label class="check-item"><input type="checkbox" id="sl-wake"> Night awakenings</label>
        <label class="check-item"><input type="checkbox" id="sl-sleepy"> Daytime sleepiness</label>
        <label class="check-item"><input type="checkbox" id="sl-vivid"> Vivid/disturbing dreams</label>
        <label class="check-item"><input type="checkbox" id="sl-shift"> Shift work disruption</label>
        <label class="check-item"><input type="checkbox" id="sl-restless"> Restless legs</label>
      </div>
      <label class="hq-label">Overall sleep quality (self-rated)</label>
      <div class="radio-group" id="hq-sleepq-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepq')">Poor</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepq')">Fair</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepq')">Good</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepq')">Very good</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sleepq')">Excellent</div>
      </div>
    </div>

    <!-- Section 8 -->
    <div class="hq-section" id="hqs-8">
      <div class="section-title">8Ô∏è‚É£ Mental & Cognitive Health</div>
      <label class="hq-label">Current mood baseline</label>
      <div class="radio-group" id="hq-moodbase-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-moodbase')">Chronically low</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-moodbase')">Below neutral</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-moodbase')">Neutral</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-moodbase')">Generally positive</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-moodbase')">Consistently high</div>
      </div>
      <label class="hq-label">Mental health symptoms (check all that apply)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="mh-anxiety"> Anxiety</label>
        <label class="check-item"><input type="checkbox" id="mh-depression"> Depression</label>
        <label class="check-item"><input type="checkbox" id="mh-adhd"> ADHD / Focus issues</label>
        <label class="check-item"><input type="checkbox" id="mh-burnout"> Burnout</label>
        <label class="check-item"><input type="checkbox" id="mh-trauma"> Trauma / PTSD</label>
        <label class="check-item"><input type="checkbox" id="mh-ocd"> OCD tendencies</label>
        <label class="check-item"><input type="checkbox" id="mh-bipolar"> Bipolar symptoms</label>
        <label class="check-item"><input type="checkbox" id="mh-social"> Social anxiety</label>
      </div>
      <label class="hq-label">Chronic stress level</label>
      <div class="radio-group" id="hq-stress-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-stress')">Very low</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-stress')">Low</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-stress')">Moderate</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-stress')">High</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-stress')">Overwhelming</div>
      </div>
      <label class="hq-label">Cognitive concerns</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="cog-mem"> Memory issues</label>
        <label class="check-item"><input type="checkbox" id="cog-fog"> Brain fog</label>
        <label class="check-item"><input type="checkbox" id="cog-word"> Word finding</label>
        <label class="check-item"><input type="checkbox" id="cog-focus"> Poor focus</label>
      </div>
      <label class="hq-label">Life satisfaction overall</label>
      <div class="radio-group" id="hq-life-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-life')">1‚Äì2 (Very low)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-life')">3‚Äì4</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-life')">5‚Äì6 (Moderate)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-life')">7‚Äì8</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-life')">9‚Äì10 (High)</div>
      </div>
    </div>

    <!-- Section 9 -->
    <div class="hq-section" id="hqs-9">
      <div class="section-title">9Ô∏è‚É£ Hormonal & Reproductive Health</div>
      <label class="hq-label">Energy patterns through the day</label>
      <div class="radio-group" id="hq-energy-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-energy')">Morning peak</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-energy')">Afternoon peak</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-energy')">Evening peak</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-energy')">Inconsistent</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-energy')">No clear peak</div>
      </div>
      <label class="hq-label">Libido level</label>
      <div class="radio-group" id="hq-libido-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-libido')">Very low</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-libido')">Low</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-libido')">Normal</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-libido')">High</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-libido')">Very high</div>
      </div>
      <label class="hq-label">Notable symptoms (check all applicable)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="horm-hair"> Hair loss/change</label>
        <label class="check-item"><input type="checkbox" id="horm-skin"> Skin changes</label>
        <label class="check-item"><input type="checkbox" id="horm-weight"> Unexplained weight change</label>
        <label class="check-item"><input type="checkbox" id="horm-temp"> Temperature sensitivity</label>
        <label class="check-item"><input type="checkbox" id="horm-pms"> PMS / hormonal cycles</label>
        <label class="check-item"><input type="checkbox" id="horm-pcos"> PCOS/endometriosis</label>
        <label class="check-item"><input type="checkbox" id="horm-meno"> Menopause symptoms</label>
        <label class="check-item"><input type="checkbox" id="horm-prostate"> Prostate concerns</label>
      </div>
      <label class="hq-label">Notes on hormonal health</label>
      <textarea id="hq-hormones" placeholder="Any known hormone test results, thyroid issues, testosterone panels..."></textarea>
    </div>

    <!-- Section 10 -->
    <div class="hq-section" id="hqs-10">
      <div class="section-title">üîü Cardiometabolic Health</div>
      <label class="hq-label">Blood pressure (typical)</label>
      <div class="radio-group" id="hq-bp-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-bp')">Low (&lt;90/60)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bp')">Normal (90‚Äì120/60‚Äì80)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bp')">Elevated (120‚Äì139/80‚Äì89)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bp')">High (140+/90+)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bp')">Unknown</div>
      </div>
      <label class="hq-label">Blood sugar / HbA1c status</label>
      <div class="radio-group" id="hq-sugar-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-sugar')">Normal</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sugar')">Prediabetic</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sugar')">Diabetic T1</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sugar')">Diabetic T2</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-sugar')">Unknown</div>
      </div>
      <label class="hq-label">Cholesterol status</label>
      <div class="radio-group" id="hq-chol-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-chol')">Optimal</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-chol')">Borderline high</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-chol')">High</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-chol')">On medication</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-chol')">Unknown</div>
      </div>
      <label class="hq-label">Heart symptoms (check all)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="card-chest"> Chest pain</label>
        <label class="check-item"><input type="checkbox" id="card-palp"> Palpitations</label>
        <label class="check-item"><input type="checkbox" id="card-breath"> Breathlessness</label>
        <label class="check-item"><input type="checkbox" id="card-swelling"> Ankle swelling</label>
      </div>
    </div>

    <!-- Section 11 -->
    <div class="hq-section" id="hqs-11">
      <div class="section-title">1Ô∏è‚É£1Ô∏è‚É£ Digestive & Gut Health</div>
      <label class="hq-label">Digestive symptoms (check all)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="gut-bloat"> Bloating</label>
        <label class="check-item"><input type="checkbox" id="gut-gas"> Excess gas</label>
        <label class="check-item"><input type="checkbox" id="gut-reflux"> Reflux / GERD</label>
        <label class="check-item"><input type="checkbox" id="gut-ibs"> IBS diagnosis</label>
        <label class="check-item"><input type="checkbox" id="gut-ibd"> IBD (Crohn's/colitis)</label>
        <label class="check-item"><input type="checkbox" id="gut-constip"> Constipation</label>
        <label class="check-item"><input type="checkbox" id="gut-diarr"> Diarrhea</label>
        <label class="check-item"><input type="checkbox" id="gut-sens"> Food sensitivities</label>
      </div>
      <label class="hq-label">Bowel frequency</label>
      <div class="radio-group" id="hq-bowel-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-bowel')">Less than daily</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bowel')">Once daily</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bowel')">2‚Äì3√ó daily</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bowel')">Irregular</div>
      </div>
      <label class="hq-label">Gut health notes</label>
      <textarea id="hq-gut" placeholder="Microbiome test results, probiotics used, dietary restrictions..."></textarea>
    </div>

    <!-- Section 12 -->
    <div class="hq-section" id="hqs-12">
      <div class="section-title">1Ô∏è‚É£2Ô∏è‚É£ Immune & Inflammation</div>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="imm-freq"> Frequent infections</label>
        <label class="check-item"><input type="checkbox" id="imm-auto"> Autoimmune condition</label>
        <label class="check-item"><input type="checkbox" id="imm-allergy"> Allergies/asthma</label>
        <label class="check-item"><input type="checkbox" id="imm-skin"> Skin disorders (eczema, psoriasis)</label>
        <label class="check-item"><input type="checkbox" id="imm-joint"> Joint pain/stiffness</label>
        <label class="check-item"><input type="checkbox" id="imm-crp"> High CRP/inflammation markers</label>
      </div>
      <label class="hq-label">Known inflammation markers</label>
      <textarea id="hq-inflam" placeholder="CRP levels, ESR, any inflammation-related test results..."></textarea>
    </div>

    <!-- Section 13 -->
    <div class="hq-section" id="hqs-13">
      <div class="section-title">1Ô∏è‚É£3Ô∏è‚É£ Neurological, Sensory & Pain</div>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="neuro-head"> Headaches/migraines</label>
        <label class="check-item"><input type="checkbox" id="neuro-dizzy"> Dizziness/vertigo</label>
        <label class="check-item"><input type="checkbox" id="neuro-neuro"> Neuropathy</label>
        <label class="check-item"><input type="checkbox" id="neuro-seizure"> Seizures</label>
        <label class="check-item"><input type="checkbox" id="neuro-vision"> Vision issues</label>
        <label class="check-item"><input type="checkbox" id="neuro-hear"> Hearing issues</label>
        <label class="check-item"><input type="checkbox" id="pain-back"> Back/neck pain</label>
        <label class="check-item"><input type="checkbox" id="pain-joint"> Joint pain</label>
        <label class="check-item"><input type="checkbox" id="pain-muscle"> Muscle weakness</label>
        <label class="check-item"><input type="checkbox" id="pain-arthritis"> Arthritis</label>
      </div>
      <label class="hq-label">Chronic pain description</label>
      <textarea id="hq-pain" placeholder="Location, severity, duration, triggers of any chronic pain..."></textarea>
    </div>

    <!-- Section 14 -->
    <div class="hq-section" id="hqs-14">
      <div class="section-title">1Ô∏è‚É£4Ô∏è‚É£ Environmental & Occupational Exposure</div>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="env-air"> Air pollution exposure</label>
        <label class="check-item"><input type="checkbox" id="env-chem"> Chemical exposure (work)</label>
        <label class="check-item"><input type="checkbox" id="env-metal"> Heavy metal exposure</label>
        <label class="check-item"><input type="checkbox" id="env-noise"> Chronic noise exposure</label>
        <label class="check-item"><input type="checkbox" id="env-ergo"> Ergonomic strain</label>
        <label class="check-item"><input type="checkbox" id="env-sun"> Excessive sun exposure</label>
        <label class="check-item"><input type="checkbox" id="env-mold"> Mold / indoor air quality</label>
        <label class="check-item"><input type="checkbox" id="env-screen"> High screen time (8h+/day)</label>
      </div>
      <label class="hq-label">Environmental notes</label>
      <textarea id="hq-env" placeholder="City/area air quality, workplace hazards, recent toxin exposures..."></textarea>
    </div>

    <!-- Section 15 -->
    <div class="hq-section" id="hqs-15">
      <div class="section-title">1Ô∏è‚É£5Ô∏è‚É£ Preventive Health & Screening</div>
      <label class="hq-label">Last full blood test</label>
      <div class="radio-group" id="hq-blood-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-blood')">Within 3 months</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-blood')">3‚Äì12 months ago</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-blood')">1‚Äì3 years ago</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-blood')">Never / unsure</div>
      </div>
      <label class="hq-label">Cancer screenings up to date</label>
      <div class="radio-group" id="hq-screen-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-screen')">Yes</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-screen')">No</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-screen')">Not applicable</div>
      </div>
      <label class="hq-label">Dental health</label>
      <div class="radio-group" id="hq-dental-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-dental')">Excellent</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-dental')">Good (minor issues)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-dental')">Fair (multiple issues)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-dental')">Poor</div>
      </div>
    </div>

    <!-- Section 16 -->
    <div class="hq-section" id="hqs-16">
      <div class="section-title">1Ô∏è‚É£6Ô∏è‚É£ Functional Health & Physical Capacity</div>
      <label class="hq-label">Functional capacity (check what applies easily)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="func-stairs"> Climb 4 flights comfortably</label>
        <label class="check-item"><input type="checkbox" id="func-lift"> Lift 20kg</label>
        <label class="check-item"><input type="checkbox" id="func-walk"> Walk 5km without fatigue</label>
        <label class="check-item"><input type="checkbox" id="func-balance"> Good balance (1 leg 10s)</label>
        <label class="check-item"><input type="checkbox" id="func-grip"> Strong grip strength</label>
        <label class="check-item"><input type="checkbox" id="func-sprint"> Sprint 100m</label>
      </div>
      <label class="hq-label">Daily energy curve</label>
      <div class="radio-group" id="hq-curve-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-curve')">Flat (consistent)</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-curve')">Peak morning, drops PM</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-curve')">Slow start, peak afternoon</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-curve')">Afternoon crash then recovery</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-curve')">Night owl (peak evening)</div>
      </div>
    </div>

    <!-- Section 17 -->
    <div class="hq-section" id="hqs-17">
      <div class="section-title">1Ô∏è‚É£7Ô∏è‚É£ Longevity & Aging Markers</div>
      <label class="hq-label">Have you taken any biological age tests?</label>
      <div class="radio-group" id="hq-bioage-grp">
        <div class="radio-btn" onclick="selectRadio(this,'hq-bioage')">Yes ‚Äî younger than chrono age</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bioage')">Yes ‚Äî same as chrono age</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bioage')">Yes ‚Äî older than chrono age</div>
        <div class="radio-btn" onclick="selectRadio(this,'hq-bioage')">No tests taken</div>
      </div>
      <label class="hq-label">Longevity markers known (check all)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="lon-telomere"> Telomere length test</label>
        <label class="check-item"><input type="checkbox" id="lon-epigen"> Epigenetic clock</label>
        <label class="check-item"><input type="checkbox" id="lon-inflam"> Inflammation panel</label>
        <label class="check-item"><input type="checkbox" id="lon-hormone"> Hormone panel</label>
        <label class="check-item"><input type="checkbox" id="lon-comp"> Body composition</label>
        <label class="check-item"><input type="checkbox" id="lon-grip2"> Grip strength test</label>
      </div>
      <label class="hq-label">Longevity test notes</label>
      <textarea id="hq-longevity" placeholder="Any biological age test results, markers, scores..."></textarea>
    </div>

    <!-- Section 18 -->
    <div class="hq-section" id="hqs-18">
      <div class="section-title">1Ô∏è‚É£8Ô∏è‚É£ Health Goals & Priorities</div>
      <label class="hq-label">Main health concerns right now</label>
      <textarea id="hq-concerns" placeholder="e.g., Losing weight, improving energy, managing anxiety, better sleep..."></textarea>
      <label class="hq-label">Primary health goals (rank in order)</label>
      <div class="checkbox-grid">
        <label class="check-item"><input type="checkbox" id="goal-longevity"> Longevity / lifespan</label>
        <label class="check-item"><input type="checkbox" id="goal-perf"> Peak performance</label>
        <label class="check-item"><input type="checkbox" id="goal-mental"> Mental health</label>
        <label class="check-item"><input type="checkbox" id="goal-physique"> Body composition</label>
        <label class="check-item"><input type="checkbox" id="goal-energy"> More energy</label>
        <label class="check-item"><input type="checkbox" id="goal-sleep"> Better sleep</label>
        <label class="check-item"><input type="checkbox" id="goal-cog"> Cognitive enhancement</label>
        <label class="check-item"><input type="checkbox" id="goal-creativity"> Creative enhancement</label>
        <label class="check-item"><input type="checkbox" id="goal-stress"> Stress reduction</label>
        <label class="check-item"><input type="checkbox" id="goal-social"> Social wellbeing</label>
      </div>
      <label class="hq-label">Anything else important about your health</label>
      <textarea id="hq-other" placeholder="Any additional context, concerns, or goals not covered above..."></textarea>
    </div>

    <div class="hq-nav">
      <button class="btn btn-secondary" id="hqPrevBtn" onclick="hqNav(-1)" style="display:none">‚Üê Previous</button>
      <button class="btn btn-primary" id="hqNextBtn" onclick="hqNav(1)">Next Section ‚Üí</button>
    </div>
  </div>

  <div class="card" id="healthInsightCard" style="display:none">
    <div class="card-title">ü©∫ AI Health Analysis</div>
    <div id="healthInsightContent"></div>
  </div>
</div>

<!-- =================== GAMES TAB =================== -->
<div class="tab-pane" id="tab-games">
  <div class="card" id="gameMenu">
    <div class="card-title">üéÆ Cognitive Training Games</div>
    <div class="card-desc">8 scientifically-grounded games to train memory, focus, processing speed, creativity and more. Each session tracked for your progress.</div>
    <div class="game-grid">
      <div class="game-card" onclick="startGame('memory')">
        <div class="game-icon">üß©</div>
        <div class="game-title">Memory Match</div>
        <div class="game-desc">Flip cards and find matching pairs. Tests working memory &amp; visual recall.</div>
        <div class="game-badge badge-med">Medium</div>
      </div>
      <div class="game-card" onclick="startGame('reaction')">
        <div class="game-icon">‚ö°</div>
        <div class="game-title">Reaction Time</div>
        <div class="game-desc">Tap when the light goes green. Measures neural processing speed.</div>
        <div class="game-badge badge-easy">Easy</div>
      </div>
      <div class="game-card" onclick="startGame('stroop')">
        <div class="game-icon">üé®</div>
        <div class="game-title">Stroop Challenge</div>
        <div class="game-desc">Name the ink color, not the word. Tests cognitive control &amp; attention.</div>
        <div class="game-badge badge-hard">Hard</div>
      </div>
      <div class="game-card" onclick="startGame('nback')">
        <div class="game-icon">üî¢</div>
        <div class="game-title">N-Back Memory</div>
        <div class="game-desc">Remember positions N steps back. Scientifically proven to boost IQ.</div>
        <div class="game-badge badge-hard">Hard</div>
      </div>
      <div class="game-card" onclick="startGame('math')">
        <div class="game-icon">üßÆ</div>
        <div class="game-title">Math Blitz</div>
        <div class="game-desc">Rapid mental arithmetic. Sharpens numerical processing &amp; focus.</div>
        <div class="game-badge badge-med">Medium</div>
      </div>
      <div class="game-card" onclick="startGame('word')">
        <div class="game-icon">üí¨</div>
        <div class="game-title">Word Chain</div>
        <div class="game-desc">Build word associations quickly. Activates verbal creativity &amp; fluency.</div>
        <div class="game-badge badge-easy">Easy</div>
      </div>
      <div class="game-card" onclick="startGame('sequence')">
        <div class="game-icon">üî¥</div>
        <div class="game-title">Color Sequence</div>
        <div class="game-desc">Repeat the color pattern. Classic working memory &amp; attention test.</div>
        <div class="game-badge badge-med">Medium</div>
      </div>
      <div class="game-card" onclick="startGame('breathing')">
        <div class="game-icon">üå¨Ô∏è</div>
        <div class="game-title">Focus Breathing</div>
        <div class="game-desc">4-7-8 or box breathing. Reduce stress &amp; enter a calm focused state.</div>
        <div class="game-badge badge-easy">Calm</div>
      </div>
    </div>
  </div>
  <div class="card" id="gameArenaCard" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <div class="card-title" id="gameTitleDisplay">Game</div>
      <button class="btn btn-secondary btn-sm" onclick="exitGame()">‚Üê Back</button>
    </div>
    <div class="game-arena" id="gameArena">Loading game...</div>
  </div>
</div>

<!-- =================== DREAMS TAB =================== -->
<div class="tab-pane" id="tab-dreams">
  <div class="card">
    <div class="card-title">üí§ Lucid Dreaming Tracker</div>

    <div class="lucid-stats">
      <div class="lucid-stat"><div class="lucid-stat-val" id="ldTotal">0</div><div class="lucid-stat-lbl">Dreams Logged</div></div>
      <div class="lucid-stat"><div class="lucid-stat-val" id="ldLucid">0</div><div class="lucid-stat-lbl">Lucid Dreams</div></div>
      <div class="lucid-stat"><div class="lucid-stat-val" id="ldStreak">0</div><div class="lucid-stat-lbl">Day Streak</div></div>
    </div>
  </div>

  <!-- Log a Dream -->
  <div class="card">
    <div class="card-title">üìî Log a Dream</div>
    <div class="input-label">Date</div>
    <input type="date" id="dreamDate">
    <div class="input-label">Dream Title</div>
    <input type="text" id="dreamTitle" placeholder="e.g., Flying over mountains, Lost in a city...">
    <div class="input-label">Dream Type</div>
    <div class="dream-type-grid">
      <div class="dream-type" onclick="selectDreamType(this,'regular')"><div class="dream-type-icon">üí§</div><div class="dream-type-name">Regular</div></div>
      <div class="dream-type" onclick="selectDreamType(this,'lucid')"><div class="dream-type-icon">üåü</div><div class="dream-type-name">Lucid</div></div>
      <div class="dream-type" onclick="selectDreamType(this,'vivid')"><div class="dream-type-icon">üé®</div><div class="dream-type-name">Vivid</div></div>
      <div class="dream-type" onclick="selectDreamType(this,'nightmare')"><div class="dream-type-icon">üò±</div><div class="dream-type-name">Nightmare</div></div>
      <div class="dream-type" onclick="selectDreamType(this,'recurring')"><div class="dream-type-icon">üîÅ</div><div class="dream-type-name">Recurring</div></div>
      <div class="dream-type" onclick="selectDreamType(this,'prophetic')"><div class="dream-type-icon">üîÆ</div><div class="dream-type-name">Prophetic</div></div>
    </div>
    <input type="hidden" id="selectedDreamType" value="regular">
    <div class="input-label">Dream Description</div>
    <textarea id="dreamDesc" placeholder="Describe everything you remember ‚Äî setting, characters, feelings, events, symbols..."></textarea>
    <div class="input-label">Vividness (0‚Äì10)</div>
    <div style="display:flex;align-items:center;gap:14px">
      <input type="range" id="dreamVividness" min="0" max="10" value="5" style="flex:1">
      <span style="font-size:22px;font-weight:900;color:var(--accent);font-family:var(--font-head)" id="dreamVividnessVal">5</span>
    </div>
    <div class="input-label">Lucidity Level (0‚Äì10, 0=none, 10=full control)</div>
    <div style="display:flex;align-items:center;gap:14px">
      <input type="range" id="dreamLucidity" min="0" max="10" value="0" style="flex:1">
      <span style="font-size:22px;font-weight:900;color:var(--accent);font-family:var(--font-head)" id="dreamLucidityVal">0</span>
    </div>
    <div class="input-label">Dream Signs / Reality Check Triggers</div>
    <input type="text" id="dreamSigns" placeholder="e.g., Flying, missing teeth, old school, hands look weird...">
    <div class="input-label">Emotions Felt in Dream</div>
    <input type="text" id="dreamEmotions" placeholder="e.g., Fear, Joy, Confusion, Exhilaration...">
    <br>
    <button class="btn btn-primary" onclick="saveDream()">üíæ Save Dream</button>
  </div>

  <!-- Lucid Dreaming Techniques -->
  <div class="card">
    <div class="card-title">üß† Lucid Dreaming Techniques</div>
    <div class="card-desc">Evidence-based methods to induce and maintain lucid dreams.</div>

    <div class="technique-card">
      <div class="technique-header">
        <div class="technique-name">üåä WILD ‚Äî Wake Induced Lucid Dream</div>
        <div class="technique-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Most powerful</div>
      </div>
      <div class="technique-desc">Maintain consciousness while body falls asleep. Wake after 5‚Äì6 hours of sleep, stay awake 30‚Äì60 min, then re-enter sleep with focused attention. Watch hypnagogic imagery until you "step into" the dream. Requires practice but produces the most vivid, controlled lucid dreams.</div>
    </div>

    <div class="technique-card">
      <div class="technique-header">
        <div class="technique-name">üí≠ MILD ‚Äî Mnemonic Induction</div>
        <div class="technique-rating">‚≠ê‚≠ê‚≠ê‚≠ê Beginner-friendly</div>
      </div>
      <div class="technique-desc">Before sleep, repeat: "Tonight I will realize I am dreaming." Visualize yourself becoming lucid in a previous dream. Set a clear intention. This works with prospective memory ‚Äî your brain primes itself to recognize the dream state. Most accessible technique for beginners.</div>
    </div>

    <div class="technique-card">
      <div class="technique-header">
        <div class="technique-name">üîç DILD ‚Äî Dream Initiated Lucid Dream</div>
        <div class="technique-rating">‚≠ê‚≠ê‚≠ê‚≠ê Most common</div>
      </div>
      <div class="technique-desc">Become lucid within a dream by noticing inconsistencies ‚Äî reality checks while in the dream. The key is doing reality checks habitually during the day so they become automatic in dreams. Ask: "Could this be a dream?" Look at your hands. Try to push a finger through your palm.</div>
    </div>

    <div class="technique-card">
      <div class="technique-header">
        <div class="technique-name">‚è∞ WBTB ‚Äî Wake Back To Bed</div>
        <div class="technique-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Synergy booster</div>
      </div>
      <div class="technique-desc">Wake up after 5‚Äì6 hours of sleep (alarm). Stay awake 30‚Äì60 minutes reading about lucid dreaming, journaling or meditating. Return to sleep with lucid dreaming intention. REM periods are longest in the second half of sleep ‚Äî this directly targets them. Combine with WILD or MILD for maximum effect.</div>
    </div>

    <div class="technique-card">
      <div class="technique-header">
        <div class="technique-name">üåÄ Reality Testing Protocol</div>
        <div class="technique-rating">‚≠ê‚≠ê‚≠ê Foundation practice</div>
      </div>
      <div class="technique-desc">Do 10‚Äì15 reality checks daily with genuine questioning. Best checks: (1) Push finger through palm ‚Äî in dreams it goes through, (2) Read text twice ‚Äî it changes in dreams, (3) Check a digital clock twice ‚Äî digits shift in dreams, (4) Pinch nose and try to breathe ‚Äî you can in dreams. Do checks at random moments AND after unusual events.</div>
    </div>
  </div>

  <!-- Reality Check Tracker -->
  <div class="card">
    <div class="card-title">üîç Reality Check Reminders</div>
    <div class="card-desc">Tap each check when you do it in waking life to build the habit that carries into dreams.</div>
    <div class="reality-check-grid">
      <div class="rc-item" onclick="logRC(this,'finger')"><div class="rc-icon">üëÜ</div><div class="rc-name">Finger Through Palm</div><div class="rc-desc">Push index finger into palm</div></div>
      <div class="rc-item" onclick="logRC(this,'text')"><div class="rc-icon">üìñ</div><div class="rc-name">Read Text Twice</div><div class="rc-desc">Look away and re-read text</div></div>
      <div class="rc-item" onclick="logRC(this,'clock')"><div class="rc-icon">üïê</div><div class="rc-name">Check Clock Twice</div><div class="rc-desc">Look at time, look away, check again</div></div>
      <div class="rc-item" onclick="logRC(this,'nose')"><div class="rc-icon">üëÉ</div><div class="rc-name">Nose Pinch Breathe</div><div class="rc-desc">Pinch nose and try to breathe</div></div>
      <div class="rc-item" onclick="logRC(this,'hands')"><div class="rc-icon">ü§≤</div><div class="rc-name">Inspect Hands</div><div class="rc-desc">Look closely at your hands</div></div>
      <div class="rc-item" onclick="logRC(this,'jump')"><div class="rc-icon">‚¨ÜÔ∏è</div><div class="rc-name">Try to Float</div><div class="rc-desc">Gently jump and expect to float</div></div>
    </div>
    <div style="margin-top:12px;padding:12px;background:var(--bg4);border-radius:10px;font-size:13px;color:var(--text2)">
      Today's checks: <strong id="rcCount">0</strong> / 15 target
      <div class="progress-bar-wrap" style="margin-top:8px"><div class="progress-bar-fill" id="rcProgress" style="width:0%"></div></div>
    </div>
  </div>

  <!-- Sleep Cycle Calculator -->
  <div class="card">
    <div class="card-title">‚è∞ Sleep Cycle & WBTB Calculator</div>
    <div class="card-desc">Calculate optimal WBTB alarm and sleep cycles for lucid dreaming.</div>
    <div class="input-label">I plan to sleep at</div>
    <input type="time" id="sleepAt" value="23:00">
    <div class="input-label">I want to wake up by</div>
    <input type="time" id="wakeAt" value="07:00">
    <button class="btn btn-primary" onclick="calcSleep()" style="margin-top:10px">Calculate Optimal Times</button>
    <div id="sleepCalcResult" style="margin-top:14px"></div>
  </div>

  <!-- Dream Journal -->
  <div class="card">
    <div class="card-title">üìî Dream Journal</div>
    <div id="dreamJournal"><div class="empty-state"><div class="empty-icon">üí§</div><p>Log your first dream to begin building your dream journal</p></div></div>
  </div>
</div>

<!-- =================== VOICE TAB =================== -->
<div class="tab-pane" id="tab-voice">
  <div class="card">
    <div class="card-title">üé§ Voice Memo Recorder</div>
    <div class="card-desc">Record voice notes with real-time transcription for consciousness capture on the go.</div>
    <div style="text-align:center;padding:20px 0">
      <button id="recordBtn" onclick="toggleRecording()" style="width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;font-size:36px;cursor:pointer;box-shadow:0 8px 24px rgba(124,58,237,0.4);transition:all 0.3s">‚óè</button>
      <p id="recordStatus" style="text-align:center;font-weight:700;margin:14px 0;color:var(--text2)">Tap to start recording</p>
    </div>
    <div id="transcriptBox" style="min-height:80px;background:var(--bg4);border-radius:12px;padding:14px;border:1px solid var(--border);font-size:14px;color:var(--text2)">Transcription will appear here...</div>
  </div>
  <div class="card">
    <div class="card-title">üìÅ Voice Memos (<span id="memoCount">0</span>)</div>
    <div id="memosList"><div class="empty-state"><div class="empty-icon">üé§</div><p>No memos recorded yet</p></div></div>
  </div>
</div>

<!-- =================== MEDIA TAB =================== -->
<div class="tab-pane" id="tab-media">
  <div class="card">
    <div class="card-title">üì∏ Visual Memory Archive</div>
    <label style="display:block;border:2px dashed var(--border);border-radius:14px;padding:40px;text-align:center;cursor:pointer;background:var(--bg4);transition:all 0.2s" for="mediaInput" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
      <div style="font-size:48px;margin-bottom:12px">üì∑</div>
      <div style="font-weight:700;margin-bottom:6px;font-family:var(--font-head)">Tap to upload photos or videos</div>
      <div style="font-size:13px;color:var(--text2)">Preserves visual consciousness states &amp; memories</div>
      <input type="file" id="mediaInput" accept="image/*,video/*" onchange="uploadMedia(event)" multiple style="display:none">
    </label>
  </div>
  <div class="card">
    <div class="card-title">üñºÔ∏è Gallery (<span id="mediaCount">0</span>)</div>
    <div id="mediaGallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px">
      <div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üñºÔ∏è</div><p>No media uploaded yet</p></div>
    </div>
  </div>
</div>

<!-- =================== CALENDAR TAB =================== -->
<div class="tab-pane" id="tab-calendar">
  <div class="card">
    <div class="card-title">üìÖ Consciousness Calendar</div>
    <div class="calendar" id="calendarEl"></div>
  </div>
  <div class="card">
    <div class="card-title">‚è∞ Reminders</div>
    <input type="text" id="reminderText" placeholder="What to remember?">
    <input type="datetime-local" id="reminderTime">
    <button class="btn btn-primary" onclick="addReminder()" style="margin-top:8px">‚ûï Add Reminder</button>
    <div id="remindersList" style="margin-top:14px"></div>
  </div>
</div>

<!-- =================== SETTINGS TAB =================== -->
<div class="tab-pane" id="tab-settings">
  <div class="card">
    <div class="card-title">‚öôÔ∏è App Settings</div>
    <label class="toggle-row">
      <span class="toggle-lbl">üåô Dark Mode</span>
      <label class="toggle"><input type="checkbox" id="darkModeToggle" onchange="applyTheme()"><div class="toggle-track"></div><div class="toggle-thumb"></div></label>
    </label>
    <label class="toggle-row">
      <span class="toggle-lbl">üîî Notifications</span>
      <label class="toggle"><input type="checkbox" id="notifToggle" checked><div class="toggle-track"></div><div class="toggle-thumb"></div></label>
    </label>
    <label class="toggle-row">
      <span class="toggle-lbl">üé§ Auto-transcribe Voice</span>
      <label class="toggle"><input type="checkbox" id="transcribeToggle" checked><div class="toggle-track"></div><div class="toggle-thumb"></div></label>
    </label>
    <label class="toggle-row">
      <span class="toggle-lbl">üí° Show Slider Anchors</span>
      <label class="toggle"><input type="checkbox" id="anchorsToggle" checked><div class="toggle-track"></div><div class="toggle-thumb"></div></label>
    </label>
  </div>
  <div class="card">
    <div class="card-title">üíæ Data Management</div>
    <button class="btn btn-primary" onclick="exportData()">üì§ Export All Data (JSON)</button>
    <button class="btn btn-secondary" onclick="importData()">üì• Import Data</button>
    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
  </div>
  <div class="card">
    <div class="card-title">‚ÑπÔ∏è About</div>
    <p style="font-size:14px;color:var(--text2);line-height:1.7">
      <strong>Consciousness OS v5.0</strong><br>
      A comprehensive mind tracking, preservation, and enhancement system.<br><br>
      All data is stored locally on your device. Nothing is sent to external servers. Your consciousness data is yours alone.
    </p>
    <div style="margin-top:14px">
      <button class="btn btn-secondary btn-sm" onclick="showLegal('privacy')">Privacy Policy</button>
      <button class="btn btn-secondary btn-sm" onclick="showLegal('terms')" style="margin-left:8px">Terms of Use</button>
      <button class="btn btn-secondary btn-sm" onclick="showLegal('copyright')" style="margin-left:8px">Copyright</button>
      <button class="btn btn-secondary btn-sm" onclick="showLegal('disclaimer')" style="margin-left:8px">Disclaimer</button>
    </div>
  </div>
</div>

</div><!-- end main-content -->

<!-- =================== FOOTER =================== -->
<footer class="footer">
  <div class="footer-brand">üß† Consciousness OS</div>
  <div class="footer-links">
    <a href="#" onclick="showLegal('privacy');return false">Privacy Policy</a>
    <a href="#" onclick="showLegal('terms');return false">Terms of Use</a>
    <a href="#" onclick="showLegal('copyright');return false">Copyright Notice</a>
    <a href="#" onclick="showLegal('disclaimer');return false">Health Disclaimer</a>
    <a href="#" onclick="showLegal('features');return false">Features Guide</a>
    <a href="#" onclick="showOnboarding();return false">App Tour</a>
  </div>
  <div class="footer-copy">¬© 2025 Consciousness OS. All rights reserved. Version 5.0 ‚Äî Local-first, privacy-first.</div>
</footer>

</div><!-- end app-shell -->

<!-- =================== MODAL =================== -->
<div class="modal" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal-box">
    <span class="modal-close" onclick="closeModal()">‚úï</span>
    <div id="modalBody"></div>
  </div>
</div>

<!-- =================== TOAST =================== -->
<div class="toast" id="toast"></div>

<script>
// =================== STATE ===================
let logs = JSON.parse(localStorage.getItem('cos_logs') || '[]')
let voiceMemos = JSON.parse(localStorage.getItem('cos_voice') || '[]')
let mediaFiles = JSON.parse(localStorage.getItem('cos_media') || '[]')
let healthData = JSON.parse(localStorage.getItem('cos_health2') || '{}')
let reminders = JSON.parse(localStorage.getItem('cos_reminders') || '[]')
let dreams = JSON.parse(localStorage.getItem('cos_dreams') || '[]')
let rcCount = parseInt(localStorage.getItem('cos_rc_today') || '0')
let isRecording = false, mediaRecorder = null, audioChunks = [], recognition = null, fullTranscript = ''
let currentGame = null, gameState = {}
let hqSection = 1
const TOTAL_HQ = 18

// =================== INIT ===================
document.addEventListener('DOMContentLoaded', () => {
  initDateTime()
  document.getElementById('dreamDate').valueAsDate = new Date()
  document.getElementById('dreamVividness').oninput = () => document.getElementById('dreamVividnessVal').textContent = document.getElementById('dreamVividness').value
  document.getElementById('dreamLucidity').oninput = () => document.getElementById('dreamLucidityVal').textContent = document.getElementById('dreamLucidity').value
  initSpeechRecognition()
  updateRCDisplay()
  updateLucidStats()
  renderAnalysis()

  const hasVisited = localStorage.getItem('cos_visited')
  if (!hasVisited) {
    document.getElementById('onboarding').classList.remove('hidden')
    initOnboarding()
  } else {
    document.getElementById('onboarding').classList.add('hidden')
  }

  const dark = localStorage.getItem('cos_theme') === 'dark'
  if (dark) {
    document.documentElement.setAttribute('data-theme','dark')
    document.getElementById('darkModeToggle').checked = true
    document.getElementById('themeBtn').textContent = 'üåô'
  }
})

// =================== ONBOARDING ===================
let onboardStep = 0
const ONBOARD_STEPS = 5
function initOnboarding() {
  const prog = document.getElementById('onboardProgress')
  prog.innerHTML = Array.from({length:ONBOARD_STEPS},(_,i)=>`<div class="onboard-dot ${i===0?'active':''}" onclick="goOnboard(${i})"></div>`).join('')
}
function goOnboard(n) {
  document.querySelectorAll('.onboard-step').forEach(s=>s.classList.remove('active'))
  document.querySelectorAll('.onboard-dot').forEach((d,i)=>d.classList.toggle('active',i===n))
  document.querySelectorAll('.onboard-step')[n].classList.add('active')
  onboardStep = n
}
function nextOnboard() { if(onboardStep<ONBOARD_STEPS-1) goOnboard(onboardStep+1) }
function prevOnboard() { if(onboardStep>0) goOnboard(onboardStep-1) }
function closeOnboarding() {
  document.getElementById('onboarding').classList.add('hidden')
  localStorage.setItem('cos_visited','1')
}
function showOnboarding() {
  document.getElementById('onboarding').classList.remove('hidden')
  initOnboarding()
  goOnboard(0)
}

// =================== THEME ===================
function toggleTheme() {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark')
  document.getElementById('themeBtn').textContent = isDark ? '‚òÄÔ∏è' : 'üåô'
  document.getElementById('darkModeToggle').checked = !isDark
  localStorage.setItem('cos_theme', isDark ? 'light' : 'dark')
}
function applyTheme() {
  const isDark = document.getElementById('darkModeToggle').checked
  document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light')
  document.getElementById('themeBtn').textContent = isDark ? 'üåô' : '‚òÄÔ∏è'
  localStorage.setItem('cos_theme', isDark ? 'dark' : 'light')
}

// =================== TABS ===================
function switchTab(name, btn) {
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'))
  document.querySelectorAll('.nav-tab').forEach(b=>b.classList.remove('active'))
  document.getElementById('tab-'+name).classList.add('active')
  if (btn) btn.classList.add('active')
  if (name==='analysis') renderAnalysis()
  if (name==='calendar') renderCalendar()
  if (name==='voice') loadMemos()
  if (name==='media') loadMedia()
  if (name==='twin') updateTwinInfo()
  if (name==='dreams') { updateLucidStats(); loadDreamJournal() }
}

// =================== DATETIME ===================
function initDateTime() {
  const now = new Date()
  document.getElementById('entryDate').valueAsDate = now
  const t = now.toTimeString().slice(0,5)
  document.getElementById('entryTime').value = t
}

// =================== SLIDERS ===================
function updateSlider(id) {
  const val = document.getElementById(id).value
  const disp = document.getElementById(id+'Val')
  if (disp) disp.textContent = val
  calcLiveScore()
}

function calcLiveScore() {
  const g = id => +document.getElementById(id).value
  const mood=g('mood'), energy=g('mentalEnergy'), phys=g('physicalEnergy')
  const focus=g('focus'), sleep=g('sleep'), stress=g('stress')
  const creat=g('creativity'), motiv=g('motivation'), flow=g('flow')
  const clarity=g('clarity'), mindful=g('mindfulness'), willpower=g('willpower')
  const score = ((focus*2.5+energy*2.2+phys*1.5+mood*1.8+sleep*1.8+creat*1.3+motiv*1.2+flow*1.5+clarity*1.8+mindful*1.0+willpower*1.0+stress*-1.5)/18.1).toFixed(1)
  document.getElementById('currentScore').textContent = score
  document.getElementById('currentLabel').textContent =
    score>8.5?'üöÄ Transcendent Peak':
    score>7.5?'‚ö° High Performance':
    score>6.5?'üåü Elevated State':
    score>5.5?'‚öñÔ∏è Balanced Baseline':
    score>4?'üå•Ô∏è Below Baseline':
    'üåô Recovery Mode'
}

// =================== SAVE ENTRY ===================
function saveEntry() {
  const g = id => document.getElementById(id)
  const entry = {
    id: Date.now(),
    ts: new Date().toISOString(),
    date: g('entryDate').value,
    time: g('entryTime').value,
    timeOfDay: g('timeOfDay').value,
    activity: g('activity').value,
    sleep: +g('sleep').value,
    mood: +g('mood').value,
    physicalEnergy: +g('physicalEnergy').value,
    mentalEnergy: +g('mentalEnergy').value,
    focus: +g('focus').value,
    stress: +g('stress').value,
    creativity: +g('creativity').value,
    motivation: +g('motivation').value,
    clarity: +g('clarity').value,
    flow: +g('flow').value,
    anxiety: +g('anxiety').value,
    stability: +g('stability').value,
    social: +g('social').value,
    mindfulness: +g('mindfulness').value,
    willpower: +g('willpower').value,
    intuition: +g('intuition').value,
    emotion: g('emotion').value,
    brainwave: g('brainwave').value,
    sensation: g('sensation').value,
    pattern: g('pattern').value,
    action: g('action').value,
    thought: g('thought').value,
    goal: g('goal').value,
    obstacle: g('obstacle').value,
    gratitude: g('gratitude').value,
    insight: g('insight').value
  }
  entry.score = ((entry.focus*2.5+entry.mentalEnergy*2.2+entry.physicalEnergy*1.5+entry.mood*1.8+entry.sleep*1.8+entry.creativity*1.3+entry.motivation*1.2+entry.flow*1.5+entry.clarity*1.8+entry.mindfulness*1.0+entry.willpower*1.0+entry.stress*-1.5)/18.1).toFixed(1)

  logs.push(entry)
  localStorage.setItem('cos_logs', JSON.stringify(logs))
  showToast('‚úÖ Entry saved! Score: '+entry.score)

  document.querySelectorAll('#tab-log input[type="text"], #tab-log textarea').forEach(el=>el.value='')
  document.getElementById('brainwave').value = ''
}

// =================== AI TWIN ===================
function updateTwinInfo() {
  const info = logs.length
    ? `Learned from ${logs.length} entries ¬∑ Avg score: ${(logs.reduce((s,e)=>s+parseFloat(e.score),0)/logs.length).toFixed(1)}`
    : 'No data yet ‚Äî start logging to activate'
  document.getElementById('twinDataInfo').textContent = info
}

function askTwin(q) {
  document.getElementById('chatInput').value = q
  sendChat()
}

function sendChat() {
  const input = document.getElementById('chatInput')
  const msg = input.value.trim()
  if (!msg) return
  addMsg('user', msg)
  input.value = ''
  setTimeout(() => {
    const response = getTwinResponse(msg)
    addMsg('ai', response)
  }, 600)
}

function addMsg(role, text) {
  const c = document.getElementById('chatMsgs')
  const d = document.createElement('div')
  d.className = 'msg '+role
  d.textContent = text
  c.appendChild(d)
  c.scrollTop = c.scrollHeight
}

function getTwinResponse(msg) {
  if (!logs.length) return "I don't have any data about you yet. Head to the Log tab and record your first consciousness entry ‚Äî even just a few sliders and I'll start learning your patterns."

  const n = Math.min(logs.length, 30)
  const recent = logs.slice(-n)
  const avg = field => (recent.reduce((s,e) => s+(e[field]||0), 0)/n).toFixed(1)
  const avgMood=avg('mood'), avgFocus=avg('focus'), avgEnergy=avg('mentalEnergy')
  const avgCreat=avg('creativity'), avgMotiv=avg('motivation'), avgFlow=avg('flow')
  const avgStress=avg('stress'), avgClarity=avg('clarity'), avgSleep=avg('sleep')

  const ml = msg.toLowerCase()
  const total = logs.length

  if (ml.includes('best time') || ml.includes('peak time') || ml.includes('deep work') || ml.includes('time of day')) {
    const byTime = {}
    recent.forEach(e => {
      const t = e.timeOfDay || 'Unknown'
      if (!byTime[t]) byTime[t] = {total:0,count:0}
      byTime[t].total += parseFloat(e.score)
      byTime[t].count++
    })
    const best = Object.entries(byTime).sort((a,b)=>(b[1].total/b[1].count)-(a[1].total/a[1].count))[0]
    if (best) return `Based on your ${total} entries, your peak performance time is ${best[0].split(' ')[0]} with an average score of ${(best[1].total/best[1].count).toFixed(1)}/10. That's when your focus, energy, and clarity are highest. I'd recommend scheduling your most cognitively demanding work during this window.`
    return `I need more time-tagged entries to identify your peak. Log entries across different times of day for a week and I'll find your optimal window.`
  }

  if (ml.includes('stress') || ml.includes('anxious') || ml.includes('anxiety')) {
    const highStress = recent.filter(e => e.stress > 6)
    const pct = ((highStress.length/n)*100).toFixed(0)
    const stressTimes = [...new Set(highStress.map(e=>e.timeOfDay))].join(', ')
    return `Your stress data shows: average stress ${avgStress}/10 across ${n} recent entries. High stress (above 6) occurred in ${pct}% of logs${stressTimes ? ', mostly during ' + stressTimes : ''}. Your average anxiety is ${avg('anxiety')}/10. ${parseFloat(avgStress)>6?'You may benefit from regular decompression practices ‚Äî your stress load appears elevated.':'Your stress appears manageable overall, though watch for spikes.'}`
  }

  if (ml.includes('flow') || ml.includes('flow state')) {
    const flowEntries = recent.filter(e=>e.flow>=7)
    const flowActivities = [...new Set(flowEntries.map(e=>e.activity))].slice(0,3).join(', ')
    return `Your flow data: average flow ${avgFlow}/10. You entered deep flow (7+) in ${flowEntries.length} out of ${n} recent entries${flowActivities ? ', most often while: '+flowActivities : ''}. Flow correlates strongly with your focus (${avgFocus}) and creativity (${avgCreat}) scores. To increase flow frequency: eliminate distractions, ensure adequate sleep (your avg: ${avgSleep}), and tackle tasks at your skill edge.`
  }

  if (ml.includes('creative') || ml.includes('creativity')) {
    const peakCreat = recent.filter(e=>e.creativity>=8)
    return `Your creativity profile: average ${avgCreat}/10. Peak creativity sessions (8+) happened ${peakCreat.length} times recently. Creativity correlates with your flow (${avgFlow}) and mental energy (${avgEnergy}) levels. Your brainwave patterns when creative tend toward ${logs.filter(e=>e.creativity>7&&e.brainwave).map(e=>e.brainwave)[0] || 'theta/alpha states'}. Try creative work after physical exercise or meditation when your mental energy is high.`
  }

  if (ml.includes('predict') || ml.includes('tomorrow') || ml.includes('performance')) {
    const trend3 = (recent.slice(-3).reduce((s,e)=>s+parseFloat(e.score),0)/3).toFixed(1)
    const trend7 = (recent.slice(-7).reduce((s,e)=>s+parseFloat(e.score),0)/Math.min(7,n)).toFixed(1)
    const momentum = (parseFloat(trend3)-parseFloat(trend7)).toFixed(1)
    return `Prediction for tomorrow: Your 3-day average is ${trend3} vs 7-day average of ${trend7} (momentum: ${momentum>0?'+':''}${momentum}). ${parseFloat(momentum)>0.3?'Upward trajectory ‚Äî expect above-baseline performance tomorrow. Ride this wave.':parseFloat(momentum)<-0.3?'Slight decline ‚Äî focus on sleep quality tonight, avoid late screens. Consider lighter cognitive load tomorrow.':'Stable state ‚Äî predictable performance. Your recent sleep average (${avgSleep}) is the key variable to optimize.'}`
  }

  if (ml.includes('sleep') || ml.includes('rest')) {
    const badSleep = recent.filter(e=>e.sleep<5).length
    return `Sleep analysis: your average sleep quality is ${avgSleep}/10. Poor sleep nights (below 5): ${badSleep} of ${n} recent entries. Sleep strongly predicts your next-day focus (${avgFocus}) and mood (${avgMood}). ${parseFloat(avgSleep)<6?'Your sleep quality needs attention ‚Äî this is likely your biggest performance bottleneck.':'Your sleep is decent. Optimizing further could meaningfully boost your focus and creativity scores.'}`
  }

  if (ml.includes('mood') || ml.includes('emotion') || ml.includes('happy')) {
    const emotions = recent.map(e=>e.emotion).filter(Boolean)
    const topEmotion = emotions.length ? [...emotions.reduce((m,e)=>(m.set(e,(m.get(e)||0)+1),m),new Map())].sort((a,b)=>b[1]-a[1])[0][0] : null
    return `Mood profile: average ${avgMood}/10. Your most frequent emotion: ${topEmotion||'not yet logged'}. ${parseFloat(avgMood)>7?'Your emotional baseline is positive ‚Äî you\'re thriving.':parseFloat(avgMood)<5?'Your mood baseline is below neutral. What patterns correlate with low days? Let\'s dig into your data together.':'You\'re in neutral-to-positive territory. Small interventions in sleep and exercise could push you into consistent 7+ territory.'} Mood and stability (your avg: ${avg('stability')}) correlate strongly.`
  }

  if (ml.includes('improve') || ml.includes('progress') || ml.includes('better')) {
    const oldAvg = logs.length>=20 ? (logs.slice(-20,-10).reduce((s,e)=>s+parseFloat(e.score),0)/10).toFixed(1) : null
    const newAvg = (recent.slice(-10).reduce((s,e)=>s+parseFloat(e.score),0)/Math.min(10,n)).toFixed(1)
    if (!oldAvg) return `You have ${total} entries so far. Keep logging ‚Äî once you have 20+, I can show you clear before/after comparisons. Your current 10-session average: ${newAvg}/10.`
    const change = (parseFloat(newAvg)-parseFloat(oldAvg)).toFixed(1)
    return `Progress report: Your recent 10-session average is ${newAvg} vs previous 10-session average of ${oldAvg} ‚Äî that's a ${change>0?'+':''}${change} change. ${parseFloat(change)>0.3?'üìà You\'re improving meaningfully. Keep doing what\'s working.':parseFloat(change)<-0.3?'üìâ Slight decline. Let\'s look at what changed ‚Äî stress (${avgStress}), sleep (${avgSleep}), and activity patterns are the usual suspects.':'‚û°Ô∏è You\'re stable. To break into higher levels, focus on optimizing your lowest-scoring dimension.'}`
  }

  if (ml.includes('cognit') || ml.includes('intelligence') || ml.includes('brain')) {
    const score = ((parseFloat(avgFocus)+parseFloat(avgEnergy)+parseFloat(avgClarity)+parseFloat(avgCreat))/4).toFixed(1)
    return `Cognitive profile summary (${n} entries): Composite cognition score: ${score}/10. Focus: ${avgFocus} | Mental Energy: ${avgEnergy} | Clarity: ${avgClarity} | Creativity: ${avgCreat}. Your cognitive peak dimensions: ${[['focus',avgFocus],['clarity',avgClarity],['creativity',avgCreat],['flow',avgFlow]].sort((a,b)=>b[1]-a[1])[0][0]}. Cognitive gaps to address: ${[['focus',avgFocus],['clarity',avgClarity],['creativity',avgCreat],['motivation',avgMotiv]].sort((a,b)=>a[1]-b[1])[0][0]}.`
  }

  // Default rich response
  const insights = [
    `I've analyzed your ${total} consciousness entries. Your overall pattern: avg score ${avg('score') !== 'NaN' ? (logs.reduce((s,e)=>s+parseFloat(e.score),0)/total).toFixed(1) : '--'}/10. Your strongest dimensions are ${[['mood',avgMood],['focus',avgFocus],['energy',avgEnergy],['creativity',avgCreat]].sort((a,b)=>b[1]-a[1]).slice(0,2).map(x=>x[0]).join(' and ')}. Your growth areas are ${[['sleep',avgSleep],['motivation',avgMotiv],['flow',avgFlow]].sort((a,b)=>a[1]-b[1]).slice(0,1).map(x=>x[0]).join(' and ')}.`,
    `Looking at your recent entries: sleep quality averages ${avgSleep}/10, which ${parseFloat(avgSleep)>7?'is excellent and likely boosting':'may be constraining'} your daily performance. Stress at ${avgStress}/10 ${parseFloat(avgStress)>6?'is elevated ‚Äî this is impacting your focus and mood':'appears manageable'}.`,
    `Your consciousness data shows ${logs.filter(e=>e.flow>=7).length} flow states, ${logs.filter(e=>e.creativity>=8).length} peak creative sessions, and ${logs.filter(e=>parseFloat(e.score)>=8).length} high-performance days logged so far. What would you like to optimize?`
  ]
  return insights[Math.floor(Math.random()*insights.length)]
}

// =================== ANALYSIS ===================
function renderAnalysis() {
  if (!logs.length) return
  const n = Math.min(logs.length,30)
  const recent = logs.slice(-n)
  const avg = field => (recent.reduce((s,e)=>s+(e[field]||0),0)/n).toFixed(1)

  document.getElementById('sMood').textContent = avg('mood')
  document.getElementById('sFocus').textContent = avg('focus')
  document.getElementById('sEnergy').textContent = avg('mentalEnergy')
  document.getElementById('sCreativity').textContent = avg('creativity')
  document.getElementById('sFlow').textContent = avg('flow')
  document.getElementById('sEntries').textContent = logs.length

  renderPredictions()
  renderTrends()
  renderPatterns()
  renderRecords()
  renderRecentEntries()
}

function renderPredictions() {
  const el = document.getElementById('predictions')
  if (logs.length<7) return
  const recent = logs.slice(-7).map(e=>parseFloat(e.score))
  const trend = (recent.slice(-3).reduce((s,v)=>s+v,0)/3) - (recent.slice(0,3).reduce((s,v)=>s+v,0)/3)
  const stressTrend = (logs.slice(-3).reduce((s,e)=>s+e.stress,0)/3) - (logs.slice(-7,-4).reduce((s,e)=>s+e.stress,0)/3)
  el.innerHTML = `
    <div class="insight-box">
      <strong>Tomorrow:</strong> ${trend>0.5?'üìà High performance likely ‚Äî your upward momentum suggests above-baseline day':trend<-0.5?'üìâ Lower performance risk ‚Äî prioritize sleep, light exercise, reduce commitments':'‚û°Ô∏è Stable ‚Äî expect baseline-level performance'}
    </div>
    <div class="insight-box">
      <strong>Stress Trajectory:</strong> ${stressTrend>0.5?'‚ö†Ô∏è Stress rising ‚Äî schedule decompression time today':stressTrend<-0.5?'‚úÖ Stress reducing ‚Äî positive trend continues':'üòå Stress stable'}
    </div>
    <div class="insight-box">
      <strong>This Week:</strong> ${trend>0.5?'üöÄ Upward ‚Äî this is a good time for ambitious projects':trend<-0?'‚ö° Focus on recovery ‚Äî restoration will compound into future gains':'‚öñÔ∏è Maintain current rhythms ‚Äî your patterns are working'}
    </div>
  `
}

function renderTrends() {
  const el = document.getElementById('trends')
  if (logs.length<10) return
  const metrics = ['score','mood','focus','mentalEnergy','creativity','sleep','stress']
  const labels = {'score':'Score','mood':'Mood','focus':'Focus','mentalEnergy':'Energy','creativity':'Creativity','sleep':'Sleep','stress':'Stress'}
  const recentAvg = m => (logs.slice(-10).reduce((s,e)=>s+(parseFloat(e[m])||0),0)/10)
  const prevAvg = m => logs.length>=20 ? (logs.slice(-20,-10).reduce((s,e)=>s+(parseFloat(e[m])||0),0)/10) : null

  el.innerHTML = metrics.map(m => {
    const r = recentAvg(m).toFixed(1)
    const p = prevAvg(m)
    const change = p ? (recentAvg(m)-p).toFixed(1) : null
    const arrow = change ? (change>0?'‚Üë +'+change:change<0?'‚Üì '+change:'‚Üí') : ''
    const color = change ? (change>0?'#10b981':change<0?'#ef4444':'#9ca3af') : 'var(--text2)'
    return `<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--bg4);border-radius:10px;margin-bottom:8px;border:1px solid var(--border)">
      <span style="font-weight:600;font-size:14px">${labels[m]}</span>
      <span style="display:flex;align-items:center;gap:10px">
        <span style="font-size:18px;font-weight:900;color:var(--accent);font-family:var(--font-head)">${r}</span>
        ${change!==null?`<span style="font-size:12px;font-weight:700;color:${color}">${arrow}</span>`:''}
      </span>
    </div>`
  }).join('')
}

function renderPatterns() {
  const el = document.getElementById('patterns')
  const freq = {}
  logs.forEach(e=>{if(e.pattern)freq[e.pattern]=(freq[e.pattern]||0)+1})
  const emotions = {}
  logs.forEach(e=>{if(e.emotion)emotions[e.emotion]=(emotions[e.emotion]||0)+1})
  const topP = Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,6)
  const topE = Object.entries(emotions).sort((a,b)=>b[1]-a[1]).slice(0,6)

  el.innerHTML = `
    ${topP.length?`<div style="margin-bottom:12px"><div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px">RECURRING PATTERNS</div>${topP.map(([p,c])=>`<span class="tag">${p} (${c}√ó)</span>`).join('')}</div>`:''}
    ${topE.length?`<div><div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px">DOMINANT EMOTIONS</div>${topE.map(([e,c])=>`<span class="tag">${e} (${c}√ó)</span>`).join('')}</div>`:''}
    ${!topP.length&&!topE.length?'<div class="empty-state"><div class="empty-icon">üîç</div><p>Log more entries with patterns and emotions</p></div>':''}
  `
}

function renderRecords() {
  const el = document.getElementById('records')
  if (!logs.length) return
  const maxScore = Math.max(...logs.map(e=>parseFloat(e.score)))
  const maxFocus = Math.max(...logs.map(e=>e.focus))
  const maxFlow = Math.max(...logs.map(e=>e.flow))
  const maxCreat = Math.max(...logs.map(e=>e.creativity))
  el.innerHTML = `
    <div class="stats-grid">
      <div class="stat-box"><div class="stat-val">${maxScore}</div><div class="stat-lbl">Best Score</div></div>
      <div class="stat-box"><div class="stat-val">${maxFocus}</div><div class="stat-lbl">Peak Focus</div></div>
      <div class="stat-box"><div class="stat-val">${maxFlow}</div><div class="stat-lbl">Peak Flow</div></div>
      <div class="stat-box"><div class="stat-val">${maxCreat}</div><div class="stat-lbl">Peak Creativity</div></div>
    </div>
  `
}

function renderRecentEntries() {
  const el = document.getElementById('recentEntries')
  const last5 = logs.slice(-5).reverse()
  if (!last5.length) return
  el.innerHTML = last5.map(e=>`
    <div style="padding:12px 14px;background:var(--bg4);border-radius:10px;margin-bottom:8px;border:1px solid var(--border)">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
        <span style="font-size:12px;color:var(--text3)">${new Date(e.ts).toLocaleString()}</span>
        <span style="font-size:20px;font-weight:900;color:var(--accent);font-family:var(--font-head)">${e.score}</span>
      </div>
      <div style="font-size:12px;color:var(--text2)">${e.activity||''} ${e.emotion?'¬∑ '+e.emotion:''} ${e.brainwave?'¬∑ '+e.brainwave:''}</div>
    </div>
  `).join('')
}

// =================== HEALTH QUESTIONNAIRE ===================
function hqNav(dir) {
  const next = hqSection + dir
  if (next<1||next>TOTAL_HQ) {
    if (dir>0) saveHealthAndAnalyze()
    return
  }
  document.getElementById('hqs-'+hqSection).classList.remove('active')
  hqSection = next
  document.getElementById('hqs-'+hqSection).classList.add('active')
  document.getElementById('hqCurrent').textContent = hqSection
  document.getElementById('hqProgressBar').style.width = ((hqSection/TOTAL_HQ)*100)+'%'
  document.getElementById('hqPrevBtn').style.display = hqSection>1?'block':'none'
  document.getElementById('hqNextBtn').textContent = hqSection===TOTAL_HQ ? '‚úÖ Complete Profile' : 'Next Section ‚Üí'
}

function selectRadio(el, key) {
  el.closest('.radio-group').querySelectorAll('.radio-btn').forEach(b=>b.classList.remove('selected'))
  el.classList.add('selected')
  el.dataset.group = key
}

function saveHealthAndAnalyze() {
  const hd = healthData
  hd.age = document.getElementById('hq-age').value
  hd.height = document.getElementById('hq-height').value
  hd.weight = document.getElementById('hq-weight').value
  hd.conditions = document.getElementById('hq-conditions').value
  hd.meds = document.getElementById('hq-meds').value
  hd.concerns = document.getElementById('hq-concerns').value
  hd.completed = new Date().toISOString()

  const bmi = hd.height&&hd.weight ? (hd.weight/Math.pow(hd.height/100,2)).toFixed(1) : null
  const bmiClass = bmi ? (bmi<18.5?'Underweight':bmi<25?'Healthy Weight':bmi<30?'Overweight':'Obese') : null

  localStorage.setItem('cos_health2', JSON.stringify(hd))
  showToast('‚úÖ Health profile saved!')

  const card = document.getElementById('healthInsightCard')
  const content = document.getElementById('healthInsightContent')
  card.style.display = 'block'
  content.innerHTML = `
    <div class="insight-box" style="margin-bottom:12px">
      <strong>üéØ Profile Status:</strong> Comprehensive health profile completed.<br>
      <strong>üìä BMI:</strong> ${bmi ? bmi+' ('+bmiClass+')' : 'Enter height/weight for calculation'}
    </div>
    <div class="insight-box">
      <strong>üìã Key Metrics Captured:</strong> 18 health domains assessed including cardiometabolic risk, mental health, sleep, gut health, hormones, neurology, longevity markers and more.
    </div>
    <div class="insight-box">
      <strong>üîÑ Next Steps:</strong><br>
      ‚Ä¢ Cross-reference your daily logs with health patterns<br>
      ‚Ä¢ Discuss your profile with your doctor at next visit<br>
      ‚Ä¢ Update this questionnaire every 3‚Äì6 months<br>
      ‚Ä¢ Use your goals (${hd.concerns||'not specified'}) to guide daily log focus
    </div>
    ${bmi&&parseFloat(bmi)>25?'<div class="insight-box"><strong>‚ö†Ô∏è Note:</strong> BMI above healthy range ‚Äî consult your doctor about weight management strategies appropriate for your health conditions.</div>':''}
  `
  card.scrollIntoView({behavior:'smooth'})
}

// =================== GAMES ===================
function startGame(type) {
  currentGame = type
  document.getElementById('gameMenu').style.display = 'none'
  document.getElementById('gameArenaCard').style.display = 'block'
  const titles = {memory:'üß© Memory Match',reaction:'‚ö° Reaction Time',stroop:'üé® Stroop Challenge',nback:'üî¢ N-Back Memory',math:'üßÆ Math Blitz',word:'üí¨ Word Chain',sequence:'üî¥ Color Sequence',breathing:'üå¨Ô∏è Focus Breathing'}
  document.getElementById('gameTitleDisplay').textContent = titles[type]

  if (type==='memory') initMemoryGame()
  else if (type==='reaction') initReactionGame()
  else if (type==='stroop') initStroopGame()
  else if (type==='nback') initNbackGame()
  else if (type==='math') initMathGame()
  else if (type==='word') initWordGame()
  else if (type==='sequence') initSequenceGame()
  else if (type==='breathing') initBreathingGame()
}

function exitGame() {
  document.getElementById('gameMenu').style.display = 'block'
  document.getElementById('gameArenaCard').style.display = 'none'
  if (gameState.timer) clearInterval(gameState.timer)
  if (gameState.timeout) clearTimeout(gameState.timeout)
  currentGame = null
  gameState = {}
}

// --- Memory Match ---
function initMemoryGame() {
  const arena = document.getElementById('gameArena')
  const icons = ['üß†','üåü','üíé','üîÆ','üéØ','üåä','‚ö°','ü¶ã']
  const cards = [...icons,...icons].sort(()=>Math.random()-0.5)
  gameState = {cards, flipped:[], matched:[], moves:0, start:Date.now()}
  arena.innerHTML = `
    <h2>Find matching pairs</h2>
    <div style="display:flex;justify-content:center;gap:20px;margin-bottom:12px">
      <span style="color:var(--text2);font-size:13px">Moves: <strong id="memMoves">0</strong></span>
      <span style="color:var(--text2);font-size:13px">Matched: <strong id="memMatched">0</strong>/8</span>
    </div>
    <div class="memory-grid" style="grid-template-columns:repeat(4,70px);justify-content:center">
      ${cards.map((_,i)=>`<div class="mem-card hidden" id="mc${i}" onclick="flipCard(${i})">‚ùì</div>`).join('')}
    </div>
  `
}

function flipCard(i) {
  if (!gameState.cards) return
  if (gameState.flipped.length>=2) return
  if (gameState.flipped.includes(i) || gameState.matched.includes(i)) return
  const el = document.getElementById('mc'+i)
  el.textContent = gameState.cards[i]
  el.classList.remove('hidden')
  gameState.flipped.push(i)
  if (gameState.flipped.length===2) {
    gameState.moves++
    document.getElementById('memMoves').textContent = gameState.moves
    const [a,b] = gameState.flipped
    if (gameState.cards[a]===gameState.cards[b]) {
      gameState.matched.push(a,b)
      document.getElementById('mc'+a).classList.add('matched')
      document.getElementById('mc'+b).classList.add('matched')
      gameState.flipped = []
      document.getElementById('memMatched').textContent = gameState.matched.length/2
      if (gameState.matched.length===16) {
        const time = ((Date.now()-gameState.start)/1000).toFixed(1)
        setTimeout(()=>showGameResult('Memory Match',`Completed in ${gameState.moves} moves and ${time}s! `+(gameState.moves<20?'Excellent memory!':'Good effort!')),300)
      }
    } else {
      setTimeout(()=>{
        document.getElementById('mc'+a).textContent='‚ùì'
        document.getElementById('mc'+a).classList.add('hidden')
        document.getElementById('mc'+b).textContent='‚ùì'
        document.getElementById('mc'+b).classList.add('hidden')
        gameState.flipped=[]
      },800)
    }
  }
}

// --- Reaction Time ---
function initReactionGame() {
  gameState = {attempts:[], phase:'wait', trials:0}
  const arena = document.getElementById('gameArena')
  arena.innerHTML = `
    <h2>‚ö° Reaction Time Test</h2>
    <p style="color:var(--text2);margin-bottom:20px">Click the circle when it turns green.<br>Complete 5 trials.</p>
    <div class="reaction-light red" id="reactLight" onclick="reactClick()">üî¥</div>
    <div style="color:var(--text2);font-size:14px" id="reactMsg">Get ready...</div>
    <div style="margin-top:16px;color:var(--text3);font-size:12px" id="reactHistory"></div>
  `
  setTimeout(()=>nextTrial(),1000)
}

function nextTrial() {
  if (gameState.trials>=5) {
    const avg = (gameState.attempts.reduce((s,v)=>s+v,0)/gameState.attempts.length).toFixed(0)
    showGameResult('Reaction Time',`Average: ${avg}ms. `+(avg<200?'üåü Elite reflexes!':avg<300?'‚ö° Excellent!':avg<400?'üëç Good':'üòê Room to improve'))
    return
  }
  const light = document.getElementById('reactLight')
  light.className='reaction-light red'
  light.textContent='üî¥'
  document.getElementById('reactMsg').textContent='Wait for green...'
  gameState.phase='wait'
  const delay = 2000 + Math.random()*3000
  gameState.timeout = setTimeout(()=>{
    light.className='reaction-light green'
    light.textContent='üü¢'
    document.getElementById('reactMsg').textContent='CLICK NOW!'
    gameState.phase='go'
    gameState.startTime=Date.now()
  },delay)
}

function reactClick() {
  if (!gameState || gameState.phase!=='go') {
    if (gameState.phase==='wait') {
      document.getElementById('reactMsg').textContent='Too early! Wait for green...'
      clearTimeout(gameState.timeout)
      setTimeout(nextTrial,1000)
    }
    return
  }
  const rt = Date.now()-gameState.startTime
  gameState.attempts.push(rt)
  gameState.trials++
  document.getElementById('reactMsg').textContent=`${rt}ms! Trial ${gameState.trials}/5`
  const hist = document.getElementById('reactHistory')
  hist.innerHTML = gameState.attempts.map((t,i)=>`Trial ${i+1}: <strong>${t}ms</strong>`).join(' ¬∑ ')
  gameState.phase='wait'
  setTimeout(nextTrial,1000)
}

// --- Stroop ---
function initStroopGame() {
  gameState = {score:0, wrong:0, total:0, maxTrials:15}
  renderStroop()
}

const STROOP_COLORS = [{name:'Red',hex:'#ef4444'},{name:'Blue',hex:'#3b82f6'},{name:'Green',hex:'#22c55e'},{name:'Yellow',hex:'#eab308'},{name:'Purple',hex:'#8b5cf6'}]

function renderStroop() {
  if (gameState.total>=gameState.maxTrials) {
    showGameResult('Stroop Challenge',`Score: ${gameState.score}/${gameState.maxTrials}. `+(gameState.score>=12?'üéØ Exceptional cognitive control!':gameState.score>=9?'üëç Good attention!':'Try again ‚Äî focus on the INK color, not the word!'))
    return
  }
  const wordColor = STROOP_COLORS[Math.floor(Math.random()*STROOP_COLORS.length)]
  const inkColor = STROOP_COLORS[Math.floor(Math.random()*STROOP_COLORS.length)]
  gameState.correct = inkColor.name

  const arena = document.getElementById('gameArena')
  arena.innerHTML = `
    <p style="color:var(--text2);margin-bottom:8px">Name the INK COLOR (not the word!)<br>Trial ${gameState.total+1}/${gameState.maxTrials} ¬∑ Score: ${gameState.score}</p>
    <div class="stroop-word" style="color:${inkColor.hex}">${wordColor.name}</div>
    <div class="stroop-options">
      ${STROOP_COLORS.sort(()=>Math.random()-0.5).map(c=>`<button class="stroop-btn" style="border-color:${c.hex};color:${c.hex};background:var(--bg2)" onclick="stroopAnswer('${c.name}',this)">${c.name}</button>`).join('')}
    </div>
  `
}

function stroopAnswer(ans, el) {
  gameState.total++
  const correct = ans===gameState.correct
  if (correct) { gameState.score++; el.style.background='#ecfdf5' }
  else { gameState.wrong++; el.style.background='#fef2f2' }
  document.querySelectorAll('.stroop-btn').forEach(b=>{b.disabled=true;if(b.textContent===gameState.correct)b.style.background='#ecfdf5'})
  setTimeout(renderStroop,600)
}

// --- N-Back ---
function initNbackGame() {
  gameState = {n:2, sequence:[], shown:0, score:0, total:0, length:20}
  const arena = document.getElementById('gameArena')
  arena.innerHTML = `
    <h2>2-Back Memory</h2>
    <p style="color:var(--text2);font-size:13px;margin-bottom:16px">Press MATCH if current position matches 2 steps ago</p>
    <div class="nback-display" id="nbackGrid"></div>
    <div style="font-size:16px;font-weight:700;margin:16px 0;color:var(--text2)" id="nbackInfo">Get ready...</div>
    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
      <button class="btn btn-primary" id="nbackMatch" onclick="nbackAnswer(true)" style="width:auto;padding:14px 28px" disabled>‚úÖ Match</button>
      <button class="btn btn-secondary" id="nbackNoMatch" onclick="nbackAnswer(false)" style="width:140px" disabled>‚ùå No Match</button>
    </div>
    <div style="margin-top:14px;font-size:13px;color:var(--text2)">Score: <strong id="nbackScore">0</strong> | Trial: <strong id="nbackTrial">0</strong>/${gameState.length}</div>
  `
  renderNbackGrid(null)
  setTimeout(showNback,1500)
}

function renderNbackGrid(pos) {
  const g = document.getElementById('nbackGrid')
  if (!g) return
  g.innerHTML = Array.from({length:9},(_,i)=>`<div class="nback-cell ${i===pos?'active':''}"></div>`).join('')
}

function showNback() {
  if (!document.getElementById('nbackGrid')) return
  if (gameState.shown>=gameState.length) {
    showGameResult('N-Back Memory',`Score: ${gameState.score}/${gameState.total} correct. `+(gameState.score/gameState.total>0.85?'üß† Outstanding working memory!':gameState.score/gameState.total>0.7?'üëç Good!':'Keep practicing ‚Äî this trains IQ!'))
    return
  }
  const pos = Math.floor(Math.random()*9)
  gameState.sequence.push(pos)
  gameState.shown++
  renderNbackGrid(pos)
  const isMatch = gameState.sequence.length>gameState.n && gameState.sequence[gameState.sequence.length-1]===gameState.sequence[gameState.sequence.length-1-gameState.n]
  gameState.currentMatch = isMatch
  document.getElementById('nbackInfo').textContent = `Position ${gameState.shown}/${gameState.length}`
  document.getElementById('nbackTrial').textContent = gameState.shown
  document.getElementById('nbackMatch').disabled = false
  document.getElementById('nbackNoMatch').disabled = false
  if (gameState.sequence.length>gameState.n) {
    gameState.nbackTimer = setTimeout(()=>{
      nbackAnswer(false)
    }, 2000)
  } else {
    setTimeout(()=>{renderNbackGrid(null);setTimeout(showNback,800)},1000)
  }
}

function nbackAnswer(match) {
  clearTimeout(gameState.nbackTimer)
  document.getElementById('nbackMatch').disabled = true
  document.getElementById('nbackNoMatch').disabled = true
  if (gameState.sequence.length>gameState.n) {
    gameState.total++
    if (match===gameState.currentMatch) gameState.score++
    document.getElementById('nbackScore').textContent = gameState.score
  }
  renderNbackGrid(null)
  setTimeout(showNback,600)
}

// --- Math Blitz ---
function initMathGame() {
  gameState = {score:0, wrong:0, total:20, shown:0, time:0}
  showMathProblem()
}

function showMathProblem() {
  if (gameState.shown>=gameState.total) {
    showGameResult('Math Blitz',`Score: ${gameState.score}/${gameState.total}. `+(gameState.score>=18?'üßÆ Mathematical genius!':gameState.score>=14?'‚ö° Sharp mind!':'Keep training ‚Äî speed improves!'))
    return
  }
  const ops = ['+','-','√ó']
  const op = ops[Math.floor(Math.random()*ops.length)]
  let a,b,answer
  if (op==='+'){a=Math.floor(Math.random()*50)+10;b=Math.floor(Math.random()*50)+10;answer=a+b}
  else if (op==='-'){a=Math.floor(Math.random()*50)+30;b=Math.floor(Math.random()*a)+1;answer=a-b}
  else{a=Math.floor(Math.random()*12)+2;b=Math.floor(Math.random()*12)+2;answer=a*b}

  const wrongs = new Set()
  while(wrongs.size<3){const w=answer+Math.floor(Math.random()*20)-10;if(w!==answer&&w>0)wrongs.add(w)}
  const opts = [...wrongs,answer].sort(()=>Math.random()-0.5)
  gameState.correct = answer

  const arena = document.getElementById('gameArena')
  arena.innerHTML = `
    <p style="color:var(--text2);font-size:13px;margin-bottom:8px">${gameState.shown+1}/${gameState.total} ¬∑ Score: ${gameState.score}</p>
    <div class="math-problem">${a} ${op} ${b} = ?</div>
    <div class="math-options">${opts.map(o=>`<button class="math-btn" onclick="mathAnswer(${o},this)">${o}</button>`).join('')}</div>
  `
  gameState.shown++
}

function mathAnswer(ans,el) {
  document.querySelectorAll('.math-btn').forEach(b=>b.disabled=true)
  if (ans===gameState.correct){gameState.score++;el.classList.add('correct')}
  else{el.classList.add('wrong');document.querySelectorAll('.math-btn').forEach(b=>{if(+b.textContent===gameState.correct)b.classList.add('correct')})}
  setTimeout(showMathProblem,600)
}

// --- Word Chain ---
function initWordGame() {
  const starters = ['BRAIN','MIND','DREAM','FOCUS','FLOW','STAR','FIRE','LIGHT','HEART','OCEAN']
  const word = starters[Math.floor(Math.random()*starters.length)]
  gameState = {chain:[word], score:0, timeLeft:60}
  const arena = document.getElementById('gameArena')
  arena.innerHTML = `
    <h2>üí¨ Word Chain</h2>
    <p style="color:var(--text2);font-size:13px;margin-bottom:16px">Each word must start with the last letter of the previous word. 60 seconds!</p>
    <div style="font-size:36px;font-weight:900;color:var(--accent);font-family:var(--font-head);margin:8px 0" id="wordTimer">60</div>
    <div style="padding:12px;background:var(--bg4);border-radius:10px;margin:12px 0;font-size:14px;color:var(--text)"><strong>Current word:</strong> <span id="currentWord" style="color:var(--accent);font-weight:900;font-size:18px">${word}</span></div>
    <div style="display:flex;gap:10px;margin:12px 0">
      <input type="text" id="wordInput" placeholder="Enter a word..." style="flex:1;text-transform:uppercase" onkeydown="if(event.key==='Enter')submitWord()">
      <button class="btn btn-primary" style="width:auto" onclick="submitWord()">Submit</button>
    </div>
    <div style="font-size:13px;color:var(--text2)">Words: <strong id="wordCount">0</strong> | Chain: <span id="wordChain" style="font-size:11px"></span></div>
  `
  document.getElementById('wordInput').focus()
  gameState.timer = setInterval(()=>{
    gameState.timeLeft--
    const el = document.getElementById('wordTimer')
    if (el) el.textContent = gameState.timeLeft
    if (gameState.timeLeft<=0) {
      clearInterval(gameState.timer)
      showGameResult('Word Chain',`Built a chain of ${gameState.chain.length} words in 60 seconds! `+(gameState.chain.length>=15?'üéØ Exceptional verbal fluency!':gameState.chain.length>=10?'üëç Great vocabulary!':'Keep practicing word games!'))
    }
  },1000)
}

function submitWord() {
  const input = document.getElementById('wordInput')
  const word = input.value.trim().toUpperCase()
  if (!word || word.length<2) return
  const last = gameState.chain[gameState.chain.length-1]
  const lastLetter = last[last.length-1]
  if (word[0]!==lastLetter) { showToast('‚ùå Must start with '+lastLetter); input.value=''; return }
  if (gameState.chain.includes(word)) { showToast('‚ùå Already used!'); input.value=''; return }
  gameState.chain.push(word)
  input.value=''
  const cw = document.getElementById('currentWord')
  if (cw) cw.textContent = word
  const wc = document.getElementById('wordCount')
  if (wc) wc.textContent = gameState.chain.length-1
  const wch = document.getElementById('wordChain')
  if (wch) wch.textContent = gameState.chain.slice(-5).join(' ‚Üí ')
  input.focus()
}

// --- Color Sequence ---
function initSequenceGame() {
  gameState = {sequence:[], userSeq:[], level:1, isShowing:false}
  const arena = document.getElementById('gameArena')
  const colors = [{n:'Red',h:'#ef4444'},{n:'Blue',h:'#3b82f6'},{n:'Green',h:'#22c55e'},{n:'Yellow',h:'#eab308'}]
  arena.innerHTML = `
    <h2>üî¥ Color Sequence</h2>
    <p id="seqMsg" style="color:var(--text2);font-size:13px;margin-bottom:16px">Watch and repeat the sequence</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;max-width:220px;margin:0 auto 20px">
      ${colors.map(c=>`<div id="btn_${c.n}" onclick="seqBtn('${c.n}')" style="width:90px;height:90px;border-radius:16px;background:${c.h}44;border:3px solid ${c.h};cursor:pointer;transition:all 0.15s;display:flex;align-items:center;justify-content:center;font-weight:700;color:${c.h}" data-color="${c.n}">${c.n}</div>`).join('')}
    </div>
    <div style="font-size:14px;color:var(--text2)">Level: <strong id="seqLevel">1</strong></div>
  `
  setTimeout(nextSeqLevel,1000)
}

function nextSeqLevel() {
  const msg = document.getElementById('seqMsg')
  if (msg) msg.textContent = 'Watch carefully...'
  gameState.isShowing=true
  gameState.userSeq=[]
  const colors = ['Red','Blue','Green','Yellow']
  gameState.sequence.push(colors[Math.floor(Math.random()*4)])
  let i=0
  const show=setInterval(()=>{
    if (i>0) unhighlightSeqBtn(gameState.sequence[i-1])
    if (i>=gameState.sequence.length){clearInterval(show);gameState.isShowing=false;if(msg)msg.textContent='Your turn! Repeat the sequence';return}
    highlightSeqBtn(gameState.sequence[i])
    i++
  },700)
}

function highlightSeqBtn(color) {
  const el = document.getElementById('btn_'+color)
  if (el) { el.style.opacity='1';el.style.transform='scale(1.15)';el.style.filter='brightness(2)' }
}
function unhighlightSeqBtn(color) {
  const el = document.getElementById('btn_'+color)
  if (el) { el.style.opacity='0.5';el.style.transform='scale(1)';el.style.filter='brightness(1)' }
}

function seqBtn(color) {
  if (gameState.isShowing) return
  highlightSeqBtn(color)
  setTimeout(()=>unhighlightSeqBtn(color),150)
  gameState.userSeq.push(color)
  const idx=gameState.userSeq.length-1
  if (gameState.userSeq[idx]!==gameState.sequence[idx]) {
    showGameResult('Color Sequence','Level '+gameState.level+' reached! '+(gameState.level>=10?'üåü Incredible memory span!':gameState.level>=6?'üëç Good working memory!':'Keep training!'))
    return
  }
  if (gameState.userSeq.length===gameState.sequence.length) {
    gameState.level++
    const l=document.getElementById('seqLevel')
    if(l)l.textContent=gameState.level
    const m=document.getElementById('seqMsg')
    if(m)m.textContent='‚úÖ Correct! Next level...'
    setTimeout(nextSeqLevel,1200)
  }
}

// --- Breathing ---
function initBreathingGame() {
  const arena = document.getElementById('gameArena')
  const techniques = [{name:'4-7-8 Breathing',in:4,hold:7,out:8,desc:'Calms nervous system, reduces stress'},{name:'Box Breathing',in:4,hold:4,out:4,desc:'Used by Navy SEALs for focus'},{name:'Power Breath',in:6,hold:2,out:4,desc:'Energizing and activating'}]
  const t=techniques[0]
  gameState={phase:'inhale',count:0,technique:t,rounds:0}
  arena.innerHTML = `
    <h2>üå¨Ô∏è ${t.name}</h2>
    <p style="color:var(--text2);font-size:12px;margin-bottom:4px">${t.desc}</p>
    <div id="breathCircle" style="width:140px;height:140px;border-radius:50%;background:radial-gradient(circle,var(--accent),var(--accent2));margin:20px auto;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:900;color:#fff;font-family:var(--font-head);transition:all 1s;box-shadow:0 0 40px rgba(124,58,237,0.4)">4</div>
    <div id="breathPhase" style="font-size:18px;font-weight:700;color:var(--text);margin:8px 0">INHALE</div>
    <div style="font-size:13px;color:var(--text2)">Rounds: <strong id="breathRounds">0</strong></div>
    <button class="btn btn-secondary btn-sm" onclick="exitGame()" style="margin-top:20px">Stop</button>
  `
  runBreath()
}

function runBreath() {
  if (!document.getElementById('breathCircle')) return
  const t=gameState.technique
  const phases=[{name:'INHALE',dur:t.in,scale:'scale(1.3)'},{name:'HOLD',dur:t.hold,scale:'scale(1.3)'},{name:'EXHALE',dur:t.out,scale:'scale(0.9)'}]
  let pi=0
  function doPhase(){
    if (!document.getElementById('breathCircle')) return
    const p=phases[pi]
    const circle=document.getElementById('breathCircle')
    const phaseEl=document.getElementById('breathPhase')
    if(circle){circle.style.transform=p.scale;circle.textContent=p.dur}
    if(phaseEl)phaseEl.textContent=p.name
    let count=p.dur-1
    clearInterval(gameState.timer)
    gameState.timer=setInterval(()=>{
      if(!document.getElementById('breathCircle')){clearInterval(gameState.timer);return}
      if(circle)circle.textContent=count
      if(count<=0){
        clearInterval(gameState.timer)
        pi=(pi+1)%3
        if(pi===0){gameState.rounds++;const r=document.getElementById('breathRounds');if(r)r.textContent=gameState.rounds}
        setTimeout(doPhase,300)
      }
      count--
    },1000)
  }
  doPhase()
}

function showGameResult(gameName, msg) {
  const arena = document.getElementById('gameArena')
  arena.innerHTML = `
    <div style="text-align:center">
      <div style="font-size:64px;margin-bottom:12px">üéâ</div>
      <h2 style="font-family:var(--font-head);font-size:22px;margin-bottom:10px">${gameName} Complete!</h2>
      <p style="color:var(--text2);font-size:15px;margin-bottom:24px">${msg}</p>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <button class="btn btn-primary" style="width:auto" onclick="startGame('${currentGame}')">üîÑ Play Again</button>
        <button class="btn btn-secondary btn-sm" onclick="exitGame()">‚Üê All Games</button>
      </div>
    </div>
  `
}

// =================== DREAMS ===================
function selectDreamType(el, type) {
  document.querySelectorAll('.dream-type').forEach(d=>d.classList.remove('selected'))
  el.classList.add('selected')
  document.getElementById('selectedDreamType').value = type
}

function saveDream() {
  const dream = {
    id: Date.now(),
    date: document.getElementById('dreamDate').value,
    title: document.getElementById('dreamTitle').value,
    type: document.getElementById('selectedDreamType').value,
    desc: document.getElementById('dreamDesc').value,
    vividness: +document.getElementById('dreamVividness').value,
    lucidity: +document.getElementById('dreamLucidity').value,
    signs: document.getElementById('dreamSigns').value,
    emotions: document.getElementById('dreamEmotions').value
  }
  if (!dream.title && !dream.desc) { showToast('‚ùå Add a title or description'); return }
  dreams.push(dream)
  localStorage.setItem('cos_dreams', JSON.stringify(dreams))
  document.getElementById('dreamTitle').value = ''
  document.getElementById('dreamDesc').value = ''
  document.getElementById('dreamSigns').value = ''
  document.getElementById('dreamEmotions').value = ''
  document.getElementById('dreamVividness').value = 5
  document.getElementById('dreamVividnessVal').textContent = 5
  document.getElementById('dreamLucidity').value = 0
  document.getElementById('dreamLucidityVal').textContent = 0
  updateLucidStats()
  loadDreamJournal()
  showToast('‚úÖ Dream logged!')
}

function updateLucidStats() {
  document.getElementById('ldTotal').textContent = dreams.length
  document.getElementById('ldLucid').textContent = dreams.filter(d=>d.lucidity>4).length
  const today = new Date().toDateString()
  const streak = (() => {
    let s=0, d=new Date()
    while(true) {
      const ds=d.toDateString()
      if (dreams.some(dr=>new Date(dr.date).toDateString()===ds)) {s++;d.setDate(d.getDate()-1)}
      else break
    }
    return s
  })()
  document.getElementById('ldStreak').textContent = streak
}

function loadDreamJournal() {
  const el = document.getElementById('dreamJournal')
  if (!dreams.length) { el.innerHTML = '<div class="empty-state"><div class="empty-icon">üí§</div><p>No dreams logged yet</p></div>'; return }
  el.innerHTML = dreams.slice().reverse().slice(0,20).map(d=>`
    <div class="dream-entry">
      <div class="dream-entry-hdr">
        <span style="font-weight:700;font-size:15px">${d.title||'Untitled Dream'}</span>
        <div class="dream-entry-badges">
          ${d.lucidity>4?'<span class="dream-badge badge-lucid">‚ú® Lucid</span>':'<span class="dream-badge badge-normal">üí§ Regular</span>'}
        </div>
      </div>
      <div class="dream-entry-date">${d.date} ¬∑ Vividness: ${d.vividness}/10 ¬∑ Lucidity: ${d.lucidity}/10</div>
      ${d.desc?`<div style="font-size:13px;color:var(--text2);margin-top:8px;line-height:1.6">${d.desc.slice(0,200)}${d.desc.length>200?'...':''}</div>`:''}
      ${d.signs?`<div style="font-size:11px;color:var(--text3);margin-top:6px">üîç Signs: ${d.signs}</div>`:''}
    </div>
  `).join('')
}

function logRC(el, type) {
  rcCount++
  localStorage.setItem('cos_rc_today', rcCount)
  el.style.borderColor = 'var(--accent)'
  el.style.background = 'var(--bg3)'
  updateRCDisplay()
  showToast(`‚úÖ Reality check done! (${rcCount}/15)`)
}

function updateRCDisplay() {
  document.getElementById('rcCount').textContent = rcCount
  document.getElementById('rcProgress').style.width = Math.min(100,(rcCount/15)*100)+'%'
}

function calcSleep() {
  const sleep = document.getElementById('sleepAt').value
  const wake = document.getElementById('wakeAt').value
  if (!sleep || !wake) { showToast('‚ùå Enter both times'); return }
  const [sh,sm] = sleep.split(':').map(Number)
  const [wh,wm] = wake.split(':').map(Number)
  const totalMin = ((wh*60+wm) - (sh*60+sm) + 1440) % 1440
  const cycles = Math.floor(totalMin/90)
  const optimalMins = cycles * 90
  const optimal = new Date(0,0,0,sh,sm+optimalMins)
  const wbtb5h = new Date(0,0,0,sh,sm+300)
  const wbtb6h = new Date(0,0,0,sh,sm+360)
  const fmt = d => d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0')
  document.getElementById('sleepCalcResult').innerHTML = `
    <div class="insight-box">
      <strong>üõèÔ∏è Sleep Duration:</strong> ${Math.floor(totalMin/60)}h ${totalMin%60}m ¬∑ ${cycles} full 90-min cycles<br>
      <strong>‚è∞ Optimal Wake Time:</strong> ${fmt(optimal)} (after ${cycles} cycles ‚Äî avoid heavy grogginess)<br>
      <strong>üîÅ WBTB Alarms:</strong><br>
      ¬∑ Set alarm for <strong>${fmt(wbtb5h)}</strong> (5h mark ‚Äî ideal for most)<br>
      ¬∑ Or <strong>${fmt(wbtb6h)}</strong> (6h mark ‚Äî for longer sleepers)<br>
      <strong>üí° Protocol:</strong> Wake at your chosen WBTB time. Stay awake 30‚Äì45min reading about LD, then return to sleep with clear intention.
    </div>
  `
}

// =================== VOICE ===================
function initSpeechRecognition() {
  try {
    const SR = window.SpeechRecognition||window.webkitSpeechRecognition
    if (SR) {
      recognition = new SR()
      recognition.continuous=true; recognition.interimResults=true; recognition.lang='en-US'
      recognition.onresult=e=>{
        let t=''
        for(let i=e.resultIndex;i<e.results.length;i++) t+=e.results[i][0].transcript
        fullTranscript=t
        const tb=document.getElementById('transcriptBox')
        if(tb)tb.textContent=t
      }
      recognition.onerror=e=>showToast('‚ùå Mic: '+e.error)
    }
  } catch(e){}
}

async function toggleRecording() {
  if (!isRecording) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({audio:true})
      audioChunks=[]
      mediaRecorder = new MediaRecorder(stream)
      mediaRecorder.ondataavailable=e=>audioChunks.push(e.data)
      mediaRecorder.onstop=()=>{
        const blob=new Blob(audioChunks,{type:'audio/webm'})
        const reader=new FileReader()
        reader.onloadend=()=>{
          voiceMemos.push({id:Date.now(),ts:new Date().toISOString(),audio:reader.result,transcript:fullTranscript})
          localStorage.setItem('cos_voice',JSON.stringify(voiceMemos))
          loadMemos()
          showToast('‚úÖ Memo saved')
        }
        reader.readAsDataURL(blob)
        stream.getTracks().forEach(t=>t.stop())
      }
      mediaRecorder.start()
      if(recognition)recognition.start()
      isRecording=true
      document.getElementById('recordBtn').style.background='#ef4444'
      document.getElementById('recordStatus').textContent='Recording... Tap to stop'
      showToast('üé§ Recording...')
    } catch(e){ showToast('‚ùå Mic denied') }
  } else {
    if(mediaRecorder)mediaRecorder.stop()
    if(recognition)recognition.stop()
    isRecording=false
    document.getElementById('recordBtn').style.background='linear-gradient(135deg,var(--accent),var(--accent2))'
    document.getElementById('recordStatus').textContent='Tap to start recording'
  }
}

function loadMemos() {
  const c=document.getElementById('memoCount'); if(c)c.textContent=voiceMemos.length
  const list=document.getElementById('memosList'); if(!list)return
  if(!voiceMemos.length){list.innerHTML='<div class="empty-state"><div class="empty-icon">üé§</div><p>No memos yet</p></div>';return}
  list.innerHTML=voiceMemos.slice().reverse().slice(0,20).map(m=>`
    <div style="padding:14px;background:var(--bg4);border-radius:12px;margin-bottom:10px;border:1px solid var(--border)">
      <div style="font-size:11px;color:var(--text3);margin-bottom:8px">${new Date(m.ts).toLocaleString()}</div>
      <audio controls src="${m.audio}" style="width:100%;height:36px"></audio>
      ${m.transcript?`<div style="font-size:13px;padding:10px;background:var(--bg2);border-radius:8px;margin-top:8px;color:var(--text2)">${m.transcript}</div>`:''}
    </div>
  `).join('')
}

// =================== MEDIA ===================
function uploadMedia(e) {
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader()
    reader.onload=ev=>{
      mediaFiles.push({id:Date.now()+Math.random(),ts:new Date().toISOString(),type:file.type.startsWith('video')?'video':'image',data:ev.target.result,name:file.name})
      localStorage.setItem('cos_media',JSON.stringify(mediaFiles))
      loadMedia()
    }
    reader.readAsDataURL(file)
  })
  showToast('‚úÖ Uploaded!')
  e.target.value=''
}

function loadMedia() {
  const c=document.getElementById('mediaCount'); if(c)c.textContent=mediaFiles.length
  const g=document.getElementById('mediaGallery'); if(!g)return
  if(!mediaFiles.length){g.innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üñºÔ∏è</div><p>No media yet</p></div>';return}
  g.innerHTML=mediaFiles.slice().reverse().slice(0,50).map(m=>`
    <div style="aspect-ratio:1;border-radius:10px;overflow:hidden;background:var(--bg3);border:1px solid var(--border)">
      ${m.type==='image'?`<img src="${m.data}" style="width:100%;height:100%;object-fit:cover">`:`<video src="${m.data}" style="width:100%;height:100%;object-fit:cover"></video>`}
    </div>
  `).join('')
}

// =================== CALENDAR ===================
function renderCalendar() {
  const el=document.getElementById('calendarEl'); if(!el)return
  const now=new Date()
  const y=now.getFullYear(),m=now.getMonth()
  const month=now.toLocaleString('default',{month:'long'})
  const firstDay=new Date(y,m,1).getDay()
  const days=new Date(y,m+1,0).getDate()
  const entryDates=new Set(logs.map(e=>new Date(e.ts).getDate()+'_'+new Date(e.ts).getMonth()))
  const dreamDates=new Set(dreams.map(d=>new Date(d.date).getDate()+'_'+new Date(d.date).getMonth()))
  let html=`<div class="cal-header"><h3 style="font-family:var(--font-head)">${month} ${y}</h3></div><div class="cal-grid">`
  const dn=['Su','Mo','Tu','We','Th','Fr','Sa']
  dn.forEach(d=>html+=`<div class="cal-day-hdr">${d}</div>`)
  for(let i=0;i<firstDay;i++)html+=`<div></div>`
  for(let i=1;i<=days;i++){
    const isToday=i===now.getDate()
    const hasEntry=entryDates.has(i+'_'+m)
    const hasDream=dreamDates.has(i+'_'+m)
    html+=`<div class="cal-day${isToday?' today':''}${hasEntry&&!isToday?' has-entry':''}" title="${hasEntry?'Has log entry':''}${hasDream?' + dream':''}">
      ${i}${hasDream?'<br><span style="font-size:8px">üí§</span>':''}
    </div>`
  }
  html+=`</div>`
  el.innerHTML=html
  loadReminders()
}

// =================== REMINDERS ===================
function addReminder() {
  const text=document.getElementById('reminderText').value
  const time=document.getElementById('reminderTime').value
  if(!text||!time){showToast('‚ùå Fill all fields');return}
  reminders.push({id:Date.now(),text,time})
  localStorage.setItem('cos_reminders',JSON.stringify(reminders))
  document.getElementById('reminderText').value=''
  document.getElementById('reminderTime').value=''
  loadReminders()
  showToast('‚úÖ Reminder added')
}

function loadReminders() {
  const list=document.getElementById('remindersList'); if(!list)return
  if(!reminders.length){list.innerHTML='<div class="empty-state"><div class="empty-icon">‚è∞</div><p>No reminders set</p></div>';return}
  list.innerHTML=reminders.map(r=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg4);border-radius:10px;margin-bottom:8px;border:1px solid var(--border)">
      <div>
        <div style="font-weight:700;font-size:14px">${r.text}</div>
        <div style="font-size:11px;color:var(--text3);margin-top:2px">${new Date(r.time).toLocaleString()}</div>
      </div>
      <button class="btn btn-danger" onclick="delReminder(${r.id})" style="width:auto;padding:6px 12px;font-size:12px">Delete</button>
    </div>
  `).join('')
}

function delReminder(id) {
  reminders=reminders.filter(r=>r.id!==id)
  localStorage.setItem('cos_reminders',JSON.stringify(reminders))
  loadReminders()
}

// =================== EXPORT/IMPORT ===================
function exportData() {
  const exp={version:'5.0',exported:new Date().toISOString(),logs,voiceMemos,mediaFiles,healthData,reminders,dreams}
  const blob=new Blob([JSON.stringify(exp,null,2)],{type:'application/json'})
  const a=document.createElement('a')
  a.href=URL.createObjectURL(blob)
  a.download='consciousness-os-'+new Date().toISOString().split('T')[0]+'.json'
  a.click()
  showToast('üì§ Exported')
}

function importData() {
  const inp=document.createElement('input'); inp.type='file'; inp.accept='.json'
  inp.onchange=e=>{
    const r=new FileReader()
    r.onload=ev=>{
      try{
        const d=JSON.parse(ev.target.result)
        if(d.logs){logs=d.logs;localStorage.setItem('cos_logs',JSON.stringify(logs))}
        if(d.dreams){dreams=d.dreams;localStorage.setItem('cos_dreams',JSON.stringify(dreams))}
        showToast('‚úÖ Imported: '+logs.length+' logs')
        renderAnalysis()
      }catch{showToast('‚ùå Invalid file')}
    }
    r.readAsText(e.target.files[0])
  }
  inp.click()
}

function clearAllData() {
  if(!confirm('‚ö†Ô∏è Delete ALL data? This cannot be undone.'))return
  localStorage.clear()
  location.reload()
}

// =================== LEGAL MODALS ===================
const LEGAL = {
  privacy: {
    title:'üîí Privacy Policy',
    content:`<p style="line-height:1.8;color:var(--text2);font-size:14px">
      <strong style="color:var(--text)">Last updated: 2025</strong><br><br>
      <strong>Data Storage:</strong> All data you enter into Consciousness OS is stored exclusively on your local device using browser localStorage. No data is transmitted to any server, cloud service, or third party.<br><br>
      <strong>What We Store:</strong> Consciousness logs, health questionnaire responses, dream journal entries, voice memo audio and transcriptions, uploaded images and videos, and settings. All data remains on your device.<br><br>
      <strong>No Tracking:</strong> We do not use cookies, analytics, advertising trackers, or any form of behavioral monitoring. There are no user accounts, no registration, and no login required.<br><br>
      <strong>Voice &amp; Media:</strong> Audio recordings and images are stored as base64 data in your browser's localStorage. They are processed entirely client-side.<br><br>
      <strong>Your Rights:</strong> You can export, delete, or manage all your data at any time via the Settings tab. Clearing browser data removes all app data.<br><br>
      <strong>Health Data:</strong> Health questionnaire responses are stored locally and are not medical advice. This data is private to your device only.<br><br>
      <strong>Third Parties:</strong> Consciousness OS does not share any data with any third parties. The app operates entirely offline after initial load.
    </p>`
  },
  terms: {
    title:'üìã Terms of Use',
    content:`<p style="line-height:1.8;color:var(--text2);font-size:14px">
      <strong style="color:var(--text)">By using Consciousness OS, you agree to these terms:</strong><br><br>
      <strong>Personal Use:</strong> This application is provided for personal self-tracking and enhancement purposes only. It is not a medical, psychological, or therapeutic service.<br><br>
      <strong>No Medical Advice:</strong> Information provided by this app, including AI responses and health analyses, is for informational purposes only and does not constitute medical advice. Always consult qualified healthcare professionals for medical decisions.<br><br>
      <strong>User Responsibility:</strong> You are responsible for all data you enter and for how you use the insights generated. We are not liable for any decisions made based on app outputs.<br><br>
      <strong>Data Loss:</strong> As data is stored in browser localStorage, clearing your browser data will permanently delete all app data. We recommend regular exports via Settings > Export Data.<br><br>
      <strong>Acceptable Use:</strong> You agree to use this app lawfully and not attempt to reverse-engineer, modify, or redistribute the application.<br><br>
      <strong>Limitation of Liability:</strong> This app is provided "as is" without warranty. We disclaim all liability for errors, data loss, or any consequences arising from app use.
    </p>`
  },
  copyright: {
    title:'¬©Ô∏è Copyright Notice',
    content:`<p style="line-height:1.8;color:var(--text2);font-size:14px">
      <strong style="color:var(--text)">¬© 2025 Consciousness OS. All Rights Reserved.</strong><br><br>
      The Consciousness OS application, including its design, code, interface elements, feature set, and written content, is protected under copyright law.<br><br>
      <strong>Permitted Use:</strong> You may use this application for personal, non-commercial purposes. You may not reproduce, distribute, modify, create derivative works of, or commercially exploit any part of this application without express written permission.<br><br>
      <strong>Your Content:</strong> All personal data, logs, dreams, and entries you create remain your own intellectual property. We make no claim over your personal content.<br><br>
      <strong>Third-Party Resources:</strong> This application uses Google Fonts (Syne, DM Sans) under the SIL Open Font License. All other assets are original works.<br><br>
      <strong>Attribution:</strong> Consciousness OS v5.0 ‚Äî Complete Mind Enhancement &amp; Preservation System.
    </p>`
  },
  disclaimer: {
    title:'‚ö†Ô∏è Health Disclaimer',
    content:`<p style="line-height:1.8;color:var(--text2);font-size:14px">
      <strong style="color:var(--text);font-size:16px">IMPORTANT ‚Äî PLEASE READ</strong><br><br>
      <strong>Not Medical Advice:</strong> Consciousness OS is a self-tracking and personal development tool. It is NOT a medical device, diagnostic tool, or substitute for professional medical, psychological, or therapeutic care.<br><br>
      <strong>Health Questionnaire:</strong> The 18-section health questionnaire collects self-reported information for personal reflection only. Results and analyses are general informational outputs and are NOT medical diagnoses or treatment recommendations.<br><br>
      <strong>Mental Health:</strong> If you are experiencing mental health crises, severe depression, anxiety, or any psychological distress, please consult a qualified mental health professional immediately.<br><br>
      <strong>Lucid Dreaming:</strong> Some lucid dreaming techniques involve sleep disruption. Individuals with sleep disorders should consult a doctor before practicing advanced techniques like WILD or WBTB.<br><br>
      <strong>Emergency Services:</strong> This app is not an emergency service. In a medical or mental health emergency, contact emergency services (911 or your local equivalent) immediately.<br><br>
      <strong>Consult Professionals:</strong> Always consult qualified doctors, therapists, nutritionists, or other healthcare professionals before making decisions about your health based on any information in this app.
    </p>`
  },
  features: {
    title:'‚ú® Features Guide',
    content:`<p style="line-height:1.8;color:var(--text2);font-size:14px">
      <strong style="color:var(--text)">Complete Feature Reference ‚Äî Consciousness OS v5.0</strong><br><br>
      <strong>üìù Daily Log:</strong> Track 17 consciousness dimensions daily including mood, focus, energy, creativity, flow, clarity, anxiety, stability, social energy, mindfulness, willpower, intuition, stress, and sleep. All sliders include detailed anchor descriptions for accurate rating.<br><br>
      <strong>üí¨ AI Digital Twin:</strong> An AI that learns from your log data and responds with personalized insights about your patterns, peak times, stress triggers, flow states, and performance predictions.<br><br>
      <strong>üß¨ Analysis Dashboard:</strong> Statistics, trends, predictions, pattern detection, personal records, and recent entry review.<br><br>
      <strong>‚öïÔ∏è Health Questionnaire:</strong> 18-section comprehensive health profile covering demographics, medical history, genetics, nutrition, fitness, sleep, mental health, hormones, cardiometabolic risk, gut health, immunity, neurology, pain, environment, preventive care, functional capacity, longevity markers, and health goals.<br><br>
      <strong>üéÆ Brain Games (8):</strong> Memory Match, Reaction Time, Stroop Challenge, N-Back Memory, Math Blitz, Word Chain, Color Sequence, Focus Breathing. All fully playable with scoring.<br><br>
      <strong>üí§ Lucid Dreams:</strong> Dream journal, lucidity tracking, 5 evidence-based induction techniques (WILD, MILD, DILD, WBTB), reality check tracker (6 types), sleep cycle calculator with WBTB alarm times.<br><br>
      <strong>üé§ Voice Memos:</strong> Record voice notes with real-time speech-to-text transcription.<br><br>
      <strong>üì∑ Media Archive:</strong> Upload photos and videos as visual consciousness memories.<br><br>
      <strong>üìÖ Calendar:</strong> View your logging history on a calendar. Dream nights marked. Set reminders.<br><br>
      <strong>‚öôÔ∏è Settings:</strong> Dark/light mode, data export/import (JSON), full data clear.
    </p>`
  }
}

function showLegal(type) {
  const l = LEGAL[type]
  if (!l) return
  document.getElementById('modalBody').innerHTML = `<h3 style="font-family:var(--font-head);font-size:20px;margin-bottom:16px">${l.title}</h3>${l.content}`
  document.getElementById('modal').classList.add('open')
}

function closeModal() { document.getElementById('modal').classList.remove('open') }

// =================== TOAST ===================
function showToast(msg) {
  const t=document.getElementById('toast')
  t.textContent=msg
  t.classList.add('show')
  setTimeout(()=>t.classList.remove('show'),3200)
}
</script>
</body>
</html>
