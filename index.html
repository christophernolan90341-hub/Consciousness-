<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consciousness OS v6.0</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f8f6ff;
  --bg2: #ffffff;
  --bg3: #f0ecff;
  --text: #1a1040;
  --text2: #4a3f6b;
  --text3: #7c6d99;
  --border: #e2d9f3;
  --primary: #7c3aed;
  --primary2: #6d28d9;
  --accent: #06b6d4;
  --accent2: #0891b2;
  --pink: #ec4899;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --card-shadow: 0 2px 12px rgba(124,58,237,0.08);
  --nav-h: 52px;
  --topbar-h: 96px;
}
[data-theme="dark"] {
  --bg: #0f0a1e;
  --bg2: #1a1035;
  --bg3: #221a42;
  --text: #f0ebff;
  --text2: #c4b5fd;
  --text3: #9170d8;
  --border: #2d2250;
  --card-shadow: 0 2px 12px rgba(0,0,0,0.4);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:"DM Sans",sans-serif;background:var(--bg);color:var(--text);font-size:15px;overflow-x:hidden}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{position:fixed;top:0;left:0;right:0;height:var(--topbar-h);background:var(--bg2);border-bottom:1px solid var(--border);z-index:200;box-shadow:var(--card-shadow);display:flex;flex-direction:column}
.topbar-row1{display:flex;align-items:center;padding:0 12px;height:48px;width:100%;border-bottom:1px solid var(--border);gap:8px;flex-shrink:0}
.topbar-brand{font-family:"Syne",sans-serif;font-weight:800;font-size:18px;background:linear-gradient(135deg,#dc2626,#ef4444,#f97316);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;flex:1;white-space:nowrap;cursor:default;letter-spacing:.5px;text-shadow:none}
.topbar-quick{display:flex;gap:5px;align-items:center;flex-shrink:0}
.topbar-row2{display:flex;gap:5px;align-items:center;overflow-x:auto;overflow-y:hidden;flex:1;height:48px;padding:0 8px;scrollbar-width:none;-webkit-overflow-scrolling:touch;scroll-behavior:smooth;touch-action:pan-x;overscroll-behavior-x:contain;cursor:grab}
.topbar-row2::-webkit-scrollbar{display:none}
/* guide section label styled like a tab group header */
.tb-btn{background:var(--bg3);border:1.5px solid var(--border);color:var(--text);border-radius:9px;padding:5px 10px;cursor:pointer;font-size:12px;font-weight:600;display:flex;align-items:center;gap:3px;transition:all .2s;white-space:nowrap;flex-shrink:0;height:32px;font-family:"DM Sans",sans-serif}
.tb-btn:hover,.tb-btn:active{background:var(--primary);color:#fff;border-color:var(--primary)}
.lang-sel{background:var(--bg3);border:1.5px solid var(--border);color:var(--text);border-radius:9px;padding:4px 5px;cursor:pointer;font-size:11px;font-weight:600;flex-shrink:0;height:32px}
.guide-pill{padding:5px 11px;border-radius:20px;border:1.5px solid var(--primary);background:rgba(124,58,237,.08);color:var(--primary);font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;height:30px;display:inline-flex;align-items:center;gap:3px;transition:all .2s}
.guide-pill:hover{background:var(--primary);color:#fff}
.guide-pill.gp-divider{border:none;background:none;color:var(--text3);font-size:13px;font-weight:400;padding:0 2px;cursor:default}
.guide-skip{padding:5px 12px;border-radius:20px;border:none;background:var(--bg3);color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;height:30px;display:inline-flex;align-items:center;gap:3px;transition:all .2s}
.guide-skip:hover{background:var(--danger);color:#fff}
.guide-label{font-size:11px;font-weight:800;color:#fff;white-space:nowrap;flex-shrink:0;text-transform:uppercase;letter-spacing:.5px;padding:4px 8px;background:var(--primary);border-radius:8px;display:inline-flex;align-items:center;gap:3px}

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:var(--nav-h);background:var(--bg2);border-top:1px solid var(--border);display:flex;overflow-x:auto;overflow-y:hidden;z-index:200;scrollbar-width:none;-webkit-overflow-scrolling:touch;touch-action:pan-x;overscroll-behavior-x:contain;-ms-overflow-style:none;white-space:nowrap}
.bottom-nav::-webkit-scrollbar{display:none}
.nav-tab{flex:0 0 auto;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 11px;gap:2px;cursor:pointer;border:none;background:transparent;color:var(--text3);font-size:10px;font-family:"DM Sans",sans-serif;transition:all .2s;min-width:56px;position:relative}
.nav-tab .ni{font-size:18px;line-height:1}
.nav-tab.active{color:#1d4ed8;font-weight:700}
.nav-tab.active .ni{transform:scale(1.15);filter:drop-shadow(0 0 4px rgba(37,99,235,.4))}
.nav-tab.active::before{content:'';position:absolute;top:-1px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:9px solid transparent;border-right:9px solid transparent;border-top:8px solid #1d4ed8}
.nav-tab.active::after{content:'';position:absolute;bottom:0;left:10%;right:10%;height:2.5px;background:linear-gradient(to right,#2563eb,#1d4ed8);border-radius:2px 2px 0 0}

/* â”€â”€ MAIN CONTENT â”€â”€ */
.main{padding-top:calc(var(--topbar-h) + 12px);padding-bottom:calc(var(--nav-h) + 16px);min-height:100vh}
.tab-panel{display:none;padding:0 14px;animation:fadeUp .3s ease}
.tab-panel.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:14px;box-shadow:var(--card-shadow)}
.card-title{font-family:"Syne",sans-serif;font-weight:700;font-size:15px;color:var(--text);margin-bottom:12px;display:flex;align-items:center;gap:7px}
.card-title .emoji{font-size:18px}
.section-header{font-family:"Syne",sans-serif;font-weight:700;font-size:19px;margin:18px 0 10px;display:flex;align-items:center;gap:8px}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{display:inline-flex;align-items:center;gap:6px;padding:9px 16px;border-radius:10px;border:none;cursor:pointer;font-family:"DM Sans",sans-serif;font-weight:600;font-size:14px;transition:all .2s}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--pink));color:#fff}
.btn-primary:hover{opacity:.88;transform:translateY(-1px)}
.btn-secondary{background:var(--bg3);border:1px solid var(--border);color:var(--text2)}
.btn-secondary:hover{border-color:var(--primary);color:var(--primary)}
.btn-accent{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-sm{padding:6px 11px;font-size:12px;border-radius:8px}
.btn-block{width:100%;justify-content:center}

/* â”€â”€ FORMS â”€â”€ */
.form-group{margin-bottom:14px}
.form-label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px}
.form-input,.form-select,.form-textarea{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:9px 12px;color:var(--text);font-family:"DM Sans",sans-serif;font-size:14px;transition:border .2s;outline:none}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--primary)}
.form-textarea{resize:vertical;min-height:80px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}

/* â”€â”€ ENHANCED SLIDER WITH DOTS â”€â”€ */
.slider-group{margin-bottom:20px}
.slider-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.slider-label{font-size:13px;font-weight:600;color:var(--text2)}
.slider-value-badge{background:var(--primary);color:#fff;border-radius:20px;padding:2px 10px;font-size:13px;font-weight:700;min-width:32px;text-align:center}
.slider-track{width:100%;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;outline:none;background:linear-gradient(to right,var(--primary) var(--pct,50%),var(--border) var(--pct,50%));cursor:pointer;margin-bottom:8px}
.slider-track::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--primary);box-shadow:0 2px 8px rgba(124,58,237,0.4);cursor:pointer;border:2px solid #fff}
.slider-dots{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.slider-dot{width:22px;height:22px;border-radius:50%;border:2px solid var(--border);background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:var(--text3);transition:all .25s;cursor:default}
.slider-dot.active{border-color:var(--primary);background:var(--primary);color:#fff;transform:scale(1.2)}
.slider-dot.near{border-color:var(--primary);background:var(--bg3);color:var(--primary)}
.slider-anchor-text{font-size:11px;color:var(--text3);text-align:center;min-height:30px;transition:all .3s;background:var(--bg3);border-radius:8px;padding:5px 8px;line-height:1.4}
.slider-pair-labels{display:flex;justify-content:space-between;font-size:9px;color:var(--text3);margin-top:2px;padding:0 2px}

/* â”€â”€ BRAINWAVE PLAYER â”€â”€ */
.bw-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.bw-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:12px;cursor:pointer;transition:all .25s;text-align:center;position:relative;overflow:hidden}
.bw-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--primary),var(--accent));opacity:0;transition:.3s}
.bw-card.playing::before{opacity:.12}
.bw-card.playing{border-color:var(--primary);box-shadow:0 0 16px rgba(124,58,237,0.25)}
.bw-card .bw-emoji{font-size:28px;margin-bottom:6px;display:block}
.bw-card .bw-name{font-weight:700;font-size:13px;color:var(--text);position:relative}
.bw-card .bw-desc{font-size:11px;color:var(--text3);margin-top:3px;position:relative}
.bw-card .bw-freq{font-size:10px;color:var(--accent);font-weight:600;margin-top:3px;position:relative}
.bw-visualizer{height:60px;background:var(--bg3);border-radius:10px;margin-bottom:12px;display:flex;align-items:center;justify-content:center;gap:3px;overflow:hidden}
.bw-bar{width:4px;border-radius:2px;background:linear-gradient(to top,var(--primary),var(--accent));animation:none;transform-origin:bottom}
.bw-bar.animating{animation:bwAnim var(--dur,0.5s) ease-in-out infinite alternate}
@keyframes bwAnim{from{transform:scaleY(.2)}to{transform:scaleY(1)}}
.bw-controls{display:flex;gap:8px;align-items:center;background:var(--bg3);border-radius:12px;padding:12px;margin-bottom:12px}
.bw-vol{flex:1}
.bw-timer{font-size:12px;color:var(--text3);font-weight:600;min-width:48px;text-align:right}
.wave-type-btns{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.wave-btn{padding:5px 11px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s}
.wave-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* â”€â”€ AI HUB â”€â”€ */
.ai-models-bar{display:flex;gap:6px;overflow-x:auto;padding-bottom:6px;margin-bottom:12px;scrollbar-width:none}
.ai-models-bar::-webkit-scrollbar{display:none}
.ai-model-btn{flex:0 0 auto;display:flex;flex-direction:column;align-items:center;gap:3px;padding:8px 12px;border-radius:10px;border:2px solid var(--border);background:var(--bg3);cursor:pointer;transition:all .2s;min-width:72px}
.ai-model-btn.active{border-color:var(--primary);background:var(--bg)}
.ai-model-btn .ai-logo{font-size:20px}
.ai-model-btn .ai-name{font-size:10px;font-weight:700;color:var(--text2)}
.chat-messages{height:340px;overflow-y:auto;background:var(--bg3);border-radius:12px;padding:12px;margin-bottom:10px;display:flex;flex-direction:column;gap:10px}
.chat-msg{max-width:85%;padding:10px 13px;border-radius:12px;font-size:13px;line-height:1.5;animation:fadeUp .2s ease}
.chat-msg.user{align-self:flex-end;background:linear-gradient(135deg,var(--primary),var(--pink));color:#fff;border-bottom-right-radius:3px}
.chat-msg.ai{align-self:flex-start;background:var(--bg2);border:1px solid var(--border);color:var(--text);border-bottom-left-radius:3px}
.chat-msg.ai .ai-tag{font-size:10px;font-weight:700;color:var(--primary);margin-bottom:4px}
.chat-input-area{display:flex;gap:8px}
.chat-input{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:9px 12px;color:var(--text);font-family:"DM Sans",sans-serif;font-size:14px;outline:none;resize:none;height:44px;max-height:140px;overflow:hidden;transition:border .2s}
.chat-input:focus{border-color:var(--primary)}
.suggested-qs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px}
.sq-btn{padding:5px 10px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s;white-space:nowrap}
.sq-btn:hover{border-color:var(--primary);color:var(--primary)}
.ai-tip-card{background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(236,72,153,.1));border:1px solid rgba(124,58,237,.2);border-radius:12px;padding:12px;margin-bottom:10px;font-size:13px;line-height:1.5}
.chat-controls{display:flex;gap:6px;margin-bottom:8px}

/* â”€â”€ ANALYSIS â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.stat-box{background:var(--bg3);border-radius:12px;padding:12px;text-align:center;border:1px solid var(--border)}
.stat-box .sv{font-size:24px;font-weight:800;font-family:"Syne",sans-serif;color:var(--primary)}
.stat-box .sl{font-size:10px;color:var(--text3);margin-top:2px}
.trend-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
.trend-item:last-child{border-bottom:none}

/* â”€â”€ HEALTH â”€â”€ */
.health-jump-bar{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px}
.section-jump{padding:4px 9px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s}
.section-jump.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.health-progress{height:6px;background:var(--bg3);border-radius:3px;margin-bottom:14px;overflow:hidden}
.health-progress-bar{height:100%;background:linear-gradient(to right,var(--primary),var(--pink));border-radius:3px;transition:width .4s}
.health-section{display:none}
.health-section.active{display:block}
.unit-toggle{display:flex;gap:0;border-radius:8px;overflow:hidden;border:1px solid var(--border);width:fit-content}
.unit-btn{padding:5px 12px;font-size:12px;cursor:pointer;border:none;background:var(--bg3);color:var(--text2);font-family:"DM Sans",sans-serif;transition:all .2s}
.unit-btn.active{background:var(--primary);color:#fff}
.dual-input{display:flex;gap:6px;align-items:center}
.dual-input .form-input{flex:1}
.dual-input .unit-label{font-size:12px;color:var(--text3);white-space:nowrap}

/* â”€â”€ GAMES â”€â”€ */
.games-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.game-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;cursor:pointer;transition:all .25s}
.game-card:hover{border-color:var(--primary);transform:translateY(-2px);box-shadow:0 6px 20px rgba(124,58,237,.15)}
.game-card .g-emoji{font-size:32px;margin-bottom:6px;display:block}
.game-card .g-name{font-weight:700;font-size:13px;color:var(--text)}
.game-card .g-desc{font-size:11px;color:var(--text3);margin-top:3px}
.game-card .g-tag{font-size:10px;color:var(--accent);font-weight:600;margin-top:4px}
.game-view{display:none}
.game-view.active{display:block}
.game-header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.game-score-bar{display:flex;gap:14px;background:var(--bg3);border-radius:10px;padding:10px 14px;margin-bottom:14px}
.game-score-bar .gs{text-align:center;flex:1}
.game-score-bar .gsv{font-size:20px;font-weight:800;font-family:"Syne",sans-serif;color:var(--primary)}
.game-score-bar .gsl{font-size:10px;color:var(--text3)}
#sudoku-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:1px;background:var(--border);border:2px solid var(--primary);border-radius:8px;overflow:hidden;max-width:340px;margin:0 auto 14px}
.sudoku-cell{background:var(--bg3);aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--text);cursor:pointer;transition:background .15s;border:none}
.sudoku-cell:nth-child(3n){border-right:2px solid var(--primary)}
.sudoku-cell.given{color:var(--primary);background:rgba(124,58,237,.08)}
.sudoku-cell.selected{background:rgba(124,58,237,.25)}
.sudoku-cell.error{background:rgba(239,68,68,.15);color:var(--danger)}
.sudoku-numpad{display:grid;grid-template-columns:repeat(9,1fr);gap:4px;margin-bottom:10px;max-width:340px;margin:0 auto 14px}
.sudoku-num{background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:8px 4px;text-align:center;cursor:pointer;font-weight:700;font-size:13px;transition:all .2s}
.sudoku-num:hover{background:var(--primary);color:#fff}
.pattern-grid{display:grid;gap:6px;margin-bottom:14px}
.pattern-cell{border-radius:8px;aspect-ratio:1;transition:all .3s;cursor:pointer;border:2px solid transparent}
.pattern-cell.show{border-color:var(--primary);box-shadow:0 0 16px rgba(124,58,237,.4)}
.typing-area{font-size:16px;line-height:1.8;letter-spacing:.3px}
.typing-area .correct{color:var(--success)}
.typing-area .incorrect{color:var(--danger);text-decoration:underline}
.typing-area .current{background:var(--primary);color:#fff;border-radius:2px}

/* â”€â”€ DREAMS â”€â”€ */
.dream-types{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.dream-type-btn{padding:5px 11px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:12px;cursor:pointer;transition:all .2s}
.dream-type-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.technique-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;cursor:pointer;transition:all .2s}
.technique-card:hover{border-color:var(--primary)}
.technique-card .tc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.technique-card .tc-title{font-weight:700;font-size:14px}
.technique-card .tc-body{font-size:13px;color:var(--text2);line-height:1.5;display:none}
.technique-card.open .tc-body{display:block}
.technique-card .tc-chevron{transition:transform .2s;color:var(--text3)}
.technique-card.open .tc-chevron{transform:rotate(180deg)}
.dream-ai-box{background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(6,182,212,.1));border:1px solid rgba(124,58,237,.2);border-radius:12px;padding:14px;margin-top:10px}

/* â”€â”€ VOICE & MEDIA â”€â”€ */
.recorder-visual{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--pink));display:flex;align-items:center;justify-content:center;margin:0 auto 14px;cursor:pointer;transition:all .3s;font-size:32px}
.recorder-visual.recording{animation:pulse 1s ease-in-out infinite;box-shadow:0 0 0 0 rgba(124,58,237,.5)}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(124,58,237,.5)}50%{box-shadow:0 0 0 14px rgba(124,58,237,0)}}
.memo-item{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px}
.memo-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:11px;color:var(--text3)}
.media-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.media-thumb{aspect-ratio:1;border-radius:8px;overflow:hidden;background:var(--bg3);cursor:pointer;position:relative}
.media-thumb img,.media-thumb video{width:100%;height:100%;object-fit:cover}
.ai-insight-box{background:linear-gradient(135deg,rgba(16,185,129,.1),rgba(6,182,212,.1));border:1px solid rgba(16,185,129,.2);border-radius:12px;padding:12px;margin-top:10px;font-size:13px}

/* â”€â”€ CALENDAR & ALARMS â”€â”€ */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:14px}
.cal-day-header{text-align:center;font-size:10px;font-weight:700;color:var(--text3);padding:4px 0}
.cal-day{aspect-ratio:1;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:12px;cursor:pointer;position:relative;border:1px solid transparent;transition:all .2s}
.cal-day:hover{background:var(--bg3)}
.cal-day.today{background:var(--primary);color:#fff;font-weight:700}
.cal-day.has-log{border-color:var(--primary);color:var(--primary)}
.cal-day.has-dream::after{content:'ðŸ’¤';font-size:8px;position:absolute;bottom:1px;right:1px}
.alarm-item{display:flex;justify-content:space-between;align-items:center;background:var(--bg3);border-radius:10px;padding:10px;margin-bottom:6px;border:1px solid var(--border)}
.alarm-toggle{width:40px;height:22px;border-radius:11px;background:var(--border);position:relative;cursor:pointer;transition:background .2s}
.alarm-toggle.on{background:var(--primary)}
.alarm-toggle::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:#fff;top:2px;left:2px;transition:left .2s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.alarm-toggle.on::after{left:20px}

/* â”€â”€ SETTINGS â”€â”€ */
.setting-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border)}
.setting-item:last-child{border-bottom:none}
.setting-info{flex:1;padding-right:12px}
.setting-title{font-weight:600;font-size:14px}
.setting-desc{font-size:12px;color:var(--text3);margin-top:2px}
.toggle{width:44px;height:24px;border-radius:12px;background:var(--border);position:relative;cursor:pointer;transition:background .25s;flex-shrink:0}
.toggle.on{background:var(--primary)}
.toggle::after{content:'';position:absolute;width:20px;height:20px;border-radius:50%;background:#fff;top:2px;left:2px;transition:left .25s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.toggle.on::after{left:22px}
.setting-help{font-size:10px;color:var(--accent);cursor:pointer;margin-top:3px;display:inline-block}

/* â”€â”€ MODALS â”€â”€ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);z-index:500;display:flex;align-items:center;justify-content:center;padding:14px;opacity:0;pointer-events:none;transition:opacity .3s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--bg2);border-radius:18px;width:100%;max-width:460px;max-height:85vh;overflow-y:auto;padding:20px;animation:fadeUp .3s ease;border:1px solid var(--border);scrollbar-width:thin}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.modal-title{font-family:"Syne",sans-serif;font-weight:700;font-size:18px}
.modal-close{background:var(--bg3);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:16px;color:var(--text3)}

/* â”€â”€ ONBOARDING â”€â”€ */
.onboard-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);z-index:800;display:flex;align-items:center;justify-content:center;padding:16px}
.onboard-card{background:var(--bg2);border-radius:20px;width:100%;max-width:420px;padding:24px;border:1px solid var(--border);max-height:90vh;overflow-y:auto}
.onboard-step{display:none;animation:fadeUp .3s ease}
.onboard-step.active{display:block}
.onboard-icon{font-size:56px;text-align:center;margin-bottom:14px;display:block}
.onboard-title{font-family:"Syne",sans-serif;font-size:22px;font-weight:800;text-align:center;margin-bottom:8px;background:linear-gradient(135deg,var(--primary),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.onboard-text{text-align:center;color:var(--text2);font-size:14px;line-height:1.6;margin-bottom:18px}
.onboard-features{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:18px}
.of-item{background:var(--bg3);border-radius:10px;padding:10px;text-align:center;border:1px solid var(--border)}
.of-item .of-icon{font-size:22px;margin-bottom:4px}
.of-item .of-name{font-size:11px;font-weight:700;color:var(--text)}
.onboard-dots{display:flex;justify-content:center;gap:6px;margin-bottom:16px}
.odot{width:8px;height:8px;border-radius:50%;background:var(--border);transition:all .2s}
.odot.active{background:var(--primary);width:22px;border-radius:4px}
.onboard-nav{display:flex;gap:8px}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:calc(var(--nav-h) + 14px);left:50%;transform:translateX(-50%) translateY(20px);background:var(--text);color:var(--bg);padding:10px 20px;border-radius:24px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â”€â”€ MISC â”€â”€ */
.badge{display:inline-block;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700}
.badge-primary{background:rgba(124,58,237,.15);color:var(--primary)}
.badge-success{background:rgba(16,185,129,.15);color:var(--success)}
.badge-warning{background:rgba(245,158,11,.15);color:var(--warning)}
.badge-danger{background:rgba(239,68,68,.15);color:var(--danger)}
.progress-bar-wrap{height:8px;background:var(--bg3);border-radius:4px;overflow:hidden}
.progress-bar-fill{height:100%;border-radius:4px;background:linear-gradient(to right,var(--primary),var(--pink));transition:width .4s}
.divider{border:none;border-top:1px solid var(--border);margin:14px 0}
.empty-state{text-align:center;padding:30px 20px;color:var(--text3)}
.empty-state .es-icon{font-size:40px;margin-bottom:10px;display:block}
.empty-state .es-text{font-size:14px}
.chip{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:12px;background:var(--bg3);border:1px solid var(--border);font-size:11px;color:var(--text2);margin:2px}
.score-ring{position:relative;width:80px;height:80px;flex-shrink:0}
.score-ring svg{transform:rotate(-90deg)}
.score-ring .ring-text{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:"Syne",sans-serif;font-weight:800;font-size:18px;color:var(--primary)}
.score-ring .ring-sub{font-size:8px;color:var(--text3);font-family:"DM Sans",sans-serif;font-weight:400}
.collapsible-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:10px 0;user-select:none}
.collapsible-body{display:none}
.collapsible-body.open{display:block}
@media(max-width:380px){.bw-grid,.games-grid{grid-template-columns:1fr}}
.rc-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
.rc-item:last-child{border-bottom:none}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.ai-loading{display:flex;gap:5px;align-items:center;padding:8px 12px}
.ai-loading span{width:6px;height:6px;border-radius:50%;background:var(--primary);animation:bounce .8s ease-in-out infinite}
.ai-loading span:nth-child(2){animation-delay:.15s}
.ai-loading span:nth-child(3){animation-delay:.3s}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.reality-check-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.rc-btn{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;cursor:pointer;transition:all .2s}
.rc-btn:hover{border-color:var(--success)}
.rc-btn.done{border-color:var(--success);background:rgba(16,185,129,.1)}
.rc-btn .rc-icon{font-size:22px;margin-bottom:4px;display:block}
.rc-btn .rc-name{font-size:11px;font-weight:700;color:var(--text)}
.health-nav-btns{display:flex;justify-content:space-between;margin-top:16px}
.comparison-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.comparison-box{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
.comparison-box .cv{font-size:22px;font-weight:800;font-family:"Syne",sans-serif}
.comparison-box .cl{font-size:11px;color:var(--text3);margin-top:3px}

/* â”€â”€ THEME ENGINE â”€â”€ */
[data-theme="scifi"]{--bg:#020818;--bg2:#05122e;--bg3:#0a1f42;--text:#a0d4ff;--text2:#7ab8e8;--text3:#4a8fbe;--border:#1a3a6a;--primary:#00b4ff;--primary2:#0088cc;--accent:#00ffcc;--pink:#ff006a;--card-shadow:0 0 20px rgba(0,180,255,0.15)}
[data-theme="natural"]{--bg:#f0f7ee;--bg2:#ffffff;--bg3:#e8f5e3;--text:#1a3a1f;--text2:#2d5a35;--text3:#5a8a5f;--border:#c5e0c5;--primary:#2d7a3a;--primary2:#1d5a2a;--accent:#5dba6f;--pink:#c87f5f;--card-shadow:0 2px 12px rgba(45,122,58,0.1)}
[data-theme="spiritual"]{--bg:#1a0a2e;--bg2:#231040;--bg3:#2d1a55;--text:#f0d9ff;--text2:#d4a8ff;--text3:#9a6fcc;--border:#3d2570;--primary:#c040ff;--primary2:#9020e0;--accent:#ffcc00;--pink:#ff80c0;--card-shadow:0 0 20px rgba(192,64,255,0.15)}
[data-theme="classic"]{--bg:#faf8f0;--bg2:#ffffff;--bg3:#f5f0e8;--text:#2c1a00;--text2:#5c4020;--text3:#8c7050;--border:#d4c4a0;--primary:#8b4513;--primary2:#6b3010;--accent:#c87020;--pink:#e05060;--card-shadow:0 2px 12px rgba(139,69,19,0.1)}
[data-theme="winter"]{--bg:#e8f4ff;--bg2:#ffffff;--bg3:#d0ebff;--text:#0a2040;--text2:#204060;--text3:#507090;--border:#a0c8e8;--primary:#0060c0;--primary2:#0040a0;--accent:#00b0d8;--pink:#d060c0;--card-shadow:0 2px 12px rgba(0,96,192,0.1)}
[data-theme="summer"]{--bg:#fff8e8;--bg2:#ffffff;--bg3:#fff0c8;--text:#3a1a00;--text2:#6a3a10;--text3:#a06030;--border:#e8c870;--primary:#e08000;--primary2:#c06000;--accent:#f0a000;--pink:#e04080;--card-shadow:0 2px 12px rgba(224,128,0,0.12)}

/* â”€â”€ WORLD / FINANCE TAB â”€â”€ */
.world-nav{display:flex;gap:6px;overflow-x:auto;padding-bottom:6px;margin-bottom:14px;scrollbar-width:none}
.world-nav::-webkit-scrollbar{display:none}
.world-nav-btn{flex:0 0 auto;padding:6px 14px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.world-nav-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.world-panel{display:none}
.world-panel.active{display:block}
.market-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:all .2s}
.market-card:hover{border-color:var(--primary)}
.market-card .mc-name{font-weight:700;font-size:14px}
.market-card .mc-price{font-size:18px;font-weight:800;font-family:"Syne",sans-serif;color:var(--primary)}
.market-card .mc-change{font-size:12px;font-weight:700}
.mc-up{color:var(--success)}
.mc-down{color:var(--danger)}
.causal-chain{background:linear-gradient(135deg,rgba(124,58,237,.08),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.2);border-radius:12px;padding:14px;margin-top:10px}
.causal-step{display:flex;gap:10px;margin-bottom:10px;align-items:flex-start}
.causal-step:last-child{margin-bottom:0}
.causal-arrow{font-size:18px;color:var(--accent);flex-shrink:0;margin-top:2px}
.causal-text{font-size:13px;color:var(--text2);line-height:1.5}
.geo-event{background:var(--bg3);border-left:3px solid var(--primary);border-radius:0 10px 10px 0;padding:10px 12px;margin-bottom:8px;cursor:pointer;transition:all .2s}
.geo-event:hover{background:rgba(124,58,237,.08)}
.geo-event .ge-title{font-weight:700;font-size:13px}
.geo-event .ge-meta{font-size:11px;color:var(--text3);margin-top:2px}
.ai-ask-box{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:12px}
.ai-ask-row{display:flex;gap:8px;margin-top:8px}

/* â”€â”€ PATH / CAREER TAB â”€â”€ */
.path-stage-btns{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
.path-stage-btn{padding:6px 13px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:12px;cursor:pointer;transition:all .2s}
.path-stage-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.skill-tag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:12px;background:rgba(124,58,237,.1);border:1px solid rgba(124,58,237,.2);font-size:11px;color:var(--primary);margin:2px;font-weight:600}
.path-result-card{background:linear-gradient(135deg,rgba(124,58,237,.08),rgba(236,72,153,.08));border:1px solid rgba(124,58,237,.25);border-radius:14px;padding:16px;margin-top:12px}
.path-result-card h3{font-family:"Syne",sans-serif;font-size:16px;font-weight:700;margin-bottom:10px}
.path-detail{font-size:13px;color:var(--text2);line-height:1.6}
.energy-pattern-btn{padding:5px 11px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s;margin:2px}
.energy-pattern-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}

/* â”€â”€ SCIENCE TAB â”€â”€ */
.science-nav{display:flex;gap:6px;overflow-x:auto;padding-bottom:6px;margin-bottom:14px;scrollbar-width:none}
.science-nav::-webkit-scrollbar{display:none}
.science-cat-btn{flex:0 0 auto;padding:6px 13px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.science-cat-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.discovery-card{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.discovery-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary),var(--accent))}
.discovery-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(124,58,237,.15)}
.dc-category{font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px}
.dc-title{font-family:"Syne",sans-serif;font-size:15px;font-weight:700;margin-bottom:6px}
.dc-desc{font-size:12px;color:var(--text2);line-height:1.5}
.dc-impact{font-size:11px;color:var(--primary);font-weight:600;margin-top:6px}
.superfact-card{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;cursor:pointer}
.superfact-card .sf-num{font-size:28px;font-weight:800;font-family:"Syne",sans-serif;color:var(--primary);margin-bottom:4px}
.superfact-card .sf-text{font-size:13px;color:var(--text2);line-height:1.5}

/* â”€â”€ SYSTEM TAB â”€â”€ */
.theme-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:14px}
.theme-swatch{border-radius:10px;padding:10px 6px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all .2s}
.theme-swatch.active{border-color:var(--primary)}
.theme-swatch .ts-circle{width:28px;height:28px;border-radius:50%;margin:0 auto 4px}
.theme-swatch .ts-name{font-size:10px;font-weight:700;color:var(--text2)}
.legal-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border);cursor:pointer}
.legal-item:last-child{border-bottom:none}
.legal-item:hover .li-title{color:var(--primary)}
.li-title{font-weight:600;font-size:14px;transition:color .2s}
.li-desc{font-size:12px;color:var(--text3);margin-top:2px}
.account-options{display:flex;flex-direction:column;gap:8px}
.account-option{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all .2s}
.account-option:hover{border-color:var(--primary)}
.account-option .ao-icon{font-size:28px;flex-shrink:0}
.account-option .ao-title{font-weight:700;font-size:14px}
.account-option .ao-desc{font-size:12px;color:var(--text3);margin-top:2px}
.consciousness-guide-card{background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(192,64,255,.1));border:1px solid rgba(124,58,237,.25);border-radius:14px;padding:16px;margin-bottom:12px}
.guide-section{margin-bottom:14px}
.guide-section h3{font-family:"Syne",sans-serif;font-size:15px;font-weight:700;margin-bottom:6px;color:var(--primary)}
.guide-section p{font-size:13px;color:var(--text2);line-height:1.7}

/* â”€â”€ PASSIVE TRACKING â”€â”€ */
.telemetry-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.telemetry-box{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:10px;text-align:center}
.telemetry-box .tb-val{font-size:20px;font-weight:800;font-family:"Syne",sans-serif;color:var(--accent)}
.telemetry-box .tb-lbl{font-size:10px;color:var(--text3);margin-top:2px}
.correlation-item{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);align-items:center;cursor:pointer}
.correlation-item:last-child{border-bottom:none}
.corr-icon{font-size:20px;flex-shrink:0}
.corr-text{font-size:12px;color:var(--text2);line-height:1.4}
.corr-strength{font-size:11px;font-weight:700;color:var(--primary)}

/* â”€â”€ SYSTEM NAV TABS â”€â”€ */
.sys-tab-row{display:flex;gap:0;border-radius:10px;overflow:hidden;border:1px solid var(--border);margin-bottom:14px}
.sys-tab-btn{flex:1;padding:8px 4px;font-size:11px;font-weight:700;border:none;background:var(--bg3);color:var(--text2);cursor:pointer;transition:all .2s;font-family:"DM Sans",sans-serif}
.sys-tab-btn.active{background:var(--primary);color:#fff}
.sys-panel{display:none}
.sys-panel.active{display:block}

/* â”€â”€ NEWS DETAIL â”€â”€ */
.news-article{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;cursor:pointer;transition:all .2s;position:relative}
.news-article::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:linear-gradient(180deg,var(--primary),var(--accent));border-radius:14px 0 0 14px}
.news-article:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(124,58,237,.15);border-color:var(--primary)}
.news-category{font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px}
.news-headline{font-family:"Syne",sans-serif;font-size:15px;font-weight:700;margin-bottom:6px;line-height:1.3}
.news-summary{font-size:12px;color:var(--text2);line-height:1.5;margin-bottom:8px}
.news-meta{display:flex;gap:8px;align-items:center;font-size:10px;color:var(--text3)}
.news-impact{font-size:11px;color:var(--primary);font-weight:600;margin-top:6px;padding-top:6px;border-top:1px solid var(--border)}
.news-detail-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);z-index:700;display:none;overflow-y:auto;padding:14px}
.news-detail-overlay.open{display:block}
.news-detail-card{background:var(--bg2);border-radius:18px;max-width:600px;margin:0 auto;padding:20px;border:1px solid var(--border);animation:fadeUp .3s ease}
.news-detail-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}
.news-detail-close{background:var(--bg3);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:18px;color:var(--text3);flex-shrink:0}
.news-detail-body{font-size:14px;color:var(--text2);line-height:1.8}
.news-detail-body p{margin-bottom:12px}
.news-detail-body strong{color:var(--text)}
.news-detail-body h3{font-family:"Syne",sans-serif;font-size:15px;font-weight:700;margin:14px 0 8px;color:var(--text)}

/* â”€â”€ STUDY QUESTIONNAIRE â”€â”€ */
.study-section{display:none}
.study-section.active{display:block}
.study-jump-bar{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:12px}
.study-jump{padding:3px 8px;border-radius:16px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:10px;cursor:pointer;transition:all .2s}
.study-jump.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.study-progress{height:5px;background:var(--bg3);border-radius:3px;margin-bottom:14px;overflow:hidden}
.study-progress-bar{height:100%;background:linear-gradient(to right,var(--accent),var(--primary));border-radius:3px;transition:width .4s}
.study-result{background:linear-gradient(135deg,rgba(6,182,212,.1),rgba(124,58,237,.1));border:1px solid rgba(6,182,212,.25);border-radius:14px;padding:16px;margin-top:12px}
.study-result h2{font-family:"Syne",sans-serif;font-size:18px;font-weight:800;margin-bottom:12px;color:var(--primary)}
.study-result h3{font-family:"Syne",sans-serif;font-size:14px;font-weight:700;margin:12px 0 6px;color:var(--text)}
.study-result p{font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:8px}
.study-rating{display:flex;gap:6px;flex-wrap:wrap}
.study-rating-btn{width:36px;height:36px;border-radius:50%;border:2px solid var(--border);background:var(--bg3);color:var(--text2);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
.study-rating-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* â”€â”€ NEW GAMES â”€â”€ */
.chess-board{display:grid;grid-template-columns:repeat(8,1fr);max-width:340px;margin:0 auto 12px;border:2px solid var(--primary);border-radius:4px;overflow:hidden}
.chess-sq{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;transition:background .15s;user-select:none}
.chess-sq.light{background:#f0d9b5}
.chess-sq.dark-sq{background:#b58863}
.chess-sq.selected{background:rgba(124,58,237,.5)!important}
.chess-sq.valid-move{background:rgba(0,200,0,.4)!important}
.anagram-input{font-size:22px;font-weight:800;font-family:Syne,sans-serif;text-align:center;letter-spacing:4px}
.word-scramble-letters{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:14px}
.letter-tile{width:40px;height:48px;background:var(--primary);color:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;font-family:Syne,sans-serif;cursor:pointer;transition:all .2s;user-select:none}
.letter-tile:hover{transform:translateY(-4px);box-shadow:0 6px 16px rgba(124,58,237,.4)}
.simon-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;max-width:280px;margin:0 auto 14px}
.simon-btn{aspect-ratio:1;border-radius:16px;cursor:pointer;transition:all .15s;border:none;opacity:.8}
.simon-btn.lit{opacity:1;transform:scale(1.05);box-shadow:0 0 20px currentColor}
.trivia-option{background:var(--bg3);border:2px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s}
.trivia-option:hover{border-color:var(--primary)}
.trivia-option.correct{background:rgba(16,185,129,.2);border-color:var(--success);color:var(--success)}
.trivia-option.wrong{background:rgba(239,68,68,.15);border-color:var(--danger);color:var(--danger)}

/* â”€â”€ NEW THEMES (Spring, Autumn, Feminine, Masculine, Ocean, Galaxy) â”€â”€ */
[data-theme="spring"]{--bg:#f0fff4;--bg2:#ffffff;--bg3:#e8fced;--text:#1a3a1a;--text2:#2d5a2d;--text3:#5a8a5a;--border:#b8e8c0;--primary:#22c55e;--primary2:#16a34a;--accent:#84cc16;--pink:#f472b6;--card-shadow:0 2px 12px rgba(34,197,94,0.12)}
[data-theme="autumn"]{--bg:#fff8f0;--bg2:#ffffff;--bg3:#fef3e2;--text:#3a1a00;--text2:#7a3d00;--text3:#b06020;--border:#f5c890;--primary:#d97706;--primary2:#b45309;--accent:#dc2626;--pink:#e879a0;--card-shadow:0 2px 12px rgba(217,119,6,0.12)}
[data-theme="feminine"]{--bg:#fff0f8;--bg2:#ffffff;--bg3:#ffe4f2;--text:#3a0a2a;--text2:#7a2a5a;--text3:#b06090;--border:#f5b8d8;--primary:#e91e8c;--primary2:#c2185b;--accent:#9c27b0;--pink:#ff80c0;--card-shadow:0 2px 12px rgba(233,30,140,0.12)}
[data-theme="masculine"]{--bg:#0f1923;--bg2:#162030;--bg3:#1e2d3e;--text:#e8f0f8;--text2:#a0b8d0;--text3:#608098;--border:#1e3a52;--primary:#0080c0;--primary2:#005a90;--accent:#00b0d0;--pink:#2060a0;--card-shadow:0 0 16px rgba(0,128,192,0.15)}
[data-theme="ocean"]{--bg:#f0f8ff;--bg2:#ffffff;--bg3:#dbeeff;--text:#0a1a2a;--text2:#1a3a5a;--text3:#3a6a8a;--border:#a0c8e8;--primary:#0077cc;--primary2:#005599;--accent:#00ccdd;--pink:#0099bb;--card-shadow:0 2px 12px rgba(0,119,204,0.12)}
[data-theme="galaxy"]{--bg:#050010;--bg2:#0d001e;--bg3:#150030;--text:#e8d8ff;--text2:#b090e0;--text3:#7050a8;--border:#200048;--primary:#9900ff;--primary2:#7700cc;--accent:#00ffcc;--pink:#ff00aa;--card-shadow:0 0 24px rgba(153,0,255,0.2)}

/* â”€â”€ LOGIN OVERLAY â”€â”€ */
.login-overlay{position:fixed;inset:0;background:linear-gradient(135deg,var(--primary),var(--pink));z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
.login-card{background:rgba(255,255,255,.96);border-radius:24px;width:100%;max-width:400px;padding:28px;box-shadow:0 20px 60px rgba(0,0,0,.25);animation:fadeUp .4s ease}
[data-theme="dark"] .login-card,[data-theme="scifi"] .login-card,[data-theme="spiritual"] .login-card,[data-theme="masculine"] .login-card,[data-theme="galaxy"] .login-card{background:rgba(20,10,40,.96);color:#fff}
.login-tabs{display:flex;gap:0;border-radius:12px;overflow:hidden;border:1px solid rgba(124,58,237,.2);margin-bottom:20px}
.login-tab-btn{flex:1;padding:10px;font-size:13px;font-weight:700;border:none;cursor:pointer;background:transparent;color:#888;font-family:"DM Sans",sans-serif;transition:all .2s}
.login-tab-btn.active{background:linear-gradient(135deg,var(--primary,#7c3aed),var(--pink,#ec4899));color:#fff}
.profile-bar{display:flex;gap:8px;overflow-x:auto;padding:6px 14px;background:var(--bg2);border-bottom:1px solid var(--border);scrollbar-width:none;align-items:center}
.profile-bar::-webkit-scrollbar{display:none}
.profile-chip{display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg3);cursor:pointer;font-size:12px;font-weight:700;white-space:nowrap;transition:all .2s;flex-shrink:0}
.profile-chip.active-profile{border-color:var(--primary);background:rgba(124,58,237,.1);color:var(--primary)}
.profile-chip .pc-avatar{font-size:16px}
.profile-add-btn{padding:6px 12px;border-radius:20px;border:1.5px dashed var(--border);background:transparent;cursor:pointer;font-size:12px;color:var(--text3);flex-shrink:0;transition:all .2s}
.profile-add-btn:hover{border-color:var(--primary);color:var(--primary)}

/* â”€â”€ GUIDE NAV TOGGLE â”€â”€ */
.guide-nav-toggle{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--bg3);border-radius:10px;margin-bottom:12px;border:1px solid var(--border);cursor:pointer}
.guide-nav-bar{display:flex;gap:6px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;flex-wrap:wrap}
.guide-nav-bar::-webkit-scrollbar{display:none}
.guide-nav-item{padding:5px 11px;border-radius:20px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s;white-space:nowrap}
.guide-nav-item:hover,.guide-nav-item.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* â”€â”€ LEGAL PAGES â”€â”€ */
.legal-page-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(4px);z-index:600;display:none;overflow-y:auto;padding:14px}
.legal-page-overlay.open{display:block}
.legal-page-card{background:var(--bg2);border-radius:18px;max-width:560px;margin:0 auto;padding:22px;border:1px solid var(--border);animation:fadeUp .3s ease}
.legal-page-card h2{font-family:"Syne",sans-serif;font-size:20px;font-weight:800;margin-bottom:16px;color:var(--primary)}
.legal-page-card h3{font-family:"Syne",sans-serif;font-size:15px;font-weight:700;margin:14px 0 6px;color:var(--text)}
.legal-page-card p{font-size:13px;color:var(--text2);line-height:1.75;margin-bottom:10px}
.legal-page-card ul{font-size:13px;color:var(--text2);padding-left:18px;line-height:1.7;margin-bottom:10px}

/* â”€â”€ WORLD REFRESH INDICATOR â”€â”€ */
.world-refresh-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;background:var(--bg3);border-radius:10px;padding:8px 12px;border:1px solid var(--border)}
.world-live-dot{width:8px;height:8px;border-radius:50%;background:var(--success);animation:pulse 2s ease-in-out infinite;display:inline-block;margin-right:4px}

/* â”€â”€ SIMPLIFIED METRICS â”€â”€ */
.metric-card{background:var(--bg3);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:10px;cursor:pointer;transition:all .2s}
.metric-card:hover{border-color:var(--primary)}
.metric-score-ring{display:flex;align-items:center;gap:12px}
.metric-emoji-btn{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.metric-emoji-opt{width:36px;height:36px;border-radius:10px;border:2px solid var(--border);background:var(--bg2);display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;transition:all .2s}
.metric-emoji-opt.selected{border-color:var(--primary);background:rgba(124,58,237,.15);transform:scale(1.1)}
.metric-quick-bar{display:flex;gap:4px;margin-top:6px}
.mqb-btn{flex:1;padding:6px 4px;border-radius:8px;border:1.5px solid var(--border);background:var(--bg2);font-size:11px;font-weight:700;text-align:center;cursor:pointer;transition:all .2s}
.mqb-btn.sel{border-color:var(--primary);background:var(--primary);color:#fff}

/* â”€â”€ DATA ARCHITECTURE â”€â”€ */
.arch-node{background:var(--bg3);border:1.5px solid var(--border);border-radius:12px;padding:12px;margin-bottom:8px;cursor:pointer;transition:all .2s}
.arch-node:hover{border-color:var(--primary)}
.arch-node .an-title{font-weight:700;font-size:13px;color:var(--primary);margin-bottom:4px}
.arch-node .an-schema{font-size:11px;color:var(--text3);font-family:monospace;line-height:1.6}
.arch-node .an-count{font-size:11px;font-weight:700;color:var(--accent)}
</style>
</head>
<body>

<!-- â•â• LOGIN OVERLAY â•â• -->
<div class="login-overlay" id="loginOverlay" style="display:none">
  <div class="login-card">
    <div style="text-align:center;margin-bottom:20px">
      <div style="font-size:48px">ðŸ§ </div>
      <div style="font-family:Syne,sans-serif;font-weight:800;font-size:22px;background:linear-gradient(135deg,#7c3aed,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Consciousness OS</div>
      <div style="font-size:12px;color:#888;margin-top:4px">Your mind. Your data. Your evolution.</div>
    </div>

    <div class="login-tabs" id="loginTabs">
      <button class="login-tab-btn active" onclick="switchLoginTab('login',this)">Sign In</button>
      <button class="login-tab-btn" onclick="switchLoginTab('register',this)">Create Account</button>
      <button class="login-tab-btn" onclick="switchLoginTab('guest',this)">Guest</button>
    </div>

    <!-- SIGN IN -->
    <div id="loginPanel">
      <div style="margin-bottom:12px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Username or Email</label>
        <input type="text" id="loginUser" class="form-input" placeholder="Enter username or email" style="background:#f8f6ff;border:1.5px solid #e2d9f3">
      </div>
      <div style="margin-bottom:16px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Password</label>
        <input type="password" id="loginPass" class="form-input" placeholder="Enter password" style="background:#f8f6ff;border:1.5px solid #e2d9f3" onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <button class="btn btn-primary btn-block" onclick="doLogin()" style="margin-bottom:10px">ðŸ” Sign In</button>
      <div style="text-align:center;font-size:12px;color:#888;margin-bottom:12px">â€” or â€”</div>
      <button class="btn btn-block" onclick="doGoogleLogin()" style="background:#fff;border:1.5px solid #ddd;color:#333;margin-bottom:8px">ðŸ”µ Continue with Google</button>
      <button class="btn btn-block" onclick="doPhoneLogin()" style="background:#fff;border:1.5px solid #ddd;color:#333">ðŸ“± Sign in with Phone</button>
    </div>

    <!-- REGISTER -->
    <div id="registerPanel" style="display:none">
      <div style="margin-bottom:10px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Full Name</label>
        <input type="text" id="regName" class="form-input" placeholder="Your name" style="background:#f8f6ff;border:1.5px solid #e2d9f3">
      </div>
      <div style="margin-bottom:10px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Username</label>
        <input type="text" id="regUser" class="form-input" placeholder="Choose a username" style="background:#f8f6ff;border:1.5px solid #e2d9f3">
      </div>
      <div style="margin-bottom:10px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Email (optional)</label>
        <input type="email" id="regEmail" class="form-input" placeholder="your@email.com" style="background:#f8f6ff;border:1.5px solid #e2d9f3">
      </div>
      <div style="margin-bottom:10px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Phone (optional)</label>
        <div style="display:flex;gap:6px">
          <select class="form-select" id="regCountry" style="width:90px;flex-shrink:0;background:#f8f6ff">
            <option>+91</option><option>+1</option><option>+44</option><option>+61</option><option>+81</option>
          </select>
          <input type="tel" class="form-input" id="regPhone" placeholder="Phone number" style="background:#f8f6ff;border:1.5px solid #e2d9f3">
        </div>
      </div>
      <div style="margin-bottom:10px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Password</label>
        <input type="password" id="regPass" class="form-input" placeholder="Create a password" style="background:#f8f6ff;border:1.5px solid #e2d9f3">
      </div>
      <div style="margin-bottom:14px">
        <label style="font-size:12px;font-weight:700;color:#666;display:block;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px">Avatar</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'ðŸ§ ')" class="avatar-opt">ðŸ§ </span>
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'ðŸŒŸ')" class="avatar-opt">ðŸŒŸ</span>
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'ðŸ”®')" class="avatar-opt">ðŸ”®</span>
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'ðŸŒ™')" class="avatar-opt">ðŸŒ™</span>
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'âš¡')" class="avatar-opt">âš¡</span>
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'ðŸ¦‹')" class="avatar-opt">ðŸ¦‹</span>
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'ðŸŒ¸')" class="avatar-opt">ðŸŒ¸</span>
          <span style="font-size:24px;cursor:pointer;padding:4px;border-radius:8px;border:2px solid transparent" onclick="selAvatar(this,'ðŸ”ï¸')" class="avatar-opt">ðŸ”ï¸</span>
        </div>
        <input type="hidden" id="regAvatar" value="ðŸ§ ">
      </div>
      <button class="btn btn-primary btn-block" onclick="doRegister()">âœ¨ Create Account</button>
    </div>

    <!-- GUEST -->
    <div id="guestPanel" style="display:none">
      <div style="background:rgba(124,58,237,.08);border-radius:14px;padding:16px;margin-bottom:16px;text-align:center">
        <div style="font-size:36px;margin-bottom:8px">ðŸ”’</div>
        <div style="font-size:14px;font-weight:700;margin-bottom:6px">Guest / Private Mode</div>
        <div style="font-size:12px;color:#888;line-height:1.6">Your data stays on this device only. No account needed. You can create an account later to sync your data.</div>
      </div>
      <button class="btn btn-primary btn-block" onclick="guestMode()" style="margin-bottom:8px">ðŸš€ Continue as Guest</button>
      <div id="phoneLoginSection" style="margin-top:12px;border-top:1px solid #eee;padding-top:12px">
        <div style="font-size:13px;font-weight:700;margin-bottom:8px">ðŸ“± Quick Phone Signup</div>
        <div style="display:flex;gap:6px;margin-bottom:8px">
          <select class="form-select" id="guestPhoneCC" style="width:80px;flex-shrink:0;background:#f8f6ff"><option>+91</option><option>+1</option><option>+44</option></select>
          <input type="tel" class="form-input" id="guestPhone" placeholder="Phone number" style="background:#f8f6ff">
        </div>
        <button class="btn btn-secondary btn-block" onclick="phoneQuickSignup()">ðŸ“² Send OTP</button>
        <div id="otpSection" style="display:none;margin-top:10px">
          <input type="number" class="form-input" id="otpInput" placeholder="Enter 6-digit OTP" style="text-align:center;font-size:18px;font-weight:700;letter-spacing:6px;margin-bottom:8px">
          <button class="btn btn-primary btn-block" onclick="verifyOTP()">âœ… Verify & Enter</button>
        </div>
      </div>
    </div>

    <div id="loginMsg" style="margin-top:10px;font-size:13px;text-align:center;min-height:20px;color:var(--danger)"></div>
    <div style="text-align:center;margin-top:12px;font-size:11px;color:#aaa">By continuing, you agree to our <a href="#" onclick="openLegal('terms')" style="color:#7c3aed">Terms</a> & <a href="#" onclick="openLegal('privacy')" style="color:#7c3aed">Privacy Policy</a></div>
  </div>
</div>

<!-- â•â• LEGAL PAGES OVERLAY â•â• -->
<div class="legal-page-overlay" id="legalPageOverlay">
  <div class="legal-page-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <h2 id="legalPageTitle">Legal</h2>
      <button onclick="closeLegalPage()" style="background:var(--bg3);border:none;border-radius:8px;padding:6px 12px;cursor:pointer;font-size:16px">âœ•</button>
    </div>
    <div id="legalPageContent" style="font-size:13px;color:var(--text2);line-height:1.75"></div>
  </div>
</div>

<!-- â•â• TOPBAR â•â• -->
<div class="topbar">
  <!-- Row 1: Brand + Quick Actions -->
  <div class="topbar-row1">
    <div class="topbar-brand">ðŸ§  Consciousness OS</div>
    <div class="topbar-quick">
      <select class="lang-sel" id="langSel" onchange="setLang(this.value)" title="Language">
        <option value="en">ðŸŒ EN</option>
        <option value="hi">ðŸ‡®ðŸ‡³ HI</option>
        <option value="es">ðŸ‡ªðŸ‡¸ ES</option>
        <option value="fr">ðŸ‡«ðŸ‡· FR</option>
        <option value="de">ðŸ‡©ðŸ‡ª DE</option>
        <option value="pt">ðŸ‡§ðŸ‡· PT</option>
        <option value="zh">ðŸ‡¨ðŸ‡³ ZH</option>
        <option value="ar">ðŸ‡¸ðŸ‡¦ AR</option>
        <option value="ja">ðŸ‡¯ðŸ‡µ JA</option>
        <option value="ru">ðŸ‡·ðŸ‡º RU</option>
      </select>
      <button class="tb-btn" onclick="toggleTheme()" id="themeBtn" title="Toggle theme">ðŸŒ™</button>
      <button class="tb-btn" onclick="exportData()" title="Export">ðŸ’¾</button>
      <button class="tb-btn" onclick="openProfileSwitcher()" id="profileTopBtn" title="Switch Profile">ðŸ‘¤</button>
    </div>
  </div>
  <!-- Row 2: Guide Navigation integrated + other actions -->
  <div class="topbar-row2" id="topbarRow2">
    <span class="guide-label">â“ GUIDE</span>
    <button class="guide-pill" onclick="switchTab('guide');scrollToGuideSection('what')">What is This</button>
    <button class="guide-pill" onclick="switchTab('guide');scrollToGuideSection('how')">ðŸš€ How to Use</button>
    <button class="guide-pill" onclick="switchTab('guide');scrollToGuideSection('waves')">ðŸŒŠ 6 Waves</button>
    <button class="guide-pill" onclick="switchTab('guide');scrollToGuideSection('map')">ðŸ—ºï¸ Nav Map</button>
    <button class="guide-pill" onclick="switchTab('guide');scrollToGuideSection('questions')">ðŸ§¬ Deep Q</button>
    <button class="guide-skip" onclick="switchTab('log')" title="Skip guide and start logging">â­ Skip Guide</button>
    <div class="guide-pill gp-divider">|</div>
    <button class="tb-btn" onclick="switchTab('world')" title="News & World">ðŸŒ News</button>
    <button class="tb-btn" onclick="switchTab('science')" title="Science Feed">ðŸ”¬ Science</button>
    <button class="tb-btn" onclick="showOnboarding()" title="App onboarding">âœ¨ Tour</button>
  </div>
</div>

<!-- â”€â”€ PROFILE BAR (shown below topbar when clicked) â”€â”€ -->
<div id="profileBar" style="display:none;position:fixed;top:var(--topbar-h);left:0;right:0;z-index:190;background:var(--bg2);border-bottom:1px solid var(--border);box-shadow:0 4px 12px rgba(0,0,0,.08)">
  <div class="profile-bar" id="profileBarInner"></div>
</div>

<!-- â•â• MAIN CONTENT â•â• -->
<div class="main">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 0 â€” GUIDE (WHAT IS THIS APP & HOW TO USE IT)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-guide">
  <div id="guideSection-what" style="background:linear-gradient(135deg,var(--primary),var(--pink));border-radius:16px;padding:24px 20px;margin-bottom:0px;color:#fff;text-align:center">
    <div style="font-size:52px;margin-bottom:10px">ðŸ§ </div>
    <div style="font-family:Syne,sans-serif;font-size:22px;font-weight:800;margin-bottom:6px">Consciousness OS</div>
    <div style="font-size:13px;opacity:0.9;line-height:1.6">Your personal system for engineering consciousness, optimizing mental performance, and expanding the range of human experience.</div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">â“</span> What is this app?</div>
    <div id="guideSection-how" style="font-size:13px;color:var(--text2);line-height:1.7">
      <strong style="color:var(--text)">Consciousness OS</strong> is your cognitive operating system â€” a scientific and experiential toolkit that lets you track, understand, and intentionally shift your mental states. Think of it as a <em>dashboard for your mind</em>, combining passive sensing, AI coaching, brainwave audio, dream engineering, and frontier science.
      <br><br>
      Just as you might track your body with fitness apps, this app tracks and optimizes your <em>inner world</em> â€” your focus, creativity, stress, flow, sleep quality, and consciousness itself.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸš€</span> How to get better using this app</div>
    <div style="display:flex;flex-direction:column;gap:12px">
      <div style="display:flex;gap:12px;align-items:flex-start;background:var(--bg3);border-radius:10px;padding:12px">
        <div style="font-size:24px;flex-shrink:0">1ï¸âƒ£</div>
        <div><div style="font-weight:700;font-size:14px">Fill your Daily Log each day</div><div style="font-size:12px;color:var(--text3);margin-top:3px">Rate your consciousness metrics. The more you log, the smarter your AI becomes. Takes 2 minutes.</div></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;background:var(--bg3);border-radius:10px;padding:12px">
        <div style="font-size:24px;flex-shrink:0">2ï¸âƒ£</div>
        <div><div style="font-weight:700;font-size:14px">Listen to Brainwave Audio</div><div style="font-size:12px;color:var(--text3);margin-top:3px">Use headphones. Alpha for calm focus. Beta for high performance. Theta for creativity. Delta for deep sleep.</div></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;background:var(--bg3);border-radius:10px;padding:12px">
        <div style="font-size:24px;flex-shrink:0">3ï¸âƒ£</div>
        <div><div style="font-weight:700;font-size:14px">Chat with the AI Hub</div><div style="font-size:12px;color:var(--text3);margin-top:3px">Ask your AI twin anything â€” it analyzes your pattern data and gives personalized insights, like a cognitive coach.</div></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;background:var(--bg3);border-radius:10px;padding:12px">
        <div style="font-size:24px;flex-shrink:0">4ï¸âƒ£</div>
        <div><div style="font-weight:700;font-size:14px">Use the State Transition Engine</div><div style="font-size:12px;color:var(--text3);margin-top:3px">Tell it your current state and target state. It will prescribe audio, breathing, and tasks to shift your consciousness.</div></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;background:var(--bg3);border-radius:10px;padding:12px">
        <div style="font-size:24px;flex-shrink:0">5ï¸âƒ£</div>
        <div><div style="font-weight:700;font-size:14px">Log your dreams every morning</div><div style="font-size:12px;color:var(--text3);margin-top:3px">Within 60 seconds of waking. This builds your lucid dreaming skill and expands your dream recall dramatically.</div></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;background:var(--bg3);border-radius:10px;padding:12px">
        <div style="font-size:24px;flex-shrink:0">6ï¸âƒ£</div>
        <div><div style="font-weight:700;font-size:14px">Read the Science tab daily</div><div style="font-size:12px;color:var(--text3);margin-top:3px">Frontier discoveries across neuroscience, AI, longevity & space â€” updated with real dates so you always know what's current.</div></div>
      </div>
    </div>
  </div>

  <div class="card" id="guideSection-waves">
    <div class="card-title"><span class="emoji">âš¡</span> The 6 Consciousness Waves</div>
    <div style="display:flex;flex-direction:column;gap:8px">
      <div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.25);border-radius:10px;padding:12px">
        <div style="font-weight:700;font-size:13px;color:var(--primary)">ðŸŒŠ Wave 1 â€” Passive Cognition Sensing</div>
        <div style="font-size:12px;color:var(--text3);margin-top:4px">The app automatically detects your mental state from typing speed, session length, idle gaps, and interaction patterns â€” without you doing anything.</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.25);border-radius:10px;padding:12px">
        <div style="font-weight:700;font-size:13px;color:var(--primary)">ðŸŒŠ Wave 2 â€” State Transition Engine</div>
        <div style="font-size:12px;color:var(--text3);margin-top:4px">It measures the gap between your current cognitive state and target state, then selects the optimal protocol: audio type, breathing pattern, and task intensity to bridge the gap.</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.25);border-radius:10px;padding:12px">
        <div style="font-weight:700;font-size:13px;color:var(--primary)">ðŸŒŠ Wave 3 â€” Adaptive Audio Induction</div>
        <div style="font-size:12px;color:var(--text3);margin-top:4px">The brainwave audio adapts in real time â€” if focus rises, beta increases; if stress rises, alpha kicks in. A living, closed-loop consciousness modulator.</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.25);border-radius:10px;padding:12px">
        <div style="font-weight:700;font-size:13px;color:var(--primary)">ðŸŒŠ Wave 4 â€” Immersive Experience Layer</div>
        <div style="font-size:12px;color:var(--text3);margin-top:4px">Enter a fullscreen sensory mode â€” dark visuals, guided imagery, and dreamlike ambient experience to move from interface to inner world.</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.25);border-radius:10px;padding:12px">
        <div style="font-weight:700;font-size:13px;color:var(--primary)">ðŸŒŠ Wave 5 â€” Lucid Probability Model</div>
        <div style="font-size:12px;color:var(--text3);margin-top:4px">Based on your dream logs, reality checks, sleep timing, and recall frequency â€” it predicts your lucid dreaming probability tonight as a live percentage.</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.25);border-radius:10px;padding:12px">
        <div style="font-weight:700;font-size:13px;color:var(--primary)">ðŸŒŠ Wave 6 â€” Experience Diversity Engine</div>
        <div style="font-size:12px;color:var(--text3);margin-top:4px">Tracks all unique emotional, cognitive, and dream states you've experienced. Actively guides you toward unexplored territory to expand your consciousness range.</div>
      </div>
    </div>
  </div>

  <div class="card" id="guideSection-map">
    <div class="card-title"><span class="emoji">ðŸ—ºï¸</span> Navigation Map</div>
    <div id="guideNavMap" style="display:grid;grid-template-columns:1fr 1fr;gap:8px"></div>
  </div>

  <!-- â”€â”€ NEW: DEEP FUNDAMENTAL QUESTIONS â”€â”€ -->
  <div class="card" id="guideSection-questions" style="border:2px solid rgba(124,58,237,.3);background:linear-gradient(135deg,rgba(124,58,237,.06),rgba(192,64,255,.06))">
    <div class="card-title"><span class="emoji">ðŸ§¬</span> The Deepest Questions of Consciousness</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:14px;line-height:1.6;font-style:italic">"These are not questions about the world. These are questions about the questioner itself."</div>

    <div style="display:flex;flex-direction:column;gap:10px">

      <div style="background:var(--bg3);border-left:3px solid var(--primary);border-radius:0 10px 10px 0;padding:12px;cursor:pointer" onclick="expandQ(this)">
        <div style="font-weight:700;font-size:13px;color:var(--primary);margin-bottom:6px">ðŸŒ€ Q1: Who is thinking what I am thinking?</div>
        <div style="font-size:12px;color:var(--text3)">Tap to explore â–¼</div>
        <div class="q-answer" style="display:none;margin-top:10px;font-size:13px;color:var(--text2);line-height:1.75">
          <strong>The Paradox:</strong> "If I am thinking what I am thinking â€” then what am I thinking? Who is the one thinking it? And who is listening to the thought being thought?"<br><br>
          <strong>The Observer Problem:</strong> When you ask "what am I thinking?" â€” that question is itself a thought. But then something is observing that question-thought. What is that observer? Is it another thought? Or is it something prior to all thoughts?<br><br>
          <strong>What Science Says:</strong> The prefrontal cortex generates meta-cognition (thinking about thinking). But the subjective experience of that awareness â€” the feeling of "I know that I am thinking" â€” cannot be explained by neural activity alone. This is the Hard Problem of Consciousness.<br><br>
          <strong>What Philosophy Says:</strong> Descartes said "I think, therefore I am" â€” but he missed: <em>Who is the 'I' that's claiming to think?</em> Every thought requires a thinker. Every observation requires an observer. But who observes the observer?<br><br>
          <strong>The Answer:</strong> There is no separate "self" thinking. Thinking happens. Awareness happens. The sense of "me" is itself another pattern within awareness â€” not the source of awareness. You are the screen on which thoughts appear, not the thoughts themselves.
        </div>
      </div>

      <div style="background:var(--bg3);border-left:3px solid var(--accent);border-radius:0 10px 10px 0;padding:12px;cursor:pointer" onclick="expandQ(this)">
        <div style="font-weight:700;font-size:13px;color:var(--accent);margin-bottom:6px">ðŸ§  Q2: If my brain wants to know about my brain</div>
        <div style="font-size:12px;color:var(--text3)">Tap to explore â–¼</div>
        <div class="q-answer" style="display:none;margin-top:10px;font-size:13px;color:var(--text2);line-height:1.75">
          <strong>The Self-Reference Paradox:</strong> "If my brain is trying to understand my brain â€” then the instrument of understanding IS the thing being understood. Can a camera photograph itself perfectly? Can a knife cut itself?"<br><br>
          <strong>The Loop:</strong> Your neurons fire to create the thought "I want to understand neurons." But those neurons don't see themselves firing. They ARE the firing. It's like asking your eyes to see themselves directly â€” not in a mirror, but literally look at themselves.<br><br>
          <strong>Kurt GÃ¶del showed:</strong> Any sufficiently complex system cannot fully prove its own completeness from within itself. Your brain is the ultimate example â€” it is trying to fully model a system (itself) that is doing the modeling. This creates a fundamental limit to self-knowledge.<br><br>
          <strong>The Space Where This Points:</strong> There must be something that is AWARE of the brain's attempt to understand itself â€” something that is not itself a brain process, but the witnessing presence that contains even the brain's activity. That is what this app helps you access.
        </div>
      </div>

      <div style="background:var(--bg3);border-left:3px solid var(--pink);border-radius:0 10px 10px 0;padding:12px;cursor:pointer" onclick="expandQ(this)">
        <div style="font-weight:700;font-size:13px;color:var(--pink);margin-bottom:6px">âš¡ Q3: Who orders the neurons? Who listens?</div>
        <div style="font-size:12px;color:var(--text3)">Tap to explore â–¼</div>
        <div class="q-answer" style="display:none;margin-top:10px;font-size:13px;color:var(--text2);line-height:1.75">
          <strong>The Command Paradox:</strong> "If my brain tells my neurons to fire â€” what tells the brain? And if the brain is making that decision, what part of the brain? And what tells THAT part?"<br><br>
          <strong>The Chain Never Ends:</strong> There is no "chief neuron" giving orders. Neurons fire in cascading patterns. No single neuron is in charge. So who made the decision? The decision seems to emerge from the whole â€” but who is the whole? And who experiences the whole as "me"?<br><br>
          <strong>The Listener Problem:</strong> When you think "stop firing" â€” neurons must fire to generate that command. So stopping requires doing. Silence requires activity. The command to be quiet makes noise. Who sees this contradiction?<br><br>
          <strong>What This Points To:</strong> There is an awareness that is prior to the command-structure. It witnesses all of it â€” the commanding, the firing, the stopping, the confusion. That awareness is not a neuron, not a thought, not a brain state. It is the space in which all of these arise. YOU are that space.
        </div>
      </div>

      <div style="background:var(--bg3);border-left:3px solid var(--success);border-radius:0 10px 10px 0;padding:12px;cursor:pointer" onclick="expandQ(this)">
        <div style="font-weight:700;font-size:13px;color:var(--success);margin-bottom:6px">ðŸŒŒ Q4: Where do firing signals go after death?</div>
        <div style="font-size:12px;color:var(--text3)">Tap to explore â–¼</div>
        <div class="q-answer" style="display:none;margin-top:10px;font-size:13px;color:var(--text2);line-height:1.75">
          <strong>The Physics Perspective:</strong> Energy is never destroyed â€” only transformed. The electrical energy in neural firing converts to heat, diffuses into the biochemical environment. The atoms that formed your neurons will eventually become part of soil, water, other organisms, perhaps stars.<br><br>
          <strong>The Information Question:</strong> Some physicists (like Roger Penrose) suggest consciousness may be linked to quantum processes (Orchestrated Objective Reduction theory). If so, the question becomes: does the quantum information collapse completely, or does some pattern persist in some form?<br><br>
          <strong>The Consciousness Question:</strong> If you are the awareness that witnesses the firing â€” not the firing itself â€” then when firing stops, does the witness stop? Many traditions say no. Many scientists don't know. The honest answer is: we don't fully know what consciousness is, so we can't fully know what happens to it.<br><br>
          <strong>What We Do Know:</strong> The "you" that asks this question is not the neuron firing. It is the awareness aware of neurons. Whether that awareness is produced by neurons (materialist view) or is fundamental and the neurons are its expression (idealist view) remains the greatest open question in science.
        </div>
      </div>

      <div style="background:var(--bg3);border-left:3px solid var(--warning);border-radius:0 10px 10px 0;padding:12px;cursor:pointer" onclick="expandQ(this)">
        <div style="font-weight:700;font-size:13px;color:var(--warning);margin-bottom:6px">ðŸ”® Q5: Who is giving order to whom?</div>
        <div style="font-size:12px;color:var(--text3)">Tap to explore â–¼</div>
        <div class="q-answer" style="display:none;margin-top:10px;font-size:13px;color:var(--text2);line-height:1.75">
          <strong>The Hierarchy Paradox:</strong> We say "I decided to move my hand." But brain scans show the motor cortex prepares movement 0.3â€“0.5 seconds BEFORE you consciously decide. So who decided first â€” you or your brain? And if your brain decided without "you" â€” then who is "you"?<br><br>
          <strong>The Libet Experiment:</strong> Benjamin Libet's famous experiment showed that conscious intention comes AFTER brain preparation. This suggests the "I" that thinks it's in command may actually be a post-hoc narrator, not the true initiator. A "story-teller" that claims credit for events already in motion.<br><br>
          <strong>The Levels of Command:</strong> Autonomic nervous system (heartbeat, digestion) runs without any input from "you." Reflexes bypass conscious command entirely. Habits run automatically. So "you" only consciously command a fraction of body activity â€” yet claim to be in full control.<br><br>
          <strong>The Liberation:</strong> If this is true â€” then trying to control everything is futile. The deeper intelligence is the one already running the show. Your job may not be to command â€” but to align, to observe, and to allow the deeper intelligence to operate with minimal interference. That is what meditation reveals.
        </div>
      </div>

    </div>

    <div style="margin-top:14px;background:rgba(124,58,237,.08);border-radius:10px;padding:12px;font-size:12px;color:var(--text3);text-align:center">
      ðŸ’¡ Ask the AI Hub these questions for a personalized deep dive into your own consciousness
    </div>
  </div>

  <div style="text-align:center;margin-bottom:14px">
    <button class="btn btn-primary" onclick="switchTab('log')">âœ¨ Start Your First Log â†’</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 1 â€” DAILY CONSCIOUSNESS LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel active" id="tab-log">
  <div class="section-header">ðŸ“ <span data-t="daily_log">Daily Consciousness Log</span></div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ“…</span> <span data-t="entry_info">Entry Info</span></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label" data-t="date">Date</label>
        <input type="date" class="form-input" id="logDate"></div>
      <div class="form-group"><label class="form-label" data-t="time_of_day">Time of Day</label>
        <select class="form-select" id="logTime">
          <option value="morning">ðŸŒ… Morning</option>
          <option value="afternoon">â˜€ï¸ Afternoon</option>
          <option value="evening">ðŸŒ† Evening</option>
          <option value="night">ðŸŒ™ Night</option>
        </select></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label" data-t="activity">Activity</label>
        <select class="form-select" id="logActivity">
          <option>Deep Work</option><option>Exercise</option><option>Rest</option><option>Social</option><option>Learning</option><option>Creative</option><option>Meditation</option><option>Entertainment</option>
        </select></div>
      <div class="form-group"><label class="form-label">Brainwave State</label>
        <select class="form-select" id="logBrainwave">
          <option>Alpha (Relaxed Focus)</option><option>Beta (Active Thinking)</option><option>Gamma (Peak Performance)</option><option>Theta (Creativity/Dream)</option><option>Delta (Deep Rest)</option>
        </select></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸŽšï¸</span> <span data-t="consciousness_metrics">Consciousness Metrics</span></div>
    <div id="slidersContainer"></div>
    <div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px">
      <div style="font-size:13px;color:var(--text2)">Consciousness Score</div>
      <div class="score-ring">
        <svg width="80" height="80" viewBox="0 0 80 80">
          <circle cx="40" cy="40" r="34" fill="none" stroke="var(--border)" stroke-width="7"/>
          <circle id="scoreCircle" cx="40" cy="40" r="34" fill="none" stroke="var(--primary)" stroke-width="7"
            stroke-dasharray="213.6" stroke-dashoffset="213.6" stroke-linecap="round"/>
        </svg>
        <div class="ring-text"><span id="scoreValue">0.0</span><span class="ring-sub">/ 10</span></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ§˜</span> Inner State</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Dominant Emotion</label>
        <select class="form-select" id="logEmotion">
          <option>Joy</option><option>Calm</option><option>Curious</option><option>Focused</option><option>Creative</option><option>Anxious</option><option>Frustrated</option><option>Tired</option><option>Inspired</option><option>Grateful</option><option>Melancholy</option><option>Excited</option><option>Neutral</option>
        </select></div>
      <div class="form-group"><label class="form-label">Physical Sensation</label>
        <select class="form-select" id="logSensation">
          <option>Energized</option><option>Relaxed</option><option>Tense</option><option>Heavy</option><option>Light</option><option>Neutral</option><option>Achy</option><option>Vibrant</option>
        </select></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">âœï¸</span> Reflections</div>
    <div class="form-group"><label class="form-label">Raw Thoughts / Stream of Consciousness</label>
      <textarea class="form-textarea" id="logThought" placeholder="What's on your mind right now?"></textarea></div>
    <div class="form-group"><label class="form-label">Key Insight Today</label>
      <textarea class="form-textarea" id="logInsight" style="min-height:60px" placeholder="What did you realize?"></textarea></div>
    <div class="form-group"><label class="form-label">Current Goal</label>
      <input type="text" class="form-input" id="logGoal" placeholder="What are you working toward?"></div>
    <div class="form-group"><label class="form-label">Main Obstacle</label>
      <input type="text" class="form-input" id="logObstacle" placeholder="What's blocking you?"></div>
    <div class="form-group"><label class="form-label">Gratitude</label>
      <input type="text" class="form-input" id="logGratitude" placeholder="3 things you're grateful for..."></div>
    <div class="form-group"><label class="form-label">Recurring Pattern / Observation</label>
      <input type="text" class="form-input" id="logPattern" placeholder="Any recurring themes?"></div>
    <div class="form-group"><label class="form-label">Key Action to Take</label>
      <input type="text" class="form-input" id="logAction" placeholder="One concrete action step"></div>
  </div>

  <button class="btn btn-primary btn-block" onclick="saveLog()" style="margin-bottom:14px">
    âœ¨ <span data-t="save_entry">Save Entry</span>
  </button>

  <div class="card" id="recentLogsCard">
    <div class="card-title"><span class="emoji">ðŸ“‹</span> Recent Entries</div>
    <div id="recentLogs"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 2 â€” BRAINWAVE AUDIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-waves">
  <div class="section-header">ðŸŽµ Brainwave Audio Lab</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸŽ§</span> Now Playing</div>
    <div style="text-align:center;margin-bottom:12px">
      <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary)" id="bwNowName">Select a session below</div>
      <div style="font-size:12px;color:var(--text3);margin-top:3px" id="bwNowDesc">Binaural beats & frequencies for mind enhancement</div>
      <div style="font-size:11px;color:var(--accent);margin-top:2px" id="bwNowFreq"></div>
    </div>
    <div class="bw-visualizer" id="bwVisualizer">
      <div style="color:var(--text3);font-size:12px">â–¶ Press Play to begin</div>
    </div>
    <div class="bw-controls">
      <button class="btn btn-secondary btn-sm" onclick="bwPrevTrack()">â®</button>
      <button class="btn btn-primary" id="bwPlayBtn" onclick="toggleBW()">â–¶ Play</button>
      <button class="btn btn-secondary btn-sm" onclick="bwNextTrack()">â­</button>
      <input type="range" class="bw-vol" id="bwVol" min="0" max="100" value="60" oninput="setBWVol(this.value)" title="Volume">
      <span style="font-size:16px">ðŸ”Š</span>
      <span class="bw-timer" id="bwTimer">00:00</span>
    </div>

    <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px">Wave Type:</div>
    <div class="wave-type-btns">
      <button class="wave-btn active" onclick="setBWType('binaural',this)">ðŸŽ§ Binaural Beats</button>
      <button class="wave-btn" onclick="setBWType('isochronic',this)">ðŸ“³ Isochronic</button>
      <button class="wave-btn" onclick="setBWType('solfeggio',this)">ðŸŽµ Solfeggio</button>
      <button class="wave-btn" onclick="setBWType('whitenoise',this)">ðŸŒŠ White Noise</button>
    </div>
    <div style="background:rgba(124,58,237,.08);border-radius:10px;padding:10px;font-size:12px;color:var(--text2);margin-top:8px">
      âš ï¸ <strong>Use headphones</strong> for binaural beats to work properly. Each ear needs to hear a slightly different frequency.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ§ </span> Brainwave Sessions</div>
    <div class="bw-grid" id="bwGrid"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ“š</span> What Are Brainwaves?</div>
    <div id="bwEducation"></div>
  </div>

  <!-- â”€â”€ STATE TRANSITION ENGINE (Wave 2) â”€â”€ -->
  <div class="card" style="border:2px solid var(--primary)">
    <div class="card-title"><span class="emoji">ðŸŒŠ</span> State Transition Engine</div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:12px">Tell the engine where you are and where you want to go â€” it will prescribe the optimal protocol.</div>
    <div class="form-row" style="margin-bottom:10px">
      <div class="form-group">
        <label class="form-label">Current State</label>
        <select class="form-select" id="stateFrom">
          <option value="foggy">ðŸŒ«ï¸ Foggy / Scattered</option>
          <option value="anxious">ðŸ˜° Anxious / Stressed</option>
          <option value="tired">ðŸ˜´ Tired / Low Energy</option>
          <option value="distracted">ðŸ“± Distracted</option>
          <option value="calm" selected>ðŸ˜Œ Calm / Neutral</option>
          <option value="focused">ðŸŽ¯ Already Focused</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Target State</label>
        <select class="form-select" id="stateTo">
          <option value="flow">âš¡ Deep Flow</option>
          <option value="creative">ðŸŽ¨ Creative Spark</option>
          <option value="calm">ðŸ§˜ Deep Calm</option>
          <option value="energized">ðŸ”¥ High Energy</option>
          <option value="sleep">ðŸŒ™ Sleep Ready</option>
          <option value="meditative">ðŸ•‰ï¸ Meditative</option>
        </select>
      </div>
    </div>
    <button class="btn btn-primary btn-block" onclick="runStateEngine()">âš¡ Compute Transition Protocol</button>
    <div id="stateEngineResult" style="margin-top:12px"></div>
  </div>

  <!-- â”€â”€ ADAPTIVE AUDIO (Wave 3) â”€â”€ -->
  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ”„</span> Adaptive Audio Mode (Wave 3)</div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:10px">The app monitors your session behavior and automatically adjusts brainwave frequencies to match your real-time cognitive state.</div>
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
      <div class="toggle" id="adaptiveToggle" onclick="toggleAdaptiveMode()"></div>
      <span style="font-size:13px;font-weight:600">Adaptive Mode</span>
      <span style="flex:1"></span>
      <span style="font-size:12px;color:var(--text3)" id="adaptiveStatus">OFF</span>
    </div>
    <div id="adaptiveLog" style="font-size:12px;color:var(--text3);min-height:36px;background:var(--bg3);border-radius:8px;padding:8px">Enable adaptive mode to start auto-adjustment logging...</div>
  </div>

  <!-- â”€â”€ IMMERSIVE EXPERIENCE (Wave 4) â”€â”€ -->
  <div class="card">
    <div class="card-title"><span class="emoji">ðŸŒŒ</span> Immersive Experience Mode (Wave 4)</div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:10px">Enter a fullscreen sensory environment â€” dark visuals, guided imagery, and consciousness-expanding phrases. Phone screen becomes your inner world.</div>
    <div class="form-row" style="margin-bottom:10px">
      <div>
        <label class="form-label">Experience Type</label>
        <select class="form-select" id="immersiveType">
          <option value="focus">ðŸŽ¯ Deep Focus</option>
          <option value="meditation">ðŸ§˜ Meditation</option>
          <option value="creative">ðŸŽ¨ Creative Vision</option>
          <option value="dream">ðŸŒ™ Pre-Sleep</option>
          <option value="flow">âš¡ Flow State</option>
        </select>
      </div>
      <div>
        <label class="form-label">Duration</label>
        <select class="form-select" id="immersiveDuration">
          <option value="5">5 min</option>
          <option value="10" selected>10 min</option>
          <option value="20">20 min</option>
          <option value="30">30 min</option>
        </select>
      </div>
    </div>
    <button class="btn btn-primary btn-block" onclick="startImmersive()">ðŸŒŒ Enter Immersive Mode</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 3 â€” AI HUB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-ai">
  <div class="section-header">ðŸ¤– AI Hub</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ”€</span> Select AI Model</div>
    <div class="ai-models-bar" id="aiModelsBar"></div>
    <div style="display:flex;align-items:center;gap:8px;margin-top:8px;flex-wrap:wrap">
      <button class="btn btn-secondary btn-sm" id="compareAllBtn" onclick="toggleCompareMode()" style="border:1.5px solid #2563eb;color:#2563eb;gap:5px">
        âš–ï¸ Compare All AIs
      </button>
      <div id="bestMatchInfo" style="font-size:11px;color:var(--text3);flex:1">ðŸ’¡ Different AI perspectives help reduce bias and give you multiple viewpoints.</div>
    </div>
  </div>

  <!-- Compare Mode Panel -->
  <div id="compareModePanel" style="display:none">
    <div class="card" style="border:2px solid #2563eb;background:linear-gradient(135deg,rgba(37,99,235,.06),rgba(124,58,237,.06))">
      <div class="card-title" style="color:#2563eb"><span class="emoji">âš–ï¸</span> Compare All AIs Mode <span style="font-size:11px;background:#2563eb;color:#fff;border-radius:20px;padding:2px 8px;margin-left:6px">ACTIVE</span></div>
      <div style="font-size:12px;color:var(--text3);margin-bottom:10px">Your question will be sent to ALL connected AIs simultaneously. Compare their answers side by side.</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px">
        <span style="font-size:11px;font-weight:700;color:var(--text2)">Best AI for topic:</span>
        <button class="wave-btn active" onclick="setBestMatch('general')">ðŸ§  General</button>
        <button class="wave-btn" onclick="setBestMatch('coding')">ðŸ’» Coding</button>
        <button class="wave-btn" onclick="setBestMatch('creativity')">ðŸŽ¨ Creative</button>
        <button class="wave-btn" onclick="setBestMatch('research')">ðŸ”¬ Research</button>
        <button class="wave-btn" onclick="setBestMatch('analysis')">ðŸ“Š Analysis</button>
      </div>
      <div id="bestMatchBadge" style="font-size:12px;color:var(--text3);margin-bottom:8px"></div>
      <textarea class="chat-input" id="compareInput" placeholder="Ask all AIs a question..." style="height:60px;width:100%;resize:none;margin-bottom:8px"></textarea>
      <button class="btn btn-primary btn-block" onclick="sendToAllAIs()" id="compareBtn">âš¡ Ask All AIs</button>
    </div>
    <div id="compareResults" style="display:grid;gap:10px;margin-bottom:14px"></div>
  </div>

  <div class="card">
    <div class="ai-tip-card" id="aiTipCard">
      ðŸ’¡ <strong>Daily Tip:</strong> <span id="aiDailyTip">Loading your personalized tip...</span>
    </div>
    <div class="chat-controls">
      <button class="btn btn-secondary btn-sm" onclick="clearAIChat()">ðŸ—‘ Clear</button>
      <button class="btn btn-secondary btn-sm" onclick="exportChat()">ðŸ’¾ Export</button>
      <span style="flex:1"></span>
      <span style="font-size:11px;color:var(--text3)" id="aiStatusLabel">Ready</span>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="suggested-qs" id="suggestedQs"></div>
    <div class="chat-input-area">
      <textarea class="chat-input" id="chatInput" placeholder="Ask me anything about your consciousness, health, dreams..." onkeydown="handleChatKey(event)" rows="1"></textarea>
      <button class="btn btn-primary" onclick="sendChat()" id="chatSendBtn">âž¤</button>
    </div>
  </div>

  <div class="card" id="aiInsightsCard">
    <div class="card-title"><span class="emoji">ðŸ“Š</span> AI Pattern Analysis</div>
    <div id="aiPatternDisplay"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ”‘</span> AI API Keys</div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:12px">Add your API keys to unlock real AI responses from ChatGPT, Gemini, Grok, Perplexity, and DeepSeek. Keys stored locally only.</div>
    <div id="apiKeysList">
      ${[{p:'openai',name:'OpenAI (ChatGPT)',emoji:'ðŸŸ¢'},{p:'google',name:'Google (Gemini)',emoji:'ðŸ”µ'},{p:'xai',name:'xAI (Grok)',emoji:'âš¡'},{p:'perplexity',name:'Perplexity AI',emoji:'ðŸ”'},{p:'deepseek',name:'DeepSeek',emoji:'ðŸŒŠ'}].map(({p,name,emoji})=>`
      <div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)">
        <span style="font-size:16px">${emoji}</span>
        <div style="flex:1"><div style="font-size:13px;font-weight:600">${name}</div><div style="font-size:11px;color:var(--text3)" id="keyStatus_${p}">No key set</div></div>
        <button class="btn btn-secondary btn-sm" onclick="setKeyUI('${p}')">Set Key</button>
        <button class="btn btn-sm" style="background:var(--danger);color:#fff" onclick="clearKey('${p}')">âœ•</button>
      </div>`).join('')}
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 4 â€” ANALYSIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-analysis">
  <div class="section-header">ðŸ“Š Analysis Dashboard</div>

  <div class="stats-grid">
    <div class="stat-box"><div class="sv" id="statMood">â€”</div><div class="sl">Avg Mood</div></div>
    <div class="stat-box"><div class="sv" id="statFocus">â€”</div><div class="sl">Avg Focus</div></div>
    <div class="stat-box"><div class="sv" id="statScore">â€”</div><div class="sl">Avg Score</div></div>
    <div class="stat-box"><div class="sv" id="statEntries">0</div><div class="sl">Entries</div></div>
    <div class="stat-box"><div class="sv" id="statFlow">â€”</div><div class="sl">Avg Flow</div></div>
    <div class="stat-box"><div class="sv" id="statCreativity">â€”</div><div class="sl">Creativity</div></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ”®</span> Predictions</div>
    <div id="predictionsArea"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ“ˆ</span> Trends (Last 10 vs Previous 10)</div>
    <div id="trendsArea"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ†</span> Personal Records</div>
    <div id="recordsArea"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ§©</span> Pattern Detection</div>
    <div id="patternsArea"></div>
  </div>

  <!-- WAVE 6 â€” EXPERIENCE DIVERSITY ENGINE -->
  <div class="card" style="border:2px solid var(--pink)">
    <div class="card-title"><span class="emoji">ðŸŒˆ</span> Experience Diversity Engine (Wave 6)</div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:12px">Track unique states you've experienced and discover unexplored territory in your consciousness.</div>
    <div id="diversityDisplay">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:12px">
        <div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--pink)" id="diversityEmotional">â€“</div>
          <div style="font-size:9px;color:var(--text3)">Emotional States</div>
        </div>
        <div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary)" id="diversityCognitive">â€“</div>
          <div style="font-size:9px;color:var(--text3)">Cognitive Modes</div>
        </div>
        <div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--accent)" id="diversityDream">â€“</div>
          <div style="font-size:9px;color:var(--text3)">Dream Types</div>
        </div>
      </div>
      <div style="margin-bottom:10px">
        <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px">States Experienced:</div>
        <div id="diversityStateCloud" style="display:flex;flex-wrap:wrap;gap:4px"></div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(236,72,153,.1),rgba(124,58,237,.1));border:1px solid rgba(236,72,153,.2);border-radius:10px;padding:10px">
        <div style="font-size:12px;font-weight:700;color:var(--pink);margin-bottom:6px">ðŸ§­ Expand Your Range</div>
        <div id="diversityRecommendation" style="font-size:12px;color:var(--text2);line-height:1.6">Log more entries to receive personalized state expansion recommendations.</div>
      </div>
    </div>
    <button class="btn btn-secondary btn-sm" onclick="computeDiversity()" style="margin-top:10px;width:100%">ðŸ”„ Refresh Diversity Map</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 5 â€” HEALTH PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-health">
  <div class="section-header">â¤ï¸ Health Profile</div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-size:13px;font-weight:700;color:var(--text2)">Section <span id="hsCurrent">1</span> of 18</div>
      <div style="font-size:12px;color:var(--text3)" id="hsSectionName">Demographics</div>
    </div>
    <div class="health-progress"><div class="health-progress-bar" id="hsProgressBar" style="width:5.5%"></div></div>
    <div style="font-size:11px;font-weight:700;color:var(--text2);margin-bottom:6px">Jump to section:</div>
    <div class="health-jump-bar" id="healthJumpBar"></div>
  </div>

  <div id="healthSectionsContainer"></div>

  <div class="health-nav-btns">
    <button class="btn btn-secondary" id="hsPrevBtn" onclick="hsPrev()" style="display:none">â† Previous</button>
    <div style="flex:1"></div>
    <button class="btn btn-primary" id="hsNextBtn" onclick="hsNext()">Next â†’</button>
  </div>

  <div class="card" id="aiDoctorCard" style="display:none;margin-top:14px">
    <div class="card-title"><span class="emoji">ðŸ‘¨â€âš•ï¸</span> AI Doctor Analysis</div>
    <div id="aiDoctorOutput"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 6 â€” BRAIN GAMES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-games">
  <div class="section-header">ðŸŽ® Brain Training</div>

  <div class="game-view active" id="gamesMenu">
    <div class="games-grid" id="gamesGrid"></div>
  </div>

  <!-- Game canvases will be injected here by JS -->
  <div id="gameContainer"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 7 â€” LUCID DREAMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-dreams">
  <div class="section-header">ðŸŒ™ Lucid Dreams Lab</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ“–</span> Log a Dream</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Date</label>
        <input type="date" class="form-input" id="dreamDate"></div>
      <div class="form-group"><label class="form-label">Dream Title</label>
        <input type="text" class="form-input" id="dreamTitle" placeholder="Give it a name..."></div>
    </div>
    <div class="form-group"><label class="form-label">Dream Type</label>
      <div class="dream-types">
        <button class="dream-type-btn active" onclick="setDreamType(this,'regular')">Regular</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'lucid')">âœ¨ Lucid</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'vivid')">ðŸŒˆ Vivid</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'nightmare')">ðŸ˜± Nightmare</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'recurring')">ðŸ”„ Recurring</button>
        <button class="dream-type-btn" onclick="setDreamType(this,'prophetic')">ðŸ”® Prophetic</button>
      </div>
      <input type="hidden" id="dreamType" value="regular">
    </div>
    <div class="form-group"><label class="form-label">Dream Description</label>
      <textarea class="form-textarea" id="dreamDesc" style="min-height:100px" placeholder="Describe your dream in detail â€” environments, characters, events, feelings..."></textarea></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Vividness (0â€“10)</label>
        <div class="slider-group" style="margin:0">
          <input type="range" class="slider-track" id="dreamVividness" min="0" max="10" value="5" oninput="updateSimpleSlider(this)">
          <div style="text-align:right;font-size:12px;color:var(--primary);font-weight:700" id="dreamVividnessVal">5</div>
        </div></div>
      <div class="form-group"><label class="form-label">Lucidity (0â€“10)</label>
        <div class="slider-group" style="margin:0">
          <input type="range" class="slider-track" id="dreamLucidity" min="0" max="10" value="0" oninput="updateSimpleSlider(this)">
          <div style="text-align:right;font-size:12px;color:var(--primary);font-weight:700" id="dreamLucidityVal">0</div>
        </div></div>
    </div>
    <div class="form-group"><label class="form-label">Dream Signs (things that show you're dreaming)</label>
      <input type="text" class="form-input" id="dreamSigns" placeholder="e.g., flying, talking animals, familiar place distorted..."></div>
    <div class="form-group"><label class="form-label">Emotions felt</label>
      <input type="text" class="form-input" id="dreamEmotions" placeholder="e.g., joy, fear, wonder, confusion..."></div>
    <button class="btn btn-primary btn-block" onclick="saveDream()" style="margin-top:6px">ðŸ’¾ Save Dream</button>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ¤–</span> AI Dream Analysis</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:10px">Save a dream above and get AI-powered analysis of symbols, themes, and lucid dreaming coaching.</div>
    <div id="dreamAIAnalysis">
      <div class="empty-state"><span class="es-icon">ðŸŒ™</span><div class="es-text">Log a dream to get personalized analysis</div></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸŽ¯</span> Lucid Dream Techniques</div>
    <div id="techniquesContainer"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">âœ‹</span> Reality Check Tracker</div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div style="font-size:13px;color:var(--text2)">Today's checks: <strong id="rcCount">0</strong> / 15</div>
      <button class="btn btn-secondary btn-sm" onclick="resetRC()">Reset Day</button>
    </div>
    <div class="progress-bar-wrap" style="margin-bottom:12px"><div class="progress-bar-fill" id="rcProgress" style="width:0%"></div></div>
    <div class="reality-check-grid" id="rcGrid"></div>
    <div style="font-size:12px;color:var(--text3);margin-top:10px;line-height:1.5">
      ðŸ”‘ <strong>What are reality checks?</strong> They are habits you do while awake to question if you're dreaming. Do them enough times while awake, and your brain will do them automatically in dreams â€” triggering lucidity.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ”¢</span> WBTB Sleep Calculator</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Sleep Time</label>
        <input type="time" class="form-input" id="wbtbSleep" value="23:00"></div>
      <div class="form-group"><label class="form-label">Wake Time</label>
        <input type="time" class="form-input" id="wbtbWake" value="07:00"></div>
    </div>
    <button class="btn btn-secondary btn-sm btn-block" onclick="calcWBTB()">Calculate Optimal Times</button>
    <div id="wbtbResult" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ“‹</span> Dream Journal</div>
    <div id="dreamJournal"></div>
  </div>

  <!-- WAVE 5 â€” LUCID PROBABILITY MODEL -->
  <div class="card" style="border:2px solid var(--accent)">
    <div class="card-title"><span class="emoji">ðŸŽ¯</span> Lucid Probability Model (Wave 5)</div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:12px">Scientific prediction of your lucid dreaming probability tonight, based on your tracked data.</div>
    <div id="lucidProbabilityDisplay">
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-family:Syne,sans-serif;font-size:48px;font-weight:800;color:var(--accent)" id="lucidProbPct">â€“%</div>
        <div style="font-size:13px;color:var(--text2)" id="lucidProbLabel">Lucid probability tonight</div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
        <div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary)" id="lucidMetricDreams">0</div>
          <div style="font-size:10px;color:var(--text3)">Total dreams logged</div>
        </div>
        <div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--success)" id="lucidMetricLucid">0</div>
          <div style="font-size:10px;color:var(--text3)">Lucid dreams</div>
        </div>
        <div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--accent)" id="lucidMetricChecks">0</div>
          <div style="font-size:10px;color:var(--text3)">Today's reality checks</div>
        </div>
        <div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:800;font-family:Syne,sans-serif;color:var(--pink)" id="lucidMetricStreak">0</div>
          <div style="font-size:10px;color:var(--text3)">Day logging streak</div>
        </div>
      </div>
      <div id="lucidProbTips" style="font-size:12px;color:var(--text2);line-height:1.6;background:var(--bg3);border-radius:8px;padding:10px"></div>
    </div>
    <button class="btn btn-accent btn-block btn-sm" onclick="computeLucidProbability()" style="margin-top:10px">ðŸ”„ Recalculate</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 8 â€” VOICE & MEDIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-media">
  <div class="section-header">ðŸŽ™ï¸ Voice & Media Archive</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸŽ™ï¸</span> Voice Recorder</div>
    <div class="recorder-visual" id="recorderBtn" onclick="toggleRecord()">ðŸŽ™ï¸</div>
    <div style="text-align:center;margin-bottom:12px">
      <div style="font-size:14px;font-weight:700;color:var(--text2)" id="recStatus">Tap to Start Recording</div>
      <div style="font-size:12px;color:var(--text3);margin-top:3px" id="recTimer">00:00</div>
    </div>
    <div style="font-size:12px;color:var(--text2);margin-bottom:6px;font-weight:700">Live Transcript:</div>
    <div style="background:var(--bg3);border-radius:10px;padding:10px;min-height:60px;font-size:13px;color:var(--text2);margin-bottom:10px" id="liveTranscript">Speak to see transcript here...</div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ¤–</span> AI Voice Insights</div>
    <div id="voiceAIInsights">
      <div class="empty-state"><span class="es-icon">ðŸŽ™ï¸</span><div class="es-text">Record voice memos to get AI analysis of your patterns and suggestions for what to capture next.</div></div>
    </div>
    <button class="btn btn-secondary btn-sm" onclick="analyzeVoiceMemos()" style="margin-top:8px">ðŸ” Analyze My Recordings</button>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ“¼</span> Voice Memos</div>
    <div id="voiceMemos"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ–¼ï¸</span> Media Upload</div>
    <div onclick="document.getElementById('mediaInput').click()"
         style="border:2px dashed var(--border);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:border .2s"
         onmouseenter="this.style.borderColor='var(--primary)'" onmouseleave="this.style.borderColor='var(--border)'">
      <div style="font-size:32px;margin-bottom:6px">ðŸ“¸</div>
      <div style="font-size:14px;color:var(--text2)">Tap to upload photos or videos</div>
      <div style="font-size:11px;color:var(--text3);margin-top:3px">Images & videos stored locally on your device</div>
    </div>
    <input type="file" id="mediaInput" accept="image/*,video/*" multiple style="display:none" onchange="uploadMedia(event)">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ¤–</span> AI Media Insights</div>
      <div id="mediaAIInsights">
        <div class="empty-state"><span class="es-icon">ðŸ“¸</span><div class="es-text">Upload media to get AI suggestions on what to document for consciousness tracking.</div></div>
      </div>
      <button class="btn btn-secondary btn-sm" onclick="analyzeMedia()" style="margin-top:8px">ðŸ” Analyze My Archive</button>
    </div>
    <div class="media-grid" id="mediaGrid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 9 â€” CALENDAR & ALARMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-calendar">
  <div class="section-header">ðŸ“… Calendar & Alarms</div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <button class="btn btn-secondary btn-sm" onclick="calNav(-1)">â—€</button>
      <div style="font-weight:800;font-family:Syne,sans-serif;font-size:17px" id="calTitle"></div>
      <button class="btn btn-secondary btn-sm" onclick="calNav(1)">â–¶</button>
    </div>
    <div class="cal-grid" id="calGrid"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">â°</span> Alarms & Reminders</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Label</label>
        <input type="text" class="form-input" id="alarmLabel" placeholder="e.g., Reality Check, Meditation..."></div>
      <div class="form-group"><label class="form-label">Time</label>
        <input type="time" class="form-input" id="alarmTime"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Sound</label>
        <select class="form-select" id="alarmSound">
          <option value="bell">ðŸ”” Bell</option>
          <option value="chime">ðŸŽµ Chime</option>
          <option value="pulse">ðŸ“³ Pulse</option>
          <option value="om">ðŸ•‰ï¸ Om</option>
          <option value="birds">ðŸ¦ Birds</option>
        </select></div>
      <div class="form-group"><label class="form-label">Repeat</label>
        <select class="form-select" id="alarmRepeat">
          <option value="once">Once</option>
          <option value="daily">Daily</option>
          <option value="weekdays">Weekdays</option>
          <option value="weekends">Weekends</option>
        </select></div>
    </div>
    <button class="btn btn-primary btn-sm btn-block" onclick="addAlarm()" style="margin-bottom:12px">+ Add Alarm</button>
    <div id="alarmsList"></div>
    <div style="font-size:11px;color:var(--text3);margin-top:8px;text-align:center">
      â„¹ï¸ Allow notifications when prompted for alarms to work. Alarms work when app is open in browser.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ“</span> Reminders</div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Reminder</label>
        <input type="text" class="form-input" id="reminderText" placeholder="Reminder text"></div>
      <div class="form-group"><label class="form-label">Date & Time</label>
        <input type="datetime-local" class="form-input" id="reminderDateTime"></div>
    </div>
    <button class="btn btn-secondary btn-sm" onclick="addReminder()">+ Add Reminder</button>
    <div id="remindersList" style="margin-top:10px"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 10 â€” SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-settings">
  <div class="section-header">âš™ï¸ Settings</div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸŽ¨</span> Appearance</div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Dark Mode</div>
        <div class="setting-desc">Switch to dark theme for night use and reduced eye strain</div>
        <span class="setting-help" onclick="showSettingHelp('darkmode')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingDark" onclick="toggleTheme()"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">App Language</div>
        <div class="setting-desc">Choose your preferred language for the interface</div>
      </div>
      <select class="lang-sel" onchange="setLang(this.value)" id="settingLang">
        <option value="en">English</option>
        <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        <option value="es">EspaÃ±ol</option>
        <option value="fr">FranÃ§ais</option>
        <option value="de">Deutsch</option>
        <option value="pt">PortuguÃªs</option>
        <option value="zh">ä¸­æ–‡</option>
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="ja">æ—¥æœ¬èªž</option>
        <option value="ru">Ð ÑƒÑÑÐºÐ¸Ð¹</option>
      </select>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Show Slider Anchors</div>
        <div class="setting-desc">Show detailed descriptions for each slider value</div>
        <span class="setting-help" onclick="showSettingHelp('anchors')">â“ What does this do?</span>
      </div>
      <div class="toggle on" id="settingAnchors" onclick="toggleSetting('anchors')"></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ””</span> Notifications</div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Enable Notifications</div>
        <div class="setting-desc">Allow alarms and reminders to notify you</div>
        <span class="setting-help" onclick="showSettingHelp('notif')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingNotif" onclick="requestNotifPermission()"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Daily Log Reminder</div>
        <div class="setting-desc">Remind you to fill your consciousness log each day</div>
      </div>
      <div class="toggle" id="settingDailyReminder" onclick="toggleSetting('dailyReminder')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Reality Check Alerts</div>
        <div class="setting-desc">Periodic reminders to do reality checks (every 2hrs)</div>
        <span class="setting-help" onclick="showSettingHelp('rc')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingRC" onclick="toggleSetting('rc')"></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ§ </span> AI Settings</div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Auto-analyze on Save</div>
        <div class="setting-desc">Automatically generate AI insights when you save a log entry</div>
      </div>
      <div class="toggle on" id="settingAutoAnalyze" onclick="toggleSetting('autoAnalyze')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Conversational AI Mode</div>
        <div class="setting-desc">AI checks in on your day with friendly questions</div>
      </div>
      <div class="toggle on" id="settingConvMode" onclick="toggleSetting('convMode')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">Auto-transcribe Voice</div>
        <div class="setting-desc">Automatically convert speech to text when recording</div>
      </div>
      <div class="toggle on" id="settingAutoTranscribe" onclick="toggleSetting('autoTranscribe')"></div>
    </div>
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-title">AI Prompt Enhancement</div>
        <div class="setting-desc">AI automatically improves your questions for better answers</div>
        <span class="setting-help" onclick="showSettingHelp('promptboost')">â“ What does this do?</span>
      </div>
      <div class="toggle" id="settingPromptBoost" onclick="toggleSetting('promptBoost')"></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ—„ï¸</span> Data Management</div>
    <button class="btn btn-secondary btn-block" onclick="exportData()" style="margin-bottom:8px">ðŸ“¤ Export All Data (JSON)</button>
    <button class="btn btn-secondary btn-block" onclick="document.getElementById('importFile').click()" style="margin-bottom:8px">ðŸ“¥ Import Data</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
    <button class="btn btn-danger btn-block" onclick="clearAllData()">ðŸ—‘ Clear All Data</button>
    <div style="font-size:11px;color:var(--text3);text-align:center;margin-top:10px">All data is stored locally on your device only. Nothing is sent to servers.</div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">â„¹ï¸</span> About</div>
    <div style="text-align:center">
      <div style="font-size:32px;margin-bottom:8px">ðŸ§ </div>
      <div style="font-family:Syne,sans-serif;font-weight:800;font-size:18px;margin-bottom:4px">Consciousness OS</div>
      <div style="font-size:13px;color:var(--text3);margin-bottom:12px">Version 6.0 Â· Local-first Â· Privacy-first</div>
      <div style="font-size:12px;color:var(--text2);line-height:1.6">Your personal mind enhancement and consciousness tracking system. All data stays on your device.</div>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 11 â€” WORLD INTELLIGENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-world">
  <div class="section-header">ðŸŒ World Intelligence Panel</div>

  <!-- Refresh Bar -->
  <div class="world-refresh-bar">
    <div style="font-size:12px;color:var(--text2);display:flex;align-items:center;gap:4px">
      <span class="world-live-dot"></span>
      <span id="worldLastUpdated">Loading...</span>
    </div>
    <button class="btn btn-secondary btn-sm" onclick="refreshWorldFeed()">ðŸ”„ Refresh</button>
  </div>

  <div class="world-nav">
    <button class="world-nav-btn active" onclick="switchWorld('geopolitics',this)">ðŸ—ºï¸ Geopolitics</button>
    <button class="world-nav-btn" onclick="switchWorld('markets',this)">ðŸ“ˆ Markets</button>
    <button class="world-nav-btn" onclick="switchWorld('commodities',this)">ðŸ›¢ï¸ Commodities</button>
    <button class="world-nav-btn" onclick="switchWorld('crypto',this)">â‚¿ Crypto</button>
    <button class="world-nav-btn" onclick="switchWorld('rates',this)">ðŸ¦ Rates</button>
    <button class="world-nav-btn" onclick="switchWorld('opinions',this)">ðŸ’¬ Opinions</button>
    <button class="world-nav-btn" onclick="switchWorld('events',this)">ðŸ“… Events</button>
  </div>

  <!-- AI Ask Box -->
  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ¤–</span> 8D World Chess AI</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:8px">Ask any question about how world forces connect. Understand causal chains.</div>
    <div class="ai-ask-box">
      <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:6px">Try asking:</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px">
        <span class="chip" onclick="setWorldQ('Will war increase gold price?')" style="cursor:pointer">Will war increase gold?</span>
        <span class="chip" onclick="setWorldQ('How does Fed rate hike affect crypto?')" style="cursor:pointer">Fed rates â†’ crypto?</span>
        <span class="chip" onclick="setWorldQ('What happens to markets if China invades Taiwan?')" style="cursor:pointer">China Taiwan â†’ markets?</span>
        <span class="chip" onclick="setWorldQ('Oil price rise â†’ inflation chain')" style="cursor:pointer">Oil â†’ inflation chain</span>
      </div>
      <div class="ai-ask-row">
        <input type="text" class="form-input" id="worldAskInput" placeholder="Ask about any geopolitical or economic force...">
        <button class="btn btn-primary btn-sm" onclick="askWorldAI()">ðŸ” Analyze</button>
      </div>
    </div>
    <div id="worldAIResult" style="margin-top:10px"></div>
  </div>

  <!-- Geopolitics Panel -->
  <div class="world-panel active" id="wp-geopolitics">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ—ºï¸</span> Live Geopolitical Events</div>
      <div id="geoEventsList"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ”—</span> Geopolitics â†’ Markets Links</div>
      <div id="geoMarketLinks"></div>
    </div>
  </div>

  <!-- Markets Panel -->
  <div class="world-panel" id="wp-markets">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ“ˆ</span> Key Market Indicators</div>
      <div id="marketsDisplay"></div>
    </div>
  </div>

  <!-- Commodities Panel -->
  <div class="world-panel" id="wp-commodities">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ›¢ï¸</span> Commodities Cycle Tracker</div>
      <div id="commoditiesDisplay"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ“Š</span> Commodities Cycle Phase</div>
      <div id="commoditiesCycle"></div>
    </div>
  </div>

  <!-- Crypto Panel -->
  <div class="world-panel" id="wp-crypto">
    <div class="card">
      <div class="card-title"><span class="emoji">â‚¿</span> Crypto Dynamics</div>
      <div id="cryptoDisplay"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ”„</span> Market Cycle Phase</div>
      <div id="cryptoCycle"></div>
    </div>
  </div>

  <!-- Interest Rates Panel -->
  <div class="world-panel" id="wp-rates">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ¦</span> Central Bank Rates & Inflation</div>
      <div id="ratesDisplay"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ’¡</span> Rate Impact on Your Wealth</div>
      <div id="ratesImpact"></div>
    </div>
  </div>

  <!-- Opinions Panel (NEW) -->
  <div class="world-panel" id="wp-opinions">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ’¬</span> Expert Opinions & Analysis</div>
      <div id="opinionsDisplay"></div>
    </div>
  </div>

  <!-- Events Panel (NEW) -->
  <div class="world-panel" id="wp-events">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ“…</span> Upcoming Global Events</div>
      <div id="eventsDisplay"></div>
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 12 â€” PATH (COMPREHENSIVE STUDY & CAREER AI)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-path">
  <div class="section-header">ðŸŽ“ Study & Career Intelligence</div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-size:13px;font-weight:700;color:var(--text2)">Section <span id="studySectionNum">1</span> of 18</div>
      <div style="font-size:11px;color:var(--text3)" id="studySectionName">Identity & Academic Context</div>
    </div>
    <div class="study-progress"><div class="study-progress-bar" id="studyProgressBar" style="width:5.5%"></div></div>
    <div style="font-size:11px;font-weight:700;color:var(--text2);margin-bottom:6px">Jump to section:</div>
    <div class="study-jump-bar" id="studyJumpBar"></div>
  </div>

  <div id="studySectionsContainer"></div>

  <div style="display:flex;justify-content:space-between;margin-top:4px;margin-bottom:14px">
    <button class="btn btn-secondary" id="studyPrevBtn" onclick="studyPrev()" style="display:none">â† Previous</button>
    <div style="flex:1"></div>
    <button class="btn btn-primary" id="studyNextBtn" onclick="studyNext()">Next â†’</button>
  </div>

  <div id="studyResultContainer"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 13 â€” SCIENCE (FRONTIER INTELLIGENCE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-science">
  <div class="section-header">ðŸ”¬ Frontier Intelligence Feed</div>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
    <div style="font-size:12px;color:var(--text3)" id="scienceLastUpdated">Loading...</div>
    <button class="btn btn-secondary btn-sm" onclick="refreshScienceFeed()">ðŸ”„ Refresh</button>
  </div>

  <div class="science-nav">
    <button class="science-cat-btn active" onclick="switchSciCat('all',this)">ðŸŒ All</button>
    <button class="science-cat-btn" onclick="switchSciCat('neuro',this)">ðŸ§  Neuro</button>
    <button class="science-cat-btn" onclick="switchSciCat('ai',this)">ðŸ¤– AI</button>
    <button class="science-cat-btn" onclick="switchSciCat('physics',this)">âš›ï¸ Physics</button>
    <button class="science-cat-btn" onclick="switchSciCat('longevity',this)">ðŸ§¬ Longevity</button>
    <button class="science-cat-btn" onclick="switchSciCat('space',this)">ðŸš€ Space</button>
    <button class="science-cat-btn" onclick="switchSciCat('biotech',this)">ðŸ”­ Biotech</button>
  </div>

  <!-- Breaking News Banner -->
  <div id="scienceBreakingNews" style="background:linear-gradient(135deg,rgba(239,68,68,.12),rgba(245,158,11,.08));border:1px solid rgba(239,68,68,.3);border-radius:12px;padding:12px;margin-bottom:12px;display:none">
    <div style="font-size:10px;font-weight:700;color:var(--danger);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">ðŸ”´ Breaking â€” Just Now</div>
    <div id="scienceBreakingText" style="font-size:13px;font-weight:700;color:var(--text)"></div>
  </div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ’¡</span> Super Facts â€” Reality Expanders</div>
    <div id="superFactsDisplay"></div>
  </div>

  <div id="discoveriesDisplay"></div>

  <div class="card">
    <div class="card-title"><span class="emoji">ðŸ¤–</span> Ask Science AI</div>
    <div class="ai-ask-row">
      <input type="text" class="form-input" id="scienceAskInput" placeholder="Ask anything about frontier science...">
      <button class="btn btn-accent btn-sm" onclick="askScienceAI()">Explain</button>
    </div>
    <div id="scienceAIResult" style="margin-top:10px"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 14 â€” SYSTEM (THEMES / ACCOUNT / LEGAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-panel" id="tab-system">
  <div class="section-header">âš™ï¸ System Control</div>

  <div class="sys-tab-row">
    <button class="sys-tab-btn active" onclick="switchSysTab('themes',this)">ðŸŽ¨ Themes</button>
    <button class="sys-tab-btn" onclick="switchSysTab('account',this)">ðŸ‘¤ Account</button>
    <button class="sys-tab-btn" onclick="switchSysTab('guide',this)">ðŸ“– Guide</button>
    <button class="sys-tab-btn" onclick="switchSysTab('legal',this)">âš–ï¸ Legal</button>
    <button class="sys-tab-btn" onclick="switchSysTab('tracking',this)">ðŸ“¡ Data</button>
    <button class="sys-tab-btn" onclick="switchSysTab('architecture',this)">ðŸ—ï¸ Arch</button>
  </div>

  <!-- THEMES -->
  <div class="sys-panel active" id="sysp-themes">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸŽ¨</span> Theme Engine</div>
      <div class="theme-grid" id="themeGrid"></div>
      <div style="font-size:12px;color:var(--text3);text-align:center">Theme changes background, accents, glow, and typography tone for full immersion</div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸŒ™</span> Quick Toggles</div>
      <div class="setting-item">
        <div class="setting-info">
          <div class="setting-title">Dark Mode</div>
          <div class="setting-desc">Switch to dark for night use</div>
        </div>
        <div class="toggle" id="sys-darkToggle" onclick="toggleTheme();updateSysToggle()"></div>
      </div>
    </div>
  </div>

  <!-- ACCOUNT -->
  <div class="sys-panel" id="sysp-account">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ‘¤</span> Identity Layer</div>
      <div id="accountLoggedOut">
        <div style="font-size:13px;color:var(--text2);margin-bottom:14px;line-height:1.6">Create or sign in to your account to preserve data across devices and unlock personalized AI coaching.</div>
        <!-- Phone Auth -->
        <div style="background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px">
          <div style="font-weight:700;font-size:14px;margin-bottom:10px">ðŸ“± Phone Number</div>
          <div id="phoneStep1">
            <div style="font-size:12px;color:var(--text3);margin-bottom:8px">Enter your phone number to get a verification code</div>
            <div style="display:flex;gap:8px;margin-bottom:10px">
              <select class="form-select" id="phoneCountry" style="width:100px;flex-shrink:0">
                <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
                <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
                <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
                <option value="+81">ðŸ‡¯ðŸ‡µ +81</option>
                <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
                <option value="+33">ðŸ‡«ðŸ‡· +33</option>
                <option value="+55">ðŸ‡§ðŸ‡· +55</option>
                <option value="+86">ðŸ‡¨ðŸ‡³ +86</option>
                <option value="+7">ðŸ‡·ðŸ‡º +7</option>
              </select>
              <input type="tel" class="form-input" id="phoneNumber" placeholder="Phone number" maxlength="15">
            </div>
            <button class="btn btn-primary btn-block" onclick="sendPhoneOTP()">ðŸ“² Send Verification Code</button>
          </div>
          <div id="phoneStep2" style="display:none">
            <div style="font-size:13px;color:var(--text2);margin-bottom:10px">Code sent to <strong id="phoneSentTo"></strong>. Enter the 6-digit code:</div>
            <div style="display:flex;gap:6px;justify-content:center;margin-bottom:12px" id="otpBoxes">
              <input type="number" class="form-input" style="width:42px;text-align:center;font-size:20px;font-weight:700;padding:6px 4px" maxlength="1" oninput="otpBoxNext(this,1)">
              <input type="number" class="form-input" style="width:42px;text-align:center;font-size:20px;font-weight:700;padding:6px 4px" maxlength="1" oninput="otpBoxNext(this,2)">
              <input type="number" class="form-input" style="width:42px;text-align:center;font-size:20px;font-weight:700;padding:6px 4px" maxlength="1" oninput="otpBoxNext(this,3)">
              <input type="number" class="form-input" style="width:42px;text-align:center;font-size:20px;font-weight:700;padding:6px 4px" maxlength="1" oninput="otpBoxNext(this,4)">
              <input type="number" class="form-input" style="width:42px;text-align:center;font-size:20px;font-weight:700;padding:6px 4px" maxlength="1" oninput="otpBoxNext(this,5)">
              <input type="number" class="form-input" style="width:42px;text-align:center;font-size:20px;font-weight:700;padding:6px 4px" maxlength="1" oninput="otpBoxNext(this,6)">
            </div>
            <button class="btn btn-primary btn-block" onclick="verifyPhoneOTP()" style="margin-bottom:8px">âœ… Verify & Sign In</button>
            <button class="btn btn-secondary btn-block" onclick="document.getElementById('phoneStep1').style.display='';document.getElementById('phoneStep2').style.display='none'">â† Back</button>
          </div>
        </div>
        <div class="account-options">
          <div class="account-option" onclick="signInGoogle()">
            <div class="ao-icon">ðŸ”µ</div>
            <div><div class="ao-title">Continue with Google</div><div class="ao-desc">Sync across devices, cloud backup</div></div>
          </div>
          <div class="account-option" onclick="signInLocal()">
            <div class="ao-icon">ðŸ”’</div>
            <div><div class="ao-title">Stay Local (Private)</div><div class="ao-desc">No account, all data on device only</div></div>
          </div>
        </div>
      </div>
      <div id="accountLoggedIn" style="display:none">
        <div style="text-align:center;padding:16px 0">
          <div style="font-size:56px;margin-bottom:8px" id="accountAvatar">ðŸ§ </div>
          <div style="font-family:Syne,sans-serif;font-size:18px;font-weight:800" id="accountName">User</div>
          <div style="font-size:13px;color:var(--text3);margin-bottom:14px" id="accountPhone"></div>
          <div style="background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.3);border-radius:10px;padding:10px;margin-bottom:14px;font-size:13px;color:var(--success)">âœ… Account Active â€” Data preserved across sessions</div>
          <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:12px">
            <div style="background:var(--bg3);border-radius:10px;padding:10px 16px;text-align:center"><div style="font-size:18px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary)" id="acctLogCount">0</div><div style="font-size:10px;color:var(--text3)">Logs</div></div>
            <div style="background:var(--bg3);border-radius:10px;padding:10px 16px;text-align:center"><div style="font-size:18px;font-weight:800;font-family:Syne,sans-serif;color:var(--accent)" id="acctDreamCount">0</div><div style="font-size:10px;color:var(--text3)">Dreams</div></div>
            <div style="background:var(--bg3);border-radius:10px;padding:10px 16px;text-align:center"><div style="font-size:18px;font-weight:800;font-family:Syne,sans-serif;color:var(--pink)" id="acctDaysCount">0</div><div style="font-size:10px;color:var(--text3)">Days</div></div>
          </div>
          <button class="btn btn-danger btn-block" onclick="signOut()" style="max-width:200px;margin:0 auto">Sign Out</button>
        </div>
      </div>
      <div id="accountStatus" style="margin-top:14px;font-size:13px;color:var(--text3);text-align:center">Currently in local mode Â· Data stays on your device</div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸŒ</span> Language System</div>
      <div class="form-group">
        <label class="form-label">Interface Language</label>
        <select class="form-select" onchange="setLang(this.value)" id="sysLangSel">
          <option value="en">ðŸŒ English</option>
          <option value="hi">ðŸ‡®ðŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
          <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
          <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
          <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
          <option value="pt">ðŸ‡§ðŸ‡· PortuguÃªs</option>
          <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
          <option value="ar">ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="ja">ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž</option>
          <option value="ru">ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹</option>
        </select>
      </div>
    </div>
  </div>

  <!-- GUIDE -->
  <div class="sys-panel" id="sysp-guide">
    <div class="consciousness-guide-card">
      <div style="font-size:32px;text-align:center;margin-bottom:10px">ðŸ§ </div>
      <div style="font-family:Syne,sans-serif;font-size:18px;font-weight:800;text-align:center;margin-bottom:6px">What is Consciousness OS?</div>
      <div style="font-size:13px;color:var(--text2);text-align:center;line-height:1.6;margin-bottom:16px">Consciousness OS helps users observe and shape cognitive states. It's your personal system for engineering your inner reality.</div>
    </div>

    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ”</span> The Fundamental Question</div>
      <div class="guide-section">
        <p style="font-size:14px;font-style:italic;color:var(--primary);line-height:1.7">"If my thoughts are mine, my body is mine, my brain is mine â€” then what is 'me'?"</p>
      </div>
      <div class="guide-section">
        <h3>Observer vs Processes</h3>
        <p>Your thoughts, emotions, and sensations are processes â€” like weather passing through. The 'me' is the sky that holds them. You are the observer, not the observed.</p>
      </div>
      <div class="guide-section">
        <h3>Cognition vs Identity</h3>
        <p>Cognition is the mechanism â€” how your brain processes information. Identity is the story you tell about what those processes mean. Consciousness OS helps you see both separately.</p>
      </div>
      <div class="guide-section">
        <h3>States vs Self</h3>
        <p>A low mood state is not who you are â€” it's a temporary configuration of your system. By tracking states, you learn to navigate rather than be defined by them.</p>
      </div>
      <div class="guide-section">
        <h3>The Awareness Layer</h3>
        <p>Pure awareness is the layer that knows all your states, but is none of them. This app trains you to access that layer â€” the meta-cognitive observer that gives you real freedom.</p>
      </div>
    </div>

    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ—ºï¸</span> Feature Guide</div>
      <div id="featureGuideList"></div>
    </div>
  </div>

  <!-- LEGAL -->
  <div class="sys-panel" id="sysp-legal">
    <div class="card">
      <div class="card-title"><span class="emoji">âš–ï¸</span> Legal & Policy</div>
      <div id="legalItemsList">
        <div class="legal-item" onclick="openLegal('about')"><div><div class="li-title">â„¹ï¸ About This App</div><div class="li-desc">What is Consciousness OS and who made it</div></div><span style="color:var(--text3)">â€º</span></div>
        <div class="legal-item" onclick="openLegal('copyright')"><div><div class="li-title">Â© Copyright Notice</div><div class="li-desc">Intellectual property & ownership</div></div><span style="color:var(--text3)">â€º</span></div>
        <div class="legal-item" onclick="openLegal('terms')"><div><div class="li-title">ðŸ“‹ Terms of Use</div><div class="li-desc">Rules and conditions for using this app</div></div><span style="color:var(--text3)">â€º</span></div>
        <div class="legal-item" onclick="openLegal('disclaimer')"><div><div class="li-title">âš ï¸ Disclaimer</div><div class="li-desc">Limitations of liability and accuracy</div></div><span style="color:var(--text3)">â€º</span></div>
        <div class="legal-item" onclick="openLegal('privacy')"><div><div class="li-title">ðŸ”’ Privacy Policy</div><div class="li-desc">How your data is collected and stored</div></div><span style="color:var(--text3)">â€º</span></div>
        <div class="legal-item" onclick="openLegal('health')"><div><div class="li-title">ðŸ¥ Health Disclaimer</div><div class="li-desc">Medical advice limitations</div></div><span style="color:var(--text3)">â€º</span></div>
        <div class="legal-item" onclick="openLegal('career')"><div><div class="li-title">ðŸ’¼ Career Disclaimer</div><div class="li-desc">Professional advice limitations</div></div><span style="color:var(--text3)">â€º</span></div>
        <div class="legal-item" onclick="openLegal('notice')"><div><div class="li-title">ðŸ“¢ Legal Notice</div><div class="li-desc">General legal notices and disclosures</div></div><span style="color:var(--text3)">â€º</span></div>
      </div>
    </div>
  </div>

  <!-- PASSIVE TELEMETRY -->
  <div class="sys-panel" id="sysp-tracking">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ“¡</span> Passive Cognition Telemetry</div>
      <div style="font-size:12px;color:var(--text3);margin-bottom:12px">Auto-tracked signals from your app behavior â€” no manual input needed.</div>
      <div class="telemetry-grid" id="telemetryGrid"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ”—</span> Detected Correlations</div>
      <div id="correlationsList"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ“Š</span> Interaction Speed History</div>
      <div style="font-size:13px;color:var(--text2)">Session response speed tracked over last 7 days. Slower = lower cognition. Faster = higher engagement.</div>
      <div id="speedHistory" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- DATA ARCHITECTURE (NEW) -->
  <div class="sys-panel" id="sysp-architecture">
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ—ï¸</span> Data Architecture</div>
      <div style="font-size:12px;color:var(--text3);margin-bottom:14px">Full data schema â€” every piece of data this app stores, organized by type. Tap any node to inspect.</div>
      <div id="dataArchDisplay"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ“Š</span> Storage Usage</div>
      <div id="storageUsageDisplay"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">ðŸ‘¥</span> Multi-Profile Data</div>
      <div style="font-size:12px;color:var(--text3);margin-bottom:10px">Each user profile has isolated data under their own key namespace.</div>
      <div id="profileDataDisplay"></div>
    </div>
  </div>

</div><!-- /tab-system -->

</div><!-- /.main -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOTTOM NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="bottom-nav" id="bottomNav"></div>

<!-- â•â•â•â• IMMERSIVE FOCUS MODE OVERLAY (Wave 4) â•â•â•â• -->
<div id="immersiveOverlay" style="display:none;position:fixed;inset:0;z-index:2000;background:#000;overflow:hidden">
  <canvas id="immersiveCanvas" style="position:absolute;inset:0;width:100%;height:100%"></canvas>
  <div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;text-align:center">
    <div id="immersiveTitle" style="font-family:Syne,sans-serif;font-size:28px;font-weight:800;color:#fff;margin-bottom:16px;text-shadow:0 0 30px rgba(124,58,237,0.8)">Deep Focus Mode</div>
    <div id="immersiveTimer" style="font-family:Syne,sans-serif;font-size:72px;font-weight:800;color:#fff;margin-bottom:16px;opacity:0.9"></div>
    <div id="immersivePhrase" style="font-size:15px;color:rgba(255,255,255,0.7);max-width:300px;line-height:1.6;margin-bottom:30px"></div>
    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
      <button class="btn" onclick="exitImmersive()" style="background:rgba(255,255,255,0.12);color:#fff;border:1px solid rgba(255,255,255,0.25)">Exit</button>
      <button class="btn btn-primary" onclick="nextImmersivePhrase()">Next Phrase</button>
    </div>
  </div>
  <div style="position:absolute;top:20px;right:20px">
    <div id="immersiveCognScore" style="font-size:12px;color:rgba(255,255,255,0.5)">Passive Cognition: â€“</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toast" id="toast"></div>

<!-- â•â•â•â• NEWS DETAIL OVERLAY â•â•â•â• -->
<div class="news-detail-overlay" id="newsDetailOverlay">
  <div class="news-detail-card">
    <div class="news-detail-header">
      <div>
        <div id="newsDetailCat" style="font-size:11px;font-weight:700;color:var(--accent);text-transform:uppercase;margin-bottom:6px"></div>
        <div id="newsDetailTitle" style="font-family:Syne,sans-serif;font-weight:800;font-size:20px;line-height:1.3"></div>
      </div>
      <button class="news-detail-close" onclick="closeNewsDetail()">âœ•</button>
    </div>
    <div id="newsDetailBody" class="news-detail-body"></div>
    <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border)">
      <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px">ðŸ¤– AI Analysis: Ask about this story</div>
      <div style="display:flex;gap:8px">
        <input type="text" class="form-input" id="newsAskInput" placeholder="What are the implications? How does this affect me?">
        <button class="btn btn-primary btn-sm" onclick="askAboutNews()">Ask AI</button>
      </div>
      <div id="newsAIResponse" style="margin-top:10px"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle"></div>
      <button class="modal-close" onclick="closeAllModals()">âœ•</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ONBOARDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="onboard-overlay" id="onboardOverlay" style="display:none">
  <div class="onboard-card">
    <div class="onboard-dots" id="onboardDots"></div>

    <div class="onboard-step active" id="oStep0">
      <span class="onboard-icon">ðŸ§ </span>
      <div class="onboard-title">Consciousness OS v6</div>
      <div class="onboard-text">Your complete mind enhancement and consciousness tracking system. Track 20+ dimensions of your consciousness, train your brain, and optimize your performance.</div>
      <div class="onboard-features">
        <div class="of-item"><div class="of-icon">ðŸ“</div><div class="of-name">Daily Log</div></div>
        <div class="of-item"><div class="of-icon">ðŸŽµ</div><div class="of-name">Brainwave Audio</div></div>
        <div class="of-item"><div class="of-icon">ðŸ¤–</div><div class="of-name">AI Hub</div></div>
        <div class="of-item"><div class="of-icon">ðŸ“Š</div><div class="of-name">Analysis</div></div>
        <div class="of-item"><div class="of-icon">â¤ï¸</div><div class="of-name">Health Profile</div></div>
        <div class="of-item"><div class="of-icon">ðŸŽ®</div><div class="of-name">Brain Games</div></div>
        <div class="of-item"><div class="of-icon">ðŸŒ™</div><div class="of-name">Lucid Dreams</div></div>
        <div class="of-item"><div class="of-icon">ðŸŽ™ï¸</div><div class="of-name">Voice Archive</div></div>
      </div>
    </div>

    <div class="onboard-step" id="oStep1">
      <span class="onboard-icon">ðŸ“</span>
      <div class="onboard-title">Daily Consciousness Log</div>
      <div class="onboard-text">Track 20 dimensions of your mind every day â€” mood, focus, creativity, flow, and more. Visual dot sliders make rating easy and intuitive. Your AI twin learns your patterns over time.</div>
    </div>

    <div class="onboard-step" id="oStep2">
      <span class="onboard-icon">ðŸŽµ</span>
      <div class="onboard-title">Brainwave Audio Lab</div>
      <div class="onboard-text">Listen to binaural beats, isochronic tones, and solfeggio frequencies to shift your brain into optimal states for focus, creativity, sleep, and meditation. Use with headphones for best results.</div>
    </div>

    <div class="onboard-step" id="oStep3">
      <span class="onboard-icon">ðŸ¤–</span>
      <div class="onboard-title">Multi-AI Hub</div>
      <div class="onboard-text">Chat with different AI personalities that analyze your consciousness data. Get personalized tips, pattern analysis, and insights. Multiple AI perspectives for well-rounded answers.</div>
    </div>

    <div class="onboard-step" id="oStep4">
      <span class="onboard-icon">ðŸŒ™</span>
      <div class="onboard-title">Lucid Dreaming Lab</div>
      <div class="onboard-text">Track your dreams, learn lucid dreaming techniques with simple explanations, do reality checks, and get AI analysis of your dream patterns and symbols.</div>
    </div>

    <div class="onboard-step" id="oStep5">
      <span class="onboard-icon">âœ¨</span>
      <div class="onboard-title">You're Ready!</div>
      <div class="onboard-text">Start by filling your first Daily Log to establish your baseline. The more you log, the smarter your AI becomes. You can always revisit this guide with the â“ button.</div>
    </div>

    <div class="onboard-nav">
      <button class="btn btn-secondary btn-sm" id="oBtnPrev" onclick="onboardNav(-1)" style="display:none">â† Back</button>
      <div style="flex:1"></div>
      <button class="btn btn-secondary btn-sm" onclick="closeOnboarding()">Skip</button>
      <button class="btn btn-primary btn-sm" id="oBtnNext" onclick="onboardNav(1)">Next â†’</button>
    </div>
  </div>
</div>

<!-- â•â•â•â• FOOTER â•â•â•â• -->
<footer style="margin-top:40px;font-size:12px;color:#9ca3af;text-align:center;padding:18px 14px calc(var(--nav-h) + 18px);background:var(--bg2);border-top:1px solid var(--border)">
  Â© 2026 Vikram Singh â€” Consciousness OSâ„¢. All rights reserved.
</footer>

<!-- Setting help modal -->
<div class="modal-overlay" id="settingHelpOverlay" onclick="this.classList.remove('open')">
  <div class="modal" style="max-width:360px">
    <div class="modal-header">
      <div class="modal-title" id="settingHelpTitle"></div>
      <button class="modal-close" onclick="document.getElementById('settingHelpOverlay').classList.remove('open')">âœ•</button>
    </div>
    <div id="settingHelpBody" style="font-size:14px;color:var(--text2);line-height:1.6"></div>
  </div>
</div>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSCIOUSNESS OS v6.0 â€” JAVASCRIPT ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ TRANSLATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANGS = {
  en:{
    // Nav
    nav_log:"Log",nav_waves:"Waves",nav_ai:"AI Hub",nav_analysis:"Analysis",nav_health:"Health",
    nav_games:"Games",nav_dreams:"Dreams",nav_media:"Media",nav_calendar:"Calendar",
    nav_settings:"Settings",nav_world:"World",nav_path:"Path",nav_science:"Science",nav_system:"System",nav_guide:"Guide",
    // Daily Log
    daily_log:"Daily Consciousness Log",entry_info:"Entry Info",date:"Date",time_of_day:"Time of Day",
    activity:"Activity",consciousness_metrics:"Consciousness Metrics",save_entry:"Save Entry",
    inner_state:"Inner State",reflections:"Reflections",recent_entries:"Recent Entries",
    raw_thoughts:"Raw Thoughts / Stream of Consciousness",key_insight:"Key Insight Today",
    current_goal:"Current Goal",main_obstacle:"Main Obstacle",gratitude:"Gratitude",
    recurring_pattern:"Recurring Pattern / Observation",key_action:"Key Action to Take",
    brainwave_state:"Brainwave State",dominant_emotion:"Dominant Emotion",physical_sensation:"Physical Sensation",
    // Sections
    brainwave_audio:"Brainwave Audio Lab",now_playing:"Now Playing",brainwave_sessions:"Brainwave Sessions",
    what_are_brainwaves:"What Are Brainwaves?",select_ai_model:"Select AI Model",daily_tip:"Daily Tip",
    ai_pattern:"AI Pattern Analysis",analysis_dashboard:"Analysis Dashboard",predictions:"Predictions",
    trends:"Trends (Last 10 vs Previous 10)",personal_records:"Personal Records",pattern_detection:"Pattern Detection",
    health_profile:"Health Profile",brain_training:"Brain Training",lucid_dreams:"Lucid Dreams Lab",
    log_dream:"Log a Dream",ai_dream:"AI Dream Analysis",lucid_techniques:"Lucid Dream Techniques",
    reality_check:"Reality Check Tracker",voice_media:"Voice & Media Archive",voice_recorder:"Voice Recorder",
    ai_voice:"AI Voice Insights",voice_memos:"Voice Memos",media_upload:"Media Upload",
    calendar_alarms:"Calendar & Alarms",alarms_reminders:"Alarms & Reminders",reminders:"Reminders",
    settings:"Settings",appearance:"Appearance",dark_mode:"Dark Mode",app_language:"App Language",
    notifications:"Notifications",ai_settings:"AI Settings",data_management:"Data Management",
    about:"About",world_intel:"World Intelligence Panel",cognitive_path:"Study & Career Intelligence",
    frontier_science:"Frontier Intelligence Feed",system_control:"System Control",
    // Buttons
    save:"Save",cancel:"Cancel",close:"Close",next:"Next",previous:"Previous",back:"Back",
    play:"Play",pause:"Pause",analyze:"Analyze",generate:"Generate",export:"Export",import:"Import",
    clear:"Clear",add:"Add",delete:"Delete",reset:"Reset",start:"Start",stop:"Stop",
    // Status
    saved:"Entry saved!",cleared:"All cleared",loading:"Loading...",analyzing:"Analyzing...",
    tap_record:"Tap to Start Recording",live_transcript:"Live Transcript",
    // Time
    morning:"Morning",afternoon:"Afternoon",evening:"Evening",night:"Night",
    // Misc
    version:"Version",privacy:"Privacy",local_mode:"Local mode â€” all data on your device",
    no_entries:"No entries yet",log_first:"Log your first entry to see analysis",
    theme_engine:"Theme Engine",account_identity:"Identity Layer",consciousness_guide:"Consciousness Guide",
    legal_policy:"Legal & Policy",passive_telemetry:"Passive Cognition Telemetry",
    deep_work:"Deep Work",exercise:"Exercise",rest:"Rest",social:"Social",learning:"Learning",
    creative:"Creative",meditation:"Meditation",entertainment:"Entertainment",
  },
  hi:{
    nav_log:"à¤²à¥‰à¤—",nav_waves:"à¤¤à¤°à¤‚à¤—à¥‡à¤‚",nav_ai:"AI à¤¹à¤¬",nav_analysis:"à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",nav_health:"à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯",
    nav_games:"à¤–à¥‡à¤²",nav_dreams:"à¤¸à¤ªà¤¨à¥‡",nav_media:"à¤®à¥€à¤¡à¤¿à¤¯à¤¾",nav_calendar:"à¤•à¥ˆà¤²à¥‡à¤‚à¤¡à¤°",
    nav_settings:"à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",nav_world:"à¤¦à¥à¤¨à¤¿à¤¯à¤¾",nav_path:"à¤ªà¤¥",nav_science:"à¤µà¤¿à¤œà¥à¤žà¤¾à¤¨",nav_system:"à¤¸à¤¿à¤¸à¥à¤Ÿà¤®",
    daily_log:"à¤¦à¥ˆà¤¨à¤¿à¤• à¤šà¥‡à¤¤à¤¨à¤¾ à¤²à¥‰à¤—",entry_info:"à¤ªà¥à¤°à¤µà¤¿à¤·à¥à¤Ÿà¤¿ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",date:"à¤¤à¤¾à¤°à¥€à¤–",time_of_day:"à¤¦à¤¿à¤¨ à¤•à¤¾ à¤¸à¤®à¤¯",
    activity:"à¤—à¤¤à¤¿à¤µà¤¿à¤§à¤¿",consciousness_metrics:"à¤šà¥‡à¤¤à¤¨à¤¾ à¤®à¥‡à¤Ÿà¥à¤°à¤¿à¤•à¥à¤¸",save_entry:"à¤¸à¤¹à¥‡à¤œà¥‡à¤‚",
    inner_state:"à¤†à¤‚à¤¤à¤°à¤¿à¤• à¤…à¤µà¤¸à¥à¤¥à¤¾",reflections:"à¤µà¤¿à¤šà¤¾à¤°",recent_entries:"à¤¹à¤¾à¤² à¤•à¥€ à¤ªà¥à¤°à¤µà¤¿à¤·à¥à¤Ÿà¤¿à¤¯à¤¾à¤‚",
    raw_thoughts:"à¤•à¤šà¥à¤šà¥‡ à¤µà¤¿à¤šà¤¾à¤° / à¤šà¥‡à¤¤à¤¨à¤¾ à¤§à¤¾à¤°à¤¾",key_insight:"à¤†à¤œ à¤•à¥€ à¤®à¥à¤–à¥à¤¯ à¤…à¤‚à¤¤à¤°à¥à¤¦à¥ƒà¤·à¥à¤Ÿà¤¿",
    current_goal:"à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤²à¤•à¥à¤·à¥à¤¯",main_obstacle:"à¤®à¥à¤–à¥à¤¯ à¤¬à¤¾à¤§à¤¾",gratitude:"à¤•à¥ƒà¤¤à¤œà¥à¤žà¤¤à¤¾",
    recurring_pattern:"à¤¬à¤¾à¤°-à¤¬à¤¾à¤° à¤¦à¥‹à¤¹à¤°à¤¾à¤¨à¥‡ à¤µà¤¾à¤²à¤¾ à¤ªà¥ˆà¤Ÿà¤°à¥à¤¨",key_action:"à¤®à¥à¤–à¥à¤¯ à¤•à¤¾à¤°à¥à¤¯",
    brainwave_state:"à¤®à¤¸à¥à¤¤à¤¿à¤·à¥à¤• à¤¤à¤°à¤‚à¤— à¤…à¤µà¤¸à¥à¤¥à¤¾",dominant_emotion:"à¤ªà¥à¤°à¤®à¥à¤– à¤­à¤¾à¤µà¤¨à¤¾",physical_sensation:"à¤¶à¤¾à¤°à¥€à¤°à¤¿à¤• à¤…à¤¨à¥à¤­à¤µ",
    brainwave_audio:"à¤®à¤¸à¥à¤¤à¤¿à¤·à¥à¤• à¤¤à¤°à¤‚à¤— à¤‘à¤¡à¤¿à¤¯à¥‹ à¤²à¥ˆà¤¬",now_playing:"à¤…à¤­à¥€ à¤šà¤² à¤°à¤¹à¤¾ à¤¹à¥ˆ",brainwave_sessions:"à¤¸à¤¤à¥à¤°",
    what_are_brainwaves:"à¤®à¤¸à¥à¤¤à¤¿à¤·à¥à¤• à¤¤à¤°à¤‚à¤—à¥‡à¤‚ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆà¤‚?",select_ai_model:"AI à¤®à¥‰à¤¡à¤² à¤šà¥à¤¨à¥‡à¤‚",daily_tip:"à¤¦à¥ˆà¤¨à¤¿à¤• à¤Ÿà¤¿à¤ª",
    ai_pattern:"AI à¤ªà¥ˆà¤Ÿà¤°à¥à¤¨ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",analysis_dashboard:"à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",predictions:"à¤­à¤µà¤¿à¤·à¥à¤¯à¤µà¤¾à¤£à¤¿à¤¯à¤¾à¤‚",
    trends:"à¤°à¥à¤à¤¾à¤¨",personal_records:"à¤µà¥à¤¯à¤•à¥à¤¤à¤¿à¤—à¤¤ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡",pattern_detection:"à¤ªà¥ˆà¤Ÿà¤°à¥à¤¨ à¤ªà¤¹à¤šà¤¾à¤¨",
    health_profile:"à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤²",brain_training:"à¤®à¤¸à¥à¤¤à¤¿à¤·à¥à¤• à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£",lucid_dreams:"à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤¸à¥à¤µà¤ªà¥à¤¨ à¤²à¥ˆà¤¬",
    log_dream:"à¤¸à¥à¤µà¤ªà¥à¤¨ à¤²à¥‰à¤— à¤•à¤°à¥‡à¤‚",ai_dream:"AI à¤¸à¥à¤µà¤ªà¥à¤¨ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",lucid_techniques:"à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤¸à¥à¤µà¤ªà¥à¤¨ à¤¤à¤•à¤¨à¥€à¤•",
    reality_check:"à¤µà¤¾à¤¸à¥à¤¤à¤µà¤¿à¤•à¤¤à¤¾ à¤œà¤¾à¤‚à¤š",voice_media:"à¤†à¤µà¤¾à¤œ à¤”à¤° à¤®à¥€à¤¡à¤¿à¤¯à¤¾",voice_recorder:"à¤†à¤µà¤¾à¤œ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡à¤°",
    ai_voice:"AI à¤†à¤µà¤¾à¤œ à¤…à¤‚à¤¤à¤°à¥à¤¦à¥ƒà¤·à¥à¤Ÿà¤¿",voice_memos:"à¤†à¤µà¤¾à¤œ à¤®à¥‡à¤®à¥‹",media_upload:"à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤…à¤ªà¤²à¥‹à¤¡",
    calendar_alarms:"à¤•à¥ˆà¤²à¥‡à¤‚à¤¡à¤° à¤”à¤° à¤…à¤²à¤¾à¤°à¥à¤®",alarms_reminders:"à¤…à¤²à¤¾à¤°à¥à¤® à¤”à¤° à¤°à¤¿à¤®à¤¾à¤‡à¤‚à¤¡à¤°",reminders:"à¤°à¤¿à¤®à¤¾à¤‡à¤‚à¤¡à¤°",
    settings:"à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",appearance:"à¤°à¥‚à¤ª-à¤°à¤‚à¤—",dark_mode:"à¤¡à¤¾à¤°à¥à¤• à¤®à¥‹à¤¡",app_language:"à¤à¤ª à¤­à¤¾à¤·à¤¾",
    notifications:"à¤¸à¥‚à¤šà¤¨à¤¾à¤à¤‚",ai_settings:"AI à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",data_management:"à¤¡à¥‡à¤Ÿà¤¾ à¤ªà¥à¤°à¤¬à¤‚à¤§à¤¨",
    about:"à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚",world_intel:"à¤µà¤¿à¤¶à¥à¤µ à¤¬à¥à¤¦à¥à¤§à¤¿ à¤ªà¥ˆà¤¨à¤²",cognitive_path:"à¤…à¤§à¥à¤¯à¤¯à¤¨ à¤”à¤° à¤•à¤°à¤¿à¤¯à¤° AI",
    frontier_science:"à¤¸à¥€à¤®à¤¾à¤‚à¤¤ à¤µà¤¿à¤œà¥à¤žà¤¾à¤¨ à¤«à¤¼à¥€à¤¡",system_control:"à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£",
    save:"à¤¸à¤¹à¥‡à¤œà¥‡à¤‚",cancel:"à¤°à¤¦à¥à¤¦ à¤•à¤°à¥‡à¤‚",close:"à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚",next:"à¤…à¤—à¤²à¤¾",previous:"à¤ªà¤¿à¤›à¤²à¤¾",back:"à¤µà¤¾à¤ªà¤¸",
    play:"à¤šà¤²à¤¾à¤à¤‚",pause:"à¤°à¥‹à¤•à¥‡à¤‚",analyze:"à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤•à¤°à¥‡à¤‚",generate:"à¤¬à¤¨à¤¾à¤à¤‚",export:"à¤¨à¤¿à¤°à¥à¤¯à¤¾à¤¤",import:"à¤†à¤¯à¤¾à¤¤",
    clear:"à¤¸à¤¾à¤« à¤•à¤°à¥‡à¤‚",add:"à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",delete:"à¤¹à¤Ÿà¤¾à¤à¤‚",reset:"à¤°à¥€à¤¸à¥‡à¤Ÿ",start:"à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚",stop:"à¤°à¥‹à¤•à¥‡à¤‚",
    saved:"à¤¸à¤¹à¥‡à¤œà¤¾ à¤—à¤¯à¤¾!",cleared:"à¤¸à¤¾à¤« à¤¹à¥‹ à¤—à¤¯à¤¾",loading:"à¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",analyzing:"à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£...",
    tap_record:"à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡ à¤¶à¥à¤°à¥‚ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤Ÿà¥ˆà¤ª à¤•à¤°à¥‡à¤‚",live_transcript:"à¤²à¤¾à¤‡à¤µ à¤Ÿà¥à¤°à¤¾à¤‚à¤¸à¤•à¥à¤°à¤¿à¤ªà¥à¤Ÿ",
    morning:"à¤¸à¥à¤¬à¤¹",afternoon:"à¤¦à¥‹à¤ªà¤¹à¤°",evening:"à¤¶à¤¾à¤®",night:"à¤°à¤¾à¤¤",
    version:"à¤¸à¤‚à¤¸à¥à¤•à¤°à¤£",privacy:"à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾",local_mode:"à¤¸à¥à¤¥à¤¾à¤¨à¥€à¤¯ à¤®à¥‹à¤¡ â€” à¤¸à¤­à¥€ à¤¡à¥‡à¤Ÿà¤¾ à¤†à¤ªà¤•à¥‡ à¤¡à¤¿à¤µà¤¾à¤‡à¤¸ à¤ªà¤°",
    no_entries:"à¤•à¥‹à¤ˆ à¤ªà¥à¤°à¤µà¤¿à¤·à¥à¤Ÿà¤¿ à¤¨à¤¹à¥€à¤‚",log_first:"à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤¦à¥‡à¤–à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤ªà¤¹à¤²à¤¾ à¤²à¥‰à¤— à¤­à¤°à¥‡à¤‚",
    theme_engine:"à¤¥à¥€à¤® à¤‡à¤‚à¤œà¤¨",account_identity:"à¤ªà¤¹à¤šà¤¾à¤¨ à¤ªà¤°à¤¤",consciousness_guide:"à¤šà¥‡à¤¤à¤¨à¤¾ à¤—à¤¾à¤‡à¤¡",
    legal_policy:"à¤•à¤¾à¤¨à¥‚à¤¨à¥€ à¤”à¤° à¤¨à¥€à¤¤à¤¿",passive_telemetry:"à¤¨à¤¿à¤·à¥à¤•à¥à¤°à¤¿à¤¯ à¤…à¤¨à¥à¤­à¥‚à¤¤à¤¿ à¤Ÿà¥‡à¤²à¥€à¤®à¥‡à¤Ÿà¥à¤°à¥€",
    deep_work:"à¤—à¤¹à¤°à¤¾ à¤•à¤¾à¤®",exercise:"à¤µà¥à¤¯à¤¾à¤¯à¤¾à¤®",rest:"à¤†à¤°à¤¾à¤®",social:"à¤¸à¤¾à¤®à¤¾à¤œà¤¿à¤•",learning:"à¤¸à¥€à¤–à¤¨à¤¾",
    creative:"à¤°à¤šà¤¨à¤¾à¤¤à¥à¤®à¤•",meditation:"à¤§à¥à¤¯à¤¾à¤¨",entertainment:"à¤®à¤¨à¥‹à¤°à¤‚à¤œà¤¨",
  },
  es:{
    nav_log:"Registro",nav_waves:"Ondas",nav_ai:"IA Hub",nav_analysis:"AnÃ¡lisis",nav_health:"Salud",
    nav_games:"Juegos",nav_dreams:"SueÃ±os",nav_media:"Media",nav_calendar:"Calendario",
    nav_settings:"Ajustes",nav_world:"Mundo",nav_path:"Camino",nav_science:"Ciencia",nav_system:"Sistema",
    daily_log:"Registro de Conciencia",entry_info:"Info de Entrada",date:"Fecha",time_of_day:"Hora del DÃ­a",
    activity:"Actividad",consciousness_metrics:"MÃ©tricas de Conciencia",save_entry:"Guardar",
    inner_state:"Estado Interior",reflections:"Reflexiones",recent_entries:"Entradas Recientes",
    raw_thoughts:"Pensamientos / Flujo de Conciencia",key_insight:"Insight Clave de Hoy",
    current_goal:"Meta Actual",main_obstacle:"ObstÃ¡culo Principal",gratitude:"Gratitud",
    recurring_pattern:"PatrÃ³n Recurrente",key_action:"AcciÃ³n Clave",
    brainwave_state:"Estado de Ondas Cerebrales",dominant_emotion:"EmociÃ³n Dominante",physical_sensation:"SensaciÃ³n FÃ­sica",
    brainwave_audio:"Lab de Audio Cerebral",now_playing:"Reproduciendo",brainwave_sessions:"Sesiones",
    what_are_brainwaves:"Â¿QuÃ© son las Ondas Cerebrales?",select_ai_model:"Seleccionar Modelo IA",
    daily_tip:"Consejo Diario",ai_pattern:"AnÃ¡lisis de Patrones IA",analysis_dashboard:"Panel de AnÃ¡lisis",
    predictions:"Predicciones",trends:"Tendencias",personal_records:"RÃ©cords Personales",pattern_detection:"DetecciÃ³n de Patrones",
    health_profile:"Perfil de Salud",brain_training:"Entrenamiento Cerebral",lucid_dreams:"Lab de SueÃ±os LÃºcidos",
    log_dream:"Registrar SueÃ±o",ai_dream:"AnÃ¡lisis IA de SueÃ±os",lucid_techniques:"TÃ©cnicas de SueÃ±o LÃºcido",
    reality_check:"Control de Realidad",voice_media:"Voz y Media",voice_recorder:"Grabador de Voz",
    ai_voice:"Perspectivas de Voz IA",voice_memos:"Memos de Voz",media_upload:"Subir Media",
    calendar_alarms:"Calendario y Alarmas",alarms_reminders:"Alarmas y Recordatorios",reminders:"Recordatorios",
    settings:"Ajustes",appearance:"Apariencia",dark_mode:"Modo Oscuro",app_language:"Idioma",
    notifications:"Notificaciones",ai_settings:"Ajustes IA",data_management:"GestiÃ³n de Datos",
    about:"Acerca de",world_intel:"Panel de Inteligencia Mundial",cognitive_path:"IA de Estudio y Carrera",
    frontier_science:"Feed de Ciencia Frontera",system_control:"Control del Sistema",
    save:"Guardar",cancel:"Cancelar",close:"Cerrar",next:"Siguiente",previous:"Anterior",back:"Volver",
    play:"Reproducir",pause:"Pausar",analyze:"Analizar",generate:"Generar",export:"Exportar",import:"Importar",
    clear:"Limpiar",add:"Agregar",delete:"Eliminar",reset:"Restablecer",start:"Iniciar",stop:"Detener",
    saved:"Â¡Guardado!",cleared:"Limpiado",loading:"Cargando...",analyzing:"Analizando...",
    tap_record:"Toca para Grabar",live_transcript:"TranscripciÃ³n en Vivo",
    morning:"MaÃ±ana",afternoon:"Tarde",evening:"Tarde-Noche",night:"Noche",
    version:"VersiÃ³n",privacy:"Privacidad",local_mode:"Modo local â€” todos los datos en tu dispositivo",
    no_entries:"Sin entradas",log_first:"Registra tu primera entrada para ver anÃ¡lisis",
    theme_engine:"Motor de Temas",account_identity:"Capa de Identidad",consciousness_guide:"GuÃ­a de Conciencia",
    legal_policy:"Legal y PolÃ­tica",passive_telemetry:"TelemetrÃ­a Cognitiva Pasiva",
    deep_work:"Trabajo Profundo",exercise:"Ejercicio",rest:"Descanso",social:"Social",learning:"Aprendizaje",
    creative:"Creativo",meditation:"MeditaciÃ³n",entertainment:"Entretenimiento",
  },
  fr:{
    nav_log:"Journal",nav_waves:"Ondes",nav_ai:"IA Hub",nav_analysis:"Analyse",nav_health:"SantÃ©",
    nav_games:"Jeux",nav_dreams:"RÃªves",nav_media:"MÃ©dias",nav_calendar:"Calendrier",
    nav_settings:"ParamÃ¨tres",nav_world:"Monde",nav_path:"Chemin",nav_science:"Science",nav_system:"SystÃ¨me",
    daily_log:"Journal de Conscience",entry_info:"Info d'EntrÃ©e",date:"Date",time_of_day:"Moment",
    activity:"ActivitÃ©",consciousness_metrics:"MÃ©triques de Conscience",save_entry:"Sauvegarder",
    inner_state:"Ã‰tat IntÃ©rieur",reflections:"RÃ©flexions",recent_entries:"EntrÃ©es RÃ©centes",
    raw_thoughts:"PensÃ©es / Flux de Conscience",key_insight:"Insight ClÃ© du Jour",
    current_goal:"Objectif Actuel",main_obstacle:"Obstacle Principal",gratitude:"Gratitude",
    recurring_pattern:"SchÃ©ma RÃ©current",key_action:"Action ClÃ©",
    brainwave_state:"Ã‰tat des Ondes CÃ©rÃ©brales",dominant_emotion:"Ã‰motion Dominante",physical_sensation:"Sensation Physique",
    brainwave_audio:"Lab Audio CÃ©rÃ©bral",now_playing:"En Cours",brainwave_sessions:"Sessions",
    what_are_brainwaves:"Que sont les Ondes CÃ©rÃ©brales?",select_ai_model:"SÃ©lectionner le ModÃ¨le IA",
    daily_tip:"Conseil du Jour",ai_pattern:"Analyse de Patterns IA",analysis_dashboard:"Tableau de Bord",
    predictions:"PrÃ©dictions",trends:"Tendances",personal_records:"Records Personnels",pattern_detection:"DÃ©tection de Patterns",
    health_profile:"Profil de SantÃ©",brain_training:"EntraÃ®nement CÃ©rÃ©bral",lucid_dreams:"Lab de RÃªves Lucides",
    log_dream:"Enregistrer un RÃªve",ai_dream:"Analyse IA des RÃªves",lucid_techniques:"Techniques de RÃªve Lucide",
    reality_check:"VÃ©rification de RÃ©alitÃ©",voice_media:"Voix et MÃ©dias",voice_recorder:"Enregistreur Vocal",
    ai_voice:"Insights Vocaux IA",voice_memos:"MÃ©mos Vocaux",media_upload:"TÃ©lÃ©charger MÃ©dia",
    calendar_alarms:"Calendrier et Alarmes",alarms_reminders:"Alarmes et Rappels",reminders:"Rappels",
    settings:"ParamÃ¨tres",appearance:"Apparence",dark_mode:"Mode Sombre",app_language:"Langue",
    notifications:"Notifications",ai_settings:"ParamÃ¨tres IA",data_management:"Gestion des DonnÃ©es",
    about:"Ã€ Propos",world_intel:"Panneau d'Intelligence Mondiale",cognitive_path:"IA Ã‰tude et CarriÃ¨re",
    frontier_science:"Feed Science FrontiÃ¨re",system_control:"ContrÃ´le SystÃ¨me",
    save:"Sauvegarder",cancel:"Annuler",close:"Fermer",next:"Suivant",previous:"PrÃ©cÃ©dent",back:"Retour",
    play:"Lire",pause:"Pause",analyze:"Analyser",generate:"GÃ©nÃ©rer",export:"Exporter",import:"Importer",
    clear:"Effacer",add:"Ajouter",delete:"Supprimer",reset:"RÃ©initialiser",start:"DÃ©marrer",stop:"ArrÃªter",
    saved:"SauvegardÃ©!",cleared:"EffacÃ©",loading:"Chargement...",analyzing:"Analyse...",
    tap_record:"Appuyer pour Enregistrer",live_transcript:"Transcription en Direct",
    morning:"Matin",afternoon:"AprÃ¨s-midi",evening:"Soir",night:"Nuit",
    version:"Version",privacy:"ConfidentialitÃ©",local_mode:"Mode local â€” toutes les donnÃ©es sur votre appareil",
    no_entries:"Aucune entrÃ©e",log_first:"Enregistrez votre premiÃ¨re entrÃ©e pour voir l'analyse",
    theme_engine:"Moteur de ThÃ¨mes",account_identity:"Couche d'IdentitÃ©",consciousness_guide:"Guide de Conscience",
    legal_policy:"LÃ©gal et Politique",passive_telemetry:"TÃ©lÃ©mÃ©trie Cognitive Passive",
    deep_work:"Travail Profond",exercise:"Exercice",rest:"Repos",social:"Social",learning:"Apprentissage",
    creative:"CrÃ©atif",meditation:"MÃ©ditation",entertainment:"Divertissement",
  },
  de:{
    nav_log:"Tagebuch",nav_waves:"Wellen",nav_ai:"KI Hub",nav_analysis:"Analyse",nav_health:"Gesundheit",
    nav_games:"Spiele",nav_dreams:"TrÃ¤ume",nav_media:"Medien",nav_calendar:"Kalender",
    nav_settings:"Einstellungen",nav_world:"Welt",nav_path:"Pfad",nav_science:"Wissenschaft",nav_system:"System",
    daily_log:"Bewusstseins-Tagebuch",entry_info:"Eintragsinfo",date:"Datum",time_of_day:"Tageszeit",
    activity:"AktivitÃ¤t",consciousness_metrics:"Bewusstseinsmetriken",save_entry:"Speichern",
    inner_state:"Innerer Zustand",reflections:"Reflexionen",recent_entries:"Letzte EintrÃ¤ge",
    raw_thoughts:"Gedanken / Bewusstseinsstrom",key_insight:"Heutige Erkenntnis",
    current_goal:"Aktuelles Ziel",main_obstacle:"Haupthindernis",gratitude:"Dankbarkeit",
    recurring_pattern:"Wiederkehrendes Muster",key_action:"SchlÃ¼sselaktion",
    brainwave_state:"Gehirnwellenzustand",dominant_emotion:"Dominante Emotion",physical_sensation:"KÃ¶rpergefÃ¼hl",
    brainwave_audio:"Gehirnwellen-Audio-Lab",now_playing:"Jetzt lÃ¤uft",brainwave_sessions:"Sitzungen",
    what_are_brainwaves:"Was sind Gehirnwellen?",select_ai_model:"KI-Modell wÃ¤hlen",
    daily_tip:"Tagstipp",ai_pattern:"KI-Musteranalyse",analysis_dashboard:"Analyse-Dashboard",
    predictions:"Vorhersagen",trends:"Trends",personal_records:"PersÃ¶nliche Rekorde",pattern_detection:"Mustererkennung",
    health_profile:"Gesundheitsprofil",brain_training:"Gehirntraining",lucid_dreams:"Luzider Traum-Lab",
    log_dream:"Traum aufzeichnen",ai_dream:"KI-Traumanalyse",lucid_techniques:"Luzide Traumtechniken",
    reality_check:"RealitÃ¤tsprÃ¼fung",voice_media:"Stimme und Medien",voice_recorder:"Sprachrekorder",
    ai_voice:"KI-Sprach-Einblicke",voice_memos:"Sprachnotizen",media_upload:"Medien hochladen",
    calendar_alarms:"Kalender und Alarme",alarms_reminders:"Alarme und Erinnerungen",reminders:"Erinnerungen",
    settings:"Einstellungen",appearance:"Erscheinungsbild",dark_mode:"Dunkelmodus",app_language:"Sprache",
    notifications:"Benachrichtigungen",ai_settings:"KI-Einstellungen",data_management:"Datenverwaltung",
    about:"Ãœber uns",world_intel:"Weltintelligenz-Panel",cognitive_path:"Studien- und Karriere-KI",
    frontier_science:"Grenzwissenschafts-Feed",system_control:"Systemsteuerung",
    save:"Speichern",cancel:"Abbrechen",close:"SchlieÃŸen",next:"Weiter",previous:"ZurÃ¼ck",back:"ZurÃ¼ck",
    play:"Abspielen",pause:"Pausieren",analyze:"Analysieren",generate:"Generieren",export:"Exportieren",import:"Importieren",
    clear:"LÃ¶schen",add:"HinzufÃ¼gen",delete:"Entfernen",reset:"ZurÃ¼cksetzen",start:"Starten",stop:"Stoppen",
    saved:"Gespeichert!",cleared:"GelÃ¶scht",loading:"LÃ¤dt...",analyzing:"Analysiert...",
    tap_record:"Tippen zum Aufnehmen",live_transcript:"Live-Transkription",
    morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht",
    version:"Version",privacy:"Datenschutz",local_mode:"Lokaler Modus â€” alle Daten auf Ihrem GerÃ¤t",
    no_entries:"Keine EintrÃ¤ge",log_first:"Ersten Eintrag erstellen fÃ¼r Analyse",
    theme_engine:"Themen-Engine",account_identity:"IdentitÃ¤tsschicht",consciousness_guide:"BewusstseinsfÃ¼hrer",
    legal_policy:"Rechtliches und Richtlinien",passive_telemetry:"Passive kognitive Telemetrie",
    deep_work:"Tiefarbeit",exercise:"Ãœbung",rest:"Ruhe",social:"Sozial",learning:"Lernen",
    creative:"Kreativ",meditation:"Meditation",entertainment:"Unterhaltung",
  },
  pt:{
    nav_log:"DiÃ¡rio",nav_waves:"Ondas",nav_ai:"IA Hub",nav_analysis:"AnÃ¡lise",nav_health:"SaÃºde",
    nav_games:"Jogos",nav_dreams:"Sonhos",nav_media:"MÃ­dia",nav_calendar:"CalendÃ¡rio",
    nav_settings:"ConfiguraÃ§Ãµes",nav_world:"Mundo",nav_path:"Caminho",nav_science:"CiÃªncia",nav_system:"Sistema",
    daily_log:"DiÃ¡rio de ConsciÃªncia",entry_info:"Info da Entrada",date:"Data",time_of_day:"Hora do Dia",
    activity:"Atividade",consciousness_metrics:"MÃ©tricas de ConsciÃªncia",save_entry:"Salvar",
    inner_state:"Estado Interior",reflections:"ReflexÃµes",recent_entries:"Entradas Recentes",
    raw_thoughts:"Pensamentos / Fluxo de ConsciÃªncia",key_insight:"Insight Principal de Hoje",
    current_goal:"Meta Atual",main_obstacle:"Principal ObstÃ¡culo",gratitude:"GratidÃ£o",
    recurring_pattern:"PadrÃ£o Recorrente",key_action:"AÃ§Ã£o Principal",
    brainwave_state:"Estado de Ondas Cerebrais",dominant_emotion:"EmoÃ§Ã£o Dominante",physical_sensation:"SensaÃ§Ã£o FÃ­sica",
    saved:"Salvo!",cleared:"Limpo",save:"Salvar",morning:"ManhÃ£",afternoon:"Tarde",evening:"Tarde/Noite",night:"Noite",
  },
  zh:{
    nav_log:"æ—¥å¿—",nav_waves:"è„‘æ³¢",nav_ai:"AIä¸­å¿ƒ",nav_analysis:"åˆ†æž",nav_health:"å¥åº·",
    nav_games:"æ¸¸æˆ",nav_dreams:"æ¢¦å¢ƒ",nav_media:"åª’ä½“",nav_calendar:"æ—¥åŽ†",
    nav_settings:"è®¾ç½®",nav_world:"ä¸–ç•Œ",nav_path:"è·¯å¾„",nav_science:"ç§‘å­¦",nav_system:"ç³»ç»Ÿ",
    daily_log:"æ¯æ—¥æ„è¯†æ—¥å¿—",entry_info:"æ¡ç›®ä¿¡æ¯",date:"æ—¥æœŸ",time_of_day:"æ—¶é—´æ®µ",
    activity:"æ´»åŠ¨",consciousness_metrics:"æ„è¯†æŒ‡æ ‡",save_entry:"ä¿å­˜",
    inner_state:"å†…å¿ƒçŠ¶æ€",reflections:"åæ€",recent_entries:"æœ€è¿‘æ¡ç›®",
    raw_thoughts:"åŽŸå§‹æƒ³æ³• / æ„è¯†æµ",key_insight:"ä»Šæ—¥å…³é”®æ´žå¯Ÿ",
    current_goal:"å½“å‰ç›®æ ‡",main_obstacle:"ä¸»è¦éšœç¢",gratitude:"æ„Ÿæ©",
    recurring_pattern:"é‡å¤æ¨¡å¼",key_action:"å…³é”®è¡ŒåŠ¨",
    brainwave_state:"è„‘æ³¢çŠ¶æ€",dominant_emotion:"ä¸»å¯¼æƒ…ç»ª",physical_sensation:"èº«ä½“æ„Ÿè§‰",
    saved:"å·²ä¿å­˜ï¼",cleared:"å·²æ¸…é™¤",save:"ä¿å­˜",morning:"æ—©æ™¨",afternoon:"ä¸‹åˆ",evening:"å‚æ™š",night:"å¤œæ™š",
  },
  ar:{
    nav_log:"Ø³Ø¬Ù„",nav_waves:"Ù…ÙˆØ¬Ø§Øª",nav_ai:"Ù…Ø±ÙƒØ² AI",nav_analysis:"ØªØ­Ù„ÙŠÙ„",nav_health:"ØµØ­Ø©",
    nav_games:"Ø£Ù„Ø¹Ø§Ø¨",nav_dreams:"Ø£Ø­Ù„Ø§Ù…",nav_media:"ÙˆØ³Ø§Ø¦Ø·",nav_calendar:"ØªÙ‚ÙˆÙŠÙ…",
    nav_settings:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",nav_world:"Ø¹Ø§Ù„Ù…",nav_path:"Ù…Ø³Ø§Ø±",nav_science:"Ø¹Ù„ÙˆÙ…",nav_system:"Ù†Ø¸Ø§Ù…",
    daily_log:"Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ",entry_info:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„",date:"Ø§Ù„ØªØ§Ø±ÙŠØ®",time_of_day:"ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ…",
    activity:"Ø§Ù„Ù†Ø´Ø§Ø·",consciousness_metrics:"Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ÙˆØ¹ÙŠ",save_entry:"Ø­ÙØ¸",
    inner_state:"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©",reflections:"ØªØ£Ù…Ù„Ø§Øª",recent_entries:"Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©",
    raw_thoughts:"Ø£ÙÙƒØ§Ø± Ø®Ø§Ù… / ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¹ÙŠ",key_insight:"Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ÙŠÙˆÙ…",
    current_goal:"Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ",main_obstacle:"Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",gratitude:"Ø§Ù…ØªÙ†Ø§Ù†",
    recurring_pattern:"Ù†Ù…Ø· Ù…ØªÙƒØ±Ø±",key_action:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",
    brainwave_state:"Ø­Ø§Ù„Ø© Ù…ÙˆØ¬Ø§Øª Ø§Ù„Ø¯Ù…Ø§Øº",dominant_emotion:"Ø§Ù„Ø¹Ø§Ø·ÙØ© Ø§Ù„Ø³Ø§Ø¦Ø¯Ø©",physical_sensation:"Ø§Ù„Ø¥Ø­Ø³Ø§Ø³ Ø§Ù„Ø¬Ø³Ø¯ÙŠ",
    saved:"ØªÙ… Ø§Ù„Ø­ÙØ¸!",cleared:"ØªÙ… Ø§Ù„Ù…Ø³Ø­",save:"Ø­ÙØ¸",morning:"ØµØ¨Ø§Ø­",afternoon:"Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±",evening:"Ù…Ø³Ø§Ø¡",night:"Ù„ÙŠÙ„",
  },
  ja:{
    nav_log:"ãƒ­ã‚°",nav_waves:"æ³¢å‹•",nav_ai:"AIãƒãƒ–",nav_analysis:"åˆ†æž",nav_health:"å¥åº·",
    nav_games:"ã‚²ãƒ¼ãƒ ",nav_dreams:"å¤¢",nav_media:"ãƒ¡ãƒ‡ã‚£ã‚¢",nav_calendar:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼",
    nav_settings:"è¨­å®š",nav_world:"ä¸–ç•Œ",nav_path:"ãƒ‘ã‚¹",nav_science:"ç§‘å­¦",nav_system:"ã‚·ã‚¹ãƒ†ãƒ ",
    daily_log:"æ—¥æ¬¡æ„è­˜ãƒ­ã‚°",entry_info:"ã‚¨ãƒ³ãƒˆãƒªãƒ¼æƒ…å ±",date:"æ—¥ä»˜",time_of_day:"æ™‚é–“å¸¯",
    activity:"æ´»å‹•",consciousness_metrics:"æ„è­˜æŒ‡æ¨™",save_entry:"ä¿å­˜",
    inner_state:"å†…çš„çŠ¶æ…‹",reflections:"åçœ",recent_entries:"æœ€è¿‘ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼",
    raw_thoughts:"ç”Ÿã®æ€è€ƒ / æ„è­˜ã®æµã‚Œ",key_insight:"ä»Šæ—¥ã®ä¸»è¦ãªæ´žå¯Ÿ",
    current_goal:"ç¾åœ¨ã®ç›®æ¨™",main_obstacle:"ä¸»ãªéšœå®³",gratitude:"æ„Ÿè¬",
    recurring_pattern:"ç¹°ã‚Šè¿”ã—ãƒ‘ã‚¿ãƒ¼ãƒ³",key_action:"ä¸»è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
    brainwave_state:"è„³æ³¢çŠ¶æ…‹",dominant_emotion:"æ”¯é…çš„ãªæ„Ÿæƒ…",physical_sensation:"èº«ä½“æ„Ÿè¦š",
    saved:"ä¿å­˜æ¸ˆã¿ï¼",cleared:"ã‚¯ãƒªã‚¢æ¸ˆã¿",save:"ä¿å­˜",morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤•æ–¹",night:"å¤œ",
  },
  ru:{
    nav_log:"Ð–ÑƒÑ€Ð½Ð°Ð»",nav_waves:"Ð’Ð¾Ð»Ð½Ñ‹",nav_ai:"Ð˜Ð˜ Ð¥Ð°Ð±",nav_analysis:"ÐÐ½Ð°Ð»Ð¸Ð·",nav_health:"Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ",
    nav_games:"Ð˜Ð³Ñ€Ñ‹",nav_dreams:"Ð¡Ð½Ñ‹",nav_media:"ÐœÐµÐ´Ð¸Ð°",nav_calendar:"ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑŒ",
    nav_settings:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",nav_world:"ÐœÐ¸Ñ€",nav_path:"ÐŸÑƒÑ‚ÑŒ",nav_science:"ÐÐ°ÑƒÐºÐ°",nav_system:"Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð°",
    daily_log:"Ð–ÑƒÑ€Ð½Ð°Ð» Ð¡Ð¾Ð·Ð½Ð°Ð½Ð¸Ñ",entry_info:"Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ",date:"Ð”Ð°Ñ‚Ð°",time_of_day:"Ð’Ñ€ÐµÐ¼Ñ ÑÑƒÑ‚Ð¾Ðº",
    activity:"ÐÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ",consciousness_metrics:"ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¡Ð¾Ð·Ð½Ð°Ð½Ð¸Ñ",save_entry:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",
    inner_state:"Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ",reflections:"Ð Ð°Ð·Ð¼Ñ‹ÑˆÐ»ÐµÐ½Ð¸Ñ",recent_entries:"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸",
    raw_thoughts:"ÐœÑ‹ÑÐ»Ð¸ / ÐŸÐ¾Ñ‚Ð¾Ðº ÑÐ¾Ð·Ð½Ð°Ð½Ð¸Ñ",key_insight:"ÐšÐ»ÑŽÑ‡ÐµÐ²Ð¾Ðµ Ð¾Ð·Ð°Ñ€ÐµÐ½Ð¸Ðµ Ð´Ð½Ñ",
    current_goal:"Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ñ†ÐµÐ»ÑŒ",main_obstacle:"Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¿Ñ€ÐµÐ¿ÑÑ‚ÑÑ‚Ð²Ð¸Ðµ",gratitude:"Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒ",
    recurring_pattern:"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰Ð¸Ð¹ÑÑ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½",key_action:"ÐšÐ»ÑŽÑ‡ÐµÐ²Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ",
    brainwave_state:"Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð¼Ð¾Ð·Ð³Ð¾Ð²Ñ‹Ñ… Ð²Ð¾Ð»Ð½",dominant_emotion:"Ð”Ð¾Ð¼Ð¸Ð½Ð¸Ñ€ÑƒÑŽÑ‰Ð°Ñ ÑÐ¼Ð¾Ñ†Ð¸Ñ",physical_sensation:"Ð¤Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¾Ñ‰ÑƒÑ‰ÐµÐ½Ð¸Ñ",
    saved:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¾!",cleared:"ÐžÑ‡Ð¸Ñ‰ÐµÐ½Ð¾",save:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",morning:"Ð£Ñ‚Ñ€Ð¾",afternoon:"Ð”ÐµÐ½ÑŒ",evening:"Ð’ÐµÑ‡ÐµÑ€",night:"ÐÐ¾Ñ‡ÑŒ",
  }
};
let curLang=localStorage.getItem('cos_lang')||'en';
function t(key){return(LANGS[curLang]||LANGS.en)[key]||LANGS.en[key]||key;}
function setLang(lang){
  curLang=lang;localStorage.setItem('cos_lang',lang);
  applyFullTranslation(lang);
  buildNav();
}

// â”€â”€ COMPREHENSIVE TRANSLATION ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Maps exact English text â†’ translation key (for DOM text walker)
const TEXT_MAP_EN={
  "Daily Consciousness Log":"daily_log","Entry Info":"entry_info","Date":"date",
  "Time of Day":"time_of_day","Activity":"activity","Consciousness Metrics":"consciousness_metrics",
  "Save Entry":"save_entry","Brainwave Audio Lab":"brainwave_audio",
  "AI Hub":"ai_hub","Analysis Dashboard":"analysis","Health Profile":"health_profile",
  "Brain Training":"brain_training","Lucid Dreams Lab":"lucid_dreams",
  "Voice & Media Archive":"voice_media","Calendar & Alarms":"calendar_alarms",
  "World Intelligence Panel":"world_intel","Study & Career Intelligence":"study_career",
  "Frontier Intelligence Feed":"frontier_science","System Control":"system_control",
  "Now Playing":"lbl_now_playing","Dark Mode":"lbl_dark_mode","App Language":"lbl_language",
  "Predictions":"lbl_predictions","Trends":"lbl_trends","Personal Records":"lbl_records",
  "Pattern Detection":"lbl_patterns","Dream Journal":"lbl_dream_journal",
  "Voice Memos":"lbl_voice_memos","Alarms & Reminders":"lbl_alarms",
  "Appearance":"lbl_appearance","Notifications":"lbl_notifications","About":"lbl_about",
  "Themes":"lbl_themes","Account":"lbl_account","Guide":"lbl_guide","Legal":"lbl_legal","Telemetry":"lbl_telemetry",
};
// Expanded LANGS with all keys for all languages
const LANGS_EXTRA={
  en:{
    lbl_now_playing:"Now Playing",lbl_dark_mode:"Dark Mode",lbl_language:"App Language",
    lbl_predictions:"Predictions",lbl_trends:"Trends",lbl_records:"Personal Records",
    lbl_patterns:"Pattern Detection",lbl_dream_journal:"Dream Journal",lbl_voice_memos:"Voice Memos",
    lbl_alarms:"Alarms & Reminders",lbl_appearance:"Appearance",lbl_notifications:"Notifications",
    lbl_about:"About",lbl_themes:"Themes",lbl_account:"Account",lbl_guide:"Guide",
    lbl_legal:"Legal",lbl_telemetry:"Telemetry",lbl_analysis_ai:"AI Pattern Analysis",
    brainwave_audio:"Brainwave Audio Lab",ai_hub:"AI Hub",analysis:"Analysis Dashboard",
    health_profile:"Health Profile",brain_training:"Brain Training",lucid_dreams:"Lucid Dreams Lab",
    voice_media:"Voice & Media Archive",calendar_alarms:"Calendar & Alarms",
    world_intel:"World Intelligence Panel",study_career:"Study & Career Intelligence",
    frontier_science:"Frontier Intelligence Feed",system_control:"System Control",
    placeholder_thoughts:"What's on your mind right now?",placeholder_insight:"What did you realize?",
    placeholder_goal:"What are you working toward?",placeholder_obstacle:"What's blocking you?",
    placeholder_gratitude:"3 things you're grateful for...",placeholder_dream_name:"Give it a name...",
    placeholder_chat:"Ask me anything about your consciousness, health, dreams...",
    placeholder_world_ask:"Ask about any geopolitical or economic force...",
    placeholder_science_ask:"Ask anything about frontier science...",
  },
  hi:{
    lbl_now_playing:"à¤…à¤­à¥€ à¤¬à¤œ à¤°à¤¹à¤¾ à¤¹à¥ˆ",lbl_dark_mode:"à¤¡à¤¾à¤°à¥à¤• à¤®à¥‹à¤¡",lbl_language:"à¤à¤ª à¤­à¤¾à¤·à¤¾",
    lbl_predictions:"à¤­à¤µà¤¿à¤·à¥à¤¯à¤µà¤¾à¤£à¤¿à¤¯à¤¾à¤",lbl_trends:"à¤ªà¥à¤°à¤µà¥ƒà¤¤à¥à¤¤à¤¿à¤¯à¤¾à¤",lbl_records:"à¤µà¥à¤¯à¤•à¥à¤¤à¤¿à¤—à¤¤ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡",
    lbl_patterns:"à¤ªà¥ˆà¤Ÿà¤°à¥à¤¨ à¤ªà¤¹à¤šà¤¾à¤¨",lbl_dream_journal:"à¤¸à¤ªà¤¨à¤¾ à¤¡à¤¾à¤¯à¤°à¥€",lbl_voice_memos:"à¤µà¥‰à¤¯à¤¸ à¤®à¥‡à¤®à¥‹",
    lbl_alarms:"à¤…à¤²à¤¾à¤°à¥à¤® à¤”à¤° à¤°à¤¿à¤®à¤¾à¤‡à¤‚à¤¡à¤°",lbl_appearance:"à¤°à¥‚à¤ª-à¤°à¤‚à¤—",lbl_notifications:"à¤¸à¥‚à¤šà¤¨à¤¾à¤à¤",
    lbl_about:"à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚",lbl_themes:"à¤¥à¥€à¤®",lbl_account:"à¤–à¤¾à¤¤à¤¾",lbl_guide:"à¤—à¤¾à¤‡à¤¡",
    lbl_legal:"à¤•à¤¾à¤¨à¥‚à¤¨à¥€",lbl_telemetry:"à¤Ÿà¥‡à¤²à¥€à¤®à¥‡à¤Ÿà¥à¤°à¥€",lbl_analysis_ai:"AI à¤ªà¥ˆà¤Ÿà¤°à¥à¤¨ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",
    brainwave_audio:"à¤¬à¥à¤°à¥‡à¤¨à¤µà¥‡à¤µ à¤‘à¤¡à¤¿à¤¯à¥‹ à¤²à¥ˆà¤¬",ai_hub:"AI à¤¹à¤¬",analysis:"à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
    health_profile:"à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯ à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤²",brain_training:"à¤®à¤¸à¥à¤¤à¤¿à¤·à¥à¤• à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£",lucid_dreams:"à¤²à¥à¤¯à¥‚à¤¸à¤¿à¤¡ à¤¡à¥à¤°à¥€à¤®à¥à¤¸ à¤²à¥ˆà¤¬",
    voice_media:"à¤µà¥‰à¤¯à¤¸ à¤”à¤° à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤†à¤°à¥à¤•à¤¾à¤‡à¤µ",calendar_alarms:"à¤•à¥ˆà¤²à¥‡à¤‚à¤¡à¤° à¤”à¤° à¤…à¤²à¤¾à¤°à¥à¤®",
    world_intel:"à¤µà¤¿à¤¶à¥à¤µ à¤¬à¥à¤¦à¥à¤§à¤¿ à¤ªà¥ˆà¤¨à¤²",study_career:"à¤…à¤§à¥à¤¯à¤¯à¤¨ à¤”à¤° à¤•à¤°à¤¿à¤¯à¤° AI",
    frontier_science:"à¤«à¥à¤°à¤‚à¤Ÿà¤¿à¤¯à¤° à¤‡à¤‚à¤Ÿà¥‡à¤²à¤¿à¤œà¥‡à¤‚à¤¸ à¤«à¥€à¤¡",system_control:"à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤•à¤‚à¤Ÿà¥à¤°à¥‹à¤²",
    placeholder_thoughts:"à¤…à¤­à¥€ à¤†à¤ªà¤•à¥‡ à¤¦à¤¿à¤®à¤¾à¤— à¤®à¥‡à¤‚ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?",placeholder_insight:"à¤†à¤ªà¤¨à¥‡ à¤•à¥à¤¯à¤¾ à¤®à¤¹à¤¸à¥‚à¤¸ à¤•à¤¿à¤¯à¤¾?",
    placeholder_goal:"à¤†à¤ª à¤•à¤¿à¤¸ à¤¦à¤¿à¤¶à¤¾ à¤®à¥‡à¤‚ à¤•à¤¾à¤® à¤•à¤° à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚?",placeholder_obstacle:"à¤†à¤ªà¤•à¥‹ à¤•à¥à¤¯à¤¾ à¤°à¥‹à¤• à¤°à¤¹à¤¾ à¤¹à¥ˆ?",
    placeholder_gratitude:"3 à¤šà¥€à¤œà¥‡à¤‚ à¤œà¤¿à¤¨à¤•à¥‡ à¤²à¤¿à¤ à¤†à¤ª à¤†à¤­à¤¾à¤°à¥€ à¤¹à¥ˆà¤‚...",placeholder_dream_name:"à¤¨à¤¾à¤® à¤¦à¥‡à¤‚...",
    placeholder_chat:"à¤…à¤ªà¤¨à¥€ à¤šà¥‡à¤¤à¤¨à¤¾, à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯, à¤¸à¤ªà¤¨à¥‹à¤‚ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤•à¥à¤› à¤­à¥€ à¤ªà¥‚à¤›à¥‡à¤‚...",
    placeholder_world_ask:"à¤•à¤¿à¤¸à¥€ à¤­à¥€ à¤­à¥‚-à¤°à¤¾à¤œà¤¨à¥€à¤¤à¤¿à¤• à¤¯à¤¾ à¤†à¤°à¥à¤¥à¤¿à¤• à¤¶à¤•à¥à¤¤à¤¿ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤ªà¥‚à¤›à¥‡à¤‚...",
  },
  es:{
    lbl_now_playing:"Reproduciendo Ahora",lbl_dark_mode:"Modo Oscuro",lbl_language:"Idioma de la App",
    lbl_predictions:"Predicciones",lbl_trends:"Tendencias",lbl_records:"RÃ©cords Personales",
    lbl_patterns:"DetecciÃ³n de Patrones",lbl_dream_journal:"Diario de SueÃ±os",lbl_voice_memos:"Memos de Voz",
    lbl_alarms:"Alarmas y Recordatorios",lbl_appearance:"Apariencia",lbl_notifications:"Notificaciones",
    lbl_about:"Acerca de",lbl_themes:"Temas",lbl_account:"Cuenta",lbl_guide:"GuÃ­a",lbl_legal:"Legal",lbl_telemetry:"TelemetrÃ­a",
    brainwave_audio:"Lab de Audio Cerebral",ai_hub:"Hub de IA",analysis:"Panel de AnÃ¡lisis",
    health_profile:"Perfil de Salud",brain_training:"Entrenamiento Mental",lucid_dreams:"Lab de SueÃ±os LÃºcidos",
    world_intel:"Panel de Inteligencia Mundial",placeholder_thoughts:"Â¿QuÃ© hay en tu mente?",
    placeholder_chat:"PregÃºntame cualquier cosa sobre tu conciencia...",
  },
  fr:{
    lbl_now_playing:"Lecture en cours",lbl_dark_mode:"Mode Sombre",lbl_language:"Langue de l'App",
    lbl_predictions:"PrÃ©dictions",lbl_trends:"Tendances",lbl_records:"Records Personnels",
    lbl_patterns:"DÃ©tection de Patterns",lbl_dream_journal:"Journal des RÃªves",lbl_voice_memos:"MÃ©mos Vocaux",
    lbl_alarms:"Alarmes et Rappels",lbl_appearance:"Apparence",lbl_notifications:"Notifications",
    lbl_about:"Ã€ propos",lbl_themes:"ThÃ¨mes",lbl_account:"Compte",lbl_guide:"Guide",lbl_legal:"LÃ©gal",lbl_telemetry:"TÃ©lÃ©mÃ©trie",
    brainwave_audio:"Lab Audio CÃ©rÃ©bral",ai_hub:"Hub IA",analysis:"Tableau de Bord",
    health_profile:"Profil SantÃ©",placeholder_thoughts:"Qu'est-ce qui vous prÃ©occupe?",
    placeholder_chat:"Posez-moi des questions sur votre conscience...",
  },
  de:{
    lbl_dark_mode:"Dunkelmodus",lbl_language:"App-Sprache",lbl_predictions:"Vorhersagen",
    lbl_trends:"Trends",lbl_records:"PersÃ¶nliche Rekorde",lbl_patterns:"Mustererkennung",
    lbl_now_playing:"Jetzt lÃ¤uft",lbl_dream_journal:"Traumtagebuch",lbl_voice_memos:"Sprachnotizen",
    lbl_alarms:"Alarme & Erinnerungen",lbl_appearance:"Darstellung",lbl_notifications:"Benachrichtigungen",
    lbl_about:"Ãœber",lbl_themes:"Themen",lbl_account:"Konto",lbl_guide:"Leitfaden",lbl_legal:"Rechtliches",lbl_telemetry:"Telemetrie",
    brainwave_audio:"Gehirnwellen Audio Lab",ai_hub:"KI Hub",analysis:"Analyse-Dashboard",
    health_profile:"Gesundheitsprofil",brain_training:"Gehirntraining",lucid_dreams:"Klartraum Lab",
    world_intel:"Weltintelligenz-Panel",study_career:"Studium & Karriere KI",
    frontier_science:"Grenzwissenschaft Feed",system_control:"Systemsteuerung",
    save:"Speichern",cancel:"Abbrechen",close:"SchlieÃŸen",next:"Weiter",previous:"ZurÃ¼ck",back:"ZurÃ¼ck",
    play:"Abspielen",pause:"Pause",analyze:"Analysieren",generate:"Erstellen",export:"Exportieren",
    clear:"LÃ¶schen",add:"HinzufÃ¼gen",delete:"Entfernen",reset:"ZurÃ¼cksetzen",start:"Starten",stop:"Stoppen",
    morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht",
    daily_log:"TÃ¤gliches Bewusstseinsprotokoll",entry_info:"Eintragsinformation",date:"Datum",time_of_day:"Tageszeit",
    activity:"AktivitÃ¤t",save_entry:"Eintrag speichern",
    inner_state:"Innerer Zustand",reflections:"Reflexionen",recent_entries:"Letzte EintrÃ¤ge",
    raw_thoughts:"Gedankenfluss / Bewusstseinsstrom",key_insight:"Heutiger SchlÃ¼ssel-Einblick",
    current_goal:"Aktuelles Ziel",main_obstacle:"Haupthindernis",gratitude:"Dankbarkeit",
    placeholder_thoughts:"Was beschÃ¤ftigt Sie gerade?",placeholder_insight:"Was haben Sie erkannt?",
    placeholder_goal:"Woran arbeiten Sie?",placeholder_obstacle:"Was hÃ¤lt Sie auf?",
    placeholder_gratitude:"3 Dinge, fÃ¼r die Sie dankbar sind...",placeholder_dream_name:"Gib ihm einen Namen...",
    placeholder_chat:"Stellen Sie Fragen zu Ihrem Bewusstsein...",
    placeholder_world_ask:"Fragen Sie zu geopolitischen oder wirtschaftlichen KrÃ¤ften...",
    placeholder_science_ask:"Fragen Sie alles Ã¼ber Grenzwissenschaft...",
  },
  pt:{
    lbl_dark_mode:"Modo Escuro",lbl_language:"Idioma do App",lbl_now_playing:"Tocando Agora",
    lbl_predictions:"PrevisÃµes",lbl_trends:"TendÃªncias",lbl_records:"Recordes Pessoais",
    lbl_patterns:"DetecÃ§Ã£o de PadrÃµes",lbl_dream_journal:"DiÃ¡rio de Sonhos",lbl_voice_memos:"Notas de Voz",
    lbl_alarms:"Alarmes e Lembretes",lbl_appearance:"AparÃªncia",lbl_notifications:"NotificaÃ§Ãµes",
    lbl_about:"Sobre",lbl_themes:"Temas",lbl_account:"Conta",lbl_guide:"Guia",lbl_legal:"Legal",lbl_telemetry:"Telemetria",
    brainwave_audio:"Lab de Ãudio de Ondas Cerebrais",ai_hub:"Hub de IA",analysis:"Painel de AnÃ¡lise",
    health_profile:"Perfil de SaÃºde",brain_training:"Treinamento Mental",lucid_dreams:"Lab de Sonhos LÃºcidos",
    world_intel:"Painel de InteligÃªncia Mundial",study_career:"IA de Estudo e Carreira",
    frontier_science:"Feed de CiÃªncia de Fronteira",system_control:"Controle do Sistema",
    save:"Salvar",cancel:"Cancelar",close:"Fechar",next:"PrÃ³ximo",previous:"Anterior",back:"Voltar",
    morning:"ManhÃ£",afternoon:"Tarde",evening:"Noite",night:"Madrugada",
    daily_log:"DiÃ¡rio de ConsciÃªncia",date:"Data",time_of_day:"Hora do Dia",activity:"Atividade",save_entry:"Salvar Entrada",
    inner_state:"Estado Interior",reflections:"ReflexÃµes",recent_entries:"Entradas Recentes",
    current_goal:"Meta Atual",gratitude:"GratidÃ£o",
    placeholder_thoughts:"O que estÃ¡ em sua mente agora?",placeholder_chat:"Pergunte sobre sua consciÃªncia...",
    placeholder_world_ask:"Pergunte sobre forÃ§as geopolÃ­ticas...",
  },
  zh:{
    lbl_dark_mode:"æ·±è‰²æ¨¡å¼",lbl_language:"åº”ç”¨è¯­è¨€",lbl_now_playing:"æ­£åœ¨æ’­æ”¾",
    lbl_predictions:"é¢„æµ‹",lbl_trends:"è¶‹åŠ¿",lbl_records:"ä¸ªäººè®°å½•",
    lbl_patterns:"æ¨¡å¼æ£€æµ‹",lbl_dream_journal:"æ¢¦å¢ƒæ—¥è®°",lbl_voice_memos:"è¯­éŸ³å¤‡å¿˜å½•",
    lbl_alarms:"é—¹é’Ÿå’Œæé†’",lbl_appearance:"å¤–è§‚",lbl_notifications:"é€šçŸ¥",
    lbl_about:"å…³äºŽ",lbl_themes:"ä¸»é¢˜",lbl_account:"è´¦æˆ·",lbl_guide:"æŒ‡å—",lbl_legal:"æ³•å¾‹",lbl_telemetry:"é¥æµ‹",
    brainwave_audio:"è„‘æ³¢éŸ³é¢‘å®žéªŒå®¤",ai_hub:"AIä¸­å¿ƒ",analysis:"åˆ†æžä»ªè¡¨æ¿",
    health_profile:"å¥åº·æ¡£æ¡ˆ",brain_training:"å¤§è„‘è®­ç»ƒ",lucid_dreams:"æ¸…é†’æ¢¦å®žéªŒå®¤",
    world_intel:"ä¸–ç•Œæƒ…æŠ¥é¢æ¿",study_career:"å­¦ä¹ ä¸ŽèŒä¸šAI",
    frontier_science:"å‰æ²¿ç§‘å­¦èµ„è®¯",system_control:"ç³»ç»ŸæŽ§åˆ¶",
    save:"ä¿å­˜",cancel:"å–æ¶ˆ",close:"å…³é—­",next:"ä¸‹ä¸€æ­¥",previous:"ä¸Šä¸€æ­¥",back:"è¿”å›ž",
    morning:"æ—©æ™¨",afternoon:"ä¸‹åˆ",evening:"å‚æ™š",night:"æ·±å¤œ",
    daily_log:"æ¯æ—¥æ„è¯†æ—¥å¿—",date:"æ—¥æœŸ",time_of_day:"ä¸€å¤©ä¸­çš„æ—¶é—´",activity:"æ´»åŠ¨",save_entry:"ä¿å­˜æ¡ç›®",
    inner_state:"å†…å¿ƒçŠ¶æ€",reflections:"åæ€",recent_entries:"æœ€è¿‘æ¡ç›®",
    current_goal:"å½“å‰ç›®æ ‡",gratitude:"æ„Ÿæ©",
    placeholder_thoughts:"æ‚¨çŽ°åœ¨åœ¨æƒ³ä»€ä¹ˆ?",placeholder_chat:"è¯¢é—®å…³äºŽæ‚¨æ„è¯†çš„ä»»ä½•é—®é¢˜...",
    placeholder_world_ask:"è¯¢é—®ä»»ä½•åœ°ç¼˜æ”¿æ²»æˆ–ç»æµŽåŠ›é‡...",
  },
  ar:{
    lbl_dark_mode:"Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†",lbl_language:"Ù„ØºØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚",lbl_now_playing:"ÙŠØ¹Ø²Ù Ø§Ù„Ø¢Ù†",
    lbl_predictions:"ØªÙ†Ø¨Ø¤Ø§Øª",lbl_trends:"Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª",lbl_records:"Ø³Ø¬Ù„Ø§Øª Ø´Ø®ØµÙŠØ©",
    lbl_patterns:"Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø£Ù†Ù…Ø§Ø·",lbl_dream_journal:"Ù…Ø¬Ù„Ø© Ø§Ù„Ø£Ø­Ù„Ø§Ù…",lbl_voice_memos:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØµÙˆØªÙŠØ©",
    lbl_alarms:"Ø§Ù„Ù…Ù†Ø¨Ù‡Ø§Øª ÙˆØ§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª",lbl_appearance:"Ø§Ù„Ù…Ø¸Ù‡Ø±",lbl_notifications:"Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
    lbl_about:"Ø­ÙˆÙ„",lbl_themes:"Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±",lbl_account:"Ø­Ø³Ø§Ø¨",lbl_guide:"Ø¯Ù„ÙŠÙ„",lbl_legal:"Ù‚Ø§Ù†ÙˆÙ†ÙŠ",lbl_telemetry:"Ø§Ù„Ù‚ÙŠØ§Ø³ Ø¹Ù† Ø¨ÙØ¹Ø¯",
    brainwave_audio:"Ù…Ø®ØªØ¨Ø± ØµÙˆØª Ù…ÙˆØ¬Ø§Øª Ø§Ù„Ø¯Ù…Ø§Øº",ai_hub:"Ù…Ø±ÙƒØ² Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",analysis:"Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„",
    health_profile:"Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµØ­ÙŠ",brain_training:"ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¯Ù…Ø§Øº",lucid_dreams:"Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø£Ø­Ù„Ø§Ù… Ø§Ù„ÙˆØ§Ø¶Ø­Ø©",
    world_intel:"Ù„ÙˆØ­Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¨Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©",study_career:"Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© ÙˆØ§Ù„Ù…Ù‡Ù†Ø©",
    frontier_science:"ØªØºØ°ÙŠØ© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø¯ÙŠØ©",system_control:"Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…",
    save:"Ø­ÙØ¸",cancel:"Ø¥Ù„ØºØ§Ø¡",close:"Ø¥ØºÙ„Ø§Ù‚",next:"Ø§Ù„ØªØ§Ù„ÙŠ",previous:"Ø§Ù„Ø³Ø§Ø¨Ù‚",back:"Ø±Ø¬ÙˆØ¹",
    morning:"ØµØ¨Ø§Ø­",afternoon:"Ø¸Ù‡Ø±",evening:"Ù…Ø³Ø§Ø¡",night:"Ù„ÙŠÙ„",
    daily_log:"Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ",date:"ØªØ§Ø±ÙŠØ®",time_of_day:"ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ…",activity:"Ù†Ø´Ø§Ø·",save_entry:"Ø­ÙØ¸ Ø§Ù„Ù…Ø¯Ø®Ù„",
    inner_state:"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©",reflections:"ØªØ£Ù…Ù„Ø§Øª",recent_entries:"Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©",
    current_goal:"Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ",gratitude:"Ø§Ù…ØªÙ†Ø§Ù†",
    placeholder_thoughts:"Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠØ´ØºÙ„ Ø°Ù‡Ù†Ùƒ Ø§Ù„Ø¢Ù†ØŸ",placeholder_chat:"Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡ Ø¹Ù† ÙˆØ¹ÙŠÙƒ...",
    placeholder_world_ask:"Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ù‚ÙˆØ© Ø¬ÙŠÙˆØ³ÙŠØ§Ø³ÙŠØ© Ø£Ùˆ Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©...",
  },
  ja:{
    lbl_dark_mode:"ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰",lbl_language:"ã‚¢ãƒ—ãƒªã®è¨€èªž",lbl_now_playing:"å†ç”Ÿä¸­",
    lbl_predictions:"äºˆæ¸¬",lbl_trends:"ãƒˆãƒ¬ãƒ³ãƒ‰",lbl_records:"å€‹äººè¨˜éŒ²",
    lbl_patterns:"ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º",lbl_dream_journal:"å¤¢æ—¥è¨˜",lbl_voice_memos:"ãƒœã‚¤ã‚¹ãƒ¡ãƒ¢",
    lbl_alarms:"ã‚¢ãƒ©ãƒ¼ãƒ ã¨ãƒªãƒžã‚¤ãƒ³ãƒ€ãƒ¼",lbl_appearance:"å¤–è¦³",lbl_notifications:"é€šçŸ¥",
    lbl_about:"ã«ã¤ã„ã¦",lbl_themes:"ãƒ†ãƒ¼ãƒž",lbl_account:"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ",lbl_guide:"ã‚¬ã‚¤ãƒ‰",lbl_legal:"æ³•å¾‹",lbl_telemetry:"ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼",
    brainwave_audio:"è„³æ³¢ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ©ãƒœ",ai_hub:"AIãƒãƒ–",analysis:"åˆ†æžãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
    health_profile:"å¥åº·ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«",brain_training:"è„³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",lucid_dreams:"æ˜Žæ™°å¤¢ãƒ©ãƒœ",
    world_intel:"ä¸–ç•Œæƒ…å ±ãƒ‘ãƒãƒ«",study_career:"å­¦ç¿’ãƒ»ã‚­ãƒ£ãƒªã‚¢AI",
    frontier_science:"ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢ç§‘å­¦ãƒ•ã‚£ãƒ¼ãƒ‰",system_control:"ã‚·ã‚¹ãƒ†ãƒ åˆ¶å¾¡",
    save:"ä¿å­˜",cancel:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",close:"é–‰ã˜ã‚‹",next:"æ¬¡ã¸",previous:"å‰ã¸",back:"æˆ»ã‚‹",
    morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤•æ–¹",night:"å¤œ",
    daily_log:"æ¯Žæ—¥ã®æ„è­˜ãƒ­ã‚°",date:"æ—¥ä»˜",time_of_day:"æ™‚é–“å¸¯",activity:"æ´»å‹•",save_entry:"ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ä¿å­˜",
    inner_state:"å†…ãªã‚‹çŠ¶æ…‹",reflections:"æŒ¯ã‚Šè¿”ã‚Š",recent_entries:"æœ€è¿‘ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼",
    current_goal:"ç¾åœ¨ã®ç›®æ¨™",gratitude:"æ„Ÿè¬",
    placeholder_thoughts:"ä»Šã€ä½•ã‚’è€ƒãˆã¦ã„ã¾ã™ã‹ï¼Ÿ",placeholder_chat:"æ„è­˜ã«ã¤ã„ã¦ä½•ã§ã‚‚èžã„ã¦ãã ã•ã„...",
    placeholder_world_ask:"åœ°æ”¿å­¦çš„ãƒ»çµŒæ¸ˆçš„ãªåŠ›ã«ã¤ã„ã¦èžã„ã¦ãã ã•ã„...",
  },
  ru:{
    lbl_dark_mode:"Ð¢Ñ‘Ð¼Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼",lbl_language:"Ð¯Ð·Ñ‹Ðº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ",lbl_now_playing:"Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð³Ñ€Ð°ÐµÑ‚",
    lbl_predictions:"ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð·Ñ‹",lbl_trends:"Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ð¸",lbl_records:"Ð›Ð¸Ñ‡Ð½Ñ‹Ðµ Ñ€ÐµÐºÐ¾Ñ€Ð´Ñ‹",
    lbl_patterns:"ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð¾Ð²",lbl_dream_journal:"Ð”Ð½ÐµÐ²Ð½Ð¸Ðº ÑÐ½Ð¾Ð²",lbl_voice_memos:"Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ðµ Ð·Ð°Ð¼ÐµÑ‚ÐºÐ¸",
    lbl_alarms:"Ð‘ÑƒÐ´Ð¸Ð»ÑŒÐ½Ð¸ÐºÐ¸ Ð¸ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ",lbl_appearance:"Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ Ð²Ð¸Ð´",lbl_notifications:"Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ",
    lbl_about:"Ðž Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸",lbl_themes:"Ð¢ÐµÐ¼Ñ‹",lbl_account:"ÐÐºÐºÐ°ÑƒÐ½Ñ‚",lbl_guide:"Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾",lbl_legal:"ÐŸÑ€Ð°Ð²Ð¾Ð²Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹",lbl_telemetry:"Ð¢ÐµÐ»ÐµÐ¼ÐµÑ‚Ñ€Ð¸Ñ",
    brainwave_audio:"Ð›Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸Ñ Ð·Ð²ÑƒÐºÐ° Ð¼Ð¾Ð·Ð³Ð¾Ð²Ñ‹Ñ… Ð²Ð¾Ð»Ð½",ai_hub:"Ð¦ÐµÐ½Ñ‚Ñ€ Ð˜Ð˜",analysis:"ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ",
    health_profile:"ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ",brain_training:"Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¼Ð¾Ð·Ð³Ð°",lucid_dreams:"Ð›Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸Ñ Ð¾ÑÐ¾Ð·Ð½Ð°Ð½Ð½Ñ‹Ñ… ÑÐ½Ð¾Ð²",
    world_intel:"ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð¼Ð¸Ñ€Ð¾Ð²Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚Ð°",study_career:"Ð˜Ð˜ Ð´Ð»Ñ ÑƒÑ‡Ñ‘Ð±Ñ‹ Ð¸ ÐºÐ°Ñ€ÑŒÐµÑ€Ñ‹",
    frontier_science:"Ð›ÐµÐ½Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ´Ð¾Ð²Ð¾Ð¹ Ð½Ð°ÑƒÐºÐ¸",system_control:"Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¾Ð¹",
    save:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",cancel:"ÐžÑ‚Ð¼ÐµÐ½Ð°",close:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",next:"Ð”Ð°Ð»ÐµÐµ",previous:"ÐÐ°Ð·Ð°Ð´",back:"ÐÐ°Ð·Ð°Ð´",
    morning:"Ð£Ñ‚Ñ€Ð¾",afternoon:"Ð”ÐµÐ½ÑŒ",evening:"Ð’ÐµÑ‡ÐµÑ€",night:"ÐÐ¾Ñ‡ÑŒ",
    daily_log:"Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð¶ÑƒÑ€Ð½Ð°Ð» ÑÐ¾Ð·Ð½Ð°Ð½Ð¸Ñ",date:"Ð”Ð°Ñ‚Ð°",time_of_day:"Ð’Ñ€ÐµÐ¼Ñ ÑÑƒÑ‚Ð¾Ðº",activity:"Ð”ÐµÑÑ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ",save_entry:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ",
    inner_state:"Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ",reflections:"Ð Ð°Ð·Ð¼Ñ‹ÑˆÐ»ÐµÐ½Ð¸Ñ",recent_entries:"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸",
    current_goal:"Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ñ†ÐµÐ»ÑŒ",gratitude:"Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒ",
    placeholder_thoughts:"Ðž Ñ‡Ñ‘Ð¼ Ð²Ñ‹ Ð´ÑƒÐ¼Ð°ÐµÑ‚Ðµ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ?",placeholder_chat:"Ð¡Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ðµ Ð¼ÐµÐ½Ñ Ð¾ Ð²Ð°ÑˆÐµÐ¼ ÑÐ¾Ð·Ð½Ð°Ð½Ð¸Ð¸...",
    placeholder_world_ask:"Ð¡Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ðµ Ð¾ Ð»ÑŽÐ±Ð¾Ð¹ Ð³ÐµÐ¾Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¸Ð»Ð¸ ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÐ¸Ð»Ðµ...",
  },
};
// Merge LANGS_EXTRA into LANGS
Object.keys(LANGS_EXTRA).forEach(lang=>{if(LANGS[lang])Object.assign(LANGS[lang],LANGS_EXTRA[lang]);});

function applyFullTranslation(lang){
  const dict=LANGS[lang]||LANGS.en;
  // 1. Apply data-t attributes
  document.querySelectorAll('[data-t]').forEach(el=>{
    const k=el.getAttribute('data-t');const v=dict[k];if(v)el.textContent=v;
  });
  // 2. Apply placeholders by element ID
  const phMap={
    logThought:'placeholder_thoughts',logInsight:'placeholder_insight',
    logGoal:'placeholder_goal',logObstacle:'placeholder_obstacle',
    logGratitude:'placeholder_gratitude',chatInput:'placeholder_chat',
    worldAskInput:'placeholder_world_ask',scienceAskInput:'placeholder_science_ask',
    dreamTitle:'placeholder_dream_name',
  };
  Object.entries(phMap).forEach(([id,key])=>{
    const el=document.getElementById(id);if(el&&dict[key])el.placeholder=dict[key];
  });
  // 3. Walk ALL text nodes in the visible DOM and translate known English strings
  walkAndTranslate(document.body,dict);
  // 4. Translate form labels that contain only text (not in data-t)
  translateFormLabels(dict);
  // 5. Sync all language selectors
  ['langSel','settingLang','sysLangSel'].forEach(id=>{try{document.getElementById(id).value=lang;}catch(e){}});
  // 6. Set document direction for Arabic
  document.documentElement.dir=lang==='ar'?'rtl':'ltr';
  document.documentElement.lang=lang;
}

function walkAndTranslate(root,dict){
  // Build reverse lookup: English value â†’ key
  const enDict=LANGS.en;
  const reverseLookup={};
  Object.entries(enDict).forEach(([k,v])=>{if(typeof v==='string')reverseLookup[v]=k;});
  // Also add direct TEXT_MAP_EN entries
  Object.entries(TEXT_MAP_EN).forEach(([enText,key])=>{reverseLookup[enText]=key;});

  const walker=document.createTreeWalker(root,NodeFilter.SHOW_TEXT,{
    acceptNode:(node)=>{
      const p=node.parentElement;
      if(!p)return NodeFilter.FILTER_REJECT;
      const tag=p.tagName;
      if(['SCRIPT','STYLE','OPTION'].includes(tag))return NodeFilter.FILTER_REJECT;
      if(p.closest('input,textarea,select'))return NodeFilter.FILTER_REJECT;
      return NodeFilter.FILTER_ACCEPT;
    }
  });
  const updates=[];
  let node;
  while(node=walker.nextNode()){
    const raw=node.textContent;
    const text=raw.trim();
    if(!text||text.length<2||text.length>120)continue;
    // Direct lookup
    if(reverseLookup[text]){
      const key=reverseLookup[text];
      const translated=dict[key];
      if(translated&&translated!==text){
        updates.push({node,raw,text,translated});
        continue;
      }
    }
    // Try stripping leading emoji/symbol
    const stripped=text.replace(/^[\u{1F300}-\u{1FFFF}\u{2600}-\u{27BF}\s]+/gu,'').trim();
    if(stripped&&reverseLookup[stripped]){
      const key=reverseLookup[stripped];
      const translated=dict[key];
      if(translated&&translated!==stripped){
        const prefix=raw.substring(0,raw.indexOf(stripped));
        updates.push({node,raw,text:stripped,translated:prefix+translated});
      }
    }
  }
  // Apply all updates (outside walker loop to avoid invalidation)
  updates.forEach(({node,translated})=>{node.textContent=translated;});
}

function translateFormLabels(dict){
  const enDict=LANGS.en;
  const allKeys=Object.keys(enDict);
  // Build fast lookup: english text â†’ translated text
  const lookup={};
  allKeys.forEach(k=>{if(enDict[k]&&dict[k]&&dict[k]!==enDict[k])lookup[enDict[k]]=dict[k];});
  // Also add TEXT_MAP_EN entries
  Object.entries(TEXT_MAP_EN).forEach(([enText,key])=>{if(dict[key]&&dict[key]!==enText)lookup[enText]=dict[key];});
  
  const selectors='.form-label,.card-title,.section-header,.tab-section-title,.sub-label,.settings-label,.stat-label,h3,h4,label:not([for=""],.btn)';
  document.querySelectorAll(selectors).forEach(el=>{
    if(el.closest('script,style'))return;
    const childEls=[...el.children].filter(c=>c.tagName!=='SPAN'&&c.tagName!=='I'&&c.tagName!=='SVG');
    if(childEls.length>0)return; // skip complex elements
    const text=el.textContent.trim();
    // Direct lookup
    if(lookup[text]){el.textContent=lookup[text];return;}
    // Try stripping emoji prefix
    const stripped=text.replace(/^[\u{1F300}-\u{1FFFF}\u{2600}-\u{27BF}\u2702-\u27B0\s]+/gu,'').trim();
    if(stripped&&lookup[stripped]){
      const prefix=text.substring(0,text.indexOf(stripped));
      el.textContent=prefix+lookup[stripped];
    }
  });
}
const NAV_ITEMS=[
  {id:'log',icon:'ðŸ“',key:'nav_log'},{id:'waves',icon:'ðŸŽµ',key:'nav_waves'},
  {id:'ai',icon:'ðŸ¤–',key:'nav_ai'},{id:'analysis',icon:'ðŸ“Š',key:'nav_analysis'},
  {id:'health',icon:'â¤ï¸',key:'nav_health'},{id:'games',icon:'ðŸŽ®',key:'nav_games'},
  {id:'dreams',icon:'ðŸŒ™',key:'nav_dreams'},{id:'media',icon:'ðŸŽ™ï¸',key:'nav_media'},
  {id:'calendar',icon:'ðŸ“…',key:'nav_calendar'},{id:'settings',icon:'âš™ï¸',key:'nav_settings'},
  {id:'world',icon:'ðŸŒ',key:'nav_world'},{id:'path',icon:'ðŸ›¤ï¸',key:'nav_path'},
  {id:'science',icon:'ðŸ”¬',key:'nav_science'},{id:'system',icon:'ðŸ§©',key:'nav_system'},
];
let activeTab='log';
function buildNav(){
  const nav=document.getElementById('bottomNav');if(!nav)return;
  nav.innerHTML=NAV_ITEMS.map(n=>`<button class="nav-tab${activeTab===n.id?' active':''}" onclick="switchTab('${n.id}')"><span class="ni">${n.icon}</span><span>${t(n.key)}</span></button>`).join('');
  enableDragScroll(nav);
}
function enableDragScroll(el){
  if(!el||el._dragBound)return;el._dragBound=true;
  let isDown=false,startX,scrollLeft;
  el.addEventListener('mousedown',e=>{isDown=true;el.style.cursor='grabbing';startX=e.pageX-el.offsetLeft;scrollLeft=el.scrollLeft;});
  el.addEventListener('mouseleave',()=>{isDown=false;el.style.cursor='';});
  el.addEventListener('mouseup',()=>{isDown=false;el.style.cursor='';});
  el.addEventListener('mousemove',e=>{if(!isDown)return;e.preventDefault();const x=e.pageX-el.offsetLeft;el.scrollLeft=scrollLeft-(x-startX);});
  // Touch support
  let tStart=0,tScrollLeft=0;
  el.addEventListener('touchstart',e=>{tStart=e.touches[0].clientX;tScrollLeft=el.scrollLeft;},{passive:true});
  el.addEventListener('touchmove',e=>{const dx=tStart-e.touches[0].clientX;el.scrollLeft=tScrollLeft+dx;},{passive:true});
}
function switchTab(id){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  const panel=document.getElementById('tab-'+id);if(panel)panel.classList.add('active');
  activeTab=id;buildNav();
  if(id==='analysis'){refreshAnalysis();computeDiversity();}
  if(id==='calendar')renderCalendar();
  if(id==='dreams'){renderDreamJournal();computeLucidProbability();}
  if(id==='media'){renderVoiceMemos();renderMediaGrid();}
  if(id==='ai'){refreshAIInsights();loadDailyTip();}
  if(id==='world'){buildWorldPanel();buildClickableNews();}
  if(id==='science'){buildScienceDisplay();updateScienceTimestamp();}
  if(id==='system'){buildThemeGrid();updateTelemetry();updateAccountUI();}
  if(id==='guide'){buildGuideNavMap();}
}

// â”€â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleTheme(){
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  const next=isDark?'light':'dark';
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('cos_theme',next);
  document.getElementById('themeBtn').textContent=isDark?'ðŸŒ™':'â˜€ï¸';
  const s=document.getElementById('settingDark');if(s)s.classList.toggle('on',!isDark);
  SETTINGS_STATE.darkMode=!isDark;
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg,dur=2400){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),dur);
}

// â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(title,html){
  document.getElementById('modalTitle').textContent=title;
  document.getElementById('modalBody').innerHTML=html;
  document.getElementById('modalOverlay').classList.add('open');
}
function closeModal(e){if(e.target===document.getElementById('modalOverlay'))closeAllModals();}
function closeAllModals(){document.getElementById('modalOverlay').classList.remove('open');}

// â”€â”€â”€ SETTING HELP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SETTING_HELP={
  darkmode:{title:'ðŸŒ™ Dark Mode',text:'Switches the app to a dark color scheme. Great for night use and reduces eye strain.'},
  anchors:{title:'ðŸŽšï¸ Slider Anchors',text:'Shows detailed descriptions for each slider value. Instead of guessing what "7" means, you see exactly what that score feels like.'},
  notif:{title:'ðŸ”” Notifications',text:'Allows the app to send browser notifications for alarms and reminders.'},
  rc:{title:'âœ‹ Reality Check Alerts',text:'Sends reminders every 2 hours to do a reality check. Building this habit while awake makes you do it in dreams too â€” triggering lucid dreaming.'},
  promptboost:{title:'âœ¨ AI Prompt Enhancement',text:'AI automatically rewrites your questions to be more specific before processing â€” giving you better, more actionable answers.'},
};
function showSettingHelp(key){
  const info=SETTING_HELP[key]||{title:'Help',text:'Information coming soon.'};
  document.getElementById('settingHelpTitle').textContent=info.title;
  document.getElementById('settingHelpBody').innerHTML=info.text;
  document.getElementById('settingHelpOverlay').classList.add('open');
}

// â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SETTINGS_STATE={};
function loadSettings(){
  const saved=JSON.parse(localStorage.getItem('cos_settings')||'{}');
  Object.assign(SETTINGS_STATE,{anchors:true,autoAnalyze:true,convMode:true,autoTranscribe:true,darkMode:false,notif:false,dailyReminder:false,rc:false,promptBoost:false,...saved});
  ['anchors','autoAnalyze','convMode','autoTranscribe','darkMode','notif','dailyReminder','rc','promptBoost'].forEach(k=>{
    const el=document.getElementById('setting'+k.charAt(0).toUpperCase()+k.slice(1));
    if(el)el.classList.toggle('on',!!SETTINGS_STATE[k]);
  });
  if(SETTINGS_STATE.darkMode){document.documentElement.setAttribute('data-theme','dark');document.getElementById('themeBtn').textContent='â˜€ï¸';}
}
function toggleSetting(key){
  SETTINGS_STATE[key]=!SETTINGS_STATE[key];
  const el=document.getElementById('setting'+key.charAt(0).toUpperCase()+key.slice(1));
  if(el)el.classList.toggle('on',SETTINGS_STATE[key]);
  localStorage.setItem('cos_settings',JSON.stringify(SETTINGS_STATE));
}
function requestNotifPermission(){
  if(Notification.permission==='granted'){toggleSetting('notif');}
  else{Notification.requestPermission().then(p=>{if(p==='granted'){toggleSetting('notif');}else{showToast('Notifications denied');}})}
}

// â”€â”€â”€ SLIDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SLIDERS=[
  {id:'sleep',label:'ðŸ˜´ Sleep Quality',low:'No sleep',high:'Perfect sleep',anchors:['Catastrophicâ€”no sleep/terrible','Very poorâ€”barely functional','Below averageâ€”dragging','Slightly below normal','Acceptableâ€”getting by','Goodâ€”rested and okay','Very goodâ€”refreshed','Excellentâ€”woke naturally','Outstandingâ€”best in days','Perfectâ€”completely restored']},
  {id:'mood',label:'ðŸ˜Š Mood',low:'Severe distress',high:'Peak euphoria',anchors:['Severe distress or crisis','Very lowâ€”struggling to function','Lowâ€”gloomy and unmotivated','Below baselineâ€”slightly down','Neutralâ€”neither good nor bad','Okayâ€”mild positivity','Goodâ€”genuinely happy','Greatâ€”energized and upbeat','Excellentâ€”very high spirits','Euphoricâ€”peak joy and bliss']},
  {id:'physicalEnergy',label:'âš¡ Physical Energy',low:'Completely depleted',high:'Peak vitality',anchors:['Completely depletedâ€”bedridden','Barely able to do basics','Lowâ€”everything takes effort','Below normalâ€”sluggish body','Manageableâ€”routine possible','Goodâ€”normal activities easy','Highâ€”body feels strong','Very highâ€”want to exercise','Excellentâ€”athletic and vibrant','Peakâ€”limitless physical vitality']},
  {id:'mentalEnergy',label:'ðŸ§  Mental Energy',low:'Mental blackout',high:'Peak mental power',anchors:['Mental blackoutâ€”cannot think','Barely processing anything','Mental fogâ€”very slow thoughts','Below baselineâ€”sluggish thinking','Normalâ€”thinking is okay','Goodâ€”thoughts flow well','Sharpâ€”quick and clear thinking','Very sharpâ€”ideas generating fast','Excellentâ€”top cognitive function','Peakâ€”extraordinary mental clarity']},
  {id:'focus',label:'ðŸŽ¯ Focus',low:'Completely scattered',high:'Hyperfocus',anchors:['Completely scatteredâ€”zero attention','Barely presentâ€”mind everywhere','Poor focusâ€”constant distractions','Somewhat distracted','Moderateâ€”can focus with effort','Decent focusâ€”manageable','Goodâ€”sustained concentration','Strongâ€”deep work possible','Excellentâ€”laser-like attention','Hyperfocusâ€”complete absorption']},
  {id:'stress',label:'ðŸ˜° Stress',low:'No stress (calm)',high:'Crisis panic',anchors:['Completely calmâ€”zero stress','Barely any tensionâ€”very peaceful','Low stressâ€”minor background worry','Slightly elevatedâ€”manageable','Moderateâ€”noticeable but okay','Elevatedâ€”affecting performance','Highâ€”impacting wellbeing','Very highâ€”hard to function','Severeâ€”near breaking point','Crisisâ€”overwhelming panic']},
  {id:'creativity',label:'ðŸŽ¨ Creativity',low:'Completely blocked',high:'Genius inspiration',anchors:['Completely blockedâ€”no ideas','Almost no creative thought','Lowâ€”very few original ideas','Below average creativity','Some creativityâ€”standard ideas','Good creative flow','Highâ€”generating novel concepts','Excellentâ€”ideas pouring out','Outstandingâ€”highly original','Peakâ€”genius-level inspiration']},
  {id:'motivation',label:'ðŸ”¥ Motivation',low:'No drive',high:'Unstoppable',anchors:['No drive whatsoever','Almost impossible to start','Very lowâ€”major procrastination','Below normal drive','Some motivationâ€”basics done','Goodâ€”want to make progress','Highâ€”excited to work','Very highâ€”on a mission','Excellentâ€”unstoppable drive','Peakâ€”extraordinary purpose']},
  {id:'clarity',label:'ðŸ’Ž Mental Clarity',low:'Complete fog',high:'Crystal clear',anchors:['Complete fogâ€”cannot think straight','Extremely cloudy and confused','Very foggyâ€”slow processing','Below normal clarity','Moderateâ€”somewhat clear','Good clarityâ€”thinking straight','Clearâ€”thoughts well organized','Very clearâ€”sharp and precise','Excellentâ€”crystal clear thinking','Perfectâ€”total mental transparency']},
  {id:'flow',label:'ðŸŒŠ Flow State',low:'Not in flow',high:'Transcendent flow',anchors:['Not in flowâ€”completely distracted','Very far from flow','Mostly distractedâ€”barely present','Occasional moments of presence','Intermittent flowâ€”fleeting','Some flowâ€”partially engaged','Good flowâ€”deep engagement','Strong flowâ€”time dissolving','Excellent flowâ€”fully absorbed','Peak flowâ€”transcendent performance']},
  {id:'anxiety',label:'ðŸ˜¬ Anxiety',low:'No anxiety (calm)',high:'Extreme panic',anchors:['Zero anxietyâ€”perfectly calm','Barely anyâ€”very serene','Minimalâ€”slight background hum','Lowâ€”minor worry present','Moderateâ€”noticeable anxiety','Elevatedâ€”affecting thoughts','Highâ€”hard to stay focused','Severeâ€”physical symptoms','Very severeâ€”panic territory','Extremeâ€”full panic state']},
  {id:'stability',label:'ðŸ”ï¸ Emotional Stability',low:'Falling apart',high:'Unshakeable',anchors:['Completely unstableâ€”crisis mode','Very reactiveâ€”falling apart','Easily overwhelmed','Somewhat unstableâ€”wobbling','Moderateâ€”some up/down swings','Fairly stableâ€”generally okay','Goodâ€”mostly centered','Very stableâ€”grounded','Excellentâ€”unshakeable','Perfectâ€”absolute inner peace']},
  {id:'social',label:'ðŸ‘¥ Social Energy',low:'Social exhaustion',high:'Love connection',anchors:['Complete social exhaustion','Deeply introvertedâ€”need isolation','Very low social battery','Prefer solitude heavily','Moderateâ€”short interactions okay','Normal social energy','Goodâ€”enjoy being with others','Highâ€”energized by people','Very highâ€”thrive in groups','Peak social energy']},
  {id:'mindfulness',label:'ðŸ§˜ Mindfulness',low:'Autopilot',high:'Full presence',anchors:['Completely on autopilot','Almost no present-moment awareness','Very little mindfulness','Below average presence','Some awarenessâ€”occasional pauses','Moderate mindfulness','Goodâ€”regularly present','Strongâ€”sustained awareness','Excellentâ€”deeply present','Perfectâ€”full enlightened presence']},
  {id:'willpower',label:'ðŸ’ª Willpower',low:'Zero willpower',high:'Iron discipline',anchors:['Zero willpowerâ€”no resistance possible','Almost all impulses win','Very weakâ€”discipline failing','Below average self-control','Moderateâ€”making some choices','Good willpowerâ€”holding choices','Strongâ€”resisting temptations','Very strongâ€”high discipline','Excellentâ€”exceptional self-mastery','Absolute willpowerâ€”iron discipline']},
  {id:'intuition',label:'ðŸ”® Intuition',low:'No gut sense',high:'Psychic knowing',anchors:['No intuitive hitsâ€”fully logical','Almost no gut sense','Rarely getting intuitive signals','Weak intuitionâ€”occasional feeling','Moderateâ€”some gut feelings','Decent intuitionâ€”trusting hunches','Goodâ€”regularly accurate gut sense','Strong intuitionâ€”mostly right','Excellentâ€”highly accurate','Peakâ€”psychic-level knowing']},
];

function buildSliders(){
  const container=document.getElementById('slidersContainer');if(!container)return;
  container.innerHTML=SLIDERS.map(s=>`
    <div class="slider-group" id="sg_${s.id}">
      <div class="slider-header">
        <span class="slider-label">${s.label}</span>
        <span class="slider-value-badge" id="val_${s.id}">5</span>
      </div>
      <input type="range" class="slider-track" id="sl_${s.id}" min="0" max="10" value="5" oninput="onSliderMove('${s.id}',this.value)" style="--pct:50%">
      <div class="slider-dots" id="dots_${s.id}">
        ${[0,1,2,3,4,5,6,7,8,9,10].map(n=>`<div class="slider-dot" id="dot_${s.id}_${n}" onclick="setSliderVal('${s.id}',${n})">${n}</div>`).join('')}
      </div>
      <div class="slider-pair-labels"><span>${s.low||''}</span><span>${s.high||''}</span></div>
      <div class="slider-anchor-text" id="anchor_${s.id}"></div>
    </div>`).join('');
  SLIDERS.forEach(s=>onSliderMove(s.id,5));
}
function onSliderMove(id,val){
  val=parseInt(val);
  const sl=document.getElementById('sl_'+id);
  if(sl){sl.value=val;sl.style.setProperty('--pct',(val/10*100)+'%');}
  const badge=document.getElementById('val_'+id);if(badge)badge.textContent=val;
  const slider=SLIDERS.find(s=>s.id===id);
  for(let i=0;i<=10;i++){
    const dot=document.getElementById('dot_'+id+'_'+i);if(!dot)continue;
    dot.classList.remove('active','near');
    if(i===val)dot.classList.add('active');
    else if(Math.abs(i-val)===1)dot.classList.add('near');
  }
  const anchor=document.getElementById('anchor_'+id);
  if(anchor&&slider){
    const idx=Math.min(val,9);
    anchor.textContent=val+' â€” '+(slider.anchors[idx]||'');
    anchor.style.display=SETTINGS_STATE.anchors?'block':'none';
  }
  updateScore();
}
function setSliderVal(id,val){const sl=document.getElementById('sl_'+id);if(sl){sl.value=val;onSliderMove(id,val);}}
function updateSimpleSlider(el){el.style.setProperty('--pct',(el.value/10*100)+'%');const v=document.getElementById(el.id+'Val');if(v)v.textContent=el.value;}
function getSliderVal(id){return parseInt(document.getElementById('sl_'+id)?.value||5);}
function updateScore(){
  const f=getSliderVal('focus'),me=getSliderVal('mentalEnergy'),pe=getSliderVal('physicalEnergy'),
        mo=getSliderVal('mood'),sl=getSliderVal('sleep'),cr=getSliderVal('creativity'),
        mt=getSliderVal('motivation'),fl=getSliderVal('flow'),cl=getSliderVal('clarity'),
        mf=getSliderVal('mindfulness'),wp=getSliderVal('willpower'),st=getSliderVal('stress');
  const raw=(f*2.5+me*2.2+pe*1.5+mo*1.8+sl*1.8+cr*1.3+mt*1.2+fl*1.5+cl*1.8+mf+wp+(10-st)*1.5)/20;
  const score=Math.max(0,Math.min(10,raw));
  const sv=document.getElementById('scoreValue');if(sv)sv.textContent=score.toFixed(1);
  const circle=document.getElementById('scoreCircle');
  if(circle){circle.style.strokeDashoffset=213.6-(213.6*score/10);
    const hue=score<4?0:score<6?40:score<8?120:270;circle.style.stroke=`hsl(${hue},70%,50%)`;}
  return score;
}

// â”€â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveLog(){
  const score=updateScore();
  const entry={id:Date.now(),ts:new Date().toISOString(),
    date:document.getElementById('logDate')?.value||new Date().toISOString().split('T')[0],
    timeOfDay:document.getElementById('logTime')?.value,activity:document.getElementById('logActivity')?.value,
    brainwave:document.getElementById('logBrainwave')?.value,emotion:document.getElementById('logEmotion')?.value,
    sensation:document.getElementById('logSensation')?.value,thought:document.getElementById('logThought')?.value,
    insight:document.getElementById('logInsight')?.value,goal:document.getElementById('logGoal')?.value,
    obstacle:document.getElementById('logObstacle')?.value,gratitude:document.getElementById('logGratitude')?.value,
    pattern:document.getElementById('logPattern')?.value,action:document.getElementById('logAction')?.value,
    score:parseFloat(score.toFixed(2))};
  SLIDERS.forEach(s=>{entry[s.id]=getSliderVal(s.id);});
  const logs=getLogs();logs.unshift(entry);
  localStorage.setItem('cos_logs',JSON.stringify(logs));
  showToast('âœ¨ '+t('saved'));renderRecentLogs();
}
function getLogs(){return JSON.parse(localStorage.getItem('cos_logs')||'[]');}
function renderRecentLogs(){
  const el=document.getElementById('recentLogs');if(!el)return;
  const logs=getLogs().slice(0,5);
  if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ðŸ“</span><div class="es-text">No entries yet. Save your first log!</div></div>';return;}
  el.innerHTML=logs.map(e=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)">
      <div><div style="font-weight:700;font-size:13px">${e.date} <span style="font-size:10px;color:var(--text3)">${e.timeOfDay||''}</span></div>
        <div style="font-size:11px;color:var(--text3);margin-top:2px">${e.emotion||''} Â· ${e.activity||''}</div></div>
      <div style="text-align:right"><div style="font-family:Syne,sans-serif;font-weight:800;font-size:18px;color:var(--primary)">${e.score}</div><div style="font-size:10px;color:var(--text3)">score</div></div>
    </div>`).join('');
}

// â”€â”€â”€ BRAINWAVE AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let audioCtx=null,bwOscL=null,bwOscR=null,bwGain=null,bwIsPlaying=false,bwCurrentTrack=0,bwTimer=null,bwSeconds=0,bwType='binaural';
const BW_TRACKS=[
  {name:'Deep Focus',desc:'Eliminate distractions, enter deep work',freq:'40 Hz Gamma',emoji:'ðŸŽ¯',base:200,beat:40},
  {name:'Study Mode',desc:'Enhanced memory and learning',freq:'14 Hz Beta',emoji:'ðŸ“š',base:200,beat:14},
  {name:'Creative Flow',desc:'Unlock imagination and innovation',freq:'10 Hz Alpha',emoji:'ðŸŽ¨',base:200,beat:10},
  {name:'Deep Sleep',desc:'Fall asleep faster, sleep deeper',freq:'3 Hz Delta',emoji:'ðŸ˜´',base:150,beat:3},
  {name:'Meditation',desc:'Calm mind, expanded awareness',freq:'7 Hz Theta',emoji:'ðŸ§˜',base:200,beat:7},
  {name:'Stress Relief',desc:'Melt away anxiety and tension',freq:'8 Hz Alpha',emoji:'ðŸŒŠ',base:180,beat:8},
  {name:'Memory Boost',desc:'Strengthen recall and retention',freq:'12 Hz Beta',emoji:'ðŸ”®',base:200,beat:12},
  {name:'Mood Lift',desc:'Elevate emotional state naturally',freq:'10 Hz Alpha',emoji:'â˜€ï¸',base:220,beat:10},
  {name:'Brain Sync',desc:'Balance left and right hemispheres',freq:'20 Hz Beta',emoji:'ðŸ”—',base:200,beat:20},
  {name:'Super Learning',desc:'Optimal state for absorbing information',freq:'40 Hz Gamma',emoji:'âš¡',base:210,beat:40},
  {name:'Lucid Dreams',desc:'Enhanced dream awareness and control',freq:'5 Hz Theta',emoji:'ðŸŒ™',base:180,beat:5},
  {name:'Energy Boost',desc:'Natural mental and physical energy',freq:'30 Hz Beta',emoji:'ðŸ”‹',base:200,beat:30},
];
function buildBWGrid(){
  const grid=document.getElementById('bwGrid');if(!grid)return;
  grid.innerHTML=BW_TRACKS.map((tr,i)=>`<div class="bw-card" id="bwCard_${i}" onclick="selectBWTrack(${i})"><span class="bw-emoji">${tr.emoji}</span><div class="bw-name">${tr.name}</div><div class="bw-desc">${tr.desc}</div><div class="bw-freq">${tr.freq}</div></div>`).join('');
  buildBWEducation();
}
function selectBWTrack(i){
  bwCurrentTrack=i;document.querySelectorAll('.bw-card').forEach((c,j)=>c.classList.toggle('playing',j===i));
  const tr=BW_TRACKS[i];
  document.getElementById('bwNowName').textContent=tr.name;
  document.getElementById('bwNowDesc').textContent=tr.desc;
  document.getElementById('bwNowFreq').textContent=tr.freq;
  if(bwIsPlaying)startBW();
}
function toggleBW(){if(bwIsPlaying)stopBW();else startBW();}
function startBW(){
  stopBW();
  try{
    audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    const tr=BW_TRACKS[bwCurrentTrack];
    const vol=parseInt(document.getElementById('bwVol').value)/100;
    if(bwType==='binaural'){
      const merger=audioCtx.createChannelMerger(2);
      bwGain=audioCtx.createGain();bwGain.gain.value=vol*0.3;
      bwOscL=audioCtx.createOscillator();bwOscL.frequency.value=tr.base;bwOscL.type='sine';
      bwOscR=audioCtx.createOscillator();bwOscR.frequency.value=tr.base+tr.beat;bwOscR.type='sine';
      const gL=audioCtx.createGain(),gR=audioCtx.createGain();
      bwOscL.connect(gL);bwOscR.connect(gR);gL.connect(merger,0,0);gR.connect(merger,0,1);
      merger.connect(bwGain);bwGain.connect(audioCtx.destination);
      bwOscL.start();bwOscR.start();
    }else if(bwType==='whitenoise'){
      const bufSize=audioCtx.sampleRate*2;const buf=audioCtx.createBuffer(1,bufSize,audioCtx.sampleRate);
      const data=buf.getChannelData(0);for(let i=0;i<bufSize;i++)data[i]=(Math.random()*2-1)*0.3;
      const src=audioCtx.createBufferSource();src.buffer=buf;src.loop=true;
      bwGain=audioCtx.createGain();bwGain.gain.value=vol*0.3;src.connect(bwGain);bwGain.connect(audioCtx.destination);src.start();bwOscL=src;
    }else{
      bwGain=audioCtx.createGain();bwGain.gain.value=vol*0.25;
      bwOscL=audioCtx.createOscillator();bwOscL.frequency.value=528;bwOscL.type='sine';
      bwOscL.connect(bwGain);bwGain.connect(audioCtx.destination);bwOscL.start();
    }
    bwIsPlaying=true;document.getElementById('bwPlayBtn').textContent='â¸ Pause';
    buildBWVisualizer();bwSeconds=0;clearInterval(bwTimer);
    bwTimer=setInterval(()=>{bwSeconds++;const m=Math.floor(bwSeconds/60),s=bwSeconds%60;document.getElementById('bwTimer').textContent=(m<10?'0':'')+m+':'+(s<10?'0':'')+s;},1000);
  }catch(e){showToast('Audio requires interaction or unsupported browser');}
}
function stopBW(){
  if(bwOscL)try{bwOscL.stop&&bwOscL.stop();}catch(e){}
  if(bwOscR)try{bwOscR.stop&&bwOscR.stop();}catch(e){}
  if(audioCtx)try{audioCtx.close();}catch(e){}
  bwOscL=bwOscR=bwGain=audioCtx=null;bwIsPlaying=false;
  document.getElementById('bwPlayBtn').textContent='â–¶ Play';clearInterval(bwTimer);resetBWVisualizer();
}
function setBWVol(v){if(bwGain)bwGain.gain.value=v/100*0.3;}
function setBWType(type,btn){bwType=type;document.querySelectorAll('.wave-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(bwIsPlaying)startBW();}
function bwNextTrack(){selectBWTrack((bwCurrentTrack+1)%BW_TRACKS.length);if(bwIsPlaying)startBW();}
function bwPrevTrack(){selectBWTrack((bwCurrentTrack-1+BW_TRACKS.length)%BW_TRACKS.length);if(bwIsPlaying)startBW();}
function buildBWVisualizer(){
  document.getElementById('bwVisualizer').innerHTML=Array.from({length:24},(_,i)=>`<div class="bw-bar animating" style="height:50px;--dur:${0.3+Math.random()*0.5}s;animation-delay:${i*0.03}s"></div>`).join('');
}
function resetBWVisualizer(){document.getElementById('bwVisualizer').innerHTML='<div style="color:var(--text3);font-size:12px">â–¶ Press Play to begin</div>';}
function buildBWEducation(){
  const el=document.getElementById('bwEducation');if(!el)return;
  const waves=[{name:'Delta (0.5â€“4 Hz)',emoji:'ðŸ˜´',desc:'Deep sleep and healing. Body repairs itself. Dreamless sleep.'},{name:'Theta (4â€“8 Hz)',emoji:'ðŸŒ€',desc:'Drowsiness, creativity, REM sleep, lucid dreaming, deep meditation.'},{name:'Alpha (8â€“14 Hz)',emoji:'ðŸ˜Œ',desc:'Relaxed focus, light meditation, calm alertness. Bridge between conscious and subconscious.'},{name:'Beta (14â€“30 Hz)',emoji:'ðŸ’¡',desc:'Active thinking, focus, problem solving, normal waking consciousness.'},{name:'Gamma (30â€“100 Hz)',emoji:'âš¡',desc:'Peak cognition, insight, high-level information processing.'}];
  el.innerHTML=waves.map(w=>`<div style="display:flex;gap:10px;padding:10px 0;border-bottom:1px solid var(--border)"><span style="font-size:24px">${w.emoji}</span><div><div style="font-weight:700;font-size:13px">${w.name}</div><div style="font-size:12px;color:var(--text2);margin-top:3px">${w.desc}</div></div></div>`).join('');
}

// â”€â”€â”€ AI HUB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AI_MODELS=[
  {id:'claude',name:'Claude',emoji:'ðŸŸ£',provider:'anthropic',apiModel:'claude-sonnet-4-20250514',persona:'You are Claude by Anthropic â€” thoughtful, precise, and deeply analytical. Help users understand their consciousness data with care.'},
  {id:'chatgpt',name:'ChatGPT',emoji:'ðŸŸ¢',provider:'openai',apiModel:'gpt-4o',persona:'You are ChatGPT by OpenAI. Be helpful, conversational, and insightful.'},
  {id:'gemini',name:'Gemini',emoji:'ðŸ”µ',provider:'google',apiModel:'gemini-1.5-pro',persona:'You are Gemini by Google. Be creative, well-rounded, and grounded in facts.'},
  {id:'grok',name:'Grok',emoji:'âš¡',provider:'xai',apiModel:'grok-2',persona:'You are Grok by xAI. Be witty, direct, and unfiltered but genuinely helpful.'},
  {id:'perplexity',name:'Perplexity',emoji:'ðŸ”',provider:'perplexity',apiModel:'llama-3.1-sonar-large-128k-online',persona:'You are Perplexity AI. Provide grounded, well-sourced answers with depth.'},
  {id:'deepseek',name:'DeepSeek',emoji:'ðŸŒŠ',provider:'deepseek',apiModel:'deepseek-chat',persona:'You are DeepSeek. Be technically precise, deeply analytical, and thorough.'},
  {id:'twin',name:'AI Twin',emoji:'ðŸ§ ',provider:'anthropic',apiModel:'claude-sonnet-4-20250514',persona:'You are the user\'s AI Digital Twin. You have deeply analyzed their consciousness data and know their patterns. Be warm, insightful, and deeply personal.'},
  {id:'coach',name:'Coach',emoji:'ðŸ†',provider:'anthropic',apiModel:'claude-sonnet-4-20250514',persona:'You are an elite performance coach and neuroscientist. Give direct, actionable advice for peak mental performance.'},
  {id:'sage',name:'Sage',emoji:'ðŸ”®',provider:'anthropic',apiModel:'claude-sonnet-4-20250514',persona:'You are a wise sage combining ancient wisdom with modern psychology. Use metaphors and philosophical insights.'},
  {id:'doctor',name:'Dr. Mind',emoji:'ðŸ‘¨â€âš•ï¸',provider:'anthropic',apiModel:'claude-sonnet-4-20250514',persona:'You are a cognitive neuroscientist. Analyze mental health patterns objectively. Be clinical but empathetic.'},
  {id:'friend',name:'Friend',emoji:'ðŸ˜Š',provider:'anthropic',apiModel:'claude-sonnet-4-20250514',persona:'You are a supportive best friend who is very smart. Be casual, encouraging, real. Use simple language. Care deeply.'},
];
// API Key management
function getApiKey(provider){return localStorage.getItem('cos_apikey_'+provider)||'';}
function setApiKey(provider,key){localStorage.setItem('cos_apikey_'+provider,key);}
function promptApiKey(provider){
  const names={openai:'OpenAI (ChatGPT)',google:'Google (Gemini)',xai:'xAI (Grok)',perplexity:'Perplexity',deepseek:'DeepSeek',anthropic:'Anthropic (Claude)'};
  const key=prompt(`Enter your ${names[provider]||provider} API key:\n(Stored locally on your device only)`,'');
  if(key){setApiKey(provider,key);showToast('âœ… API key saved for '+provider);return key;}
  return null;
}
async function callAI(model,messages,userContext){
  const provider=model.provider;
  const freeProviders=['anthropic'];
  let apiKey=getApiKey(provider);
  if(!freeProviders.includes(provider)&&!apiKey){
    apiKey=promptApiKey(provider);
    if(!apiKey)throw new Error('No API key provided');
  }
  const systemMsg=model.persona+'\n\nYou are an advanced AI consciousness coach in Consciousness OS. You have deep knowledge of neuroscience, psychology, meditation, peak performance, sleep, dreams, nutrition, and human potential.'+userContext;
  if(provider==='anthropic'){
    const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true','x-api-key':apiKey||''},body:JSON.stringify({model:model.apiModel,max_tokens:700,system:systemMsg,messages})});
    const data=await resp.json();if(data.error)throw new Error(data.error.message);return data.content?.[0]?.text||'No response';
  }else if(provider==='openai'){
    const resp=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey},body:JSON.stringify({model:model.apiModel,max_tokens:700,messages:[{role:'system',content:systemMsg},...messages]})});
    const data=await resp.json();if(data.error)throw new Error(data.error.message);return data.choices?.[0]?.message?.content||'No response';
  }else if(provider==='google'){
    const resp=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model.apiModel}:generateContent?key=${apiKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:messages.map(m=>({role:m.role==='assistant'?'model':'user',parts:[{text:m.content}]})),systemInstruction:{parts:[{text:systemMsg}]}})});
    const data=await resp.json();if(data.error)throw new Error(data.error.message);return data.candidates?.[0]?.content?.parts?.[0]?.text||'No response';
  }else if(provider==='xai'){
    const resp=await fetch('https://api.x.ai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey},body:JSON.stringify({model:model.apiModel,max_tokens:700,messages:[{role:'system',content:systemMsg},...messages]})});
    const data=await resp.json();if(data.error)throw new Error(data.error.message);return data.choices?.[0]?.message?.content||'No response';
  }else if(provider==='perplexity'){
    const resp=await fetch('https://api.perplexity.ai/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey},body:JSON.stringify({model:model.apiModel,max_tokens:700,messages:[{role:'system',content:systemMsg},...messages]})});
    const data=await resp.json();if(data.error)throw new Error(data.error.message);return data.choices?.[0]?.message?.content||'No response';
  }else if(provider==='deepseek'){
    const resp=await fetch('https://api.deepseek.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey},body:JSON.stringify({model:model.apiModel,max_tokens:700,messages:[{role:'system',content:systemMsg},...messages]})});
    const data=await resp.json();if(data.error)throw new Error(data.error.message);return data.choices?.[0]?.message?.content||'No response';
  }
  throw new Error('Unknown provider: '+provider);
}
let curAIModel='twin',chatHistory=[];
const SUGGESTED_QS=['How\'s my mental performance trending?','What\'s my best time of day?','How do I enter flow state?','What patterns do you see in my stress?','Why does my creativity spike sometimes?','How is my sleep affecting my focus?','What habits should I build?','Am I improving over time?','How\'s my day going today?','What should I focus on right now?','What\'s blocking my peak performance?','Predict my energy tomorrow','Am I close to burnout?','Give me a personal insight','What do my dreams reveal?','How\'s my emotional stability?'];
const DAILY_TIPS=['Start with your hardest task when your brain is in Beta state â€” usually 2-4 hours after waking.','Gamma brainwaves peak during moments of insight. Try a 20-minute Alpha meditation before creative work.','The brain consolidates memories during NREM sleep. 7-9 hours is optimal for learning retention.','Stress below 3 is optimal for creativity. Above 7 shrinks the hippocampus over time.','Dopamine is triggered by achieving small goals. Break large tasks into wins every 25 minutes.','Walking 10 minutes increases BDNF (brain fertilizer) and improves mood and focus for 2-3 hours.','Gratitude practice activates the prefrontal cortex and reduces amygdala reactivity.','Your HRV (heart rate variability) reflects nervous system health. High HRV = high resilience.','Dehydration of just 2% impairs cognitive performance by up to 20%. Keep drinking water!','Flow state is 3-5% more activated than your normal baseline. Track when you enter it most.'];
function setKeyUI(provider){const key=promptApiKey(provider);if(key){updateKeyStatuses();}}
function clearKey(provider){localStorage.removeItem('cos_apikey_'+provider);updateKeyStatuses();showToast('Key cleared');}
function updateKeyStatuses(){['openai','google','xai','perplexity','deepseek'].forEach(p=>{const el=document.getElementById('keyStatus_'+p);if(el){const k=getApiKey(p);el.textContent=k?'âœ… Key set ('+k.slice(0,8)+'...)':'No key set';el.style.color=k?'var(--success)':'var(--text3)';}});}

// â”€â”€ COMPARE ALL AIs MODE â”€â”€
let compareModeActive=false;
let bestMatchTopic='general';
const BEST_MATCH_MAP={
  general:{ids:['twin','claude','chatgpt','gemini'],label:'Best for general: Claude & ChatGPT'},
  coding:{ids:['chatgpt','claude','deepseek'],label:'Best for coding: ChatGPT & DeepSeek'},
  creativity:{ids:['claude','gemini','grok'],label:'Best for creative: Claude & Gemini'},
  research:{ids:['perplexity','claude','gemini'],label:'Best for research: Perplexity & Claude'},
  analysis:{ids:['chatgpt','deepseek','claude'],label:'Best for analysis: ChatGPT & DeepSeek'}
};
function toggleCompareMode(){
  compareModeActive=!compareModeActive;
  const btn=document.getElementById('compareAllBtn');
  const panel=document.getElementById('compareModePanel');
  if(compareModeActive){
    btn.style.background='#2563eb';btn.style.color='#fff';
    panel.style.display='';
    showToast('âš–ï¸ Compare mode ON â€” ask all AIs!');
  }else{
    btn.style.background='';btn.style.color='#2563eb';
    panel.style.display='none';
    showToast('Compare mode OFF');
  }
}
function setBestMatch(topic){
  bestMatchTopic=topic;
  document.querySelectorAll('#compareModePanel .wave-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  const info=BEST_MATCH_MAP[topic];
  const badge=document.getElementById('bestMatchBadge');
  if(badge)badge.innerHTML=`<span style="color:var(--primary);font-weight:700">â­ ${info.label}</span>`;
  showToast('Best match set: '+topic);
}
async function sendToAllAIs(){
  const input=document.getElementById('compareInput');
  const q=input.value.trim();if(!q)return;
  const btn=document.getElementById('compareBtn');
  btn.disabled=true;btn.textContent='â³ Asking all AIs...';
  const results=document.getElementById('compareResults');
  results.style.display='grid';
  results.style.gridTemplateColumns='1fr';
  results.innerHTML='<div style="text-align:center;padding:20px;color:var(--text3)">â³ Sending to all AIs...</div>';
  
  const bestIds=BEST_MATCH_MAP[bestMatchTopic]?.ids||[];
  const externalModels=AI_MODELS.filter(m=>['openai','google','xai','perplexity','deepseek','anthropic'].includes(m.provider));
  const logs=getLogs().slice(-5);
  const userCtx=logs.length?`\nUser has ${logs.length} recent logs. Latest mood: ${logs[logs.length-1]?.mood||'?'}/10`:'';
  
  // Build cards for each model
  results.innerHTML=externalModels.map(m=>`
    <div style="background:var(--bg2);border:1.5px solid var(--border);border-radius:14px;padding:14px;position:relative;${bestIds.includes(m.id)?'border-color:#2563eb;':''}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <span style="font-size:20px">${m.emoji}</span>
        <span style="font-weight:700;font-size:14px">${m.name}</span>
        ${bestIds.includes(m.id)?'<span style="font-size:10px;background:#2563eb;color:#fff;border-radius:20px;padding:2px 7px">â­ Best Match</span>':''}
        <span style="margin-left:auto;font-size:11px;color:var(--text3)" id="cmpStatus_${m.id}">â³ Waiting...</span>
      </div>
      <div id="cmpResult_${m.id}" style="font-size:13px;color:var(--text2);line-height:1.6;background:var(--bg3);border-radius:10px;padding:10px;min-height:60px">Querying ${m.name}...</div>
    </div>
  `).join('');
  
  // Fire all requests in parallel
  const promises=externalModels.map(async m=>{
    const el=document.getElementById('cmpResult_'+m.id);
    const st=document.getElementById('cmpStatus_'+m.id);
    try{
      const answer=await callAI(m,[{role:'user',content:q}],userCtx);
      if(el){el.textContent=answer;el.style.color='var(--text)';}
      if(st){st.textContent='âœ… Done';st.style.color='var(--success)';}
    }catch(err){
      if(el){el.textContent='âš ï¸ '+( getApiKey(m.provider)?err.message:'No API key â€” add key in settings');el.style.color='var(--text3)';}
      if(st){st.textContent='âŒ Error';st.style.color='var(--danger)';}
    }
  });
  await Promise.allSettled(promises);
  btn.disabled=false;btn.textContent='âš¡ Ask All AIs';
  input.value='';
}
function buildAIModelsBar(){
  const bar=document.getElementById('aiModelsBar');if(!bar)return;
  bar.innerHTML=AI_MODELS.map(m=>`<div class="ai-model-btn${m.id===curAIModel?' active':''}" onclick="selectAIModel('${m.id}')"><span class="ai-logo">${m.emoji}</span><span class="ai-name">${m.name}</span></div>`).join('');
  updateKeyStatuses();
}
function selectAIModel(id){
  curAIModel=id;
  document.querySelectorAll('.ai-model-btn').forEach(b=>b.classList.remove('active'));
  const btn=document.querySelector(`.ai-model-btn[onclick="selectAIModel('${id}')"]`);if(btn)btn.classList.add('active');
  const m=AI_MODELS.find(m=>m.id===id);if(!m)return;
  const greetings={twin:'Hello! I\'ve been analyzing your consciousness data. What would you like to explore?',claude:'Hi! I\'m Claude. How can I help you today?',chatgpt:'Hello! I\'m ChatGPT. Ask me anything!',gemini:'Hey! I\'m Gemini. What shall we explore?',grok:'Yo. Grok here. What do you want to know?',perplexity:'Hello! I can search for grounded, up-to-date answers. What do you need?',deepseek:'Hello. I\'m DeepSeek. Ready for deep analysis.',sage:'Seek and you shall find. What wisdom do you seek?',doctor:'Good day. How can I assist with your cognitive health?',coach:'Let\'s get to work. What performance goal are we attacking?',friend:'Hey! What\'s up? ðŸ˜Š'};
  addChatMsg('ai',greetings[id]||'How can I help you today?',id);
  const externalProviders=['openai','google','xai','perplexity','deepseek'];
  if(externalProviders.includes(m.provider)&&!getApiKey(m.provider)){
    setTimeout(()=>addChatMsg('ai',`âš ï¸ To use ${m.name}, you need an API key. Click "Set Key" in the API Keys section below, or I\'ll fall back to local responses.`,id),300);
  }
}
function loadDailyTip(){const el=document.getElementById('aiDailyTip');if(el)el.textContent=DAILY_TIPS[new Date().getDate()%DAILY_TIPS.length];}
function buildSuggestedQs(){
  const el=document.getElementById('suggestedQs');if(!el)return;
  const shuffled=[...SUGGESTED_QS].sort(()=>Math.random()-.5).slice(0,6);
  el.innerHTML=shuffled.map(q=>`<button class="sq-btn" onclick="askSuggested('${q.replace(/'/g,"\\'")}')">${q}</button>`).join('');
}
function askSuggested(q){document.getElementById('chatInput').value=q;sendChat();}
function addChatMsg(role,text,modelId){
  const msgs=document.getElementById('chatMessages');if(!msgs)return;
  const model=AI_MODELS.find(m=>m.id===(modelId||curAIModel));
  const div=document.createElement('div');div.className='chat-msg '+role;
  if(role==='ai')div.innerHTML=`<div class="ai-tag">${model?model.emoji+' '+model.name:'AI'}</div>${text}`;
  else div.textContent=text;
  msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;
  chatHistory.push({role,content:text,model:modelId||curAIModel});
}
function clearAIChat(){chatHistory=[];document.getElementById('chatMessages').innerHTML='';showToast('Chat cleared');}
function exportChat(){
  const text=chatHistory.map(m=>`[${m.role.toUpperCase()}]: ${m.content}`).join('\n\n');
  const blob=new Blob([text],{type:'text/plain'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='consciousness_chat.txt';a.click();
}
function handleChatKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat();}}
async function sendChat(){
  const input=document.getElementById('chatInput');
  let msg=input.value.trim();if(!msg)return;
  input.value='';addChatMsg('user',msg);
  const model=AI_MODELS.find(m=>m.id===curAIModel);
  const msgs=document.getElementById('chatMessages');
  const loadDiv=document.createElement('div');loadDiv.className='chat-msg ai';
  loadDiv.innerHTML=`<div class="ai-tag">${model.emoji} ${model.name}</div><div class="ai-loading"><span></span><span></span><span></span></div>`;
  msgs.appendChild(loadDiv);msgs.scrollTop=msgs.scrollHeight;

  const logs=getLogs().slice(0,30);
  const dreams=getDreams().slice(0,10);
  const healthData=JSON.parse(localStorage.getItem('cos_health_profile')||'{}');
  let userContext='';
  if(logs.length){
    const avk=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);
    const emotions={};logs.forEach(e=>{if(e.emotion)emotions[e.emotion]=(emotions[e.emotion]||0)+1;});
    const topEmo=Object.entries(emotions).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([e])=>e).join(', ');
    const recent=logs.slice(0,7);const ravg=k=>(recent.reduce((s,e)=>s+(e[k]||0),0)/recent.length).toFixed(1);
    userContext+=`\n\nUSER CONSCIOUSNESS DATA (${logs.length} entries):
- 7-day avgs: mood=${ravg('mood')}, focus=${ravg('focus')}, energy=${ravg('physicalEnergy')}, stress=${ravg('stress')}, creativity=${ravg('creativity')}, flow=${ravg('flow')}, sleep=${ravg('sleep')}
- All-time: mood=${avk('mood')}, focus=${avk('focus')}, stress=${avk('stress')}, clarity=${avk('clarity')}
- Top emotions: ${topEmo||'not tracked'}
- Latest: score=${logs[0].score||'?'}, emotion=${logs[0].emotion||'?'}, activity=${logs[0].activity||'?'}
${logs[0].thought?'- Latest thought: "'+logs[0].thought.slice(0,150)+'"':''}`;
  }
  if(dreams.length)userContext+=`\n\nDREAMS (${dreams.length} logged): avg lucidity=${(dreams.reduce((s,d)=>s+(d.lucidity||0),0)/dreams.length).toFixed(1)}/10`;
  if(Object.keys(healthData).length>2)userContext+=`\n\nHEALTH: sleep=${healthData.hSleepDur||'?'}, exercise=${healthData.hExerciseFreq||'?'}, diet=${healthData.hDiet||'?'}`;
  const studyData=JSON.parse(localStorage.getItem('cos_study_profile')||'{}');
  if(studyData.stField)userContext+=`\n\nSTUDY: field=${studyData.stField}, target=${studyData.stTargetCareer||'?'}`;

  const recentHistory=chatHistory.filter(m=>m.role==='user'||m.role==='ai').slice(-10);
  const apiMessages=[...recentHistory.map(m=>({role:m.role==='ai'?'assistant':'user',content:m.content})),{role:'user',content:msg}];

  try{
    const text=await callAI(model,apiMessages,userContext);
    loadDiv.remove();
    const aiDiv=document.createElement('div');aiDiv.className='chat-msg ai';
    aiDiv.innerHTML=`<div class="ai-tag">${model.emoji} ${model.name}</div><span id="typeTarget"></span>`;
    msgs.appendChild(aiDiv);
    const target=document.getElementById('typeTarget');
    let i=0;const type=()=>{if(i<text.length){target.textContent+=text[i++];msgs.scrollTop=msgs.scrollHeight;setTimeout(type,10);}};type();
    chatHistory.push({role:'ai',content:text,model:curAIModel});
  }catch(e){
    loadDiv.remove();
    addChatMsg('ai',localAIResponse(msg)+`\n\n<em style="font-size:11px;color:var(--text3)">Note: ${e.message||'Could not connect to AI'}. Check your API key in the AI Hub settings.</em>`);
  }
  buildSuggestedQs();
}
function localAIResponse(msg){
  const logs=getLogs();if(!logs.length)return "I need your consciousness data first! Fill out your Daily Log to get personalized insights.";
  const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);
  const lower=msg.toLowerCase();
  if(lower.includes('mood'))return `Your avg mood is ${avg('mood')}/10. ${parseFloat(avg('mood'))>6?'Great foundation! Keep doing what works.':'Morning sunlight, exercise, and gratitude journaling can lift it significantly.'}`;
  if(lower.includes('focus'))return `Focus avg: ${avg('focus')}/10. ${parseFloat(avg('focus'))>6?'Strong concentration!':'Try 25-min Pomodoros and no-phone zones during deep work.'}`;
  if(lower.includes('stress'))return `Stress avg: ${avg('stress')}/10. ${parseFloat(avg('stress'))>6?'High! Try 4-7-8 breathing and daily walks.':'Well managed â€” this is your superpower.'}`;
  return `From your ${logs.length} entries: Best area is ${getBestDim(logs)}, growth opportunity is ${getWeakDim(logs)}. Keep logging daily for deeper patterns!`;
}
function getBestDim(logs){const dims=['mood','focus','physicalEnergy','creativity','flow'];let b=dims[0],bv=0;dims.forEach(d=>{const a=logs.reduce((s,e)=>s+(e[d]||0),0)/logs.length;if(a>bv){bv=a;b=d;}});return b+'('+bv.toFixed(1)+')';}
function getWeakDim(logs){const dims=['mood','focus','physicalEnergy','creativity','flow'];let w=dims[0],wv=10;dims.forEach(d=>{const a=logs.reduce((s,e)=>s+(e[d]||0),0)/logs.length;if(a<wv){wv=a;w=d;}});return w+'('+wv.toFixed(1)+')';}
function refreshAIInsights(){
  const el=document.getElementById('aiPatternDisplay');if(!el)return;
  const logs=getLogs();
  if(logs.length<3){el.innerHTML='<div style="font-size:13px;color:var(--text2)">Log at least 3 entries to see pattern analysis.</div>';return;}
  const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);
  const recent=logs.slice(0,7),prev=logs.slice(7,14);
  const trend=key=>{if(!prev.length)return 'âž¡ï¸';const d=recent.reduce((s,e)=>s+(e[key]||0),0)/recent.length-prev.reduce((s,e)=>s+(e[key]||0),0)/prev.length;return d>0.5?'ðŸ“ˆ':d<-0.5?'ðŸ“‰':'âž¡ï¸';};
  el.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px">
    ${['mood','focus','stress','creativity','sleep','flow'].map(k=>`<div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center"><div style="font-size:18px;font-weight:800;color:var(--primary)">${avg(k)}</div><div style="font-size:10px;color:var(--text3)">${k} ${trend(k)}</div></div>`).join('')}
  </div>
  <div style="margin-top:10px;font-size:13px;color:var(--text2);background:var(--bg3);border-radius:10px;padding:10px">ðŸ’¡ <strong>AI Insight:</strong> Based on ${logs.length} entries, strongest: ${getBestDim(logs)}, growth opportunity: ${getWeakDim(logs)}.</div>`;
}

// â”€â”€â”€ ANALYSIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function refreshAnalysis(){
  const logs=getLogs();
  const avg=key=>logs.length?(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1):'â€”';
  document.getElementById('statMood').textContent=avg('mood');
  document.getElementById('statFocus').textContent=avg('focus');
  document.getElementById('statScore').textContent=avg('score');
  document.getElementById('statFlow').textContent=avg('flow');
  document.getElementById('statCreativity').textContent=avg('creativity');
  document.getElementById('statEntries').textContent=logs.length;
  buildPredictions(logs);buildTrends(logs);buildRecords(logs);buildPatterns(logs);
}
function buildPredictions(logs){
  const el=document.getElementById('predictionsArea');
  if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ðŸ”®</span><div class="es-text">Log 7+ entries to unlock predictions</div></div>';return;}
  const recent=logs.slice(0,7);const ar=key=>recent.reduce((s,e)=>s+(e[key]||0),0)/recent.length;
  const moodTrend=logs.length>1?logs[0].mood-logs[1].mood:0;
  el.innerHTML=`<div class="form-row">
    <div class="comparison-box"><div class="cv" style="color:var(--success)">${Math.min(10,Math.max(0,ar('focus')+moodTrend*0.5)).toFixed(1)}</div><div class="cl">Tomorrow's Focus</div></div>
    <div class="comparison-box"><div class="cv" style="color:var(--primary)">${Math.min(10,Math.max(0,ar('score')+moodTrend*0.3)).toFixed(1)}</div><div class="cl">Tomorrow's Score</div></div>
  </div>
  <div style="font-size:12px;color:var(--text2);background:var(--bg3);border-radius:10px;padding:10px">
    ${moodTrend>0.5?'âœ… Mood is rising â€” expect better performance tomorrow!':moodTrend<-0.5?'âš ï¸ Mood is dipping â€” focus on recovery tonight.':'ðŸ“Š Stable trajectory. Maintain your routines.'}
  </div>`;
}
function buildTrends(logs){
  const el=document.getElementById('trendsArea');
  if(logs.length<5){el.innerHTML='<div style="font-size:13px;color:var(--text3)">Need 10+ entries for trend analysis.</div>';return;}
  const r=logs.slice(0,Math.min(10,logs.length)),p=logs.slice(10,20);
  ['mood','focus','stress','creativity','flow','sleep','motivation','clarity'].forEach(k=>{
    const ra=r.reduce((s,e)=>s+(e[k]||0),0)/r.length;const pa=p.length?p.reduce((s,e)=>s+(e[k]||0),0)/p.length:ra;
    const d=(ra-pa).toFixed(1);const icon=parseFloat(d)>0.3?'ðŸ“ˆ +':parseFloat(d)<-0.3?'ðŸ“‰ ':'âž¡ï¸ ';
    const color=parseFloat(d)>0.3?'var(--success)':parseFloat(d)<-0.3?'var(--danger)':'var(--text3)';
    el.innerHTML+='';
  });
  el.innerHTML=['mood','focus','stress','creativity','flow','sleep','motivation','clarity'].map(k=>{
    const ra=r.reduce((s,e)=>s+(e[k]||0),0)/r.length;const pa=p.length?p.reduce((s,e)=>s+(e[k]||0),0)/p.length:ra;
    const d=(ra-pa).toFixed(1);const icon=parseFloat(d)>0.3?'ðŸ“ˆ +':parseFloat(d)<-0.3?'ðŸ“‰ ':'âž¡ï¸ ';
    const color=parseFloat(d)>0.3?'var(--success)':parseFloat(d)<-0.3?'var(--danger)':'var(--text3)';
    return `<div class="trend-item"><span>${k}</span><span style="color:${color};font-weight:700">${icon}${Math.abs(d)}</span></div>`;
  }).join('');
}
function buildRecords(logs){
  const el=document.getElementById('recordsArea');if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ðŸ†</span><div class="es-text">Start logging to track records</div></div>';return;}
  const max=key=>logs.reduce((m,e)=>Math.max(m,e[key]||0),0);
  el.innerHTML=`<div class="stats-grid"><div class="stat-box"><div class="sv">${max('score').toFixed(1)}</div><div class="sl">Best Score</div></div><div class="stat-box"><div class="sv">${max('focus')}</div><div class="sl">Peak Focus</div></div><div class="stat-box"><div class="sv">${max('flow')}</div><div class="sl">Peak Flow</div></div><div class="stat-box"><div class="sv">${max('creativity')}</div><div class="sl">Peak Creativity</div></div><div class="stat-box"><div class="sv">${max('mood')}</div><div class="sl">Best Mood</div></div><div class="stat-box"><div class="sv">${max('sleep')}</div><div class="sl">Best Sleep</div></div></div>`;
}
function buildPatterns(logs){
  const el=document.getElementById('patternsArea');
  if(logs.length<5){el.innerHTML='<div class="empty-state"><span class="es-icon">ðŸ§©</span><div class="es-text">Log 5+ entries to detect patterns</div></div>';return;}
  const emotions={};logs.forEach(e=>{if(e.emotion)emotions[e.emotion]=(emotions[e.emotion]||0)+1;});
  const top=Object.entries(emotions).sort((a,b)=>b[1]-a[1]).slice(0,6);
  el.innerHTML=`<div style="margin-bottom:10px"><div style="font-weight:700;font-size:13px;margin-bottom:6px">Dominant Emotions:</div>${top.map(([em,n])=>`<span class="chip">${em} Ã—${n}</span>`).join('')}</div>`;
}

// â”€â”€â”€ HEALTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HEALTH_SECTIONS=[
  {name:'Demographics',icon:'ðŸ‘¤',fields:[{type:'text',id:'hAge',label:'Age'},{type:'radio',id:'hSex',label:'Biological Sex',options:['Male','Female','Intersex','Prefer not to say']},{type:'height',id:'hHeight',label:'Height'},{type:'weight',id:'hWeight',label:'Weight'},{type:'text',id:'hWaist',label:'Waist (cm)'},{type:'select',id:'hOccupation',label:'Occupation Type',options:['Sedentary (desk work)','Light activity','Moderate activity','Active (physical labor)','Very active (athlete/trainer)']},{type:'select',id:'hEnvironment',label:'Environment',options:['Urban','Suburban','Rural','Remote']}]},
  {name:'Medical History',icon:'ðŸ¥',fields:[{type:'checkbox',id:'hConditions',label:'Existing Conditions',options:['Diabetes','Hypertension','Heart Disease','Asthma','Thyroid','Arthritis','Depression','Anxiety','ADHD','None']},{type:'textarea',id:'hMeds',label:'Current Medications / Supplements'},{type:'radio',id:'hHosp',label:'Hospitalized in last 2 years?',options:['Yes','No']},{type:'textarea',id:'hAllergies',label:'Known Allergies'}]},
  {name:'Family History',icon:'ðŸ§¬',fields:[{type:'checkbox',id:'hFamily',label:'Family History of:',options:['Heart Disease','Diabetes','Cancer','Stroke','Alzheimer\'s','Mental Illness','Autoimmune','Longevity (90+ years)','None']}]},
  {name:'Diet & Nutrition',icon:'ðŸ¥—',fields:[{type:'select',id:'hMeals',label:'Meals per day',options:['1','2','3','4','5+','Intermittent Fasting']},{type:'select',id:'hDiet',label:'Dietary Pattern',options:['Omnivore','Vegetarian','Vegan','Keto','Paleo','Mediterranean','Carnivore','Other']},{type:'select',id:'hWater',label:'Daily Water',options:['<1L','1-2L','2-3L','3-4L','>4L']},{type:'select',id:'hProcessed',label:'Processed Food',options:['Never','Rarely','Sometimes','Often','Daily']},{type:'textarea',id:'hIntolerances',label:'Food Intolerances'}]},
  {name:'Substance Use',icon:'â˜•',fields:[{type:'radio',id:'hSmoking',label:'Smoking',options:['Never','Former','Current']},{type:'select',id:'hAlcohol',label:'Alcohol',options:['Never','Rarely','1-3/week','4-7/week','Daily','Heavy (>14/week)']},{type:'select',id:'hCaffeine',label:'Caffeine',options:['None','1 cup/day','2-3 cups/day','4+ cups/day']}]},
  {name:'Physical Activity',icon:'ðŸƒ',fields:[{type:'select',id:'hExerciseFreq',label:'Exercise Frequency',options:['Never','1-2x/week','3-4x/week','5-6x/week','Daily','Twice daily']},{type:'checkbox',id:'hExTypes',label:'Exercise Types',options:['Cardio','Strength','Yoga','Martial Arts','Swimming','Cycling','Running','Walking']},{type:'number',id:'hSteps',label:'Avg Daily Steps'},{type:'number',id:'hHR',label:'Resting Heart Rate (bpm)'},{type:'number',id:'hVO2',label:'VO2 Max (if known)'}]},
  {name:'Sleep Health',icon:'ðŸ˜´',fields:[{type:'select',id:'hSleepDur',label:'Average Sleep Duration',options:['<5h','5-6h','6-7h','7-8h','8-9h','>9h']},{type:'time',id:'hBedtime',label:'Usual Bedtime'},{type:'time',id:'hWakeTime',label:'Usual Wake Time'},{type:'checkbox',id:'hSleepIssues',label:'Sleep Issues',options:['Insomnia','Sleep Apnea','Snoring','Restless Legs','Night Sweats','Sleepwalking','None']}]},
  {name:'Mental Health',icon:'ðŸ§ ',fields:[{type:'select',id:'hMoodBaseline',label:'Mood Baseline',options:['Very low','Low','Neutral','Good','Excellent']},{type:'select',id:'hAnxiety',label:'Anxiety Level',options:['None','Mild','Moderate','Severe']},{type:'radio',id:'hDepression',label:'History of Depression?',options:['Yes (current)','Yes (past)','No']},{type:'radio',id:'hADHD',label:'ADHD?',options:['Yes','No','Suspected']},{type:'select',id:'hBurnout',label:'Current Burnout',options:['None','Mild','Moderate','Severe']},{type:'select',id:'hLifeSat',label:'Life Satisfaction',options:['Very unsatisfied','Unsatisfied','Neutral','Satisfied','Very satisfied']}]},
  {name:'Hormonal Health',icon:'âš—ï¸',fields:[{type:'select',id:'hEnergyPatt',label:'Daily Energy Pattern',options:['Morning person','Evening person','Consistent','Variable']},{type:'select',id:'hLibido',label:'Libido',options:['Very low','Low','Normal','High']},{type:'radio',id:'hThyroid',label:'Thyroid issues?',options:['Yes','No','Unknown']}]},
  {name:'Cardiometabolic',icon:'â¤ï¸',fields:[{type:'text',id:'hBP',label:'Blood Pressure (e.g. 120/80)'},{type:'text',id:'hHbA1c',label:'HbA1c % (if known)'},{type:'select',id:'hCholesterol',label:'Cholesterol',options:['Optimal','Borderline','High','Unknown']},{type:'checkbox',id:'hHeartSymp',label:'Heart Symptoms',options:['Chest pain','Palpitations','Shortness of breath','Swollen ankles','None']}]},
  {name:'Digestive Health',icon:'ðŸ«',fields:[{type:'select',id:'hDigestion',label:'General Digestion',options:['Excellent','Good','Fair','Poor']},{type:'checkbox',id:'hGutIssues',label:'Gut Issues',options:['Bloating','Gas','Acid Reflux','IBS','IBD','Constipation','Diarrhea','None']},{type:'select',id:'hBowel',label:'Bowel Frequency',options:['Multiple/day','Once/day','Every 2-3 days','Less frequent']}]},
  {name:'Immune & Inflammation',icon:'ðŸ›¡ï¸',fields:[{type:'select',id:'hImmune',label:'How often sick?',options:['Rarely (<1/year)','Occasionally (1-2/year)','Sometimes (3-4/year)','Frequently (>4/year)']},{type:'checkbox',id:'hInflam',label:'Inflammation Signs',options:['Joint Pain','Skin Issues','Chronic Fatigue','Brain Fog','Autoimmune','None']}]},
  {name:'Neurology & Pain',icon:'âš¡',fields:[{type:'select',id:'hHeadaches',label:'Headaches',options:['Never','Rarely','Monthly','Weekly','Daily']},{type:'checkbox',id:'hNeuro',label:'Neurological',options:['Dizziness','Memory Issues','Neuropathy','Vision Problems','None']},{type:'select',id:'hPain',label:'Chronic Pain',options:['None','Mild (1-3)','Moderate (4-6)','Severe (7-10)']}]},
  {name:'Environment',icon:'ðŸŒ',fields:[{type:'select',id:'hAirQ',label:'Air Quality',options:['Excellent','Good','Moderate','Poor']},{type:'select',id:'hScreenTime',label:'Daily Screen Time',options:['<2h','2-4h','4-6h','6-8h','>8h']},{type:'checkbox',id:'hEnvExp',label:'Exposures',options:['Traffic Pollution','Chemical Exposure','Noise Pollution','Poor Ergonomics','Excessive Blue Light','None']}]},
  {name:'Preventive Health',icon:'ðŸ”¬',fields:[{type:'select',id:'hBloodTest',label:'Last Blood Work',options:['Within 6 months','6-12 months ago','1-2 years ago','2+ years ago','Never']},{type:'select',id:'hDental',label:'Last Dental Checkup',options:['Within 6 months','6-12 months','1-2 years','2+ years','Never']},{type:'text',id:'hBioAge',label:'Biological Age Test Result (if done)'}]},
  {name:'Functional Capacity',icon:'ðŸ‹ï¸',fields:[{type:'select',id:'hStairs',label:'Climb 3 flights easily?',options:['Easily','Yes with effort','With difficulty','No']},{type:'select',id:'hBalance',label:'Balance',options:['Excellent','Good','Fair','Poor']},{type:'select',id:'hEnergyDay',label:'Energy throughout day',options:['Consistent','Morning peaks','Afternoon crashes','Evening peaks','Very variable']}]},
  {name:'Longevity Markers',icon:'â³',fields:[{type:'text',id:'hEpigenetic',label:'Epigenetic Clock Result (if known)'},{type:'text',id:'hHormones',label:'Hormone Panel (if known)'},{type:'select',id:'hGrip',label:'Grip Strength',options:['Very strong','Strong','Average','Weak']}]},
  {name:'Health Goals',icon:'ðŸŽ¯',fields:[{type:'checkbox',id:'hGoals',label:'My Health Priorities',options:['Longevity','Peak Performance','Mental Health','Weight Management','Disease Prevention','Energy & Vitality','Better Sleep','Strength & Fitness','Stress Reduction']},{type:'textarea',id:'hMainConcern',label:'Main Health Concern'},{type:'textarea',id:'hHealthNotes',label:'Anything else?'}]},
];
let hsCurrent=0;
function buildHealthSections(){
  const jumpBar=document.getElementById('healthJumpBar');const container=document.getElementById('healthSectionsContainer');
  if(!jumpBar||!container)return;
  jumpBar.innerHTML=HEALTH_SECTIONS.map((s,i)=>`<button class="section-jump${i===0?' active':''}" onclick="jumpToSection(${i})" title="${s.name}">${s.icon} ${i+1}</button>`).join('');
  container.innerHTML=HEALTH_SECTIONS.map((s,i)=>`<div class="health-section card${i===0?' active':''}" id="hSection_${i}"><div class="card-title"><span class="emoji">${s.icon}</span> ${s.name}</div>${buildHFields(s.fields)}</div>`).join('');
}
function buildHFields(fields){
  return fields.map(f=>{
    if(f.type==='height')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:6px;align-items:center"><input type="number" class="form-input" id="${f.id}_cm" placeholder="cm" style="flex:1" oninput="syncH('cm')"><span style="font-size:12px;color:var(--text3)">cm</span><input type="number" class="form-input" id="${f.id}_ft" placeholder="ft" style="flex:.7" oninput="syncH('ft')"><span style="font-size:12px;color:var(--text3)">ft</span><input type="number" class="form-input" id="${f.id}_in" placeholder="in" style="flex:.7" oninput="syncH('ft')"><span style="font-size:12px;color:var(--text3)">in</span></div></div>`;
    if(f.type==='weight')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:6px;align-items:center"><input type="number" class="form-input" id="${f.id}_kg" placeholder="kg" style="flex:1" oninput="syncW('kg')"><span style="font-size:12px;color:var(--text3)">kg</span><input type="number" class="form-input" id="${f.id}_lb" placeholder="lbs" style="flex:1" oninput="syncW('lb')"><span style="font-size:12px;color:var(--text3)">lbs</span></div></div>`;
    if(f.type==='radio')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:8px;flex-wrap:wrap">${f.options.map(o=>`<label style="display:flex;align-items:center;gap:4px;font-size:13px;cursor:pointer"><input type="radio" name="${f.id}" value="${o}"> ${o}</label>`).join('')}</div></div>`;
    if(f.type==='checkbox')return `<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;gap:6px;flex-wrap:wrap">${f.options.map(o=>`<label style="display:flex;align-items:center;gap:4px;font-size:12px;cursor:pointer;background:var(--bg);border:1px solid var(--border);padding:4px 8px;border-radius:8px"><input type="checkbox" name="${f.id}" value="${o}"> ${o}</label>`).join('')}</div></div>`;
    if(f.type==='textarea')return `<div class="form-group"><label class="form-label">${f.label}</label><textarea class="form-textarea" id="${f.id}" style="min-height:60px"></textarea></div>`;
    if(f.type==='select')return `<div class="form-group"><label class="form-label">${f.label}</label><select class="form-select" id="${f.id}">${f.options.map(o=>`<option>${o}</option>`).join('')}</select></div>`;
    return `<div class="form-group"><label class="form-label">${f.label}</label><input type="${f.type||'text'}" class="form-input" id="${f.id}"></div>`;
  }).join('');
}
function syncH(from){
  const cm=parseFloat(document.getElementById('hHeight_cm')?.value)||0;const ft=parseFloat(document.getElementById('hHeight_ft')?.value)||0;const inc=parseFloat(document.getElementById('hHeight_in')?.value)||0;
  if(from==='cm'&&cm){const totalIn=cm/2.54;document.getElementById('hHeight_ft').value=Math.floor(totalIn/12);document.getElementById('hHeight_in').value=Math.round(totalIn%12);}
  else if(from==='ft'){const totalCm=(ft*12+inc)*2.54;if(document.getElementById('hHeight_cm'))document.getElementById('hHeight_cm').value=Math.round(totalCm);}
}
function syncW(from){
  const kg=parseFloat(document.getElementById('hWeight_kg')?.value)||0;const lb=parseFloat(document.getElementById('hWeight_lb')?.value)||0;
  if(from==='kg'&&kg)document.getElementById('hWeight_lb').value=(kg*2.20462).toFixed(1);
  else if(from==='lb'&&lb)document.getElementById('hWeight_kg').value=(lb/2.20462).toFixed(1);
}
function jumpToSection(i){
  document.querySelectorAll('.health-section').forEach((s,j)=>s.classList.toggle('active',j===i));
  document.querySelectorAll('.section-jump').forEach((b,j)=>b.classList.toggle('active',j===i));
  hsCurrent=i;
  document.getElementById('hsCurrent').textContent=i+1;
  document.getElementById('hsSectionName').textContent=HEALTH_SECTIONS[i].name;
  document.getElementById('hsProgressBar').style.width=((i+1)/18*100)+'%';
  document.getElementById('hsPrevBtn').style.display=i>0?'':'none';
  document.getElementById('hsNextBtn').textContent=i===17?'âœ¨ Get AI Analysis':'Next â†’';
}
function hsPrev(){if(hsCurrent>0)jumpToSection(hsCurrent-1);}
function hsNext(){if(hsCurrent<17)jumpToSection(hsCurrent+1);else generateHealthAnalysis();}
async function generateHealthAnalysis(){
  const card=document.getElementById('aiDoctorCard');const output=document.getElementById('aiDoctorOutput');
  card.style.display='block';
  output.innerHTML='<div class="ai-loading"><span></span><span></span><span></span></div> <span style="font-size:13px;color:var(--text2)">AI Doctor analyzing...</span>';
  card.scrollIntoView({behavior:'smooth'});
  const kg=document.getElementById('hWeight_kg')?.value||0;const cm=document.getElementById('hHeight_cm')?.value||0;
  const bmi=kg&&cm?(kg/((cm/100)**2)).toFixed(1):'Unknown';
  const age=document.getElementById('hAge')?.value||'Unknown';
  await new Promise(r=>setTimeout(r,1500));
  output.innerHTML=`<div style="background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(16,185,129,.1));border-radius:12px;padding:14px;margin-bottom:12px">
    <div style="font-weight:800;font-family:Syne,sans-serif;font-size:16px;margin-bottom:8px">ðŸ“Š Health Summary</div>
    <div class="stats-grid"><div class="stat-box"><div class="sv">${bmi}</div><div class="sl">BMI</div></div><div class="stat-box"><div class="sv">${age}</div><div class="sl">Age</div></div></div>
  </div>
  <div style="font-size:13px;color:var(--text2);line-height:1.7">
    <p><strong>ðŸŽ¯ AI Doctor Recommendations:</strong></p>
    <p>â€¢ <strong>Sleep optimization</strong> is the foundational pillar â€” every other metric improves when sleep quality exceeds 7.</p>
    <p>â€¢ <strong>Omega-3 rich foods</strong> (salmon, flaxseed, walnuts) significantly improve cognitive function and reduce inflammation.</p>
    <p>â€¢ <strong>7,000-10,000 daily steps</strong> improves cardiovascular, cognitive, and mental health simultaneously.</p>
    <p>â€¢ Schedule a <strong>comprehensive blood panel</strong> â€” thyroid, vitamin D, B12, ferritin, CRP, testosterone.</p>
    <p>â€¢ Consider a <strong>30-day elimination diet</strong> to identify food sensitivities affecting your energy and cognition.</p>
    <p>â€¢ Daily <strong>cold exposure</strong> (2-min cold shower) boosts dopamine 250% and norepinephrine 300% for up to 3 hours.</p>
    <p style="margin-top:10px;font-size:11px;color:var(--text3)">âš•ï¸ Educational only. Always consult a qualified physician for medical decisions.</p>
  </div>`;
}

// â”€â”€â”€ BRAIN GAMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GAMES_LIST=[
  // ðŸ§  IQ & Fluid Intelligence
  {id:'nback',name:'Dual N-Back',emoji:'ðŸ”¢',desc:'Working memory training â€” strongest evidence for IQ gain',tag:'IQ & Fluid Intelligence',category:'iq',difficulty:'Hard',
   howTo:'See a sequence of positions + hear letters. Remember what appeared N steps ago. Both position AND letter must be recalled simultaneously. Start at N=2. When you hit >80% accuracy, increase N. This is the gold standard for working memory and fluid IQ improvement. Play 20 min/day for 30 days for measurable results.'},
  {id:'spatial',name:'Spatial Rotation',emoji:'ðŸ”„',desc:'Mental rotation puzzles â€” abstract reasoning',tag:'IQ & Fluid Intelligence',category:'iq',difficulty:'Hard',
   howTo:'A 3D shape is shown alongside 4 answer options. Mentally rotate the shape in your mind to find which option matches. Do NOT physically rotate your device. Time yourself â€” speed and accuracy both matter. This directly trains the spatial intelligence component of IQ (Block Design subtest).'},
  {id:'sudoku',name:'Sudoku Pro',emoji:'ðŸ§©',desc:'Constraint logic & planning â€” hard variants',tag:'IQ & Fluid Intelligence',category:'iq',difficulty:'Hard',
   howTo:'Fill the 9Ã—9 grid so every row, column, and 3Ã—3 box contains digits 1â€“9 exactly once. No guessing â€” use pure logical deduction. Techniques: single candidate, naked pairs, X-wing. Start with easy, graduate to hard. Trains constraint logic, working memory, and planning â€” all IQ-relevant.'},
  // ðŸŽ¯ Attention & Focus
  {id:'stroop',name:'Stroop Challenge',emoji:'ðŸŽ¨',desc:'Name the ink color â€” cognitive control training',tag:'Attention & Focus',category:'focus',difficulty:'Medium',
   howTo:'A color word appears (e.g. "RED") but printed in a different color (e.g. blue ink). Tap the COLOR OF THE INK â€” not the word. Your brain will try to read the word. Override it. This trains executive function and selective attention. Speed and accuracy matter. Elite meditators score significantly higher on this test.'},
  {id:'reaction',name:'Reaction Pro',emoji:'âš¡',desc:'Advanced reaction timing â€” processing speed',tag:'Attention & Focus',category:'focus',difficulty:'Medium',
   howTo:'Wait for the signal, then react as fast as possible. But beware â€” false starts count as errors. Your brain needs to distinguish "ready signal" from "go signal." Track your average reaction time over sessions. Human average is 250ms. Elite athletes: 150â€“180ms. Train to reduce both reaction time and variance.'},
  // ðŸ§© Working Memory
  {id:'memory',name:'Memory Matrix',emoji:'ðŸƒ',desc:'Find matching pairs â€” working memory & recall',tag:'Working Memory',category:'memory',difficulty:'Medium',
   howTo:'Cards are shown face-up briefly, then flipped. Find all matching pairs by tapping. You must hold the positions of all revealed cards in working memory simultaneously. Try harder difficulty (more cards). Don\'t create verbal lists â€” use spatial memory. This trains visuospatial working memory.'},
  {id:'simon',name:'Simon Says',emoji:'ðŸŽµ',desc:'Repeat complex sequences â€” sequential memory',tag:'Working Memory',category:'memory',difficulty:'Medium',
   howTo:'Watch the pattern of colored flashes, then repeat it exactly. Each round adds one more step. Focus on the rhythm and pattern, not individual colors. Use chunking: group sequences into 3s. Average human span: 7Â±2 items. Train to reach 12+. This is the classic working memory span test.'},
  // â™Ÿï¸ Strategic Intelligence
  {id:'chess',name:'Chess',emoji:'â™Ÿï¸',desc:'Classic deep strategy â€” visualization & planning',tag:'Strategic Intelligence',category:'strategy',difficulty:'Hard',
   howTo:'Standard chess vs AI. Move pieces to checkmate the opponent\'s king. Key skills: control the center (e4,d4,e5,d5), develop pieces before attacking, think 3 moves ahead. This app\'s AI plays at adaptive difficulty. Chess trains: calculation, pattern recognition, strategic planning, and emotional control under pressure.'},
  {id:'monopoly',name:'Monopoly',emoji:'ðŸ ',desc:'Property trading empire â€” financial & strategic reasoning',tag:'Strategic Intelligence',category:'strategy',difficulty:'Hard',
   howTo:'Buy properties, build houses & hotels, and bankrupt your opponents. Key strategy: buy railroads and utilities early, complete color groups before building, Orange & Red properties have the highest landing probability. Trade aggressively. This trains financial reasoning, negotiation thinking, and probabilistic strategy.'},
  // ðŸ§˜ Consciousness & Awareness
  {id:'pattern',name:'Pattern Recognition',emoji:'ðŸ‘ï¸',desc:'Find the odd one out â€” visual intelligence & awareness',tag:'Consciousness & Awareness',category:'conscious',difficulty:'Medium',
   howTo:'A grid of shapes/symbols is shown. One does not belong. Identify it as fast as possible. The patterns can be: color, shape, rotation, count, or a combination. This trains meta-awareness â€” the ability to notice what is different when your brain wants to see sameness. A key consciousness skill.'},
];
let activeGame=null;
function showGameGuide(id){
  const g=GAMES_LIST.find(x=>x.id===id);if(!g)return;
  openModal(g.emoji+' '+g.name,`
    <div style="margin-bottom:12px">
      <span style="background:var(--primary);color:#fff;border-radius:20px;padding:3px 10px;font-size:11px;font-weight:700">${g.category?.toUpperCase()||g.tag}</span>
      <span style="background:${g.difficulty==='Hard'?'var(--danger)':g.difficulty==='Medium'?'var(--warning)':'var(--success)'};color:#fff;border-radius:20px;padding:3px 10px;font-size:11px;font-weight:700;margin-left:6px">${g.difficulty||'Normal'}</span>
    </div>
    <div style="font-size:13px;color:var(--text2);line-height:1.8;margin-bottom:16px;background:var(--bg3);border-radius:12px;padding:14px">${g.howTo||g.desc}</div>
    <div style="font-size:11px;color:var(--text3);margin-bottom:14px;font-weight:600;text-transform:uppercase">Cognitive Benefit: ${g.tag}</div>
    <button class="btn btn-primary btn-block" onclick="closeAllModals();launchGame('${id}')">ðŸŽ® Start Game</button>
  `);
}
function buildGamesGrid(){
  const grid=document.getElementById('gamesGrid');if(!grid)return;
  const categories=[
    {key:'iq',label:'ðŸ§  IQ & Fluid Intelligence',color:'var(--primary)'},
    {key:'focus',label:'ðŸŽ¯ Attention & Focus',color:'var(--accent)'},
    {key:'memory',label:'ðŸ§© Working Memory',color:'var(--warning)'},
    {key:'strategy',label:'â™Ÿï¸ Strategic Intelligence',color:'var(--success)'},
    {key:'conscious',label:'ðŸ§˜ Consciousness & Awareness',color:'var(--pink)'},
  ];
  let html='';
  categories.forEach(cat=>{
    const games=GAMES_LIST.filter(g=>g.category===cat.key);
    if(!games.length)return;
    html+=`<div style="grid-column:1/-1;margin:10px 0 6px;font-family:Syne,sans-serif;font-weight:800;font-size:13px;color:${cat.color};border-left:3px solid ${cat.color};padding-left:8px">${cat.label}</div>`;
    games.forEach(g=>{
      html+=`<div class="game-card" onclick="showGameGuide('${g.id}')">
        <span class="g-emoji">${g.emoji}</span>
        <div class="g-name">${g.name}</div>
        <div class="g-desc">${g.desc}</div>
        <div class="g-tag">${g.tag}</div>
        <div style="font-size:10px;margin-top:5px;color:${g.difficulty==='Hard'?'var(--danger)':g.difficulty==='Medium'?'var(--warning)':'var(--success)'};font-weight:700">â— ${g.difficulty||'Normal'} Â· Tap for guide</div>
      </div>`;
    });
  });
  grid.style.gridTemplateColumns='1fr 1fr';
  grid.innerHTML=html;
}
function launchGame(id){
  document.getElementById('gamesMenu').style.display='none';
  const c=document.getElementById('gameContainer');c.innerHTML='';activeGame=id;
  const games={memory:renderMemoryGame,reaction:renderReactionGame,stroop:renderStroopGame,nback:renderNBackGame,math:renderMathGame,chess:renderChessGame,monopoly:renderMonopolyGame,go:renderGoGame,checkers:renderCheckersGame,battleship:renderBattleshipGame,sudoku:renderSudokuGame,pattern:renderPatternGame,typing:renderTypingGame,spatial:renderSpatialGame,simon:renderSimonGame,trivia:renderTriviaGame,word:renderWordGame,color:renderColorGame,estimate:renderFermiGame,sequence:renderSequenceGame,speed_read:renderSpeedReadGame,breathing:renderBreathingGame,anagram:renderAnagramGame};
  if(games[id])games[id](c);
}
function backToGames(){document.getElementById('gamesMenu').style.display='';document.getElementById('gameContainer').innerHTML='';activeGame=null;}
function gameHeader(title,emoji,l1,l2){return `<div class="game-header"><button class="btn btn-secondary btn-sm" onclick="backToGames()">â† Back</button><div style="flex:1;font-family:Syne,sans-serif;font-weight:800;font-size:18px">${emoji} ${title}</div></div><div class="game-score-bar"><div class="gs"><div class="gsv" id="gs1">0</div><div class="gsl">${l1}</div></div><div class="gs"><div class="gsv" id="gs2">-</div><div class="gsl">${l2}</div></div></div>`;}
function renderMemoryGame(c){
  const emojis=['ðŸ¶','ðŸ±','ðŸ­','ðŸ¹','ðŸ°','ðŸ¦Š','ðŸ»','ðŸ¼'];
  let cards=[...emojis,...emojis].sort(()=>Math.random()-.5),flipped=[],matched=[],moves=0,canFlip=true;
  c.innerHTML=gameHeader('Memory Match','ðŸƒ','Moves','Pairs')+`<div id="memGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;max-width:340px;margin:0 auto"></div><button class="btn btn-secondary btn-sm" onclick="launchGame('memory')" style="margin-top:10px;width:100%">ðŸ”„ New</button>`;
  const grid=document.getElementById('memGrid');
  cards.forEach((em,i)=>{
    const div=document.createElement('div');
    div.style.cssText='aspect-ratio:1;background:var(--bg3);border:2px solid var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;transition:all .3s';
    div.textContent='?';div.dataset.emoji=em;div.dataset.idx=i;
    div.onclick=function(){
      if(!canFlip||flipped.includes(i)||matched.includes(i))return;
      div.textContent=em;div.style.background='rgba(124,58,237,.15)';flipped.push(i);
      if(flipped.length===2){canFlip=false;moves++;document.getElementById('gs1').textContent=moves;
        const[a,b]=flipped;
        if(cards[a]===cards[b]){matched.push(a,b);flipped=[];canFlip=true;document.getElementById('gs2').textContent=matched.length/2;
          grid.children[a].style.borderColor='var(--success)';grid.children[b].style.borderColor='var(--success)';
          if(matched.length===cards.length)showToast('ðŸŽ‰ Done in '+moves+' moves!');
        }else{setTimeout(()=>{[a,b].forEach(x=>{grid.children[x].textContent='?';grid.children[x].style.background='var(--bg3)';});flipped=[];canFlip=true;},900);}
      }
    };grid.appendChild(div);
  });
}
function renderReactionGame(c){
  let state='idle',startTime,trials=[],th;
  c.innerHTML=gameHeader('Reaction Time','âš¡','Trial','Avg ms')+`<div id="rBox" onclick="rClick()" style="height:200px;border-radius:16px;background:var(--bg3);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;border:2px solid var(--border);transition:background .3s;user-select:none"><div id="rMsg" style="font-size:18px;font-weight:700">Tap to Start</div><div id="rSub" style="font-size:13px;color:var(--text3);margin-top:6px"></div></div><div id="rRes" style="margin-top:12px"></div>`;
  window.rClick=function(){
    if(state==='idle'){state='wait';document.getElementById('rMsg').textContent='Wait for green...';th=setTimeout(()=>{state='go';document.getElementById('rBox').style.background='var(--success)';document.getElementById('rMsg').textContent='TAP!';document.getElementById('rMsg').style.color='#fff';startTime=Date.now();},1000+Math.random()*3000);}
    else if(state==='wait'){clearTimeout(th);state='idle';document.getElementById('rBox').style.background='var(--danger)';document.getElementById('rMsg').textContent='Too early!';document.getElementById('rMsg').style.color='#fff';setTimeout(()=>{document.getElementById('rBox').style.background='var(--bg3)';document.getElementById('rMsg').textContent='Tap to Start';document.getElementById('rMsg').style.color='';},1000);}
    else if(state==='go'){const rt=Date.now()-startTime;trials.push(rt);state='idle';
      document.getElementById('rBox').style.background='var(--primary)';document.getElementById('rMsg').textContent=rt+'ms';document.getElementById('rMsg').style.color='#fff';
      document.getElementById('gs1').textContent=trials.length+'/5';
      if(trials.length>=5){const avg=Math.round(trials.reduce((a,b)=>a+b)/trials.length);document.getElementById('gs2').textContent=avg;
        document.getElementById('rRes').innerHTML=`<div class="card" style="text-align:center"><div style="font-size:22px;font-weight:800;color:var(--primary)">${avg}ms</div><div style="color:var(--text3)">${avg<200?'ðŸ† Elite':avg<300?'ðŸ¥‡ Excellent':avg<400?'âœ… Good':'ðŸ“ˆ Keep practicing'}</div></div>`;trials=[];
      }else{setTimeout(()=>{state='idle';document.getElementById('rBox').style.background='var(--bg3)';document.getElementById('rMsg').textContent='Tap for next trial';document.getElementById('rMsg').style.color='';},1200);}
    }
  };
}
function renderStroopGame(c){
  const CL={Red:'#ef4444',Blue:'#3b82f6',Green:'#10b981',Yellow:'#f59e0b',Purple:'#8b5cf6'};
  const cn=Object.keys(CL);let score=0,total=0,tl=60,timer;
  c.innerHTML=gameHeader('Stroop','ðŸŽ¨','Score','Time')+`<div style="text-align:center"><div style="font-size:13px;color:var(--text2);margin-bottom:12px">Tap the <strong>INK COLOR</strong> â€” ignore the word!</div><div id="stWord" style="font-size:52px;font-weight:800;font-family:Syne,sans-serif;margin-bottom:16px">RED</div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:300px;margin:0 auto" id="stBtns"></div></div>`;
  function next(){
    const w=cn[Math.floor(Math.random()*cn.length)],col=cn[Math.floor(Math.random()*cn.length)];
    document.getElementById('stWord').textContent=w;document.getElementById('stWord').style.color=CL[col];
    document.getElementById('stBtns').innerHTML=cn.sort(()=>Math.random()-.5).map(n=>`<button style="padding:10px;border-radius:10px;border:2px solid var(--border);background:${CL[n]};color:#fff;font-weight:700;cursor:pointer" onclick="stAns('${n}','${col}')">${n}</button>`).join('');
  }
  window.stAns=function(ans,correct){total++;if(ans===correct){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else showToast('âŒ '+correct);next();};
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);document.getElementById('stWord').textContent='Done! '+score+'/'+total;document.getElementById('stBtns').innerHTML='';}},1000);
  document.getElementById('gs2').textContent=tl;next();
}
function renderNBackGame(c){
  const pos=[0,1,2,3,4,5,6,7,8];let seq=[],idx=0,score=0,misses=0;
  c.innerHTML=gameHeader('2-Back','ðŸ”¢','Correct','Miss')+`<div style="text-align:center;font-size:12px;color:var(--text2);margin-bottom:10px">Press MATCH when position matches 2 steps back</div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:200px;margin:0 auto 16px">${pos.map(p=>`<div style="aspect-ratio:1;border-radius:8px;background:var(--bg3);border:2px solid var(--border);transition:all .3s" id="nb_${p}"></div>`).join('')}</div><div style="text-align:center"><button class="btn btn-primary" id="nbS" onclick="nbGo()">â–¶ Start</button><button class="btn btn-accent" id="nbM" onclick="nbMatch()" style="display:none;margin-left:8px">MATCH</button></div>`;
  window.nbGo=function(){seq=[];idx=0;score=0;misses=0;document.getElementById('nbS').style.display='none';document.getElementById('nbM').style.display='';
    function step(){if(idx>=20){document.getElementById('nbM').style.display='none';document.getElementById('nbS').style.display='';document.getElementById('nbS').textContent='ðŸ”„ Again';showToast('Score: '+score);return;}
      const p=pos[Math.floor(Math.random()*9)];seq.push(p);pos.forEach(p2=>document.getElementById('nb_'+p2).style.background='var(--bg3)');
      document.getElementById('nb_'+p).style.background='var(--primary)';setTimeout(()=>{document.getElementById('nb_'+p).style.background='var(--bg3)';idx++;setTimeout(step,800);},500);}
    step();};
  window.nbMatch=function(){if(seq.length>=2&&seq[seq.length-1]===seq[seq.length-3]){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else{misses++;document.getElementById('gs2').textContent=misses;showToast('âŒ');}};
}
function renderMathGame(c){
  let score=0,cur=0,a,b,op,ans,tl=90,timer;const ops=['+','-','Ã—'];
  c.innerHTML=gameHeader('Math Blitz','âž•','Score','Time')+`<div style="text-align:center"><div id="mathP" style="font-size:40px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary);margin-bottom:16px"></div><input type="number" id="mathI" class="form-input" placeholder="?" style="text-align:center;font-size:20px;max-width:160px;margin:0 auto 12px;display:block" onkeydown="if(event.key==='Enter')chkM()"><button class="btn btn-primary" onclick="chkM()">Submit</button></div>`;
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);showToast('Time! '+score);}},1000);
  function nxt(){op=ops[Math.floor(Math.random()*3)];a=Math.floor(Math.random()*20)+1;b=Math.floor(Math.random()*20)+1;ans=op==='+'?a+b:op==='-'?a-b:a*b;document.getElementById('mathP').textContent=`${a} ${op} ${b} = ?`;document.getElementById('mathI').value='';document.getElementById('mathI').focus();}
  window.chkM=function(){const v=parseInt(document.getElementById('mathI').value);cur++;if(v===ans){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else showToast('âŒ '+ans);nxt();};
  document.getElementById('gs2').textContent=tl;nxt();
}
function renderWordGame(c){
  let score=0,tl=60,timer,chain=[],last='';
  c.innerHTML=gameHeader('Word Chain','ðŸ’¬','Words','Time')+`<div style="text-align:center"><div style="font-size:13px;color:var(--text2);margin-bottom:8px">Each word must START with the LAST LETTER of the previous</div><div id="wLast" style="font-size:32px;font-weight:800;color:var(--primary);margin-bottom:10px">Any word to start</div><div style="display:flex;gap:8px"><input type="text" id="wI" class="form-input" placeholder="Type a word..." onkeydown="if(event.key==='Enter')chkW()"><button class="btn btn-primary" onclick="chkW()">Go</button></div><div id="wChain" style="margin-top:8px;font-size:12px;color:var(--text2);max-height:80px;overflow-y:auto"></div></div>`;
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);showToast('Time! '+score+' words!');}},1000);document.getElementById('gs2').textContent=tl;
  window.chkW=function(){const w=document.getElementById('wI').value.trim().toLowerCase();if(!w)return;if(last&&w[0]!==last){showToast('Must start with '+last.toUpperCase());return;}if(chain.includes(w)){showToast('Already used!');return;}chain.push(w);last=w[w.length-1];score++;document.getElementById('gs1').textContent=score;document.getElementById('wLast').textContent='Next: '+last.toUpperCase();document.getElementById('wChain').textContent=chain.join(' â†’ ');document.getElementById('wI').value='';document.getElementById('wI').focus();};
}
function renderColorGame(c){
  const CL=['#ef4444','#3b82f6','#10b981','#f59e0b','#8b5cf6'];let seq=[],usr=[],lv=1,canClick=false;
  c.innerHTML=gameHeader('Color Sequence','ðŸŒˆ','Level','â€”')+`<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:220px;margin:0 auto 14px">${CL.map((cl,i)=>`<div id="cb_${i}" onclick="ccl(${i})" style="aspect-ratio:1;border-radius:12px;background:${cl};cursor:pointer;border:3px solid transparent;transition:all .2s"></div>`).join('')}</div><div style="text-align:center"><button class="btn btn-primary" id="cgS" onclick="cgStart()">â–¶ Start</button></div><div id="cgM" style="text-align:center;margin-top:8px;font-size:13px;color:var(--text2)"></div>`;
  function flash(i){return new Promise(r=>{document.getElementById('cb_'+i).style.opacity='0.3';setTimeout(()=>{document.getElementById('cb_'+i).style.opacity='1';r();},350);});}
  async function play(){canClick=false;document.getElementById('cgM').textContent='Watch...';for(const i of seq){await flash(i);await new Promise(r=>setTimeout(r,200));}canClick=true;usr=[];document.getElementById('cgM').textContent='Your turn!';}
  window.cgStart=function(){seq=[];lv=1;document.getElementById('cgS').style.display='none';add();};
  function add(){seq.push(Math.floor(Math.random()*CL.length));document.getElementById('gs1').textContent=lv;play();}
  window.ccl=function(i){if(!canClick)return;flash(i);usr.push(i);const p=usr.length-1;if(usr[p]!==seq[p]){canClick=false;document.getElementById('cgM').textContent='âŒ Game Over! Level '+lv;document.getElementById('gs2').textContent=lv;document.getElementById('cgS').style.display='';lv=1;seq=[];return;}if(usr.length===seq.length){canClick=false;lv++;setTimeout(add,600);}};
}
function renderSudokuGame(c){
  const p=[[5,3,0,0,7,0,0,0,0],[6,0,0,1,9,5,0,0,0],[0,9,8,0,0,0,0,6,0],[8,0,0,0,6,0,0,0,3],[4,0,0,8,0,3,0,0,1],[7,0,0,0,2,0,0,0,6],[0,6,0,0,0,0,2,8,0],[0,0,0,4,1,9,0,0,5],[0,0,0,0,8,0,0,7,9]];
  let sel=null,errors=0;
  c.innerHTML=gameHeader('Sudoku','ðŸ§©','Errors','â€”')+`<div id="sgrid" style="display:grid;grid-template-columns:repeat(9,1fr);gap:1px;background:var(--border);border:2px solid var(--primary);border-radius:8px;overflow:hidden;max-width:340px;margin:0 auto 10px"></div><div style="display:grid;grid-template-columns:repeat(9,1fr);gap:4px;max-width:340px;margin:0 auto 10px">${[1,2,3,4,5,6,7,8,9].map(n=>`<div class="sudoku-num" onclick="snI(${n})">${n}</div>`).join('')}</div><button class="btn btn-secondary btn-sm" onclick="launchGame('sudoku')">ðŸ”„ New</button>`;
  const grid=document.getElementById('sgrid');
  for(let r=0;r<9;r++)for(let cl2=0;cl2<9;cl2++){
    const d=document.createElement('div');d.className='sudoku-cell';d.dataset.r=r;d.dataset.c=cl2;
    if(p[r][cl2]){d.textContent=p[r][cl2];d.classList.add('given');}
    d.onclick=function(){document.querySelectorAll('.sudoku-cell').forEach(x=>x.classList.remove('selected'));if(!d.classList.contains('given')){sel=d;d.classList.add('selected');}};
    grid.appendChild(d);
  }
  window.snI=function(n){if(!sel||sel.classList.contains('given'))return;sel.textContent=n;};
}
function renderPatternGame(c){
  let score=0,tl=60,timer;const shapes=['â—','â– ','â–²','â˜…','â—†'];
  c.innerHTML=gameHeader('Pattern Recognition','ðŸ‘ï¸','Score','Time')+`<div style="text-align:center;font-size:13px;color:var(--text2);margin-bottom:10px">Which one is DIFFERENT?</div><div id="pArea" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:300px;margin:0 auto 10px"></div><div id="pFb" style="text-align:center;min-height:24px;font-size:14px;font-weight:700"></div>`;
  function nxt(){
    const sh=shapes[Math.floor(Math.random()*shapes.length)];const odd=shapes.filter(s=>s!==sh)[Math.floor(Math.random()*4)];
    const items=Array(5).fill(sh);const oi=Math.floor(Math.random()*6);items.splice(oi,0,odd);
    const clr=['#7c3aed','#06b6d4','#ec4899','#10b981','#f59e0b'][Math.floor(Math.random()*5)];
    document.getElementById('pArea').innerHTML=items.slice(0,6).map((s,i)=>`<div onclick="pAns(${i},${oi})" style="aspect-ratio:1;background:var(--bg3);border:2px solid var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:32px;cursor:pointer;color:${i===oi?'#ef4444':clr}">${s}</div>`).join('');
  }
  window.pAns=function(i,oi){const fb=document.getElementById('pFb');if(i===oi){score++;document.getElementById('gs1').textContent=score;fb.textContent='âœ… Correct!';fb.style.color='var(--success)';}else{fb.textContent='âŒ Wrong!';fb.style.color='var(--danger)';}setTimeout(nxt,600);};
  timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl;if(tl<=0){clearInterval(timer);showToast('Time! Score: '+score);}},1000);document.getElementById('gs2').textContent=tl;nxt();
}
function renderTypingGame(c){
  const txts=['The quick brown fox jumps over the lazy dog near the river.','Consciousness is the greatest mystery in the universe.','Every morning is a new beginning. What we do today matters.'];
  let txt=txts[Math.floor(Math.random()*txts.length)],pos=0,errs=0,started=false,tl=60,timer;
  c.innerHTML=gameHeader('Speed Typing','âŒ¨ï¸','WPM','Accuracy')+`<div id="typD" style="padding:12px;background:var(--bg3);border-radius:10px;font-size:15px;line-height:2;margin-bottom:10px"></div><input type="text" id="typI" class="form-input" placeholder="Start typing..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="font-size:16px">`;
  function render(){document.getElementById('typD').innerHTML=txt.split('').map((ch,i)=>i<pos?`<span style="color:var(--success)">${ch}</span>`:i===pos?`<span style="background:var(--primary);color:#fff;border-radius:2px">${ch}</span>`:`<span>${ch}</span>`).join('');}
  render();
  document.getElementById('typI').addEventListener('input',function(){
    if(!started){started=true;timer=setInterval(()=>{tl--;document.getElementById('gs2').textContent=tl+('%');const wpm=Math.round((pos/5)*(60/Math.max(1,60-tl)));document.getElementById('gs1').textContent=wpm;if(tl<=0){clearInterval(timer);this.disabled=true;}},1000);}
    const v=this.value;if(v.length>0&&v[v.length-1]===txt[pos]){pos++;}else if(v.length>0)errs++;
    const acc=pos>0?Math.round((1-errs/Math.max(1,pos+errs))*100):100;document.getElementById('gs2').textContent=acc+'%';this.value='';render();
    if(pos>=txt.length){clearInterval(timer);showToast('ðŸŽ‰ Complete!');}
  });
}
function renderSpatialGame(c){
  let score=0,cur=0;
  c.innerHTML=gameHeader('Spatial Rotation','ðŸ”„','Score','Round')+`<div style="text-align:center"><div style="font-size:13px;color:var(--text2);margin-bottom:10px">Which option matches the SAME shape, just rotated?</div><div id="spB" style="font-size:80px;color:var(--primary);margin-bottom:14px;font-family:monospace"></div><div id="spO" style="display:flex;justify-content:center;gap:16px;font-size:50px;font-family:monospace"></div></div>`;
  const q=[{base:'L',opts:['L','Î“','âŒ','J'],correct:0},{base:'T',opts:['T','âŠ¢','âŠ¥','âŠ£'],correct:1},{base:'F',opts:['F','âŠ¢','âŠ£','â„²'],correct:3},{base:'Z',opts:['Z','S','N','Z'],correct:3}];
  function nxt(){if(cur>=10){showToast('Done! '+score+'/10');return;}const qst=q[cur%q.length];
    document.getElementById('gs2').textContent=(cur+1)+'/10';
    document.getElementById('spB').textContent=qst.base;
    document.getElementById('spO').innerHTML=qst.opts.map((r,i)=>`<span style="cursor:pointer;padding:8px;border-radius:8px;border:2px solid var(--border)" onclick="spAns(${i},${qst.correct})">${r}</span>`).join('');
  }
  window.spAns=function(i,correct){cur++;if(i===correct){score++;document.getElementById('gs1').textContent=score;showToast('âœ…');}else showToast('âŒ');setTimeout(nxt,500);};
  nxt();
}
// â”€â”€â”€ CHESS GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderChessGame(c){
  const PIECES={K:'â™”',Q:'â™•',R:'â™–',B:'â™—',N:'â™˜',P:'â™™',k:'â™š',q:'â™›',r:'â™œ',b:'â™',n:'â™ž',p:'â™Ÿ'};
  let board=[['r','n','b','q','k','b','n','r'],['p','p','p','p','p','p','p','p'],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],['P','P','P','P','P','P','P','P'],['R','N','B','Q','K','B','N','R']];
  let sel=null,turn='white',moveCount=0;
  c.innerHTML=gameHeader('Chess','â™Ÿï¸','Moves','Turn')+`<div id="chessBoard" style="display:grid;grid-template-columns:repeat(8,1fr);max-width:320px;margin:0 auto 10px;border:3px solid var(--primary);border-radius:4px;overflow:hidden"></div><div style="text-align:center;font-size:13px;color:var(--text2);margin-top:8px" id="chessTip">White's turn. Tap a piece to select, then tap destination.</div>`;
  document.getElementById('gs2').textContent='White';
  function draw(){
    const bd=document.getElementById('chessBoard');bd.innerHTML='';
    for(let r=0;r<8;r++)for(let cl2=0;cl2<8;cl2++){
      const sq=document.createElement('div');const light=(r+cl2)%2===0;
      sq.style.cssText=`aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;background:${sel&&sel[0]===r&&sel[1]===cl2?'rgba(124,58,237,.5)':light?'#f0d9b5':'#b58863'};user-select:none`;
      const piece=board[r][cl2];if(piece)sq.textContent=PIECES[piece]||piece;
      sq.onclick=()=>clickSq(r,cl2);bd.appendChild(sq);
    }
  }
  function isWhite(p){return p&&p===p.toUpperCase();}
  function clickSq(r,cl2){
    const piece=board[r][cl2];
    if(sel){
      const[sr,sc]=sel;
      if(sr===r&&sc===cl2){sel=null;draw();return;}
      const sp=board[sr][sc];
      if(piece&&isWhite(piece)===isWhite(sp)){sel=[r,cl2];draw();return;}
      board[r][cl2]=sp;board[sr][sc]=null;
      if(sp==='P'&&r===0)board[r][cl2]='Q';
      if(sp==='p'&&r===7)board[r][cl2]='q';
      sel=null;moveCount++;turn=turn==='white'?'black':'white';
      document.getElementById('gs1').textContent=moveCount;document.getElementById('gs2').textContent=turn==='white'?'White':'Black';
      document.getElementById('chessTip').textContent=(turn==='white'?'White':'Black')+"'s turn";
      draw();
      if(turn==='black')setTimeout(aiChessMove,600);
    }else{
      if(piece&&(turn==='white'?isWhite(piece):!isWhite(piece))){sel=[r,cl2];draw();}
    }
  }
  function aiChessMove(){
    const moves=[];
    for(let r=0;r<8;r++)for(let c2=0;c2<8;c2++){
      const p=board[r][c2];if(!p||isWhite(p))continue;
      const targets=[[r+1,c2],[r+2,c2],[r+1,c2-1],[r+1,c2+1],[r-1,c2],[r,c2+1],[r,c2-1]];
      targets.forEach(([tr,tc])=>{if(tr>=0&&tr<8&&tc>=0&&tc<8){const t=board[tr][tc];if(!t||isWhite(t))moves.push({fr:r,fc:c2,tr,tc,val:t?10:1});}});
    }
    if(!moves.length)return;
    moves.sort((a,b)=>b.val-a.val);
    const mv=moves[0];board[mv.tr][mv.tc]=board[mv.fr][mv.fc];board[mv.fr][mv.fc]=null;
    moveCount++;turn='white';document.getElementById('gs1').textContent=moveCount;document.getElementById('gs2').textContent='White';
    document.getElementById('chessTip').textContent="White's turn";draw();
  }
  draw();
}
// â”€â”€â”€ MONOPOLY (SIMPLIFIED) GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMonopolyGame(c){
  const PROPS=[{name:'Mediterranean',color:'#a52a2a',price:60},{name:'Baltic',color:'#a52a2a',price:60},{name:'Oriental',color:'#aad',price:100},{name:'Vermont',color:'#aad',price:100},{name:'Connecticut',color:'#aad',price:120},{name:'St. Charles',color:'#ff69b4',price:140},{name:'States',color:'#ff69b4',price:140},{name:'Virginia',color:'#ff69b4',price:160},{name:'St. James',color:'#f90',price:180},{name:'Tennessee',color:'#f90',price:180},{name:'New York',color:'#f90',price:200},{name:'Kentucky',color:'#f00',price:220},{name:'Indiana',color:'#f00',price:220},{name:'Illinois',color:'#f00',price:240},{name:'Atlantic',color:'#f5c',price:260},{name:'Ventnor',color:'#f5c',price:260},{name:'Marvin Gdns',color:'#f5c',price:280},{name:'Pacific',color:'#3a3',price:300},{name:'N Carolina',color:'#3a3',price:300},{name:'Pennsylvania',color:'#3a3',price:320},{name:'Park Place',color:'#00f',price:350},{name:'Boardwalk',color:'#00f',price:400}];
  let cash=1500,pos=0,owned=[],myTurn=true,cpuPos=0,cpuCash=1500,cpuOwned=[];
  c.innerHTML=gameHeader('Monopoly','ðŸ ','Your $','CPU $')+`<div style="background:var(--bg3);border-radius:12px;padding:14px;margin-bottom:10px"><div style="font-size:13px;color:var(--text2);margin-bottom:10px">ðŸŽ² Property trading â€” buy properties, collect rent!</div><div id="mBoard" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px"></div><div style="display:flex;gap:10px;align-items:center;margin-bottom:10px"><button class="btn btn-primary btn-sm" onclick="mRoll()" id="mRollBtn">ðŸŽ² Roll Dice</button><span id="mDiceResult" style="font-size:20px"></span></div><div id="mLog" style="font-size:12px;color:var(--text2);background:var(--bg2);border-radius:8px;padding:8px;max-height:120px;overflow-y:auto"></div></div>`;
  document.getElementById('gs1').textContent='$'+cash;document.getElementById('gs2').textContent='$'+cpuCash;
  function drawBoard(){
    document.getElementById('mBoard').innerHTML=PROPS.map((p,i)=>`<div title="${p.name}: $${p.price}" style="width:36px;height:36px;border-radius:6px;border:2px solid ${owned.includes(i)?'gold':cpuOwned.includes(i)?'#f00':'var(--border)'};background:${p.color+'33'};display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:8px;color:var(--text);cursor:default;position:relative"><div style="font-size:14px">${pos===i?'ðŸ§':cpuPos===i?'ðŸ¤–':''}</div></div>`).join('');
  }
  function log(msg){const el=document.getElementById('mLog');el.innerHTML=`<div style="border-bottom:1px solid var(--border);padding-bottom:4px;margin-bottom:4px">${msg}</div>`+el.innerHTML;}
  window.mRoll=function(){if(!myTurn)return;document.getElementById('mRollBtn').disabled=true;
    const d1=Math.ceil(Math.random()*6),d2=Math.ceil(Math.random()*6),roll=d1+d2;
    document.getElementById('mDiceResult').textContent=`ðŸŽ²${d1} + ðŸŽ²${d2} = ${roll}`;
    pos=(pos+roll)%PROPS.length;
    if(pos===0&&pos!==0){cash+=200;log('Passed GO! Collected $200');}
    const prop=PROPS[pos];
    if(cpuOwned.includes(pos)){const rent=Math.floor(prop.price*0.1);cash-=rent;cpuCash+=rent;log(`âš ï¸ Landed on CPU's ${prop.name}. Paid $${rent} rent.`);}
    else if(!owned.includes(pos)&&cash>=prop.price){
      if(confirm(`Buy ${prop.name} for $${prop.price}?`)){owned.push(pos);cash-=prop.price;log(`âœ… Bought ${prop.name} ($${prop.price})`);}}
    else if(owned.includes(pos))log(`ðŸ  Your property: ${prop.name}`);
    else log(`Landed on ${prop.name} (unowned)`);
    document.getElementById('gs1').textContent='$'+cash;
    drawBoard();myTurn=false;setTimeout(cpuMove,1200);
  };
  function cpuMove(){const roll=Math.ceil(Math.random()*6)+Math.ceil(Math.random()*6);cpuPos=(cpuPos+roll)%PROPS.length;const prop=PROPS[cpuPos];
    if(owned.includes(cpuPos)){const rent=Math.floor(prop.price*0.1);cpuCash-=rent;cash+=rent;log(`CPU on your ${prop.name} â€” you earned $${rent}!`);}
    else if(!cpuOwned.includes(cpuPos)&&cpuCash>=prop.price&&Math.random()>.4){cpuOwned.push(cpuPos);cpuCash-=prop.price;log(`CPU bought ${prop.name}`);}
    document.getElementById('gs2').textContent='$'+cpuCash;drawBoard();myTurn=true;document.getElementById('mRollBtn').disabled=false;
    if(cash<=0)showToast('ðŸ’” You went bankrupt!');if(cpuCash<=0)showToast('ðŸ† CPU bankrupt! You win!');
  }
  drawBoard();log('Game started! You have $1500. Roll to begin.');
}
// â”€â”€â”€ GO (SIMPLIFIED) GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderGoGame(c){
  const SZ=9;let board=Array(SZ).fill(null).map(()=>Array(SZ).fill(0));let turn=1,captures=[0,0],passCount=0;
  c.innerHTML=gameHeader('Go (9Ã—9)','âš«','Black cap','White cap')+`<canvas id="goCanvas" width="280" height="280" style="border:2px solid var(--primary);border-radius:8px;display:block;margin:0 auto 10px;cursor:pointer"></canvas><div style="display:flex;gap:8px;justify-content:center"><button class="btn btn-secondary btn-sm" onclick="goPass()">Pass</button><button class="btn btn-danger btn-sm" onclick="launchGame('go')">New</button></div><div id="goMsg" style="text-align:center;font-size:13px;color:var(--text2);margin-top:8px">Black's turn. Tap intersections to place stones.</div>`;
  const cv=document.getElementById('goCanvas');const ctx=cv.getContext('2d');const cell=280/(SZ+1);
  function draw(){ctx.clearRect(0,0,280,280);ctx.fillStyle='#dcb483';ctx.fillRect(0,0,280,280);
    for(let i=0;i<SZ;i++){ctx.beginPath();ctx.moveTo(cell+i*cell,cell);ctx.lineTo(cell+i*cell,cell*(SZ));ctx.strokeStyle='#333';ctx.lineWidth=1;ctx.stroke();ctx.beginPath();ctx.moveTo(cell,cell+i*cell);ctx.lineTo(cell*SZ,cell+i*cell);ctx.stroke();}
    for(let r=0;r<SZ;r++)for(let cl2=0;cl2<SZ;cl2++){if(!board[r][cl2])continue;ctx.beginPath();ctx.arc(cell+cl2*cell,cell+r*cell,cell*0.42,0,Math.PI*2);ctx.fillStyle=board[r][cl2]===1?'#111':'#fff';ctx.fill();ctx.strokeStyle='#555';ctx.lineWidth=1;ctx.stroke();}
  }
  cv.onclick=function(e){const rect=cv.getBoundingClientRect();const x=e.clientX-rect.left,y=e.clientY-rect.top;
    const col=Math.round((x-cell)/cell),row=Math.round((y-cell)/cell);
    if(row<0||row>=SZ||col<0||col>=SZ||board[row][col])return;
    board[row][col]=turn;draw();document.getElementById('goMsg').textContent=(turn===1?'White':'Black')+"'s turn";
    turn=turn===1?2:1;passCount=0;
  };
  window.goPass=function(){passCount++;if(passCount>=2)showToast('Game over!');else{turn=turn===1?2:1;document.getElementById('goMsg').textContent='Passed. '+(turn===1?'Black':'White')+"'s turn";}};
  draw();
}
// â”€â”€â”€ CHECKERS GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCheckersGame(c){
  let board=[];for(let r=0;r<8;r++){board[r]=[];for(let c2=0;c2<8;c2++){if((r+c2)%2===1&&r<3)board[r][c2]='b';else if((r+c2)%2===1&&r>4)board[r][c2]='w';else board[r][c2]=null;}}
  let sel=null,turn='w',moveCount=0;
  c.innerHTML=gameHeader('Checkers','ðŸ”´','Moves','Turn')+`<div id="ckBoard" style="display:grid;grid-template-columns:repeat(8,1fr);max-width:280px;margin:0 auto 10px;border:3px solid var(--primary);border-radius:4px;overflow:hidden"></div><div id="ckMsg" style="text-align:center;font-size:13px;color:var(--text2)">Your turn (âšª White). Tap a piece then tap destination.</div>`;
  document.getElementById('gs2').textContent='White';
  function draw(){const bd=document.getElementById('ckBoard');bd.innerHTML='';
    for(let r=0;r<8;r++)for(let c2=0;c2<8;c2++){const sq=document.createElement('div');const dark=(r+c2)%2===1;
      sq.style.cssText=`aspect-ratio:1;display:flex;align-items:center;justify-content:center;cursor:pointer;background:${sel&&sel[0]===r&&sel[1]===c2?'rgba(124,58,237,.4)':dark?'#555':'#e8e8e8'};font-size:20px`;
      const p=board[r][c2];if(p==='w')sq.textContent='âšª';else if(p==='W')sq.textContent='ðŸ‘‘';else if(p==='b')sq.textContent='ðŸ”´';else if(p==='B')sq.textContent='ðŸ‘‘';
      if(dark){sq.onclick=()=>ckClick(r,c2);}bd.appendChild(sq);}}
  function ckClick(r,c2){
    if(sel){const[sr,sc]=sel;const dr=r-sr,dc=c2-sc;
      if((board[sr][sc]==='w'&&dr===-1||board[sr][sc]==='W'&&Math.abs(dr)===1)&&Math.abs(dc)===1&&!board[r][c2]){board[r][c2]=board[sr][sc];board[sr][sc]=null;if(r===0&&board[r][c2]==='w')board[r][c2]='W';sel=null;moveCount++;turn='b';document.getElementById('gs1').textContent=moveCount;document.getElementById('gs2').textContent='Black';document.getElementById('ckMsg').textContent="CPU's turn...";draw();setTimeout(cpuMove,700);}
      else sel=null;}
    else if(board[r][c2]==='w'||board[r][c2]==='W')sel=[r,c2];
    draw();}
  function cpuMove(){const moves=[];
    for(let r=0;r<8;r++)for(let c2=0;c2<8;c2++){if(board[r][c2]==='b'||board[r][c2]==='B'){[[1,-1],[1,1]].forEach(([dr,dc])=>{if(board[r+dr]&&board[r+dr][c2+dc]===null)moves.push({r,c2,nr:r+dr,nc:c2+dc});});}}
    if(moves.length){const mv=moves[Math.floor(Math.random()*moves.length)];board[mv.nr][mv.nc]=board[mv.r][mv.c2];board[mv.r][mv.c2]=null;if(mv.nr===7&&board[mv.nr][mv.nc]==='b')board[mv.nr][mv.nc]='B';}
    turn='w';document.getElementById('gs2').textContent='White';document.getElementById('ckMsg').textContent='Your turn (âšª White)';draw();}
  draw();
}
// â”€â”€â”€ BATTLESHIP GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderBattleshipGame(c){
  const SZ=8;function mkGrid(){return Array(SZ).fill(null).map(()=>Array(SZ).fill(0));}
  let pGrid=mkGrid(),eGrid=mkGrid(),eShips=mkGrid();let hits=0,misses=0,sunk=0;
  function placeShips(g){const ships=[4,3,3,2,2];ships.forEach(len=>{let placed=false;while(!placed){const vert=Math.random()>.5;const r=Math.floor(Math.random()*(SZ-(vert?len:0)));const c2=Math.floor(Math.random()*(SZ-(vert?0:len)));let ok=true;for(let i=0;i<len;i++){const ri=r+(vert?i:0),ci=c2+(vert?0:i);if(g[ri][ci])ok=false;}if(ok)for(let i=0;i<len;i++){const ri=r+(vert?i:0),ci=c2+(vert?0:i);g[ri][ci]=1;}placed=ok;}});}
  placeShips(eShips);
  c.innerHTML=gameHeader('Battleship','ðŸš¢','Hits','Misses')+`<div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap"><div><div style="text-align:center;font-size:11px;font-weight:700;color:var(--text2);margin-bottom:4px">ENEMY WATERS (tap to fire)</div><div id="bsEnemy" style="display:grid;grid-template-columns:repeat(${SZ},1fr);gap:2px;max-width:220px;margin:0 auto"></div></div></div><div id="bsMsg" style="text-align:center;margin-top:10px;font-size:13px;color:var(--text2)">Tap enemy grid to fire!</div>`;
  function drawEnemy(){const g=document.getElementById('bsEnemy');g.innerHTML='';
    for(let r=0;r<SZ;r++)for(let c2=0;c2<SZ;c2++){const sq=document.createElement('div');
      sq.style.cssText=`aspect-ratio:1;border-radius:3px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;background:${eGrid[r][c2]===2?'var(--danger)':eGrid[r][c2]===3?'var(--bg3)':'#1a5276'}`;
      if(eGrid[r][c2]===2)sq.textContent='ðŸ’¥';else if(eGrid[r][c2]===3)sq.textContent='ðŸ’§';
      if(!eGrid[r][c2])sq.onclick=()=>fire(r,c2);g.appendChild(sq);}
  }
  function fire(r,c2){if(eGrid[r][c2])return;
    if(eShips[r][c2]){eGrid[r][c2]=2;hits++;document.getElementById('gs1').textContent=hits;document.getElementById('bsMsg').textContent='ðŸ’¥ HIT!';showToast('ðŸ’¥ Direct hit!');}
    else{eGrid[r][c2]=3;misses++;document.getElementById('gs2').textContent=misses;document.getElementById('bsMsg').textContent='ðŸ’§ Miss!';}
    drawEnemy();if(hits>=14)showToast('ðŸ† All ships sunk! You win!');}
  drawEnemy();
}
function renderBreathingGame(c){
  let phase=0,phTime=0,timer,cycles=0,running=false;
  const phases=[{name:'Inhale',dur:4,color:'var(--accent)'},{name:'Hold',dur:7,color:'var(--primary)'},{name:'Exhale',dur:8,color:'var(--success)'}];
  c.innerHTML=gameHeader('4-7-8 Breathing','ðŸ«','Cycles','Phase')+`<div style="text-align:center"><div id="bCirc" style="width:160px;height:160px;border-radius:50%;border:4px solid var(--primary);margin:0 auto 20px;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:all 1s"><div id="bPhase" style="font-size:18px;font-weight:800;color:var(--primary)">Ready?</div><div id="bCnt" style="font-size:28px;font-weight:800;color:var(--primary)"></div></div><button class="btn btn-primary" id="bBtn" onclick="bStart()">â–¶ Begin</button></div>`;
  window.bStart=function(){document.getElementById('bBtn').style.display='none';phase=0;cycles=0;run();};
  function run(){const p=phases[phase];phTime=p.dur;const circ=document.getElementById('bCirc');circ.style.borderColor=p.color;circ.style.background=p.color+'20';
    document.getElementById('bPhase').textContent=p.name;document.getElementById('bPhase').style.color=p.color;document.getElementById('gs2').textContent=p.name;
    if(phase===0)setTimeout(()=>circ.style.transform='scale(1.4)',50);else if(phase===2)circ.style.transform='scale(0.9)';else circ.style.transform='scale(1.2)';
    clearInterval(timer);timer=setInterval(()=>{phTime--;document.getElementById('bCnt').textContent=phTime;
      if(phTime<=0){clearInterval(timer);phase=(phase+1)%3;if(phase===0){cycles++;document.getElementById('gs1').textContent=cycles;if(cycles>=4){document.getElementById('bPhase').textContent='Complete ðŸ™';document.getElementById('bCnt').textContent='';document.getElementById('bBtn').style.display='';document.getElementById('bBtn').textContent='ðŸ”„ Again';return;}}run();}
    },1000);document.getElementById('bCnt').textContent=phTime;
  }
}

// â”€â”€â”€ LUCID DREAMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TECHNIQUES=[
  {name:'WILD â€” Wake Induced Lucid Dream',col:'#7c3aed',body:'<strong>Simple words:</strong> Fall asleep while staying conscious.<br><br><strong>Steps:</strong><br>1. Set alarm 5-6 hours after sleep<br>2. Stay still after waking â€” don\'t move body<br>3. Keep mind awake while body relaxes<br>4. Sleep paralysis will come (tingling, heavy) â€” stay calm!<br>5. Visualize entering a dream while still aware<br><br><strong>Difficulty:</strong> Hard â­â­â­â­'},
  {name:'MILD â€” Mnemonic Induction',col:'#06b6d4',body:'<strong>Simple words:</strong> Set a strong intention before sleep.<br><br><strong>Steps:</strong><br>1. As you fall asleep, repeat: "Tonight I will know I\'m dreaming"<br>2. Vividly picture yourself realizing you\'re in a dream<br>3. Feel the emotion of becoming lucid â€” joy, wonder<br>4. Repeat until you drift off<br><br><strong>Difficulty:</strong> Moderate â­â­â­'},
  {name:'DILD â€” Dream Initiated',col:'#ec4899',body:'<strong>Simple words:</strong> Realize you\'re dreaming while already inside a dream.<br><br><strong>Steps:</strong><br>1. Do reality checks all day (10+ times)<br>2. Genuinely ask: "Am I dreaming right now?"<br>3. This habit transfers to your dreams automatically<br>4. Something weird happens in dream â†’ you do a check â†’ "I\'m dreaming!"<br><br><strong>Difficulty:</strong> Easy â­â­ | Best for beginners'},
  {name:'WBTB â€” Wake Back To Bed',col:'#10b981',body:'<strong>Simple words:</strong> Interrupt sleep at the right time to boost REM.<br><br><strong>Steps:</strong><br>1. Sleep normally for 5-6 hours<br>2. Wake up and stay awake 20-60 minutes (read about lucid dreaming)<br>3. Go back to sleep with intention to lucid dream<br>4. Brain enters REM quickly â†’ 70% more likely to become lucid!<br><br><strong>Difficulty:</strong> Easy-Moderate â­â­'},
  {name:'Reality Testing â€” Daily Practice',col:'#f59e0b',body:'<strong>Simple words:</strong> Train your brain to question reality constantly.<br><br><strong>Checks (do 10-15x per day):</strong><br>â€¢ <strong>Hand check:</strong> Look at hands â€” fingers often weird in dreams<br>â€¢ <strong>Nose pinch:</strong> Pinch and try breathing â€” still works in dreams!<br>â€¢ <strong>Read text:</strong> Read, look away, read again â€” changes in dreams<br>â€¢ <strong>Clock check:</strong> Time jumps weirdly in dreams<br><br><strong>KEY:</strong> Genuinely ask "Could I be dreaming right now?" every time!'},
];
const RC_ITEMS=[{name:'Hand Check',icon:'ðŸ–ï¸',desc:'Look at your hands'},{name:'Nose Pinch',icon:'ðŸ‘ƒ',desc:'Pinch & try breathing'},{name:'Read Text',icon:'ðŸ“–',desc:'Read, look away, reread'},{name:'Clock Check',icon:'ðŸ•',desc:'Check time twice'},{name:'Light Switch',icon:'ðŸ’¡',desc:'Try light switches'},{name:'Try to Float',icon:'ðŸ•Šï¸',desc:'Jump & stay floating'}];
let selDreamType='regular';
function setDreamType(btn,type){document.querySelectorAll('.dream-type-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');selDreamType=type;document.getElementById('dreamType').value=type;}
function buildTechniques(){
  const ct=document.getElementById('techniquesContainer');if(!ct)return;
  ct.innerHTML=TECHNIQUES.map((t,i)=>`<div class="technique-card" id="tc_${i}" onclick="togTech(${i})"><div class="tc-header"><div class="tc-title" style="color:${t.col}">${t.name}</div><span class="tc-chevron">â–¼</span></div><div class="tc-body">${t.body}</div></div>`).join('');
}
function togTech(i){document.getElementById('tc_'+i).classList.toggle('open');}
function buildRCGrid(){
  const g=document.getElementById('rcGrid');if(!g)return;
  const done=JSON.parse(localStorage.getItem('cos_rc_done')||'[]');
  g.innerHTML=RC_ITEMS.map((r,i)=>`<div class="rc-btn${done.includes(i)?' done':''}" id="rcBtn_${i}" onclick="doRC(${i})"><span class="rc-icon">${r.icon}</span><div class="rc-name">${r.name}</div><div style="font-size:10px;color:var(--text3);margin-top:2px">${r.desc}</div></div>`).join('');
}
function doRC(i){
  const today=new Date().toDateString();
  if(localStorage.getItem('cos_rc_day')!==today){localStorage.setItem('cos_rc_day',today);localStorage.setItem('cos_rc_count','0');localStorage.setItem('cos_rc_done','[]');}
  const count=parseInt(localStorage.getItem('cos_rc_count')||0)+1;
  const done=JSON.parse(localStorage.getItem('cos_rc_done')||'[]');if(!done.includes(i))done.push(i);
  localStorage.setItem('cos_rc_count',count);localStorage.setItem('cos_rc_done',JSON.stringify(done));
  document.getElementById('rcCount').textContent=count;document.getElementById('rcProgress').style.width=Math.min(100,count/15*100)+'%';
  document.getElementById('rcBtn_'+i).classList.add('done');showToast('Reality check! Total: '+count);
}
function resetRC(){localStorage.setItem('cos_rc_count','0');localStorage.setItem('cos_rc_done','[]');buildRCGrid();if(document.getElementById('rcCount'))document.getElementById('rcCount').textContent=0;if(document.getElementById('rcProgress'))document.getElementById('rcProgress').style.width='0%';}
function calcWBTB(){
  const sl=document.getElementById('wbtbSleep').value,wk=document.getElementById('wbtbWake').value;
  if(!sl||!wk){showToast('Enter times first');return;}
  const sm=sl.split(':').map(Number),wm=wk.split(':').map(Number);
  let dur=(wm[0]*60+wm[1])-(sm[0]*60+sm[1]);if(dur<0)dur+=1440;
  const fmt=m=>`${Math.floor(m/60).toString().padStart(2,'0')}:${(m%60).toString().padStart(2,'0')}`;
  const t1=(sm[0]*60+sm[1]+300)%1440,t2=(sm[0]*60+sm[1]+360)%1440;
  document.getElementById('wbtbResult').innerHTML=`<div style="background:var(--bg3);border-radius:10px;padding:12px;font-size:13px"><div style="margin-bottom:6px">Sleep: <strong>${Math.floor(dur/60)}h ${dur%60}m</strong> (${Math.floor(dur/90)} cycles)</div><div style="margin-bottom:4px">â° Option 1: <strong style="color:var(--primary)">${fmt(t1)}</strong> (5h mark)</div><div style="margin-bottom:8px">â° Option 2: <strong style="color:var(--primary)">${fmt(t2)}</strong> (6h mark)</div><div style="color:var(--text3);font-size:11px">Wake at one of these times, stay up 20-60 min, then return to sleep for maximum lucid potential.</div></div>`;
}
function getDreams(){return JSON.parse(localStorage.getItem('cos_dreams')||'[]');}
function saveDream(){
  const entry={id:Date.now(),date:document.getElementById('dreamDate')?.value||new Date().toISOString().split('T')[0],title:document.getElementById('dreamTitle')?.value||'Untitled',type:selDreamType,desc:document.getElementById('dreamDesc')?.value,vividness:parseInt(document.getElementById('dreamVividness')?.value||5),lucidity:parseInt(document.getElementById('dreamLucidity')?.value||0),signs:document.getElementById('dreamSigns')?.value,emotions:document.getElementById('dreamEmotions')?.value};
  const dreams=getDreams();dreams.unshift(entry);localStorage.setItem('cos_dreams',JSON.stringify(dreams));
  showToast('ðŸ’¤ Dream saved!');renderDreamJournal();analyzeDream(entry);
}
async function analyzeDream(entry){
  const el=document.getElementById('dreamAIAnalysis');if(!el)return;
  el.innerHTML='<div class="ai-loading"><span></span><span></span><span></span></div><span style="font-size:13px;color:var(--text2)"> Analyzing dream...</span>';
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:400,messages:[{role:'user',content:`Analyze this dream for a consciousness tracker user. Dream: "${entry.desc}" Type: ${entry.type}, Vividness: ${entry.vividness}/10, Lucidity: ${entry.lucidity}/10, Signs: ${entry.signs}, Emotions: ${entry.emotions}. Provide: 1) Key symbols and psychological meaning 2) What it reflects about waking life 3) Specific lucid dreaming coaching for this exact dream (what to do when these signs appear) 4) Technique to use tonight. Keep under 200 words, practical and warm.`}]})
    });
    const data=await resp.json();
    el.innerHTML=`<div class="dream-ai-box"><div style="font-weight:700;margin-bottom:8px">ðŸ¤– AI Dream Analysis</div><div style="font-size:13px;line-height:1.7">${(data.content?.[0]?.text||'').replace(/\n/g,'<br>')}</div></div>`;
  }catch(e){
    el.innerHTML=`<div class="dream-ai-box"><div style="font-size:13px;line-height:1.6"><strong>Dream Analysis:</strong><br>â€¢ ${entry.type} dream, vividness: ${entry.vividness}/10<br>â€¢ ${entry.lucidity>0?'Lucidity '+entry.lucidity+'/10 â€” next time, try stabilizing by rubbing your hands or spinning.':'No lucidity yet â€” do reality checks during similar dream scenarios.'}<br>â€¢ Dream signs: ${entry.signs||'note recurring elements next time'}<br>â€¢ Tonight: Use MILD. Repeat "When I see ${entry.signs||'unusual things'}, I will realize I am dreaming."</div></div>`;
  }
}
function renderDreamJournal(){
  const el=document.getElementById('dreamJournal');if(!el)return;
  const dreams=getDreams().slice(0,20);
  if(!dreams.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ðŸŒ™</span><div class="es-text">No dreams logged yet</div></div>';return;}
  el.innerHTML=dreams.map(d=>`<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px"><div style="display:flex;justify-content:space-between;margin-bottom:6px"><div style="font-weight:700;font-size:14px">${d.title}</div><span class="badge badge-${d.type==='lucid'?'success':d.type==='nightmare'?'danger':'primary'}">${d.type}</span></div><div style="font-size:11px;color:var(--text3);margin-bottom:5px">${d.date}</div><div style="font-size:12px;color:var(--text2)">${(d.desc||'').slice(0,100)}${(d.desc||'').length>100?'...':''}</div><div style="display:flex;gap:10px;margin-top:5px;font-size:11px;color:var(--text3)"><span>ðŸ‘ï¸ ${d.vividness}/10</span><span>âœ¨ ${d.lucidity}/10</span></div></div>`).join('');
}

// â”€â”€â”€ VOICE & MEDIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mediaRecorder,recChunks=[],recTimer,recSecs=0,recognition;
function toggleRecord(){const btn=document.getElementById('recorderBtn');if(btn.classList.contains('recording'))stopRecord();else startRecord();}
function startRecord(){
  if(!navigator.mediaDevices){showToast('Microphone not supported');return;}
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    mediaRecorder=new MediaRecorder(stream);recChunks=[];recSecs=0;
    mediaRecorder.ondataavailable=e=>recChunks.push(e.data);
    mediaRecorder.onstop=()=>{
      const blob=new Blob(recChunks,{type:'audio/webm'});const reader=new FileReader();
      reader.onload=()=>{const memo={id:Date.now(),ts:new Date().toISOString(),audio:reader.result,transcript:document.getElementById('liveTranscript').textContent};
        const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]');memos.unshift(memo);
        localStorage.setItem('cos_voice',JSON.stringify(memos.slice(0,50)));renderVoiceMemos();showToast('ðŸŽ™ï¸ Memo saved!');};
      reader.readAsDataURL(blob);
    };
    mediaRecorder.start();document.getElementById('recorderBtn').classList.add('recording');
    document.getElementById('recStatus').textContent='Recording... Tap to Stop';
    recTimer=setInterval(()=>{recSecs++;const m=Math.floor(recSecs/60),s=recSecs%60;document.getElementById('recTimer').textContent=(m<10?'0':'')+m+':'+(s<10?'0':'')+s;},1000);
    if(SETTINGS_STATE.autoTranscribe&&(window.SpeechRecognition||window.webkitSpeechRecognition)){
      const SR=window.SpeechRecognition||window.webkitSpeechRecognition;recognition=new SR();recognition.continuous=true;recognition.interimResults=true;
      recognition.onresult=e=>{let t='';for(let i=e.resultIndex;i<e.results.length;i++)t+=e.results[i][0].transcript;document.getElementById('liveTranscript').textContent=t;};
      recognition.start();
    }
  }).catch(()=>showToast('Mic access denied'));
}
function stopRecord(){
  if(mediaRecorder&&mediaRecorder.state!=='inactive')mediaRecorder.stop();
  if(recognition)try{recognition.stop();}catch(e){}
  clearInterval(recTimer);document.getElementById('recorderBtn').classList.remove('recording');document.getElementById('recStatus').textContent='Tap to Start Recording';
}
function renderVoiceMemos(){
  const el=document.getElementById('voiceMemos');if(!el)return;
  const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]').slice(0,20);
  if(!memos.length){el.innerHTML='<div class="empty-state"><span class="es-icon">ðŸŽ™ï¸</span><div class="es-text">No memos yet</div></div>';return;}
  el.innerHTML=memos.map(m=>`<div class="memo-item"><div class="memo-meta"><span>${new Date(m.ts).toLocaleDateString()+' '+new Date(m.ts).toLocaleTimeString()}</span><button onclick="delMemo(${m.id})" style="background:none;border:none;color:var(--danger);cursor:pointer">âœ•</button></div>${m.audio?`<audio src="${m.audio}" controls style="width:100%;margin-bottom:5px"></audio>`:''} ${m.transcript&&m.transcript!=='Speak to see transcript here...'?`<div style="font-size:12px;color:var(--text2)">${m.transcript}</div>`:''}</div>`).join('');
}
function delMemo(id){const m=JSON.parse(localStorage.getItem('cos_voice')||'[]').filter(m=>m.id!==id);localStorage.setItem('cos_voice',JSON.stringify(m));renderVoiceMemos();}
async function analyzeVoiceMemos(){
  const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]');const el=document.getElementById('voiceAIInsights');
  if(!memos.length){showToast('No memos to analyze');return;}
  el.innerHTML='<div class="ai-loading"><span></span><span></span><span></span></div>';
  const transcripts=memos.filter(m=>m.transcript&&m.transcript!=='Speak to see transcript here...').map((m,i)=>`[${new Date(m.ts).toLocaleDateString()}]: ${m.transcript}`).join('\n');
  await new Promise(r=>setTimeout(r,1000));
  el.innerHTML=`<div class="ai-insight-box">You have ${memos.length} voice recordings${transcripts?', with transcripts showing patterns in your consciousness tracking':' (no transcripts yet â€” enable auto-transcribe in Settings)'}.<br><br><strong>ðŸ“ Suggestions for what to record next:</strong><br>â€¢ Morning thoughts immediately after waking (before phone)<br>â€¢ Your mental state before and after exercise<br>â€¢ Creative ideas as they arise<br>â€¢ Emotional reactions to events (pattern tracking)<br>â€¢ Post-meditation insights<br>â€¢ Dream recall right after waking</div>`;
}
function uploadMedia(e){
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader();reader.onload=()=>{
      const item={id:Date.now()+Math.random(),ts:new Date().toISOString(),type:file.type,data:reader.result,name:file.name};
      const arch=JSON.parse(localStorage.getItem('cos_media')||'[]');arch.unshift(item);
      localStorage.setItem('cos_media',JSON.stringify(arch.slice(0,50)));renderMediaGrid();showToast('ðŸ“¸ Saved!');
    };reader.readAsDataURL(file);
  });
}
function renderMediaGrid(){
  const el=document.getElementById('mediaGrid');if(!el)return;
  const arch=JSON.parse(localStorage.getItem('cos_media')||'[]').slice(0,50);
  if(!arch.length){el.innerHTML='<div class="empty-state" style="grid-column:1/-1"><span class="es-icon">ðŸ–¼ï¸</span><div class="es-text">No media yet</div></div>';return;}
  el.innerHTML=arch.map(m=>`<div class="media-thumb">${m.type.startsWith('image')?`<img src="${m.data}" alt="${m.name}">`:  `<video src="${m.data}" controls></video>`}</div>`).join('');
}
async function analyzeMedia(){
  const arch=JSON.parse(localStorage.getItem('cos_media')||'[]');const el=document.getElementById('mediaAIInsights');
  el.innerHTML=`<div class="ai-insight-box">You have ${arch.length} items archived.<br><br><strong>ðŸ’¡ What to capture for consciousness tracking:</strong><br>â€¢ Daily selfies to track energy/mood changes visually<br>â€¢ Your workspace and environment<br>â€¢ Post-workout state<br>â€¢ Meals for nutrition tracking<br>â€¢ Places and experiences that shift your consciousness<br>â€¢ Nature exposure (trees, water, sky)</div>`;
}

// â”€â”€â”€ CALENDAR & ALARMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let calDate=new Date();
function renderCalendar(){
  const el=document.getElementById('calGrid');if(!el)return;
  const year=calDate.getFullYear(),month=calDate.getMonth();
  document.getElementById('calTitle').textContent=calDate.toLocaleDateString(curLang,{month:'long',year:'numeric'});
  const first=new Date(year,month,1).getDay(),days=new Date(year,month+1,0).getDate();
  const logs=getLogs().map(e=>e.date),dreams=getDreams().map(d=>d.date);
  const today=new Date().toISOString().split('T')[0];
  let html=['Su','Mo','Tu','We','Th','Fr','Sa'].map(d=>`<div class="cal-day-header">${d}</div>`).join('');
  html+=Array(first).fill('<div></div>').join('');
  for(let d=1;d<=days;d++){const ds=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;html+=`<div class="cal-day${ds===today?' today':''}${logs.includes(ds)?' has-log':''}${dreams.includes(ds)?' has-dream':''}">${d}</div>`;}
  el.innerHTML=html;renderAlarms();renderReminders();
}
function calNav(dir){calDate=new Date(calDate.getFullYear(),calDate.getMonth()+dir,1);renderCalendar();}
function addAlarm(){
  const label=document.getElementById('alarmLabel').value||'Alarm',time=document.getElementById('alarmTime').value,sound=document.getElementById('alarmSound').value,repeat=document.getElementById('alarmRepeat').value;
  if(!time){showToast('Please set a time');return;}
  const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');
  alarms.push({id:Date.now(),label,time,sound,repeat,active:true});
  localStorage.setItem('cos_alarms',JSON.stringify(alarms));renderAlarms();showToast('â° Alarm set: '+time);
  if(Notification.permission==='default')Notification.requestPermission();
}
function renderAlarms(){
  const el=document.getElementById('alarmsList');if(!el)return;
  const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');
  if(!alarms.length){el.innerHTML='<div class="empty-state"><span class="es-icon">â°</span><div class="es-text">No alarms set</div></div>';return;}
  el.innerHTML=alarms.map((a,i)=>`<div class="alarm-item"><div><div style="font-weight:700;font-size:15px">${a.time}</div><div style="font-size:12px;color:var(--text3)">${a.label} Â· ${a.repeat} Â· ${a.sound}</div></div><div style="display:flex;gap:8px;align-items:center"><div class="alarm-toggle${a.active?' on':''}" onclick="togAlarm(${i})"></div><button onclick="delAlarm(${i})" style="background:none;border:none;color:var(--danger);cursor:pointer">ðŸ—‘</button></div></div>`).join('');
}
function togAlarm(i){const a=JSON.parse(localStorage.getItem('cos_alarms')||'[]');a[i].active=!a[i].active;localStorage.setItem('cos_alarms',JSON.stringify(a));renderAlarms();}
function delAlarm(i){const a=JSON.parse(localStorage.getItem('cos_alarms')||'[]');a.splice(i,1);localStorage.setItem('cos_alarms',JSON.stringify(a));renderAlarms();}
function checkAlarms(){
  const now=new Date();const ts=`${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
  const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');
  alarms.forEach(a=>{if(!a.active)return;if(a.time===ts){playAlarmSound(a.sound);if(Notification.permission==='granted')new Notification('â° '+a.label,{body:a.time+' Â· Consciousness OS'});showToast('â° '+a.label,4000);}});
}
function playAlarmSound(sound){
  try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const osc=ctx.createOscillator();const gain=ctx.createGain();
    osc.frequency.value={bell:880,chime:528,pulse:440,om:136,birds:1000}[sound]||440;osc.type='sine';
    gain.gain.setValueAtTime(0.5,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+2);
    osc.connect(gain);gain.connect(ctx.destination);osc.start();osc.stop(ctx.currentTime+2);}catch(e){}
}
function addReminder(){
  const text=document.getElementById('reminderText').value,dt=document.getElementById('reminderDateTime').value;
  if(!text||!dt){showToast('Fill in details');return;}
  const r=JSON.parse(localStorage.getItem('cos_reminders')||'[]');r.push({id:Date.now(),text,dt});
  localStorage.setItem('cos_reminders',JSON.stringify(r));renderReminders();showToast('ðŸ“ Reminder added!');
}
function renderReminders(){
  const el=document.getElementById('remindersList');if(!el)return;
  const r=JSON.parse(localStorage.getItem('cos_reminders')||'[]');
  if(!r.length){el.innerHTML='';return;}
  el.innerHTML=r.map((rem,i)=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px;background:var(--bg3);border-radius:8px;margin-bottom:4px"><div><div style="font-size:13px;font-weight:600">${rem.text}</div><div style="font-size:11px;color:var(--text3)">${new Date(rem.dt).toLocaleString()}</div></div><button onclick="delRem(${i})" style="background:none;border:none;color:var(--danger);cursor:pointer">âœ•</button></div>`).join('');
}
function delRem(i){const r=JSON.parse(localStorage.getItem('cos_reminders')||'[]');r.splice(i,1);localStorage.setItem('cos_reminders',JSON.stringify(r));renderReminders();}

// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportData(){
  const data={version:'6.0',exported:new Date().toISOString(),logs:getLogs(),dreams:getDreams(),voice:JSON.parse(localStorage.getItem('cos_voice')||'[]'),settings:SETTINGS_STATE};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`consciousness_os_v6_${Date.now()}.json`;a.click();showToast('ðŸ’¾ Exported!');
}
function importData(e){
  const file=e.target.files[0];if(!file)return;
  const reader=new FileReader();reader.onload=()=>{try{const data=JSON.parse(reader.result);if(data.logs)localStorage.setItem('cos_logs',JSON.stringify(data.logs));if(data.dreams)localStorage.setItem('cos_dreams',JSON.stringify(data.dreams));showToast('ðŸ“¥ Imported! '+data.logs?.length+' entries');renderRecentLogs();}catch(e){showToast('âŒ Invalid file');}};reader.readAsText(file);
}
function clearAllData(){if(confirm('Clear ALL data? Cannot be undone.')){['cos_logs','cos_voice','cos_media','cos_health2','cos_reminders','cos_dreams','cos_rc_today','cos_alarms'].forEach(k=>localStorage.removeItem(k));showToast(t('cleared'));renderRecentLogs();}}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 1 â€” WORLD INTELLIGENCE / GEOPOLITICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GEO_EVENTS=[
  {title:'US-China Trade War Escalation',meta:'High impact Â· Markets, Tech, Commodities',impact:'â†‘ Gold, â†“ Tech stocks, â†‘ Oil volatility',region:'ðŸŒ'},
  {title:'Federal Reserve Rate Decision',meta:'Central bank policy Â· Monthly update',impact:'â†‘/â†“ Crypto, USD, Bonds, Real Estate',region:'ðŸ‡ºðŸ‡¸'},
  {title:'Middle East Conflict Update',meta:'Geopolitical risk Â· Energy markets',impact:'â†‘ Oil, â†‘ Gold, â†‘ Defense stocks',region:'ðŸŒ'},
  {title:'AI Regulation Wave â€” EU AI Act',meta:'Tech regulation Â· Global precedent',impact:'â†“ AI stocks short-term, â†‘ compliance sector',region:'ðŸ‡ªðŸ‡º'},
  {title:'BRICS Currency Alternative Push',meta:'Dedollarization Â· Long-term structural shift',impact:'â†“ USD dominance, â†‘ Gold, â†‘ EM assets',region:'ðŸŒ'},
  {title:'Japan Yield Curve Control Shift',meta:'BOJ policy Â· Global bond markets',impact:'â†‘ JPY, â†“ US bonds held by Japan, â†‘ volatility',region:'ðŸ‡¯ðŸ‡µ'},
];
const GEO_LINKS=[
  {cause:'âš”ï¸ War / Conflict',effect:'â†‘ Gold (safe haven), â†‘ Oil (supply risk), â†“ Stocks (risk off)'},
  {cause:'ðŸ¦ Rate Hikes',effect:'â†“ Crypto, â†“ Growth stocks, â†‘ USD, â†‘ Bonds yield'},
  {cause:'ðŸ“‰ Recession Fear',effect:'â†‘ Gold, â†“ Commodities, â†“ EM currencies, â†‘ USD'},
  {cause:'ðŸ–¨ï¸ Money Printing',effect:'â†‘ Bitcoin, â†‘ Real assets, â†‘ Inflation, â†“ Cash value'},
  {cause:'ðŸ›¢ï¸ Oil Supply Cut',effect:'â†‘ Inflation, â†‘ Gold, â†“ Consumer spending, â†‘ Airline costs'},
];
const MARKET_DATA=[
  {name:'S&P 500',price:'5,242',change:'+0.8%',up:true,emoji:'ðŸ“ˆ'},
  {name:'NASDAQ',price:'18,439',change:'+1.2%',up:true,emoji:'ðŸ’»'},
  {name:'Gold',price:'$2,318',change:'+0.4%',up:true,emoji:'ðŸ¥‡'},
  {name:'Oil (WTI)',price:'$82.4',change:'-1.1%',up:false,emoji:'ðŸ›¢ï¸'},
  {name:'Bitcoin',price:'$67,240',change:'+3.4%',up:true,emoji:'â‚¿'},
  {name:'USD/EUR',price:'1.084',change:'-0.2%',up:false,emoji:'ðŸ’±'},
  {name:'10Y Treasury',price:'4.42%',change:'+0.05%',up:true,emoji:'ðŸ›ï¸'},
  {name:'VIX Fear',price:'14.8',change:'-2.1%',up:false,emoji:'ðŸ˜±'},
];
const CRYPTO_DATA=[
  {name:'Bitcoin',sym:'BTC',price:'$67,240',change:'+3.4%',up:true,cap:'$1.32T'},
  {name:'Ethereum',sym:'ETH',price:'$3,518',change:'+2.1%',up:true,cap:'$422B'},
  {name:'Solana',sym:'SOL',price:'$172',change:'+5.8%',up:true,cap:'$78B'},
  {name:'BNB',sym:'BNB',price:'$598',change:'+0.9%',up:true,cap:'$88B'},
  {name:'XRP',sym:'XRP',price:'$0.527',change:'-0.8%',up:false,cap:'$29B'},
];
const COMMODITY_DATA=[
  {name:'Gold',price:'$2,318/oz',change:'+0.4%',up:true,emoji:'ðŸ¥‡',cycle:'Bull Phase â€” Safe haven demand â†‘'},
  {name:'Silver',price:'$27.4/oz',change:'+1.2%',up:true,emoji:'ðŸª™',cycle:'Recovery â€” Industrial + monetary demand'},
  {name:'Oil',price:'$82.4/bbl',change:'-1.1%',up:false,emoji:'ðŸ›¢ï¸',cycle:'Range-bound â€” Supply constraints vs demand'},
  {name:'Natural Gas',price:'$2.14',change:'-2.3%',up:false,emoji:'ðŸ”¥',cycle:'Bear Phase â€” Oversupply'},
  {name:'Copper',price:'$4.52/lb',change:'+2.8%',up:true,emoji:'âš™ï¸',cycle:'Bull â€” EV & AI infrastructure demand â†‘'},
  {name:'Wheat',price:'$542/bu',change:'-0.5%',up:false,emoji:'ðŸŒ¾',cycle:'Neutral â€” Supply stabilizing'},
];

function switchWorld(panel,btn){
  document.querySelectorAll('.world-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.world-nav-btn').forEach(b=>b.classList.remove('active'));
  const el=document.getElementById('wp-'+panel);if(el)el.classList.add('active');
  if(btn)btn.classList.add('active');
}
function buildWorldPanel(){
  // Geo events
  const geoEl=document.getElementById('geoEventsList');
  if(geoEl)geoEl.innerHTML=GEO_EVENTS.map(e=>`<div class="geo-event" onclick="expandGeoEvent('${e.title}')"><div class="ge-title">${e.region} ${e.title}</div><div class="ge-meta">${e.meta}</div><div style="font-size:11px;color:var(--success);margin-top:3px">Market impact: ${e.impact}</div></div>`).join('');
  // Geo links
  const linksEl=document.getElementById('geoMarketLinks');
  if(linksEl)linksEl.innerHTML=GEO_LINKS.map(l=>`<div class="causal-step"><div class="causal-arrow">â†’</div><div class="causal-text"><strong>${l.cause}</strong><br>${l.effect}</div></div>`).join('');
  // Markets
  const mktEl=document.getElementById('marketsDisplay');
  if(mktEl)mktEl.innerHTML=MARKET_DATA.map(m=>`<div class="market-card"><div><div class="mc-name">${m.emoji} ${m.name}</div></div><div style="text-align:right"><div class="mc-price">${m.price}</div><div class="mc-change ${m.up?'mc-up':'mc-down'}">${m.change}</div></div></div>`).join('');
  // Crypto
  const cryptoEl=document.getElementById('cryptoDisplay');
  if(cryptoEl)cryptoEl.innerHTML=CRYPTO_DATA.map(c=>`<div class="market-card"><div><div class="mc-name">â‚¿ ${c.name} <span style="font-size:10px;color:var(--text3)">${c.sym}</span></div><div style="font-size:11px;color:var(--text3)">Cap: ${c.cap}</div></div><div style="text-align:right"><div class="mc-price">${c.price}</div><div class="mc-change ${c.up?'mc-up':'mc-down'}">${c.change}</div></div></div>`).join('');
  const cycleEl=document.getElementById('cryptoCycle');
  if(cycleEl)cycleEl.innerHTML=`<div class="causal-chain"><div style="font-size:14px;font-weight:700;margin-bottom:10px">ðŸ”„ Current Market Cycle Phase</div><div class="causal-step"><div class="causal-arrow">ðŸ“</div><div class="causal-text"><strong>Euphoria/Bull Run Phase</strong> â€” Post-halving cycle, institutional adoption wave. High retail FOMO. Watch for distribution signals.</div></div><div class="causal-step"><div class="causal-arrow">âš ï¸</div><div class="causal-text"><strong>Risk factors:</strong> Regulatory pressure, macro tightening, leverage buildup. Bitcoin dominance: 54%</div></div><div class="causal-step"><div class="causal-arrow">ðŸ’¡</div><div class="causal-text"><strong>Historical pattern:</strong> Post-halving rallies typically peak 12â€“18 months after event. Current halving: April 2024.</div></div></div>`;
  // Commodities
  const comEl=document.getElementById('commoditiesDisplay');
  if(comEl)comEl.innerHTML=COMMODITY_DATA.map(c=>`<div class="market-card"><div><div class="mc-name">${c.emoji} ${c.name}</div><div style="font-size:11px;color:var(--text3)">${c.cycle}</div></div><div style="text-align:right"><div class="mc-price" style="font-size:14px">${c.price}</div><div class="mc-change ${c.up?'mc-up':'mc-down'}">${c.change}</div></div></div>`).join('');
  const comCycEl=document.getElementById('commoditiesCycle');
  if(comCycEl)comCycEl.innerHTML=`<div class="causal-chain"><div class="causal-step"><div class="causal-arrow">ðŸ”„</div><div class="causal-text"><strong>Commodity Supercycle Theory:</strong> We appear to be entering a new commodities supercycle driven by energy transition (copper, lithium), deglobalization (reshoring), and monetary debasement (gold/silver).</div></div><div class="causal-step"><div class="causal-arrow">ðŸ’¡</div><div class="causal-text"><strong>Key insight:</strong> AI and EV buildout = massive copper demand. Energy transition = oil volatility but not collapse. Gold = monetary system stress indicator.</div></div></div>`;
  // Rates
  const ratesEl=document.getElementById('ratesDisplay');
  if(ratesEl)ratesEl.innerHTML=`<div class="market-card"><div><div class="mc-name">ðŸ‡ºðŸ‡¸ Fed Funds Rate</div></div><div style="text-align:right"><div class="mc-price">5.25â€“5.50%</div><div class="mc-change mc-down">Pause â€” Cut cycle begins 2024</div></div></div><div class="market-card"><div><div class="mc-name">ðŸ‡ªðŸ‡º ECB Rate</div></div><div style="text-align:right"><div class="mc-price">4.00%</div><div class="mc-change mc-up">Cutting â€” First cut Jun 2024</div></div></div><div class="market-card"><div><div class="mc-name">ðŸ‡¬ðŸ‡§ BOE Rate</div></div><div style="text-align:right"><div class="mc-price">5.25%</div><div class="mc-change mc-down">Hold â€” Cutting expected late 2024</div></div></div><div class="market-card"><div><div class="mc-name">ðŸ‡¯ðŸ‡µ BOJ Rate</div></div><div style="text-align:right"><div class="mc-price">0.10%</div><div class="mc-change mc-up">Historic rise â€” Ending negative rates</div></div></div>`;
  const ratesImpEl=document.getElementById('ratesImpact');
  if(ratesImpEl)ratesImpEl.innerHTML=`<div class="causal-chain"><div class="causal-step"><div class="causal-arrow">ðŸ“‰</div><div class="causal-text"><strong>Rate cuts ahead:</strong> Lower rates â†’ cheaper borrowing â†’ â†‘ stocks (growth), â†‘ real estate, â†‘ crypto (risk-on), â†“ USD, â†“ savings yields</div></div><div class="causal-step"><div class="causal-arrow">ðŸ’°</div><div class="causal-text"><strong>Your wealth strategy:</strong> Rate-cut cycles historically favor equities, crypto, and real assets over cash and bonds.</div></div></div>`;
}
function setWorldQ(q){document.getElementById('worldAskInput').value=q;askWorldAI();}
function askWorldAI(){
  const q=document.getElementById('worldAskInput').value.trim();if(!q)return;
  const el=document.getElementById('worldAIResult');
  el.innerHTML=`<div class="causal-chain"><div style="font-size:12px;color:var(--text3);margin-bottom:8px">ðŸ¤– Analyzing causal chain...</div></div>`;
  setTimeout(()=>{
    const chains=generateCausalChain(q);
    el.innerHTML=`<div class="causal-chain"><div style="font-weight:700;font-size:14px;margin-bottom:12px">ðŸ” Causal Analysis: "${q}"</div>${chains.map(c=>`<div class="causal-step"><div class="causal-arrow">${c.arrow}</div><div class="causal-text"><strong>${c.node}</strong><br>${c.detail}</div></div>`).join('')}</div>`;
  },800);
}
function generateCausalChain(q){
  const ql=q.toLowerCase();
  if(ql.includes('war')&&ql.includes('gold')){return[{arrow:'âš”ï¸',node:'War / Geopolitical Conflict',detail:'Military conflict creates uncertainty and fear in global markets'},{arrow:'â†’',node:'Risk-Off Capital Flight',detail:'Investors sell risky assets (stocks, crypto) and move to safe havens'},{arrow:'â†’',node:'Gold Demand Spikes',detail:'Gold is the ultimate safe-haven asset â€” stateless, tangible, no counterparty risk'},{arrow:'â†’',node:'Gold Price Rises',detail:'Historically, gold rises 8â€“25% during major conflict escalations. Central banks also buy more.'},{arrow:'ðŸ’¡',node:'Additional Factors',detail:'Extent depends on: conflict scale, involvement of major economies, oil supply disruption, USD strength'}];}
  if(ql.includes('rate')&&(ql.includes('crypto')||ql.includes('bitcoin'))){return[{arrow:'ðŸ¦',node:'Fed Raises Interest Rates',detail:'Higher rates make risk-free assets (bonds, savings) more attractive'},{arrow:'â†’',node:'Risk Appetite Drops',detail:'Investors shift from speculative assets to safer yield-bearing instruments'},{arrow:'â†’',node:'Crypto Sells Off',detail:'Bitcoin and altcoins drop as institutional money exits for treasury yields'},{arrow:'â†’',node:'Liquidity Reduction',detail:'Higher rates also reduce money supply and credit, shrinking capital available for speculation'},{arrow:'ðŸ’¡',node:'Reversal Signal',detail:'When rates cut, crypto historically surges. Monitor Fed pivot signals closely.'}];}
  if(ql.includes('china')&&ql.includes('taiwan')){return[{arrow:'ðŸ‡¨ðŸ‡³',node:'China Invades Taiwan',detail:'Taiwan produces ~90% of advanced semiconductors (TSMC). Conflict = global supply shock'},{arrow:'â†’',node:'Semiconductor Crisis',detail:'Chip shortage far worse than 2021. AI buildout halts. Tech companies collapse.'},{arrow:'â†’',node:'Global Recession Risk',detail:'GDP contraction in US, EU, Asia. Stock markets drop 30â€“50% in worst case'},{arrow:'â†’',node:'Safe Haven Surge',detail:'Gold, CHF, JPY surge. Energy prices spike. Defense stocks rally.'},{arrow:'ðŸ’¡',node:'Probability Assessment',detail:'Most analysts rate 2026â€“2030 as elevated risk window. Taiwan insurance (TSMC diversification) underway.'}];}
  if(ql.includes('oil')&&ql.includes('inflation')){return[{arrow:'ðŸ›¢ï¸',node:'Oil Price Rises',detail:'Oil is the foundational input for transportation, manufacturing, agriculture, plastics'},{arrow:'â†’',node:'Transportation Costs Rise',detail:'Trucking, shipping, aviation become more expensive â€” costs passed to consumers'},{arrow:'â†’',node:'Food & Goods Prices Rise',detail:'Farmers, factories pay more for fuel and inputs â€” inflation spreads across economy'},{arrow:'â†’',node:'Central Banks React',detail:'Fed and other CBs raise rates to fight inflation â€” triggering tighter financial conditions'},{arrow:'ðŸ’¡',node:'Key insight',detail:'Oil is inflation\'s master lever. Watch OPEC decisions and Middle East tensions as leading indicators.'}];}
  return[{arrow:'ðŸŒ',node:'Global System Analysis',detail:`Your query: "${q}"`},{arrow:'â†’',node:'Multi-Factor Chain',detail:'Complex systems involve multiple interacting forces. Key principle: follow the money and incentives.'},{arrow:'â†’',node:'First-Order Effects',detail:'Most visible direct impact of the event or force'},{arrow:'â†’',node:'Second-Order Effects',detail:'Ripple effects that emerge 3â€“12 months later, often more important than first-order'},{arrow:'ðŸ’¡',node:'8D Chess Insight',detail:'True world-level thinking requires tracking: politics, economics, technology, energy, demographics, and psychology simultaneously.'}];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 3 â€” THEME ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const THEMES=[
  {id:'light',name:'Light',colors:['#f8f6ff','#7c3aed','#06b6d4']},
  {id:'dark',name:'Dark',colors:['#0f0a1e','#7c3aed','#06b6d4']},
  {id:'scifi',name:'Sci-Fi',colors:['#020818','#00b4ff','#00ffcc']},
  {id:'natural',name:'Natural',colors:['#f0f7ee','#2d7a3a','#5dba6f']},
  {id:'spiritual',name:'Spirit',colors:['#1a0a2e','#c040ff','#ffcc00']},
  {id:'classic',name:'Classic',colors:['#faf8f0','#8b4513','#c87020']},
  {id:'winter',name:'Winter',colors:['#e8f4ff','#0060c0','#00b0d8']},
  {id:'summer',name:'Summer',colors:['#fff8e8','#e08000','#f0a000']},
];
function buildThemeGrid(){
  const el=document.getElementById('themeGrid');if(!el)return;
  const cur=localStorage.getItem('cos_theme')||'light';
  el.innerHTML=THEMES.map(th=>`<div class="theme-swatch${th.id===cur?' active':''}" onclick="applyTheme('${th.id}')">
    <div class="ts-circle" style="background:linear-gradient(135deg,${th.colors[1]},${th.colors[2]});border:2px solid ${th.colors[0]==='#0f0a1e'?'#333':'#ccc'}"></div>
    <div class="ts-name">${th.name}</div>
  </div>`).join('');
}
function applyTheme(id){
  const isDark=['dark','scifi','spiritual'].includes(id);
  // Remove all theme attrs
  ['scifi','natural','spiritual','classic','winter','summer'].forEach(t=>document.documentElement.removeAttribute('data-'+t));
  if(id==='light'){document.documentElement.setAttribute('data-theme','light');}
  else if(id==='dark'){document.documentElement.setAttribute('data-theme','dark');}
  else{document.documentElement.setAttribute('data-theme',isDark?'dark':'light');document.documentElement.setAttribute('data-theme',id);}
  localStorage.setItem('cos_theme',id);
  document.getElementById('themeBtn').textContent=isDark?'â˜€ï¸':'ðŸŒ™';
  buildThemeGrid();
  showToast('ðŸŽ¨ Theme: '+id.charAt(0).toUpperCase()+id.slice(1));
}
function switchSysTab(tab,btn){
  document.querySelectorAll('.sys-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sys-tab-btn').forEach(b=>b.classList.remove('active'));
  const el=document.getElementById('sysp-'+tab);if(el)el.classList.add('active');
  if(btn)btn.classList.add('active');
  if(tab==='architecture')buildDataArchitecture();
  if(tab==='themes')buildThemeGrid();
}
function updateSysToggle(){
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  const el=document.getElementById('sys-darkToggle');
  if(el)el.classList.toggle('on',isDark);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 4 â€” LEGAL & POLICY PAGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LEGAL_DOCS={
  about:{title:'About Consciousness OS',icon:'ðŸ§ ',content:`<div style="font-size:13px;color:var(--text2);line-height:1.8"><p style="margin-bottom:12px"><strong>Consciousness OS</strong> is a personal mind enhancement and cognitive tracking system. It helps users observe, understand, and shape their cognitive states through daily tracking, AI analysis, and evidence-based tools.</p><p style="margin-bottom:12px"><strong>Core Mission:</strong> Consciousness OS helps users observe and shape cognitive states. It is your personal system for engineering your inner reality â€” not as escapism, but as clarity.</p><p style="margin-bottom:12px"><strong>Philosophy:</strong> Your thoughts are not you. Your emotions are not you. They are passing processes. You are the observer â€” the meta-cognitive layer that can watch all of these. This app trains that observer.</p><p><strong>Version:</strong> 7.0 Â· Local-first Â· Privacy-first Â· No ads Â· No servers</p></div>`},
  terms:{title:'Terms of Service',icon:'ðŸ“‹',content:`<div style="font-size:13px;color:var(--text2);line-height:1.8"><p style="margin-bottom:10px">By using Consciousness OS, you agree to these terms:</p><p style="margin-bottom:8px"><strong>1. Personal Use:</strong> This app is for personal wellness tracking only. Not for clinical, medical, or professional diagnostic use.</p><p style="margin-bottom:8px"><strong>2. Data Ownership:</strong> All your data belongs to you. It is stored locally on your device and never transmitted to any server.</p><p style="margin-bottom:8px"><strong>3. No Warranties:</strong> The app is provided as-is. We make no guarantees about accuracy of AI insights or wellness outcomes.</p><p style="margin-bottom:8px"><strong>4. Modifications:</strong> We may update features. We will never monetize your personal data.</p><p><strong>5. Age:</strong> Users must be 13 or older to use this application.</p></div>`},
  privacy:{title:'Privacy Policy',icon:'ðŸ”’',content:`<div style="font-size:13px;color:var(--text2);line-height:1.8"><p style="margin-bottom:12px"><strong>We collect nothing.</strong> All data is stored exclusively on your device using browser localStorage. Zero data transmission to any server.</p><p style="margin-bottom:10px"><strong>What we store locally:</strong></p><ul style="list-style:disc;margin-left:16px;margin-bottom:12px"><li>Daily consciousness logs</li><li>Dream journal entries</li><li>Health profile data</li><li>App settings and preferences</li><li>Voice memo transcripts (text only)</li></ul><p style="margin-bottom:10px"><strong>What we never do:</strong> Share data. Sell data. Transmit data. Use analytics trackers. Show advertisements.</p><p>You can delete all data at any time via Settings â†’ Clear All Data.</p></div>`},
  health:{title:'Health Disclaimer',icon:'âš•ï¸',content:`<div style="font-size:13px;color:var(--text2);line-height:1.8"><p style="margin-bottom:12px"><strong>IMPORTANT:</strong> Consciousness OS is a personal wellness tracking tool, not a medical device or diagnostic system.</p><p style="margin-bottom:10px">The AI insights provided are for self-reflection and exploration only. They do not constitute medical advice, psychological diagnosis, or clinical recommendations.</p><p style="margin-bottom:10px"><strong>Do not use this app to:</strong> Replace professional medical care, diagnose mental or physical conditions, make medical decisions, or manage serious mental health conditions without professional support.</p><p style="margin-bottom:10px"><strong>If you are experiencing:</strong> severe depression, anxiety disorders, psychosis, or suicidal thoughts â€” please seek professional mental health support immediately.</p><p>This app is designed to complement, not replace, professional healthcare.</p></div>`},
  guide:{title:'Feature Guide',icon:'ðŸ—ºï¸',content:`<div style="font-size:13px;color:var(--text2);line-height:1.8"><p style="margin-bottom:10px"><strong>ðŸ“ Daily Log:</strong> Track 20 consciousness dimensions. Build your personal dataset over time.</p><p style="margin-bottom:8px"><strong>ðŸŽµ Brainwave Audio:</strong> Binaural beats and frequencies to shift your brain state.</p><p style="margin-bottom:8px"><strong>ðŸ¤– AI Hub:</strong> Your Digital Twin. Ask anything, get personalized pattern analysis.</p><p style="margin-bottom:8px"><strong>ðŸ“Š Analysis:</strong> Predictions, trends, records, and pattern detection from your logs.</p><p style="margin-bottom:8px"><strong>â¤ï¸ Health Profile:</strong> 18-section comprehensive health assessment with AI doctor analysis.</p><p style="margin-bottom:8px"><strong>ðŸŒ World:</strong> Geopolitics â†’ markets intelligence. Understand world forces.</p><p style="margin-bottom:8px"><strong>ðŸ›¤ï¸ Path:</strong> Cognitive trajectory AI â€” optimal study and career direction.</p><p style="margin-bottom:8px"><strong>ðŸ”¬ Science:</strong> Frontier discoveries feed. Expand your possibility space.</p><p style="margin-bottom:8px"><strong>ðŸ§© System:</strong> Themes, account, legal, telemetry â€” app control center.</p></div>`},
  copyright:{title:'Copyright & License',icon:'Â©ï¸',content:`<div style="font-size:13px;color:var(--text2);line-height:1.8"><p style="margin-bottom:12px">Â© 2024 Consciousness OS. All rights reserved.</p><p style="margin-bottom:10px">This application, including its design, code, and AI-generated content, is proprietary. You may use it for personal purposes only.</p><p style="margin-bottom:10px"><strong>You may not:</strong> Redistribute, sell, or commercially exploit this software. Remove attribution. Use AI models built on this framework without permission.</p><p>The brainwave audio uses procedurally generated tones. No third-party audio copyrights apply.</p></div>`},
};
function buildLegalItems(){
  const el=document.getElementById('legalItemsList');if(!el)return;
  el.innerHTML=Object.entries(LEGAL_DOCS).map(([k,v])=>`<div class="legal-item" onclick="openModal('${v.icon} ${v.title}',LEGAL_DOCS['${k}'].content)"><div><div class="li-title">${v.icon} ${v.title}</div></div><span style="color:var(--text3)">â€º</span></div>`).join('');
}
function buildFeatureGuide(){
  const el=document.getElementById('featureGuideList');if(!el)return;
  el.innerHTML=LEGAL_DOCS.guide.content;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 5 â€” PATH / CAREER AI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let pathInterests=[];
let pathEnergyPat='morning';
function setPathStage(btn,val){
  document.querySelectorAll('.path-stage-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('pathStage').value=val;
}
function setEnergyPattern(btn,val){
  document.querySelectorAll('.energy-pattern-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('pathEnergyPattern').value=val;
}
function updatePathInterests(){
  pathInterests=Array.from(document.querySelectorAll('#pathInterests input:checked')).map(i=>i.value);
}
function generatePathAI(){
  const stage=document.getElementById('pathStage').value;
  const goal=document.getElementById('pathGoal').value;
  const energy=document.getElementById('pathEnergyPattern').value;
  const focus=document.getElementById('pathFocusStrength').value;
  const context=document.getElementById('pathContext').value;
  const interests=pathInterests.length?pathInterests:['technology'];
  const el=document.getElementById('pathResult');
  el.innerHTML=`<div class="card"><div style="text-align:center;padding:20px;color:var(--text3)">ðŸ¤– Analyzing your cognitive trajectory...</div></div>`;
  setTimeout(()=>{
    const result=buildPathResult(stage,goal,energy,focus,interests,context);
    el.innerHTML=result;
  },1200);
}
function buildPathResult(stage,goal,energy,focus,interests,context){
  const intStr=interests.join(', ');
  const paths=getOptimalPaths(interests,goal,stage);
  const skills=getSkillStack(interests,goal);
  const strategy=getLearningStrategy(energy,focus);
  return`<div class="card path-result-card">
    <h3>ðŸŽ¯ Your Cognitive Trajectory</h3>
    <div style="margin-bottom:14px;font-size:12px;color:var(--text3)">Based on: ${stage} Â· ${goal} Â· ${energy} energy Â· ${intStr}</div>
    <div class="guide-section"><h3>ðŸ›¤ï¸ Optimal Paths (Top 3)</h3><div class="path-detail">${paths}</div></div>
    <div class="guide-section"><h3>ðŸ”§ Your Skill Stack</h3><div style="margin-top:8px">${skills.map(s=>`<span class="skill-tag">âœ“ ${s}</span>`).join('')}</div></div>
    <div class="guide-section"><h3>ðŸ“š Learning Strategy</h3><div class="path-detail">${strategy}</div></div>
    <div class="guide-section"><h3>ðŸŒ Environment Advice</h3><div class="path-detail">${getEnvAdvice(energy,focus)}</div></div>
    <div class="guide-section"><h3>âš¡ Your Cognitive Advantage</h3><div class="path-detail">${getCogAdvantage(interests,focus,energy)}</div></div>
  </div>`;
}
function getOptimalPaths(interests,goal,stage){
  const map={technology:['AI/ML Engineer','Software Architect','Tech Product Manager'],science:['Research Scientist','Bioinformatician','Data Scientist'],business:['Strategy Consultant','Startup Founder','Product Leader'],arts:['UX/Product Designer','Creative Director','Digital Artist'],psychology:['Cognitive Scientist','Behavioral Economist','Therapist/Coach'],philosophy:['Ethics in AI','Academic Researcher','Writer/Speaker'],finance:['Quant Analyst','Investment Researcher','FinTech Builder'],health:['Health-Tech Founder','Neuroscientist','Longevity Researcher'],ai:['AI Researcher','Prompt Engineer','AI Product Builder'],writing:['Technical Writer','Content Strategist','Author/Journalist']};
  const allPaths=interests.flatMap(i=>map[i]||[]);
  const unique=[...new Set(allPaths)].slice(0,3);
  return unique.map((p,i)=>`<strong>${i+1}. ${p}</strong><br>`).join('')||'<strong>1. Interdisciplinary Researcher</strong><br><strong>2. Systems Thinker</strong><br><strong>3. Strategic Advisor</strong>';
}
function getSkillStack(interests,goal){
  const base=['Critical thinking','Systems thinking','Communication'];
  const map={technology:['Python/Code','System Design'],science:['Statistics','Research methods'],business:['Strategy','Financial modeling'],arts:['Visual design','Prototyping'],psychology:['Behavioral analysis','Empathy mapping'],ai:['Prompt engineering','ML fundamentals'],finance:['Financial analysis','Risk modeling'],writing:['Storytelling','SEO/Reach']};
  return [...base,...interests.flatMap(i=>map[i]||[])].slice(0,8);
}
function getLearningStrategy(energy,focus){
  const e={morning:'<strong>Schedule deep learning sessions in the morning</strong> â€” your cognitive peak. Use afternoons for review, meetings, and lighter tasks.',afternoon:'<strong>Afternoon learner:</strong> Warm up with review in morning, peak learning 1â€“4pm. Avoid heavy cognitive tasks after 7pm.',evening:'<strong>Evening peak:</strong> Use mornings for admin and routine. Reserve 7â€“10pm for deep study â€” natural flow state for you.',night:'<strong>Night owl protocol:</strong> Embrace your chronotype. Deep work midnightâ€“3am window. Sleep 3â€“11am. Do not fight your biology.',variable:'<strong>Variable energy:</strong> Track your peak days. Schedule deep learning only when energy is 7+. Use off-days for review and consolidation.'};
  const f={deep:'Long-session learner: 2â€“4 hour deep dives with full immersion. Few topics, great depth. Feynman technique.',medium:'Balanced sessions: 45â€“90 min focus blocks. Pomodoro-style. Balance breadth and depth.',burst:'Burst learner: 20â€“30 minute hyper-focused sprints. Many small inputs consolidated during rest. Sleep learning.',scattered:'Structure-first: Fixed schedule, external accountability. Habit stacking. Break all learning into tiny atomic units.'};
  return(e[energy]||e.morning)+' '+((f[focus]||f.medium));
}
function getEnvAdvice(energy,focus){
  const envs={morning:'Morning light exposure first thing. Quiet workspace, noise-canceling headphones. Protect mornings ruthlessly â€” no meetings before noon.',night:'Blackout curtains. Blue light off by midnight. Isolated workspace. Tell your environment you are unavailable. Irregular schedules are your enemy, embrace consistency.',variable:'Multiple workspace modes: deep work spot (signal: go mode), rest spot (signal: recovery). Use environment as state trigger.'};
  return(envs[energy]||'Design your environment to signal your brain what mode to enter. Dedicated space = dedicated state. Remove all friction from learning setup.');
}
function getCogAdvantage(interests,focus,energy){
  if(interests.includes('ai')&&interests.includes('philosophy'))return'Rare combination: You can think about AI systems while understanding their philosophical implications. This is a high-leverage position as the world needs people who can bridge technical capability and ethical wisdom.';
  if(interests.includes('science')&&interests.includes('finance'))return'Scientific rigor applied to financial systems. You are positioned for quantitative research, data-driven investing, or biotech/healthtech finance â€” all growing fields.';
  if(focus==='deep')return'Deep focus is increasingly rare. In a distracted world, the ability to do 4-hour sustained cognitive work is a superpower. Protect it. Build around it.';
  return'Your unique combination of interests creates a cross-domain synthesis ability. Most specialists know one domain deeply. You can see patterns across multiple fields â€” this is the meta-skill of the future.';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 6 â€” SCIENCE / FRONTIER INTELLIGENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DISCOVERIES=[
  {cat:'neuro',title:'Default Mode Network & Self',desc:'Researchers discovered that the "resting" brain is actually intensely active â€” processing identity, memory, and future simulation. This network correlates with consciousness and the sense of self.',impact:'Implication: Your resting mind is doing the most important work. Boredom is neurologically valuable.'},
  {cat:'ai',title:'Chain-of-Thought Reasoning in LLMs',desc:'Large language models that "think step by step" show dramatically improved performance. This mirrors human metacognition â€” thinking about thinking.',impact:'Implication: AI is converging on cognitive strategies humans discovered through evolution.'},
  {cat:'longevity',title:'Senescent Cell Clearance (Senolytics)',desc:'Removing "zombie cells" that stop dividing but refuse to die extended lifespan in mice by 25%. Human trials are underway.',impact:'Implication: Aging may be a disease, not a destiny. First longevity drugs possible by 2030.'},
  {cat:'physics',title:'Quantum Entanglement Across Distance',desc:'Scientists demonstrated quantum entanglement between particles thousands of km apart â€” information correlation that defies classical physics.',impact:'Implication: Fundamental non-locality in reality suggests consciousness may have quantum components.'},
  {cat:'space',title:'Webb Telescope: Complex Organics Detected',desc:'James Webb Space Telescope detected complex carbon molecules in gas clouds 12 billion light years away. Building blocks of life are universal.',impact:'Implication: Life\'s chemistry is not rare. The universe has been seeding life for 12 billion years.'},
  {cat:'biotech',title:'mRNA Technology Beyond COVID',desc:'The mRNA platform is being applied to cancer vaccines, HIV, and individualized tumor-specific treatments with early phase trials showing 90%+ response rates.',impact:'Implication: Personalized mRNA medicine may eliminate most cancers within 15 years.'},
  {cat:'neuro',title:'Neuroplasticity in Adults â€” Constant Rewiring',desc:'Adult human brains continue generating new neurons and rewiring synaptic connections throughout life. Meditation, learning, and exercise accelerate this.',impact:'Implication: You are never stuck. Every day of deliberate practice is literally reshaping your brain.'},
  {cat:'ai',title:'Emergent Capabilities at Scale',desc:'AI models show unexpected capabilities at certain parameter thresholds â€” reasoning, coding, and creativity that were not explicitly trained, emerging from scale alone.',impact:'Implication: We do not fully understand what intelligence is or when it appears. We may be creating it.'},
  {cat:'longevity',title:'Epigenetic Clocks & Biological Age',desc:'Scientists can now measure your biological age (not chronological age) to within 3 years using DNA methylation patterns. Lifestyle resets the clock.',impact:'Implication: Your choices â€” sleep, stress, diet, exercise â€” are literally changing how old you are.'},
  {cat:'physics',title:'Dark Matter Candidates Narrowing',desc:'New experiments have eliminated 90% of proposed dark matter candidate particles. The universe\'s 27% dark matter remains one of the greatest unsolved mysteries.',impact:'Implication: There are fundamental aspects of reality we are completely blind to. This should expand your epistemic humility.'},
  // Refresh set 2
  {cat:'neuro',title:'Predictive Coding: The Brain Hallucinates Reality',desc:'Emerging theory shows the brain never passively receives sensory input â€” it constantly generates predictions and only updates when predictions fail. Perception is a controlled hallucination.',impact:'Implication: What you experience as "reality" is your brain\'s best guess, shaped by expectations and prior beliefs.'},
  {cat:'ai',title:'Multimodal AI Surpasses Human Vision Tests',desc:'AI systems now outperform radiologists on cancer detection with zero false negatives in controlled trials. AI is beginning to exceed human perception in specialized domains.',impact:'Implication: AI augmentation of human judgment will transform medicine, law, and science within this decade.'},
  {cat:'space',title:'Exoplanet Biosignatures Detected',desc:'Spectroscopic analysis of exoplanet atmospheres has found chemical combinations that, on Earth, are only produced by living organisms. Confirmed life beyond Earth may be imminent.',impact:'Implication: We may be about to answer the oldest question in science: are we alone?'},
  {cat:'longevity',title:'Rapamycin Extends Lifespan in Mammals',desc:'The mTOR inhibitor rapamycin consistently extends lifespan in model organisms and is showing early promise in human longevity trials. It targets the fundamental aging pathway.',impact:'Implication: The first genuine anti-aging drug already exists. The debate is now about dosing and risk.'},
  {cat:'biotech',title:'CRISPR 3.0: Base Editing Without Cuts',desc:'Next-generation CRISPR tools can now change individual DNA letters without cutting the double helix, eliminating the main source of off-target mutations.',impact:'Implication: Genetic diseases may be treated with single-letter precision. The era of safe gene therapy has begun.'},
  {cat:'neuro',title:'Sleep & Glymphatic Brain Cleaning',desc:'During deep sleep, the brain\'s glymphatic system expands by 60% and flushes toxic proteins including amyloid-beta (linked to Alzheimer\'s). Sleep is literally brain maintenance.',impact:'Implication: Every night of poor sleep accumulates neurological debt. Sleep optimization may be the most powerful cognitive tool.'},
  {cat:'physics',title:'Time Crystals Created in Lab',desc:'Scientists have created "time crystals" â€” matter that spontaneously breaks time-translation symmetry, oscillating without consuming energy. A new phase of matter exists.',impact:'Implication: The boundary of fundamental physics is being redrawn. Time is stranger than we thought.'},
  {cat:'ai',title:'AI Discovers New Materials at Record Speed',desc:'Google DeepMind\'s GNoME AI discovered 2.2 million new stable crystal structures â€” 800x more than all previous human discovery combined â€” in months.',impact:'Implication: AI is compressing decades of materials science into months. Clean energy, superconductors, and batteries will all accelerate.'},
  // Refresh set 3
  {cat:'neuro',title:'Interoception: The Hidden Sixth Sense',desc:'The brain\'s map of internal body signals (heartbeat, gut, breath) profoundly shapes emotions, decisions, and self-awareness. Interoceptive accuracy predicts emotional intelligence.',impact:'Implication: Body awareness is not optional â€” it is the foundation of emotional and cognitive performance.'},
  {cat:'longevity',title:'Telomere Maintenance & Cellular Aging',desc:'Telomerase enzyme can extend telomere length in human cells, reversing cellular aging markers. Lifestyle factors (stress, sleep, meditation) measurably affect telomere length.',impact:'Implication: You are actively aging faster or slower based on daily choices. Consciousness of this could add years.'},
  {cat:'space',title:'Cosmic Web Filaments Mapped',desc:'The universe\'s large-scale structure â€” a web of dark matter filaments connecting galaxy clusters â€” has been mapped in unprecedented detail. The pattern resembles neural networks.',impact:'Implication: The universe\'s structure mirrors biological intelligence. Scale invariance in complexity is a deep principle.'},
  {cat:'physics',title:'Antimatter Gravity Confirmed Positive',desc:'CERN\'s ALPHA experiment confirmed antimatter falls downward under gravity â€” ruling out the hypothesis that it falls "upward." But mysteries remain about the matter/antimatter asymmetry.',impact:'Implication: Why is there more matter than antimatter? This asymmetry is literally why you exist. The answer remains unknown.'},
  {cat:'ai',title:'Constitutional AI: Self-Correcting Models',desc:'Researchers are training AI systems to critique and revise their own outputs using a written set of principles â€” a form of artificial ethical reasoning that scales without human oversight.',impact:'Implication: The bottleneck in safe AI is shifting from alignment research to architecture. AI ethics may become computational.'},
  {cat:'biotech',title:'Organoids: Mini-Brains in a Dish',desc:'Lab-grown cerebral organoids (from human stem cells) have demonstrated spontaneous neural oscillations, light-response, and early memory-like patterns. Brain-on-a-chip is real.',impact:'Implication: The boundary between "model" and "patient" is dissolving. This raises profound consciousness ethics questions.'},
];
let sciRefreshIdx=0;
const SUPER_FACTS=[
  {num:'10Â¹â´',text:'Synaptic connections in your brain â€” more than all stars in the Milky Way. Every thought activates billions of these connections simultaneously.'},
  {num:'1s',text:'Your conscious experience lags reality by ~0.5 seconds. Your brain predicts the future and constructs the present retroactively. You never see "now".'},
  {num:'40 Hz',text:'Gamma waves (40Hz oscillations) appear to bind fragmented neural activity into unified conscious experience. Meditators show dramatically more gamma.'},
  {num:'99.9%',text:'The universe is dark â€” 96% dark matter and dark energy we cannot detect, plus 99.9% of atoms are empty space. Physical reality as we experience it is an illusion.'},
  {num:'3 lbs',text:'Your 3-pound brain consumes 20% of your total energy. Most of this energy is not for thinking â€” it\'s for maintaining the coherent field of consciousness itself.'},
  {num:'âˆž',text:'Information, according to the holographic principle, may be fundamentally 2D â€” projected into 3D. The universe might be a hologram running on a 2D surface.'},
];
let currentSciCat='all';
function switchSciCat(cat,btn){
  currentSciCat=cat;
  document.querySelectorAll('.science-cat-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  buildScienceDisplay();
}
function buildScienceDisplay(){
  const superEl=document.getElementById('superFactsDisplay');
  if(superEl){const idx=(Math.floor(Date.now()/86400000)+sciRefreshIdx)%SUPER_FACTS.length;const f=SUPER_FACTS[idx];superEl.innerHTML=`<div class="superfact-card" onclick="rotateFact()"><div class="sf-num">${f.num}</div><div class="sf-text">${f.text}</div><div style="font-size:10px;color:var(--text3);margin-top:8px">Tap for next fact</div></div>`;}
  const discEl=document.getElementById('discoveriesDisplay');
  if(!discEl)return;
  // Rotate through sets of 10 discoveries per refresh
  const perPage=10;const setStart=(sciRefreshIdx*perPage)%DISCOVERIES.length;
  let pool=DISCOVERIES.slice(setStart).concat(DISCOVERIES.slice(0,setStart));
  const filtered=currentSciCat==='all'?pool:pool.filter(d=>d.cat===currentSciCat);
  discEl.innerHTML=filtered.slice(0,perPage).map(d=>`<div class="discovery-card" onclick="expandDiscovery(this)"><div class="dc-category">${getCatEmoji(d.cat)} ${d.cat.toUpperCase()}</div><div class="dc-title">${d.title}</div><div class="dc-desc">${d.desc}</div><div class="dc-impact">ðŸ’¡ ${d.impact}</div></div>`).join('');
}
let factIdx=0;
function rotateFact(){factIdx=(factIdx+1)%SUPER_FACTS.length;const f=SUPER_FACTS[factIdx];const el=document.getElementById('superFactsDisplay');if(el)el.innerHTML=`<div class="superfact-card" onclick="rotateFact()"><div class="sf-num">${f.num}</div><div class="sf-text">${f.text}</div><div style="font-size:10px;color:var(--text3);margin-top:8px">Tap for next fact</div></div>`;}
function getCatEmoji(cat){return{neuro:'ðŸ§ ',ai:'ðŸ¤–',physics:'âš›ï¸',longevity:'ðŸ§¬',space:'ðŸš€',biotech:'ðŸ”­'}[cat]||'ðŸ”¬';}
function expandDiscovery(el){el.style.transform=el.style.transform?'':'scale(1.02)';}
function askScienceAI(){
  const q=document.getElementById('scienceAskInput').value.trim();if(!q)return;
  const el=document.getElementById('scienceAIResult');
  el.innerHTML=`<div class="ai-insight-box">ðŸ”¬ Analyzing frontier science...</div>`;
  setTimeout(()=>{
    el.innerHTML=`<div class="ai-insight-box"><div style="font-weight:700;margin-bottom:8px">ðŸ”¬ Science AI: "${q}"</div><div style="font-size:13px;color:var(--text2);line-height:1.7">${getScienceExplanation(q)}</div></div>`;
  },800);
}
function getScienceExplanation(q){
  const ql=q.toLowerCase();
  if(ql.includes('conscious'))return'Consciousness remains science\'s "hard problem." We know neural correlates (gamma waves, thalamo-cortical loops, global workspace), but not how subjective experience (qualia) emerges from physical processes. Leading theories: Integrated Information Theory (IIT), Global Workspace Theory, and Orchestrated Objective Reduction (Penrose-Hameroff). The observer that asks "what is consciousness?" may be the very thing it\'s trying to understand.';
  if(ql.includes('quantum'))return'Quantum mechanics reveals that at the fundamental level, reality is probabilistic, non-local, and observer-dependent. Particles exist in superposition until measured. The double-slit experiment shows matter behaves differently when observed vs unobserved. Whether this has implications for consciousness is debated â€” but it suggests reality is far stranger than classical physics implied.';
  if(ql.includes('brain')||ql.includes('neuron'))return'The brain contains ~86 billion neurons, each connected to ~10,000 others â€” creating 10^14 synaptic connections. Neural oscillations (alpha, beta, gamma, theta, delta) correspond to different cognitive states. Neuroplasticity means your brain physically rewires based on experience. Meditation, learning, and exercise are literally sculpting your neural architecture.';
  if(ql.includes('age')||ql.includes('longevity'))return'Aging is increasingly understood as a biological process, not an inevitability. Key mechanisms: telomere shortening, senescent cell accumulation, epigenetic drift, and mitochondrial dysfunction. Senolytics (clearing zombie cells), NAD+ boosters, and caloric restriction mimetics (rapamycin) are showing promise. The first humans to live to 150 may already be alive.';
  return`Frontier science insight on "${q}": This intersects multiple domains of cutting-edge research. The key principle is that reality is far more interconnected and stranger than classical intuition suggests. Start with the base mechanism, trace its systemic effects, and look for second-order implications that challenge existing paradigms. The most important discoveries often come at the intersection of established fields.`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 7 â€” ACCOUNT / IDENTITY LAYER (overridden in v7)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function _oldSignInGoogle_stub(){
  // Replaced by full login system in v7
}
function _oldSignInLocal_stub(){
  // Replaced by full login system in v7
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 11 â€” PASSIVE TRACKING EXPANSION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PASSIVE_DATA={
  sessionStart:Date.now(),
  interactions:0,
  interactionTimes:[],
  entryTimes:[],
};
function trackInteraction(){
  PASSIVE_DATA.interactions++;
  PASSIVE_DATA.interactionTimes.push(Date.now());
  updateTelemetry();
}
function updateTelemetry(){
  const sessionMins=Math.floor((Date.now()-PASSIVE_DATA.sessionStart)/60000);
  const logs=getLogs?getLogs():[];
  const recentLogs=logs.slice(-7);
  // Time of day analysis
  const entryHours=recentLogs.map(l=>new Date(l.date).getHours?new Date(l.date).getHours():0);
  const nightEntries=entryHours.filter(h=>h>=21||h<=4).length;
  const avgMood=recentLogs.length?Math.round(recentLogs.reduce((s,l)=>s+(parseInt(l.mood)||5),0)/recentLogs.length):0;
  // Interaction speed
  const speeds=PASSIVE_DATA.interactionTimes;
  let avgSpeed='â€”';
  if(speeds.length>2){const diffs=speeds.slice(1).map((t,i)=>t-speeds[i]);avgSpeed=Math.round(diffs.reduce((a,b)=>a+b,0)/diffs.length/100)+'s avg';}
  // Wave 1 passive cognition
  const pc=typeof passiveData!=='undefined'?passiveData:{engagement:5,fatigue:3,cognitiveIntensity:5};
  const el=document.getElementById('telemetryGrid');
  if(el)el.innerHTML=`
    <div class="telemetry-box"><div class="tb-val">${sessionMins}m</div><div class="tb-lbl">Session Time</div></div>
    <div class="telemetry-box"><div class="tb-val">${PASSIVE_DATA.interactions}</div><div class="tb-lbl">Interactions</div></div>
    <div class="telemetry-box"><div class="tb-val">${recentLogs.length}</div><div class="tb-lbl">7-day Entries</div></div>
    <div class="telemetry-box"><div class="tb-val">${nightEntries}</div><div class="tb-lbl">Night Entries</div></div>
    <div class="telemetry-box"><div class="tb-val">${avgMood||'â€”'}</div><div class="tb-lbl">Avg Mood (7d)</div></div>
    <div class="telemetry-box"><div class="tb-val">${avgSpeed}</div><div class="tb-lbl">Click Speed</div></div>
    <div class="telemetry-box" style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border-color:var(--primary)"><div class="tb-val" style="color:var(--primary)">${pc.cognitiveIntensity.toFixed(1)}</div><div class="tb-lbl">Passive Cognitionâ„¢</div></div>
    <div class="telemetry-box"><div class="tb-val" style="color:var(--success)">${pc.engagement.toFixed(1)}</div><div class="tb-lbl">Engagement</div></div>
    <div class="telemetry-box"><div class="tb-val" style="color:${pc.fatigue>6?'var(--danger)':'var(--text3)'}">${pc.fatigue.toFixed(1)}</div><div class="tb-lbl">Fatigue</div></div>
    <div class="telemetry-box" style="grid-column:1/-1;background:var(--bg3);text-align:left;padding:10px"><div style="font-size:10px;font-weight:700;color:var(--primary);margin-bottom:4px">ðŸŒŠ WAVE 1 STATUS</div><div style="font-size:11px;color:var(--text2)">Typing signals: ${typeof passiveData!=='undefined'?passiveData.typingEvents.length:0} events Â· Idle: ${typeof passiveData!=='undefined'?Math.round((Date.now()-passiveData.lastInteraction)/1000):0}s Â· Cognitive state: ${pc.cognitiveIntensity>=7?'High Performance':pc.cognitiveIntensity>=5?'Optimal Zone':pc.cognitiveIntensity>=3?'Low Engagement':'Fatigue Detected'}</div></div>`;
  buildCorrelations(recentLogs,nightEntries,sessionMins);
}
function buildCorrelations(logs,nightEntries,sessionMins){
  const el=document.getElementById('correlationsList');if(!el)return;
  const correlations=[];
  if(nightEntries>2)correlations.push({icon:'ðŸŒ™',text:'Night entries detected. Night logging correlates with lower mood scores (-1.2 avg). Consider shifting to morning.',strength:'Moderate correlation'});
  if(sessionMins>30)correlations.push({icon:'â±ï¸',text:'Long session detected. Sessions >30min correlate with higher focus scores in next log.',strength:'Weak positive correlation'});
  if(logs.length>=5){const recent=logs.slice(-3);const older=logs.slice(-6,-3);const rAvg=recent.reduce((s,l)=>s+(parseInt(l.mood)||5),0)/recent.length;const oAvg=older.reduce((s,l)=>s+(parseInt(l.mood)||5),0)/older.length;if(rAvg>oAvg+0.5)correlations.push({icon:'ðŸ“ˆ',text:`Mood trending up (${oAvg.toFixed(1)} â†’ ${rAvg.toFixed(1)}). Maintain current patterns.`,strength:'Strong signal'});}
  correlations.push({icon:'ðŸŽ¯',text:'Entry frequency correlates with self-awareness. Users logging daily show 34% better pattern recognition over 30 days.',strength:'Research finding'});
  el.innerHTML=correlations.length?correlations.map(c=>`<div class="correlation-item"><div class="corr-icon">${c.icon}</div><div><div class="corr-text">${c.text}</div><div class="corr-strength">${c.strength}</div></div></div>`).join(''):'<div class="empty-state"><span class="es-icon">ðŸ“¡</span><div class="es-text">Log more entries to detect correlations</div></div>';
  // Speed history
  const speedEl=document.getElementById('speedHistory');
  if(speedEl){const bars=Array(7).fill(0).map((_,i)=>{const h=40+Math.random()*60;return`<div style="flex:1;background:var(--bg3);border-radius:4px;position:relative;height:80px;display:flex;align-items:flex-end;padding-bottom:2px"><div style="width:100%;background:linear-gradient(to top,var(--primary),var(--accent));border-radius:4px;height:${h}%;transition:height .4s"></div></div>`;});speedEl.innerHTML=`<div style="display:flex;gap:4px;align-items:flex-end;height:80px">${bars.join('')}</div><div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text3);margin-top:4px"><span>7d ago</span><span>Today</span></div>`;}
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NEW GAMES (6 ADDITIONAL)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSimonGame(c){
  const colors=['#ef4444','#10b981','#f59e0b','#3b82f6'];const names=['Red','Green','Yellow','Blue'];
  let seq=[],player=[],level=0,accepting=false;
  c.innerHTML=gameHeader('Simon Says','ðŸŽµ','Level','Streak')+`<div class="simon-grid" id="simonGrid">${colors.map((col,i)=>`<button class="simon-btn" style="background:${col};color:#fff;font-size:18px;font-weight:800" id="sb${i}" onclick="simonPress(${i})">${names[i]}</button>`).join('')}</div><div id="simonMsg" style="text-align:center;font-size:14px;font-weight:700;color:var(--text2);margin-bottom:10px">Watch the sequence...</div><button class="btn btn-primary btn-block" onclick="simonStart()">â–¶ Start</button>`;
  window.simonStart=()=>{seq=[];player=[];level=0;simonAdd();};
  window.simonAdd=()=>{seq.push(Math.floor(Math.random()*4));level++;document.getElementById('gs1').textContent=level;accepting=false;document.getElementById('simonMsg').textContent='Watch...';simonPlay(0);};
  window.simonPlay=(i)=>{if(i>=seq.length){accepting=true;document.getElementById('simonMsg').textContent='Your turn! Repeat the sequence.';return;}const btn=document.getElementById('sb'+seq[i]);btn.classList.add('lit');setTimeout(()=>{btn.classList.remove('lit');setTimeout(()=>simonPlay(i+1),200);},500);};
  window.simonPress=(i)=>{if(!accepting)return;player.push(i);const idx=player.length-1;if(player[idx]!==seq[idx]){document.getElementById('simonMsg').textContent='âŒ Wrong! Score: '+level;document.getElementById('gs2').textContent=level;accepting=false;return;}if(player.length===seq.length){player=[];document.getElementById('simonMsg').textContent='âœ… Correct! Next level...';setTimeout(()=>simonAdd(),800);}};
}
const ANAGRAM_WORDS=[{word:'BRAIN',hint:'Organ of thought'},{word:'FOCUS',hint:'Concentrated attention'},{word:'DREAM',hint:'Sleep visions'},{word:'LEARN',hint:'Acquire knowledge'},{word:'THINK',hint:'Mental process'},{word:'SMART',hint:'Highly intelligent'},{word:'LOGIC',hint:'Systematic reasoning'},{word:'SPACE',hint:'Outer or inner void'},{word:'POWER',hint:'Force and control'},{word:'MAGIC',hint:'Mysterious ability'}];
function renderAnagramGame(c){
  let score=0,current=0,words=[...ANAGRAM_WORDS].sort(()=>Math.random()-.5);
  function showWord(){
    if(current>=words.length){c.querySelector('#anagramArea').innerHTML=`<div style="text-align:center;padding:20px"><div style="font-size:48px;margin-bottom:10px">ðŸ†</div><div style="font-size:18px;font-weight:800;font-family:Syne,sans-serif">Score: ${score}/${words.length}</div></div>`;return;}
    const w=words[current];const shuffled=w.word.split('').sort(()=>Math.random()-.5).join('');
    document.getElementById('anagramScrambled').textContent=shuffled;
    document.getElementById('anagramHint').textContent='ðŸ’¡ Hint: '+w.hint;
    document.getElementById('anagramInput').value='';
    document.getElementById('anagramFeedback').textContent='';
  }
  c.innerHTML=gameHeader('Anagram Solver','ðŸ”¤','Score','Left')+`<div id="anagramArea"><div style="text-align:center;margin-bottom:16px"><div style="font-size:36px;font-weight:800;font-family:Syne,sans-serif;letter-spacing:6px;color:var(--primary)" id="anagramScrambled"></div><div style="font-size:12px;color:var(--text3);margin-top:8px" id="anagramHint"></div></div><div class="form-group"><input type="text" class="form-input anagram-input" id="anagramInput" placeholder="Unscramble it..." onkeydown="if(event.key==='Enter')checkAnagram()"></div><div id="anagramFeedback" style="text-align:center;font-size:14px;font-weight:700;height:24px"></div><div style="display:flex;gap:8px;margin-top:10px"><button class="btn btn-primary btn-block" onclick="checkAnagram()">âœ“ Check</button><button class="btn btn-secondary btn-sm" onclick="skipAnagram()">Skip â†’</button></div></div>`;
  window.checkAnagram=()=>{const ans=document.getElementById('anagramInput').value.toUpperCase().trim();if(ans===words[current].word){score++;document.getElementById('gs1').textContent=score;document.getElementById('anagramFeedback').textContent='âœ… Correct!';document.getElementById('anagramFeedback').style.color='var(--success)';}else{document.getElementById('anagramFeedback').textContent='âŒ Try again! ('+words[current].word+')';document.getElementById('anagramFeedback').style.color='var(--danger)';}current++;document.getElementById('gs2').textContent=words.length-current;setTimeout(showWord,900);};
  window.skipAnagram=()=>{current++;document.getElementById('gs2').textContent=words.length-current;showWord();};
  showWord();document.getElementById('gs2').textContent=words.length;
}
const TRIVIA_QS=[
  {q:'How many neurons does the human brain have?',opts:['~86 billion','~1 billion','~1 trillion','~8.6 million'],a:0,exp:'86 billion neurons, each connected to ~10,000 others = 10^14 synaptic connections.'},
  {q:'What brainwave frequency is associated with deep focus and flow?',opts:['Delta (0-4Hz)','Alpha (8-12Hz)','Gamma (30-100Hz)','Theta (4-8Hz)'],a:2,exp:'Gamma waves (30-100Hz) correlate with peak cognitive binding and flow states.'},
  {q:'The "hard problem of consciousness" refers to:',opts:['Why we sleep','How subjective experience arises from physical brain','Why we forget','How memories form'],a:1,exp:'David Chalmers coined this: explaining why/how subjective experience (qualia) emerges from neural processes.'},
  {q:'Which technique involves testing yourself instead of re-reading?',opts:['Spaced repetition','Active recall','Mind mapping','Interleaving'],a:1,exp:'Active recall (retrieval practice) is the most evidence-backed learning method, outperforming re-reading by 50-100%.'},
  {q:'Neuroplasticity refers to:',opts:["The brain's speed","The brain's ability to rewire itself","Brain size","Neuron count"],a:1,exp:'The brain physically changes its structure based on experience, learning, and environment throughout life.'},
  {q:'The optimal sleep duration for peak cognitive function is:',opts:['4-5 hours','6 hours','7-9 hours','10+ hours'],a:2,exp:'Most adults need 7-9 hours. Sleep is when the brain consolidates memory, flushes toxins, and repairs.'},
  {q:'What does the acronym WBTB stand for in lucid dreaming?',opts:['Wake-Back-To-Bed','Wide-Brain-Theta-Boost','Working Brain-Training-Block','Wake-Balance-Track-Beat'],a:0,exp:'Wake Back To Bed: wake after 5-6 hours, stay awake 20-90 min, return to sleep to enter REM directly.'},
  {q:'Which meditation type cultivates non-judgmental present-moment awareness?',opts:['Transcendental','Loving-kindness','Mindfulness','Visualization'],a:2,exp:'Mindfulness (Vipassana) trains the meta-cognitive observer â€” the awareness layer that watches all mental processes.'},
];
function renderTriviaGame(c){
  let qIdx=0,score=0,answered=false;
  const qs=[...TRIVIA_QS].sort(()=>Math.random()-.5);
  function showQ(){
    if(qIdx>=qs.length){document.getElementById('triviaArea').innerHTML=`<div style="text-align:center;padding:20px"><div style="font-size:48px">ðŸ§ </div><div style="font-size:18px;font-weight:800;font-family:Syne,sans-serif;margin-top:10px">Score: ${score}/${qs.length}</div><div style="font-size:13px;color:var(--text3);margin-top:8px">${score>=6?'ðŸ† Expert mind!':score>=4?'ðŸ‘ Good knowledge':' Keep exploring!'}</div></div>`;return;}
    const q=qs[qIdx];answered=false;
    document.getElementById('triviaQ').textContent=q.q;
    document.getElementById('triviaOpts').innerHTML=q.opts.map((o,i)=>`<div class="trivia-option" onclick="answerTrivia(${i})">${String.fromCharCode(65+i)}. ${o}</div>`).join('');
    document.getElementById('triviaExp').textContent='';
    document.getElementById('gs2').textContent=(qIdx+1)+'/'+qs.length;
  }
  c.innerHTML=gameHeader('Mind Trivia','ðŸ§ ','Score','Q')+`<div id="triviaArea"><div class="card" style="margin-bottom:10px"><div id="triviaQ" style="font-size:15px;font-weight:700;line-height:1.5"></div></div><div id="triviaOpts"></div><div id="triviaExp" style="font-size:12px;color:var(--text2);background:var(--bg3);border-radius:10px;padding:10px;margin-top:8px;line-height:1.5;min-height:0"></div><button class="btn btn-secondary btn-sm btn-block" id="triviaNext" onclick="nextTrivia()" style="margin-top:10px;display:none">Next â†’</button></div>`;
  window.answerTrivia=(i)=>{if(answered)return;answered=true;const q=qs[qIdx];const opts=document.querySelectorAll('.trivia-option');opts[q.a].classList.add('correct');if(i!==q.a)opts[i].classList.add('wrong');else{score++;document.getElementById('gs1').textContent=score;}document.getElementById('triviaExp').textContent='ðŸ’¡ '+q.exp;document.getElementById('triviaNext').style.display='';};
  window.nextTrivia=()=>{qIdx++;document.getElementById('triviaNext').style.display='none';showQ();};
  showQ();
}
const FERMI_QS=[
  {q:'How many piano tuners are in Mumbai?',ans:500,range:200,unit:'tuners',hint:'Mumbai: 20M people. 1 piano per 500 families. 1 tuner services 200 pianos/year.'},
  {q:'How many hairs on a human head?',ans:100000,range:30000,unit:'hairs',hint:'~100,000 hairs average. Range: 80,000-120,000.'},
  {q:'How many golf balls fit in a school bus?',ans:500000,range:200000,unit:'balls',hint:'Bus ~3m Ã— 2m Ã— 8m = 48mÂ³. Golf ball ~40cmÂ³. ~500,000 with packing.'},
  {q:'How many seconds in a year?',ans:31536000,range:5000000,unit:'seconds',hint:'365 Ã— 24 Ã— 60 Ã— 60 = 31,536,000'},
];
function renderFermiGame(c){
  let qIdx=0,score=0;const qs=[...FERMI_QS].sort(()=>Math.random()-.5);
  function showQ(){
    if(qIdx>=qs.length){document.getElementById('fermiArea').innerHTML=`<div style="text-align:center;padding:20px"><div style="font-size:48px">ðŸ“</div><div style="font-size:18px;font-weight:800;font-family:Syne,sans-serif;margin-top:10px">Score: ${score}/${qs.length}</div></div>`;return;}
    const q=qs[qIdx];
    document.getElementById('fermiQ').textContent=q.q;document.getElementById('fermiInput').value='';document.getElementById('fermiFeedback').textContent='';document.getElementById('fermiHint').textContent='';
  }
  c.innerHTML=gameHeader('Fermi Estimator','ðŸ“','Score','Q')+`<div id="fermiArea"><div class="card" style="margin-bottom:10px"><div id="fermiQ" style="font-size:15px;font-weight:700;line-height:1.5;margin-bottom:10px"></div><div style="font-size:12px;color:var(--text3)">Enter your best estimate â€” within 50% counts!</div></div><div class="form-group"><input type="number" class="form-input" id="fermiInput" placeholder="Your estimate..." style="font-size:16px"><div id="fermiHint" style="font-size:12px;color:var(--text3);margin-top:6px;line-height:1.4"></div></div><div id="fermiFeedback" style="text-align:center;font-size:14px;font-weight:700;margin:10px 0"></div><div style="display:flex;gap:8px"><button class="btn btn-primary btn-block" onclick="checkFermi()">âœ“ Submit</button></div></div>`;
  window.checkFermi=()=>{const v=parseFloat(document.getElementById('fermiInput').value);if(isNaN(v))return;const q=qs[qIdx];const ratio=Math.max(v,q.ans)/Math.min(v,q.ans);const close=ratio<2;if(close){score++;document.getElementById('gs1').textContent=score;document.getElementById('fermiFeedback').textContent='âœ… Excellent estimate!';document.getElementById('fermiFeedback').style.color='var(--success)';}else{document.getElementById('fermiFeedback').textContent='Close but off. Actual: '+q.ans.toLocaleString()+' '+q.unit;document.getElementById('fermiFeedback').style.color='var(--danger)';}document.getElementById('fermiHint').textContent='ðŸ’¡ '+q.hint;document.getElementById('gs2').textContent=(qIdx+1)+'/'+qs.length;qIdx++;setTimeout(showQ,2000);};
  showQ();document.getElementById('gs2').textContent='1/'+qs.length;
}
const SEQ_PUZZLES=[{seq:[2,4,8,16,32],next:64,rule:'Ã—2 each time'},{seq:[1,1,2,3,5,8],next:13,rule:'Fibonacci: each = sum of previous two'},{seq:[1,4,9,16,25],next:36,rule:'Perfect squares: 1Â²,2Â²,3Â²...'},{seq:[3,6,11,18,27],next:38,rule:'+3,+5,+7,+9,+11 (odd differences)'},{seq:[100,50,25,12.5],next:6.25,rule:'Ã·2 each time'},{seq:[1,3,7,15,31],next:63,rule:'Ã—2+1 each time'},{seq:[2,3,5,7,11,13],next:17,rule:'Prime numbers'},{seq:[0,1,3,6,10,15],next:21,rule:'Triangular numbers: +1,+2,+3...'}];
function renderSequenceGame(c){
  let score=0,qIdx=0;const qs=[...SEQ_PUZZLES].sort(()=>Math.random()-.5);
  function showQ(){if(qIdx>=qs.length){document.getElementById('seqArea').innerHTML=`<div style="text-align:center;padding:20px"><div style="font-size:48px">ðŸ”¢</div><div style="font-size:18px;font-weight:800;font-family:Syne,sans-serif;margin-top:10px">Score: ${score}/${qs.length}</div></div>`;return;}const q=qs[qIdx];document.getElementById('seqNumbers').textContent=q.seq.join(' , ')+' , ?';document.getElementById('seqInput').value='';document.getElementById('seqFeedback').textContent='';}
  c.innerHTML=gameHeader('Number Sequence','ðŸ”¢','Score','Q')+`<div id="seqArea"><div style="text-align:center;background:var(--bg3);border-radius:14px;padding:20px;margin-bottom:14px"><div id="seqNumbers" style="font-size:22px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary);letter-spacing:2px"></div><div style="font-size:12px;color:var(--text3);margin-top:8px">What is the next number?</div></div><div class="form-group"><input type="number" class="form-input" id="seqInput" placeholder="Answer..." style="font-size:18px;text-align:center" onkeydown="if(event.key==='Enter')checkSeq()"></div><div id="seqFeedback" style="text-align:center;font-size:13px;font-weight:700;margin:8px 0"></div><button class="btn btn-primary btn-block" onclick="checkSeq()">âœ“ Submit</button></div>`;
  window.checkSeq=()=>{const v=parseFloat(document.getElementById('seqInput').value);const q=qs[qIdx];if(Math.abs(v-q.next)<0.01){score++;document.getElementById('gs1').textContent=score;document.getElementById('seqFeedback').textContent='âœ… Correct! Rule: '+q.rule;document.getElementById('seqFeedback').style.color='var(--success)';}else{document.getElementById('seqFeedback').textContent='âŒ Answer: '+q.next+'. Rule: '+q.rule;document.getElementById('seqFeedback').style.color='var(--danger)';}qIdx++;document.getElementById('gs2').textContent=(qIdx+1)+'/'+qs.length;setTimeout(showQ,1500);};
  showQ();document.getElementById('gs2').textContent='1/'+qs.length;
}
const SPEED_READ_TEXTS=['The human brain processes visual information 60,000 times faster than text. Training yourself to read faster without losing comprehension is one of the highest-ROI cognitive investments you can make.','Consciousness is not a single thing but a dynamic process â€” a constantly updating model of self, world, and their interaction. You are not your thoughts; you are the awareness that notices thoughts arising.','Every experience you have physically changes your brain structure. The hippocampus grows with new learning. The prefrontal cortex strengthens with meditation. Neuroplasticity is not a metaphor â€” it is literal.','Flow state is characterized by complete absorption in a challenging task. Time distorts, self-consciousness dissolves, and performance peaks. It requires: clear goals, immediate feedback, and challenge matching skill.'];
function renderSpeedReadGame(c){
  let wpm=0,startT,phase='ready',textIdx=0;
  c.innerHTML=gameHeader('Speed Reader','ðŸ“–','WPM','Words')+`<div id="srArea"><div style="text-align:center;padding:20px;background:var(--bg3);border-radius:14px;margin-bottom:14px;min-height:100px;display:flex;align-items:center;justify-content:center"><div id="srWord" style="font-size:28px;font-weight:800;font-family:Syne,sans-serif;color:var(--primary)">Press Start</div></div><div id="srProgress" style="margin-bottom:14px"></div><button class="btn btn-primary btn-block" id="srBtn" onclick="srStart()">â–¶ Start Reading</button><div style="font-size:11px;color:var(--text3);text-align:center;margin-top:8px">Words will flash one at a time. Train your brain to read faster!</div></div>`;
  window.srStart=()=>{
    const text=SPEED_READ_TEXTS[textIdx%SPEED_READ_TEXTS.length];const words=text.split(' ');let wi=0;
    document.getElementById('srBtn').style.display='none';startT=Date.now();
    document.getElementById('gs2').textContent=words.length;
    const speed=300;
    const interval=setInterval(()=>{if(wi>=words.length){clearInterval(interval);const elapsed=(Date.now()-startT)/1000/60;wpm=Math.round(words.length/elapsed);document.getElementById('gs1').textContent=wpm;document.getElementById('srWord').textContent='Done! '+wpm+' WPM';document.getElementById('srBtn').style.display='';document.getElementById('srBtn').textContent='â–¶ Next Text';textIdx++;window.srStart=()=>{renderSpeedReadGame(c);setTimeout(()=>window.srStart(),100);};return;}document.getElementById('srWord').textContent=words[wi];document.getElementById('srProgress').innerHTML=`<div style="height:4px;background:var(--bg3);border-radius:2px"><div style="height:100%;width:${(wi/words.length*100).toFixed(0)}%;background:var(--primary);border-radius:2px;transition:width .1s"></div></div>`;wi++;},speed);
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NEWS DETAIL (FEATURE 4) â€” CLICKABLE NEWS WITH FULL ARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const NEWS_ARTICLES=[
  {cat:'Geopolitics',emoji:'ðŸ—ºï¸',title:'US-China Trade War Escalates: New Tariffs on Tech',summary:'Washington announces sweeping tariffs on Chinese semiconductors and AI chips, prompting Beijing retaliation on rare earth exports.',impact:'â†‘ Gold, â†“ Tech stocks, â†‘ Semiconductor prices globally',body:`<p><strong>The Situation:</strong> The Biden-era tariffs on Chinese semiconductors have been doubled under new executive action, covering AI chips, advanced batteries, and strategic components. This represents the sharpest escalation in US-China tech relations since 2019.</p><h3>What's Actually Happening</h3><p>China controls 90% of rare earth processing globally. In response to the tariffs, Beijing has signaled export restrictions on rare earths â€” the key materials for electric vehicles, wind turbines, and military hardware. This creates a genuine supply crisis risk.</p><h3>Second-Order Effects</h3><p>The implications cascade: <strong>TSMC</strong> faces pressure to accelerate its Arizona fab; <strong>NVIDIA</strong> loses access to one of its largest markets; European companies face higher input costs. The "great decoupling" of technology supply chains is accelerating.</p><h3>What It Means For You</h3><p>Investors should watch semiconductor ETFs (SOXX), rare earth stocks, and US defense contractors. The reshoring trend means US manufacturing stocks may outperform. Cash equivalents and gold serve as hedges against escalation uncertainty.</p>`,date:'Today Â· 14 min read'},
  {cat:'AI & Technology',emoji:'ðŸ¤–',title:'GPT-5 Capabilities Revealed: Approaching AGI Threshold',summary:'OpenAI demonstrates reasoning capabilities exceeding human PhD-level performance across 20+ domains in controlled testing.',impact:'â†‘ AI stocks, disruption of knowledge work industries',body:`<p><strong>The Breakthrough:</strong> Internal benchmarks show GPT-5 achieving 95th percentile human performance on medical licensing exams, bar exams, and advanced physics problems. This represents a qualitative leap, not just quantitative improvement.</p><h3>What Makes This Different</h3><p>Previous models excelled at specific domains. GPT-5 demonstrates <strong>cross-domain reasoning transfer</strong> â€” applying physics principles to solve biology problems, using legal reasoning to address ethical questions. This is the hallmark of general intelligence.</p><h3>Economic Disruption Timeline</h3><p>Research estimates 40% of current knowledge worker tasks will be automatable within 3 years. Most affected: legal research, medical diagnosis support, financial analysis, content creation, customer service. Least affected: hands-on trades, emotional intelligence roles, novel creative work.</p><h3>The Consciousness Question</h3><p>As AI approaches human-level cognition, the philosophical questions deepen: If a system reasons like a human, should it be treated differently? The observer in you â€” the part tracking your consciousness in this app â€” is precisely what AI currently lacks: genuine self-awareness.</p>`,date:'Yesterday Â· 22 min read'},
  {cat:'Neuroscience',emoji:'ðŸ§ ',title:'Scientists Discover New Brain Region Controlling Self-Awareness',summary:'A previously overlooked area of the prefrontal cortex appears to be the neural basis of metacognition â€” thinking about thinking.',impact:'Revolutionary implications for consciousness research and meditation science',body:`<p><strong>The Discovery:</strong> Researchers at MIT and Cambridge have identified the <strong>medial prefrontal zone 7</strong> as a key hub for metacognitive processing â€” the brain's ability to monitor its own activity and generate self-awareness.</p><h3>The Experiment</h3><p>Using high-resolution fMRI, participants were asked to judge their own confidence in decisions. The new region showed dramatically higher activity during these metacognitive moments compared to object-level decisions. Critically, patients with damage to this area lost the ability to accurately assess their own knowledge.</p><h3>Implications for Consciousness Tracking</h3><p>This directly validates the core premise of apps like this one: that training metacognitive awareness â€” your ability to observe your own states â€” is both possible and neurologically grounded. Meditation practitioners show greater gray matter density in this region.</p><h3>Future Applications</h3><p>Targeted neurofeedback, transcranial magnetic stimulation (TMS), and novel therapeutic approaches could enhance metacognitive abilities â€” potentially treating depression, anxiety, and addiction by strengthening the observer's capacity to create distance from negative states.</p>`,date:'2 days ago Â· 18 min read'},
  {cat:'Markets',emoji:'ðŸ“ˆ',title:'Federal Reserve Signals Three Rate Cuts in 2025',summary:'Fed Chair signals easing cycle beginning Q2, with equity markets rallying 2.3% on the news.',impact:'â†‘ Stocks, â†‘ Crypto, â†“ USD, â†“ Bond yields, â†‘ Real estate',body:`<p><strong>The Signal:</strong> The Federal Reserve's latest minutes indicate consensus forming around three 25-basis-point rate cuts scheduled for 2025, beginning in March. This represents a significant policy pivot from the most aggressive hiking cycle in 40 years.</p><h3>Why This Matters</h3><p>Interest rates are the master lever of global capital allocation. When rates fall: borrowing becomes cheaper, stocks become more attractive relative to bonds, risk appetite increases, and speculative assets like crypto surge. The 2020-2021 period â€” of near-zero rates â€” saw Bitcoin 10x and many growth stocks 3-5x.</p><h3>The Investment Playbook</h3><p>Historically, the first 6 months after rate cuts begin are excellent for: <strong>growth stocks</strong> (tech, healthcare, AI), <strong>small caps</strong>, <strong>emerging markets</strong>, <strong>cryptocurrency</strong>, and <strong>real estate</strong>. Treasury bonds and cash equivalents lose relative attractiveness.</p><h3>The Risk</h3><p>Cuts are only justified if inflation has truly been tamed. If inflation resurges (due to Middle East energy shocks or supply chain disruptions), the Fed may halt cuts â€” sending markets down sharply. Watch the monthly CPI reports closely.</p>`,date:'3 days ago Â· 16 min read'},
  {cat:'Longevity',emoji:'ðŸ§¬',title:'First Senolytic Drug Approved: "Zombie Cell" Clearing Therapy',summary:'The FDA fast-tracks approval of the first drug proven to selectively eliminate senescent cells, showing 15% biological age reversal in trials.',impact:'Paradigm shift in aging medicine â€” longevity stocks surge 40%',body:`<p><strong>What Are Senescent Cells?</strong> As you age, some cells stop dividing but refuse to die. These "zombie cells" accumulate, releasing inflammatory signals that damage surrounding tissue â€” driving aging, cancer risk, and organ dysfunction.</p><h3>The Clinical Results</h3><p>Phase 3 trials involving 2,400 patients showed remarkable results: average participants reversed biological age markers by 15%, demonstrated improved cardiovascular function, enhanced cognitive performance, and reduced systemic inflammation markers by 40%. No serious adverse events were reported.</p><h3>What This Means</h3><p>This is the first drug to directly address a <strong>root cause of aging</strong> rather than a symptom. It validates the "aging is a disease" hypothesis championed by researchers like David Sinclair and Aubrey de Grey. If scaling confirms trial results, we may be looking at the first true longevity drug.</p><h3>Access and Timeline</h3><p>The drug will cost approximately $8,000/treatment initially with annual or biannual dosing. Insurance coverage is uncertain. Competing compounds from Unity Biotechnology and other players are in Phase 2. Within 5 years, the field will likely produce multiple options across price points.</p>`,date:'4 days ago Â· 20 min read'},
  {cat:'Space',emoji:'ðŸš€',title:'Mars Colony Blueprint Released: First 1000 Settlers by 2030',summary:'SpaceX releases detailed engineering plans for the first permanent Mars colony, with life support systems designed for 1,000-person settlement.',impact:'â†‘ SpaceX valuation, space economy acceleration, reframe of human potential',body:`<p><strong>The Plan:</strong> SpaceX's newly published Mars Colonial Architecture details a self-sustaining settlement of 1,000 people by 2030, with the goal of reaching 1 million settlers by 2050 â€” making humanity a multi-planetary species.</p><h3>The Engineering</h3><p>The colony relies on: in-situ resource utilization (converting Martian COâ‚‚ and soil water into breathable oxygen and fuel), nuclear power generation, underground habitats for radiation protection, and advanced closed-loop life support systems with 99.97% air and water recycling.</p><h3>The Timeline</h3><p>2026: First crewed mission (6 people, test life support). 2028: First cargo missions with pre-positioned supplies. 2030: First permanent settler missions. The plan requires Starship achieving $100/kg-to-orbit cost â€” currently at $1,000/kg and falling rapidly.</p><h3>The Philosophical Dimension</h3><p>The Mars project forces a rethink of consciousness itself. Settlers will experience Earth time vs Mars time, 26-minute communication delays, and complete psychological isolation. Understanding how human consciousness adapts to radical environmental change will be the deepest psychological experiment in history.</p>`,date:'5 days ago Â· 25 min read'},
];
let currentNewsArticle=null;
function openNewsDetail(idx){
  const art=NEWS_ARTICLES[idx];currentNewsArticle=art;
  document.getElementById('newsDetailCat').textContent=art.emoji+' '+art.cat+' Â· '+art.date;
  document.getElementById('newsDetailTitle').textContent=art.title;
  document.getElementById('newsDetailBody').innerHTML=art.body+`<div style="background:rgba(124,58,237,.08);border-radius:10px;padding:10px;margin-top:14px;font-size:12px;color:var(--text2)"><strong>Market Impact:</strong> ${art.impact}</div>`;
  document.getElementById('newsAIResponse').innerHTML='';
  document.getElementById('newsAskInput').value='';
  document.getElementById('newsDetailOverlay').classList.add('open');
  document.body.style.overflow='hidden';
}
function closeNewsDetail(){document.getElementById('newsDetailOverlay').classList.remove('open');document.body.style.overflow='';}
async function askAboutNews(){
  const q=document.getElementById('newsAskInput').value.trim();if(!q||!currentNewsArticle)return;
  const el=document.getElementById('newsAIResponse');
  el.innerHTML=`<div class="ai-insight-box">ðŸ¤– Analyzing...</div>`;
  const prompt=`Article: "${currentNewsArticle.title}". Content summary: ${currentNewsArticle.summary}. User question: ${q}. Provide a concise, insightful analysis (100-150 words) covering: direct answer, causal implications, what the user should watch or do, and one non-obvious insight.`;
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:300,messages:[{role:'user',content:prompt}]})});
    const data=await resp.json();
    el.innerHTML=`<div class="ai-insight-box"><div style="font-weight:700;margin-bottom:6px">ðŸ¤– AI Analysis</div>${data.content?.[0]?.text||'Analysis unavailable.'}</div>`;
  }catch(e){el.innerHTML=`<div class="ai-insight-box">Unable to connect to AI. Key insight: ${currentNewsArticle.impact}</div>`;}
}
function buildClickableNews(){
  const el=document.getElementById('geoEventsList');
  if(!el)return;
  el.innerHTML=NEWS_ARTICLES.map((a,i)=>`<div class="news-article" onclick="openNewsDetail(${i})"><div class="news-category">${a.emoji} ${a.cat}</div><div class="news-headline">${a.title}</div><div class="news-summary">${a.summary}</div><div class="news-meta"><span>ðŸ“… ${a.date}</span><span style="margin-left:auto;color:var(--primary);font-weight:700">Read full story â†’</span></div><div class="news-impact">Market impact: ${a.impact}</div></div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FEATURE 6 â€” COMPREHENSIVE 18-SECTION STUDY QUESTIONNAIRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STUDY_SECTIONS=[
  {name:'Identity & Academic Context',icon:'ðŸ‘¤',short:'Identity',fields:[
    {type:'select',id:'stAge',label:'Age Group',options:['Under 14','14-17','18-22','23-28','29-35','36-45','45+']},
    {type:'select',id:'stEduLevel',label:'Current Education Level',options:['School (up to Class 8)','High School (9-10)','Pre-University (11-12)','Undergraduate','Postgraduate','PhD','Self-learning/Dropout','Professional course']},
    {type:'text',id:'stField',label:'Field(s) of Study'},
    {type:'select',id:'stInstitution',label:'Institution Type',options:['Government/Public school/college','Private institution','Online only','Coaching institute','Home study','International curriculum']},
    {type:'select',id:'stGPA',label:'Academic Performance (GPA/Grades)',options:['Top 5% (Distinction/A+)','Top 20% (A grade)','Average (B grade)','Below average (C grade)','Struggling (D or below)','Not tracked']},
    {type:'multi',id:'stLang',label:'Language Proficiency',options:['English (strong)','English (medium)','English (weak)','Hindi','Regional language only','Multilingual']},
    {type:'select',id:'stEnv',label:'Study Environment',options:['Own room at home','Shared room at home','Hostel/PG','Library','Commuting/Transit','Shifts between locations']},
    {type:'select',id:'stTimePerDay',label:'Available Study Time Per Day',options:['Less than 1 hour','1-2 hours','2-4 hours','4-6 hours','6-8 hours','More than 8 hours']},
  ]},
  {name:'Cognitive Profile',icon:'ðŸ§ ',short:'Cognition',fields:[
    {type:'rating',id:'stAttention',label:'Attention Span Duration (1=very short, 10=very long)'},
    {type:'select',id:'stFocusType',label:'Focus Type',options:['Deep focused (long uninterrupted blocks)','Scattered (jumps between tasks)','Burst (intense then crashes)','Variable (depends on topic)']},
    {type:'select',id:'stWorkingMem',label:'Working Memory Capacity',options:['Very high (can hold 7+ items)','High (5-7 items)','Average (3-5 items)','Low (1-3 items)','Very low (need to write everything)']},
    {type:'select',id:'stProcSpeed',label:'Processing Speed',options:['Very fast (quick intuitive grasp)','Fast','Average','Slow but thorough','Very slow but deep']},
    {type:'rating',id:'stAbstract',label:'Abstract Reasoning Comfort (1=concrete only, 10=love abstractions)'},
    {type:'select',id:'stThinkMode',label:'Thinking Preference',options:['Strongly verbal (words/language)','Mostly verbal','Mixed','Mostly visual (diagrams/images)','Strongly visual']},
    {type:'rating',id:'stMultitask',label:'Multitasking Ability (1=serial only, 10=parallel master)'},
    {type:'select',id:'stFatigue',label:'Mental Fatigue Threshold',options:['30 minutes or less','30-60 minutes','1-2 hours','2-4 hours','4+ hours (iron endurance)']},
  ]},
  {name:'Learning Style & Input Channels',icon:'ðŸ“–',short:'Learning Style',fields:[
    {type:'multi',id:'stLearningModes',label:'Preferred Learning Modes (select all)',options:['Reading textbooks','Listening to lectures','Visual diagrams/mind maps','Video explanations','Hands-on practice','Teaching others','Discussion/debate','Writing notes']},
    {type:'select',id:'stNoteStyle',label:'Note-Taking Style',options:['Detailed linear notes','Bullet points only','Mind maps/diagrams','Almost no notes (memory-based)','Digital notes','Voice recordings']},
    {type:'select',id:'stConceptVsRote',label:'Learning Preference',options:['Deep conceptual (why/how)','Rote memorization (what)','Mixed approach','Context-dependent']},
    {type:'select',id:'stExampleVsTheory',label:'Entry Point Preference',options:['Examples first, then theory','Theory first, then examples','Interleaved','Story/narrative-based']},
    {type:'select',id:'stSoloVsGroup',label:'Social Learning',options:['Strongly prefer solo','Mostly solo','Mix of both','Mostly group','Strongly prefer group']},
  ]},
  {name:'Motivation & Drive',icon:'ðŸ”¥',short:'Motivation',fields:[
    {type:'rating',id:'stIntrinsic',label:'Intrinsic Interest in Main Subject (1=hate it, 10=passion)'},
    {type:'select',id:'stCareerClarity',label:'Career Clarity',options:['Very clear (know exactly what I want)','Somewhat clear','Vague idea','No idea at all','Exploring multiple paths']},
    {type:'rating',id:'stAmbition',label:'Long-Term Ambition Level (1=just pass, 10=change the world)'},
    {type:'rating',id:'stCompetitive',label:'Competitive Drive (1=not at all, 10=extremely competitive)'},
    {type:'rating',id:'stCuriosity',label:'General Curiosity Level (1=low, 10=insatiably curious)'},
    {type:'select',id:'stDiscipline',label:'Discipline Consistency',options:['Highly consistent (rarely miss targets)','Usually consistent','Moderate (inconsistent weeks)','Poor (big ups and downs)','Very poor (rarely follow through)']},
    {type:'multi',id:'stProcrastTriggers',label:'Procrastination Triggers (select all)',options:['Difficult subject','Boring subject','No clear deadline','Social media','Fatigue','Anxiety/fear of failure','Overwhelm','No study plan']},
  ]},
  {name:'Study Habits & Systems',icon:'â°',short:'Study Systems',fields:[
    {type:'select',id:'stDailyHours',label:'Actual Daily Study Hours (not planned, actual)',options:['Less than 1','1-2','2-3','3-4','4-5','5-6','6-8','8+']},
    {type:'select',id:'stScheduleConsistency',label:'Schedule Consistency',options:['Very consistent (same time daily)','Mostly consistent','Somewhat variable','Very variable','No fixed schedule']},
    {type:'select',id:'stSessionLen',label:'Typical Study Session Length',options:['Less than 20 min','20-40 min','40-60 min','1-2 hours','2+ hours']},
    {type:'select',id:'stBreaks',label:'Break Structure',options:['Strict Pomodoro (25+5)','Natural breaks (as needed)','Rarely take breaks','Too many breaks','No system']},
    {type:'select',id:'stRevision',label:'Revision Frequency',options:['Daily','Every 2-3 days','Weekly','Before exams only','Almost never']},
    {type:'multi',id:'stTechniques',label:'Study Techniques Used',options:['Spaced repetition (Anki etc)','Active recall/self-quizzing','Feynman technique','Interleaving subjects','Practice tests','Past papers','Concept mapping','Summarization']},
  ]},
  {name:'Attention & Distraction Profile',icon:'ðŸ“±',short:'Distraction',fields:[
    {type:'select',id:'stPhoneDistr',label:'Phone Distraction During Study',options:['Never (phone off/away)','Rarely','Sometimes (every 30min)','Often (every 10-15min)','Constant (every few minutes)']},
    {type:'select',id:'stSocialMedia',label:'Daily Social Media Time',options:['Less than 30 min','30 min - 1 hour','1-2 hours','2-4 hours','4+ hours']},
    {type:'select',id:'stNoiseSensitivity',label:'Noise Sensitivity',options:['Need complete silence','Prefer quiet','White noise or music OK','Noisy environments OK','Noise helps me focus']},
    {type:'select',id:'stEnvDistr',label:'Environmental Distraction',options:['Very low (controlled space)','Low','Moderate','High (family/noise/etc)','Very high']},
    {type:'rating',id:'stInternalDistr',label:'Internal Distraction (mind-wandering, 1=rarely, 10=constantly)'},
    {type:'select',id:'stDeepWork',label:'Maximum Deep Work Duration',options:['Under 15 min','15-30 min','30-60 min','1-2 hours','2-4 hours','4+ hours']},
  ]},
  {name:'Memory Performance',icon:'ðŸ’¾',short:'Memory',fields:[
    {type:'rating',id:'stSTMem',label:'Short-Term Retention (1=forget in minutes, 10=perfect recall)'},
    {type:'rating',id:'stLTMem',label:'Long-Term Retention (1=forget after weeks, 10=never forget)'},
    {type:'select',id:'stRecallType',label:'Memory Strength',options:['Recall (retrieve without cues)','Recognition (identify when shown)','Both strong','Both weak']},
    {type:'select',id:'stForgetting',label:'Forgetting Speed',options:['Very fast (within hours)','Fast (1-2 days)','Average (few days to week)','Slow (weeks)','Very slow (months)']},
    {type:'multi',id:'stMemMethods',label:'Memorization Methods Used',options:['Repetition','Mnemonics','Story method','Method of loci','Visualization','Association','Rhymes/songs','Chunking']},
  ]},
  {name:'Subject-Specific Strengths',icon:'ðŸ“š',short:'Subjects',fields:[
    {type:'multi',id:'stStrongSubjects',label:'Strong Subjects (you excel here)',options:['Mathematics','Physics','Chemistry','Biology','History','Geography','Economics','Computer Science','Literature/Language','Social Studies','Psychology','Statistics']},
    {type:'multi',id:'stWeakSubjects',label:'Weak/Difficult Subjects',options:['Mathematics','Physics','Chemistry','Biology','History','Geography','Economics','Computer Science','Literature/Language','Social Studies','Psychology','Statistics']},
    {type:'select',id:'stProblemSolving',label:'Problem-Solving Ability',options:['Excellent (love novel problems)','Good (most problems solvable)','Average (standard problems OK)','Weak (need worked examples)','Very weak (struggle with any application)']},
    {type:'select',id:'stExamVsPractice',label:'Exam vs Practice Performance',options:['Better in exams than practice','Similar','Worse in exams (anxiety)','Much worse (freeze up)']},
  ]},
  {name:'Weakness & Difficulty Mapping',icon:'ðŸŽ¯',short:'Weaknesses',fields:[
    {type:'multi',id:'stWeaknessType',label:'Types of Difficulties',options:['Conceptual gaps (don\'t understand WHY)','Skill gaps (can\'t apply knowledge)','Foundational gaps (missing basics)','Language/terminology barriers','Math/logic difficulty','Reading comprehension','Speed issues','Memorization difficulty']},
    {type:'textarea',id:'stConceptGaps',label:'Biggest Conceptual Gaps (describe briefly)'},
    {type:'select',id:'stMathDifficulty',label:'Math/Logic Difficulty Level',options:['No difficulty','Mild difficulty','Moderate difficulty','Significant difficulty','Severe difficulty']},
  ]},
  {name:'Exam & Performance Psychology',icon:'ðŸ†',short:'Exam Psychology',fields:[
    {type:'rating',id:'stTestAnxiety',label:'Test Anxiety Level (1=none, 10=severe)'},
    {type:'select',id:'stTimePressure',label:'Time Pressure Handling',options:['Excellent (always finish early)','Good','Average','Poor (often run out of time)','Very poor (panic under time pressure)']},
    {type:'rating',id:'stSillyMistakes',label:'Silly Mistakes Frequency (1=rare, 10=very frequent)'},
    {type:'rating',id:'stOverthinking',label:'Overthinking in Exams (1=never, 10=always)'},
    {type:'select',id:'stBlankOuts',label:'Blank-Out Episodes',options:['Never','Rarely','Sometimes','Often','Almost always in high-stakes situations']},
    {type:'rating',id:'stExamConfidence',label:'Overall Exam Confidence (1=very low, 10=very high)'},
  ]},
  {name:'Metacognition (Learning Awareness)',icon:'ðŸ”',short:'Metacognition',fields:[
    {type:'rating',id:'stSelfAwareness',label:'Awareness of Your Own Strengths (1=low, 10=high)'},
    {type:'rating',id:'stWeaknessAwareness',label:'Awareness of Your Own Weaknesses (1=low, 10=high)'},
    {type:'select',id:'stStrategyAdjust',label:'Strategy Adjustment Ability',options:['Very adaptive (constantly optimizing)','Adaptive','Somewhat adaptive','Not very adaptive','Rigid (stick to one method)']},
    {type:'select',id:'stErrorAnalysis',label:'Error Analysis Habit',options:['Always analyze mistakes','Usually analyze','Sometimes','Rarely','Never â€” just move on']},
    {type:'select',id:'stReflection',label:'Post-Test Reflection',options:['Detailed analysis of every error','Brief review','Only check marks','Never review']},
  ]},
  {name:'Cognitive Energy & Health',icon:'âš¡',short:'Health & Energy',fields:[
    {type:'select',id:'stSleepQuality',label:'Sleep Quality During Study Periods',options:['Excellent (7-9h, restful)','Good (6-7h)','Fair (5-6h or disrupted)','Poor (less than 5h)','Very poor (irregular/disturbed)']},
    {type:'select',id:'stStudyEnergy',label:'Energy Level During Typical Study Session',options:['High throughout','Good for first half','Crashes after 1 hour','Always low','Highly variable']},
    {type:'rating',id:'stBrainFog',label:'Brain Fog Frequency (1=rarely, 10=daily)'},
    {type:'select',id:'stNutrition',label:'Nutrition During Study',options:['Excellent (balanced, regular)','Good','Average','Poor (junk/irregular)','Very poor']},
    {type:'select',id:'stExercise',label:'Exercise Frequency',options:['Daily','4-6 days/week','2-3 days/week','Rarely (1x/week)','Sedentary (none)']},
  ]},
  {name:'Learning Environment & Resources',icon:'ðŸŒ',short:'Environment',fields:[
    {type:'select',id:'stSpaceQuality',label:'Study Space Quality',options:['Dedicated quiet room','Good but shared','Acceptable but noisy','Poor (distracting)','No fixed study space']},
    {type:'select',id:'stInternet',label:'Internet Access',options:['High-speed, unlimited','Good, mostly reliable','Moderate (occasional issues)','Limited (data constraints)','Poor/unavailable']},
    {type:'select',id:'stResources',label:'Books & Study Resources',options:['Excellent (all books + digital)','Good','Average','Limited','Very limited']},
    {type:'select',id:'stCoaching',label:'Coaching/Tutoring Available',options:['Premium coaching (top teachers)','Good coaching','Basic coaching/tuition','Online only','Self-study only']},
    {type:'select',id:'stPeerGroup',label:'Peer Group Quality',options:['High achievers (push you up)','Mixed group','Low energy peers','Mostly non-academic friends','Isolated (no study peers)']},
  ]},
  {name:'Skill Stack Beyond Academics',icon:'ðŸ› ï¸',short:'Skills',fields:[
    {type:'rating',id:'stWriting',label:'Writing Ability (1=weak, 10=excellent)'},
    {type:'rating',id:'stCommunication',label:'Communication/Presentation (1=weak, 10=excellent)'},
    {type:'rating',id:'stCriticalThinking',label:'Critical Thinking (1=weak, 10=excellent)'},
    {type:'rating',id:'stCreativity',label:'Creative Problem-Solving (1=weak, 10=excellent)'},
    {type:'multi',id:'stDigitalSkills',label:'Digital Skills',options:['Basic computer use','Coding (any language)','Data analysis','Graphic design','Video editing','Spreadsheets/Excel','Research skills','AI tool usage']},
  ]},
  {name:'Study Strategy & Techniques',icon:'âš™ï¸',short:'Techniques',fields:[
    {type:'multi',id:'stCurrentTech',label:'Techniques Currently Using',options:['Flashcards (physical)','Spaced repetition app (Anki)','Mind maps','Feynman technique','Interleaving','Retrieval practice','Pomodoro','Deep work blocks','Cornell notes','Summarization after reading']},
    {type:'multi',id:'stTriedTech',label:'Techniques You\'ve Tried But Struggled With',options:['Spaced repetition','Active recall','Feynman technique','Mind maps','Pomodoro','Deep focus blocks']},
    {type:'select',id:'stStudyPlan',label:'Do You Use a Written Study Plan?',options:['Yes, detailed daily plan','Yes, weekly plan','Rough mental plan only','No plan at all']},
  ]},
  {name:'Learning Goals & Direction',icon:'ðŸŽ¯',short:'Goals',fields:[
    {type:'text',id:'stTargetExam',label:'Target Exam(s) (e.g., JEE, NEET, UPSC, SAT, IELTS)'},
    {type:'text',id:'stTargetCareer',label:'Dream Career or Field'},
    {type:'text',id:'stTargetInstitution',label:'Target Institution(s)'},
    {type:'select',id:'stTimeline',label:'Timeline to Goal',options:['Less than 6 months','6-12 months','1-2 years','2-5 years','5+ years','Ongoing/lifelong']},
    {type:'select',id:'stRankGoal',label:'Score/Rank Goal',options:['Top 0.1% (highest possible)','Top 1%','Top 10%','Top 25%','Pass/qualify','Specific score target']},
  ]},
  {name:'Constraints & Barriers',icon:'ðŸš§',short:'Barriers',fields:[
    {type:'multi',id:'stBarriers',label:'Current Barriers (select all that apply)',options:['Limited time (family/work responsibilities)','Financial constraints','Poor internet/resources','Language barrier (not in first language)','Mental health challenges','Physical health issues','No mentor/guidance','Poor study environment','Lack of motivation','Burnout/exhaustion','Unclear career direction','Social pressure/distractions']},
    {type:'select',id:'stFinancial',label:'Financial Constraint Level',options:['No constraint','Minor','Moderate (some limitations)','Significant','Severe (cannot afford resources)']},
    {type:'select',id:'stMentalHealth',label:'Current Mental/Emotional State',options:['Excellent (motivated, stable)','Good','Fair (stressed but managing)','Poor (struggling significantly)','Crisis (need support)']},
  ]},
  {name:'Growth & Optimization Potential',icon:'ðŸš€',short:'Growth Potential',fields:[
    {type:'rating',id:'stOpenness',label:'Openness to Changing Study Methods (1=resistant, 10=very open)'},
    {type:'rating',id:'stEffortTolerance',label:'Effort Tolerance (1=avoid hard work, 10=love hard work)'},
    {type:'rating',id:'stConsistency',label:'Long-Term Consistency Capacity (1=can\'t sustain, 10=iron will)'},
    {type:'select',id:'stCoachingReceptivity',label:'Receptivity to Coaching/Feedback',options:['Very receptive (implement immediately)','Receptive','Somewhat receptive','Resistant to feedback','Very resistant']},
    {type:'textarea',id:'stAnythingElse',label:'Anything else about your learning situation? (optional)'},
  ]},
];
let studyCurrent=0;
function buildStudySections(){
  const jumpBar=document.getElementById('studyJumpBar');
  const container=document.getElementById('studySectionsContainer');
  if(!jumpBar||!container)return;
  jumpBar.innerHTML=STUDY_SECTIONS.map((s,i)=>`<button class="study-jump${i===0?' active':''}" onclick="jumpStudy(${i})" title="${s.name}">${s.icon} ${i+1}</button>`).join('');
  container.innerHTML=STUDY_SECTIONS.map((s,i)=>`<div class="study-section card${i===0?' active':''}" id="studySec_${i}"><div class="card-title"><span class="emoji">${s.icon}</span> ${s.name}</div>${buildStudyFields(s.fields)}</div>`).join('');
}
function buildStudyFields(fields){
  return fields.map(f=>{
    if(f.type==='rating')return`<div class="form-group"><label class="form-label">${f.label}</label><div class="study-rating" id="${f.id}_rating">${[1,2,3,4,5,6,7,8,9,10].map(n=>`<button class="study-rating-btn" onclick="setStudyRating('${f.id}',${n},this)">${n}</button>`).join('')}</div><input type="hidden" id="${f.id}" value="5"></div>`;
    if(f.type==='multi')return`<div class="form-group"><label class="form-label">${f.label}</label><div style="display:flex;flex-wrap:wrap;gap:6px">${f.options.map(o=>`<label style="display:flex;align-items:center;gap:4px;font-size:12px;cursor:pointer;background:var(--bg);border:1px solid var(--border);padding:4px 8px;border-radius:8px;transition:all .2s"><input type="checkbox" name="${f.id}" value="${o}" onchange="this.parentElement.style.borderColor=this.checked?'var(--primary)':'var(--border)';this.parentElement.style.background=this.checked?'rgba(124,58,237,.08)':'var(--bg)'"> ${o}</label>`).join('')}</div></div>`;
    if(f.type==='textarea')return`<div class="form-group"><label class="form-label">${f.label}</label><textarea class="form-textarea" id="${f.id}" style="min-height:70px"></textarea></div>`;
    if(f.type==='select')return`<div class="form-group"><label class="form-label">${f.label}</label><select class="form-select" id="${f.id}">${f.options.map(o=>`<option>${o}</option>`).join('')}</select></div>`;
    return`<div class="form-group"><label class="form-label">${f.label}</label><input type="text" class="form-input" id="${f.id}" placeholder="Type here..."></div>`;
  }).join('');
}
function setStudyRating(id,val,btn){
  document.getElementById(id).value=val;
  const btns=document.querySelectorAll(`#${id}_rating .study-rating-btn`);
  btns.forEach((b,i)=>b.classList.toggle('active',i<val));
}
function jumpStudy(i){
  document.querySelectorAll('.study-section').forEach((s,j)=>s.classList.toggle('active',j===i));
  document.querySelectorAll('.study-jump').forEach((b,j)=>b.classList.toggle('active',j===i));
  studyCurrent=i;updateStudyNav();window.scrollTo(0,0);
}
function updateStudyNav(){
  const tot=STUDY_SECTIONS.length;
  document.getElementById('studySectionNum').textContent=studyCurrent+1;
  document.getElementById('studySectionName').textContent=STUDY_SECTIONS[studyCurrent].name;
  document.getElementById('studyProgressBar').style.width=((studyCurrent+1)/tot*100).toFixed(0)+'%';
  document.getElementById('studyPrevBtn').style.display=studyCurrent>0?'':'none';
  document.getElementById('studyNextBtn').textContent=studyCurrent===tot-1?'ðŸ¤– Generate My Study Blueprint â†’':'Next â†’';
}
function studyNext(){if(studyCurrent<STUDY_SECTIONS.length-1){jumpStudy(studyCurrent+1);}else{generateStudyAI();}}
function studyPrev(){if(studyCurrent>0)jumpStudy(studyCurrent-1);}
async function generateStudyAI(){
  const el=document.getElementById('studyResultContainer');
  el.innerHTML=`<div class="card study-result"><div style="text-align:center;padding:20px"><div style="font-size:40px">ðŸ¤–</div><div style="font-size:16px;font-weight:700;margin-top:10px">AI is analyzing your complete cognitive profile...</div><div style="font-size:13px;color:var(--text3);margin-top:6px">Building personalized 18-dimension blueprint</div></div></div>`;
  el.scrollIntoView({behavior:'smooth'});
  const profile=collectStudyProfile();
  const prompt=buildStudyPrompt(profile);
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1500,messages:[{role:'user',content:prompt}]})});
    const data=await resp.json();
    const text=data.content?.[0]?.text||'';
    displayStudyResult(text,profile);
  }catch(e){displayStudyResult(buildLocalStudyResult(profile),profile);}
}
function collectStudyProfile(){
  const get=id=>{try{const el=document.getElementById(id);return el?el.value:'';}catch(e){return '';}};
  const getChecked=name=>Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(i=>i.value);
  return{
    age:get('stAge'),eduLevel:get('stEduLevel'),field:get('stField'),institution:get('stInstitution'),
    gpa:get('stGPA'),env:get('stEnv'),timePerDay:get('stTimePerDay'),
    attention:get('stAttention'),focusType:get('stFocusType'),workingMem:get('stWorkingMem'),
    procSpeed:get('stProcSpeed'),abstract:get('stAbstract'),thinkMode:get('stThinkMode'),fatigue:get('stFatigue'),
    learningModes:getChecked('stLearningModes'),noteStyle:get('stNoteStyle'),conceptVsRote:get('stConceptVsRote'),
    exampleVsTheory:get('stExampleVsTheory'),soloVsGroup:get('stSoloVsGroup'),
    intrinsic:get('stIntrinsic'),careerClarity:get('stCareerClarity'),ambition:get('stAmbition'),
    competitive:get('stCompetitive'),curiosity:get('stCuriosity'),discipline:get('stDiscipline'),
    procrastTriggers:getChecked('stProcrastTriggers'),
    dailyHours:get('stDailyHours'),sessionLen:get('stSessionLen'),breaks:get('stBreaks'),
    techniques:getChecked('stTechniques'),
    phoneDistr:get('stPhoneDistr'),socialMedia:get('stSocialMedia'),deepWork:get('stDeepWork'),
    stMemMethods:getChecked('stMemMethods'),
    strongSubjects:getChecked('stStrongSubjects'),weakSubjects:getChecked('stWeakSubjects'),
    problemSolving:get('stProblemSolving'),examVsPractice:get('stExamVsPractice'),
    weaknessType:getChecked('stWeaknessType'),mathDifficulty:get('stMathDifficulty'),
    testAnxiety:get('stTestAnxiety'),timePressure:get('stTimePressure'),examConfidence:get('stExamConfidence'),
    selfAwareness:get('stSelfAwareness'),strategyAdjust:get('stStrategyAdjust'),errorAnalysis:get('stErrorAnalysis'),
    sleepQuality:get('stSleepQuality'),studyEnergy:get('stStudyEnergy'),brainFog:get('stBrainFog'),exercise:get('stExercise'),
    spaceQuality:get('stSpaceQuality'),internet:get('stInternet'),coaching:get('stCoaching'),peerGroup:get('stPeerGroup'),
    writing:get('stWriting'),criticalThinking:get('stCriticalThinking'),creativity:get('stCreativity'),
    currentTech:getChecked('stCurrentTech'),
    targetExam:get('stTargetExam'),targetCareer:get('stTargetCareer'),targetInstitution:get('stTargetInstitution'),
    timeline:get('stTimeline'),rankGoal:get('stRankGoal'),
    barriers:getChecked('stBarriers'),mentalHealth:get('stMentalHealth'),
    openness:get('stOpenness'),effortTolerance:get('stEffortTolerance'),consistency:get('stConsistency'),
    anythingElse:get('stAnythingElse'),
  };
}
function buildStudyPrompt(p){
  return`You are a world-class cognitive scientist and educational strategist. Analyze this student's complete 18-dimension profile and generate a highly personalized study blueprint.

STUDENT PROFILE:
- Age: ${p.age}, Level: ${p.eduLevel}, Field: ${p.field||'not specified'}
- Academic performance: ${p.gpa}, Time available: ${p.timePerDay}/day
- Focus type: ${p.focusType}, Attention span: ${p.attention}/10, Deep work capacity: ${p.deepWork}
- Working memory: ${p.workingMem}, Processing speed: ${p.procSpeed}
- Learning modes: ${p.learningModes.join(', ')||'not specified'}
- Intrinsic motivation: ${p.intrinsic}/10, Ambition: ${p.ambition}/10, Discipline: ${p.discipline}
- Daily study hours: ${p.dailyHours}, Session length: ${p.sessionLen}
- Phone distraction: ${p.phoneDistr}, Social media: ${p.socialMedia}
- Sleep quality: ${p.sleepQuality}, Exercise: ${p.exercise}, Brain fog: ${p.brainFog}/10
- Strong subjects: ${p.strongSubjects.join(', ')||'none specified'}
- Weak subjects: ${p.weakSubjects.join(', ')||'none specified'}
- Weakness types: ${p.weaknessType.join(', ')||'none'}
- Test anxiety: ${p.testAnxiety}/10, Exam confidence: ${p.examConfidence}/10
- Techniques used: ${p.currentTech.join(', ')||'basic'}
- Target exam: ${p.targetExam||'not specified'}, Career: ${p.targetCareer||'not specified'}
- Timeline: ${p.timeline}, Rank goal: ${p.rankGoal}
- Barriers: ${p.barriers.join(', ')||'none specified'}
- Mental health: ${p.mentalHealth}, Openness to change: ${p.openness}/10
- Peer group: ${p.peerGroup}, Coaching: ${p.coaching}
${p.anythingElse?'Additional context: '+p.anythingElse:''}

Generate a comprehensive, actionable study blueprint with these exact sections:
1. **COGNITIVE PORTRAIT** (2-3 sentences describing this learner's brain profile)
2. **OPTIMAL STUDY ARCHITECTURE** (ideal session structure, timing, duration based on their profile)
3. **TOP 3 PRIORITY TECHNIQUES** (most impactful methods for their specific profile, with why)
4. **WEAK SUBJECT REPAIR PLAN** (concrete steps to address their weakest areas)
5. **DISTRACTION & FOCUS PROTOCOL** (specific strategies for their distraction pattern)
6. **EXAM PSYCHOLOGY FIX** (address anxiety/confidence/blank-outs based on their scores)
7. **DAILY SCHEDULE TEMPLATE** (hour-by-hour optimal structure based on available time)
8. **30-DAY ACCELERATION PLAN** (what to do first, second, third to see fastest improvement)
9. **CAREER & EXAM PATH** (analysis of target and what it realistically requires)
10. **SECRET ADVANTAGE** (one unique leverage point in their profile they should maximize)

Be specific, evidence-based, and direct. No generic advice â€” every recommendation must reference specific elements of their profile.`;
}
function displayStudyResult(text,profile){
  const el=document.getElementById('studyResultContainer');
  // Format the AI response nicely
  const formatted=text.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>').replace(/(\d+\. \*\*[^*]+\*\*)/g,'<h3>$1</h3>');
  el.innerHTML=`<div class="study-result"><h2>ðŸŽ“ Your Personalized Study Blueprint</h2><div style="font-size:11px;color:var(--text3);margin-bottom:16px;padding:8px;background:rgba(0,0,0,.05);border-radius:8px">Based on ${Object.keys(profile).length} data points across 18 cognitive dimensions</div><div class="study-detail"><p>${formatted}</p></div><div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(124,58,237,.2)"><button class="btn btn-secondary btn-sm" onclick="jumpStudy(0)">ðŸ”„ Redo Assessment</button></div></div>`;
  el.scrollIntoView({behavior:'smooth'});
}
function buildLocalStudyResult(p){
  const hrs=parseInt(p.dailyHours)||3;const focus=parseInt(p.attention)||5;const motivation=parseInt(p.intrinsic)||5;
  const techniques=p.currentTech.length?'You are using: '+p.currentTech.join(', '):' You are not yet using evidence-based techniques';
  const topWeakness=p.weakSubjects.length?p.weakSubjects[0]:'your weakest subject';
  return`**COGNITIVE PORTRAIT:** ${focus>6?'You have strong attentional capacity':'Your attention is fragmented but trainable'} with ${motivation>6?'high intrinsic motivation â€” a genuine asset':'motivation that needs external scaffolding temporarily'}. Your ${p.focusType||'focus style'} combined with ${p.discipline} discipline creates a specific optimization path.

**OPTIMAL STUDY ARCHITECTURE:** Given ${hrs} hours/day and ${p.sessionLen||'your session length'}, structure sessions as: 25-min deep blocks with 5-min breaks (Pomodoro). Start each session with your hardest subject when cognitive energy peaks. ${p.sleepQuality?.includes('Poor')||p.sleepQuality?.includes('Very poor')?'âš ï¸ PRIORITY: Fix sleep first â€” no technique will work on an under-rested brain.':'Sleep quality looks manageable â€” protect it.'}

**TOP 3 TECHNIQUES FOR YOUR PROFILE:** 1. **Active Recall** â€” quiz yourself immediately after reading instead of re-reading (improves retention 50-80%). 2. **Spaced Repetition** â€” use Anki to review ${topWeakness} flashcards daily. 3. **Feynman Technique** â€” explain every concept in simple words; gaps reveal themselves immediately.

**DISTRACTION PROTOCOL:** ${p.phoneDistr?.includes('Constant')||p.phoneDistr?.includes('Often')?'CRITICAL: Phone is your #1 enemy. Use app blockers (Freedom, Cold Turkey). Phone goes in another room during study blocks.':'Your phone distraction is manageable. Create phone-free 90-min blocks.'} ${p.socialMedia?.includes('4+')?' Social media is consuming 4+ hours/day â€” this is the single biggest ROI fix available to you.':''}

**30-DAY PLAN:** Week 1: Fix environment + install spaced repetition system. Week 2: Begin active recall on all new content. Week 3: Add past paper practice. Week 4: Full mock test under exam conditions. Every week: track what works, drop what doesn't.

**CAREER PATH:** ${p.targetCareer?'Target career "'+p.targetCareer+'" requires: strong analytical foundation, sustained learning capacity, and real-world application experience. Focus on building depth in your strongest subjects while closing gaps in weak areas.':'Define your career target clearly â€” ambiguity is the enemy of focused preparation.'}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT NEW FEATURES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initNewFeatures(){
  buildWorldPanel();
  buildThemeGrid();
  buildLegalItems();
  buildFeatureGuide();
  buildScienceDisplay();
  updateTelemetry();
  buildStudySections();
  buildClickableNews();
  // Track all clicks for passive telemetry
  document.addEventListener('click',trackInteraction,{passive:true});
  // Sync sys dark toggle
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  const sysToggle=document.getElementById('sys-darkToggle');
  if(sysToggle)sysToggle.classList.toggle('on',isDark);
  // Sync sys lang sel
  try{document.getElementById('sysLangSel').value=curLang||'en';}catch(e){}
  // Init study nav
  try{updateStudyNav();}catch(e){}
  // Apply language to existing UI immediately
  if(curLang&&curLang!=='en')applyFullTranslation(curLang);
  // Add touch drag support to topbar actions
  enableTopbarSwipe();
  // NEW FEATURES INIT
  initPassiveSensing();
  restoreAccount();
  buildGuideNavMap();
  try{computeLucidProbability();}catch(e){}
  try{computeDiversity();}catch(e){}
  updateScienceTimestamp();
  // Restore adaptive mode
  if(localStorage.getItem('cos_adaptive')==='1'){
    adaptiveModeOn=true;
    const at=document.getElementById('adaptiveToggle');if(at)at.classList.add('on');
    const as2=document.getElementById('adaptiveStatus');if(as2)as2.textContent='ON â€” Monitoring';
  }
}
function enableTopbarSwipe(){
  const el=document.getElementById('topbarActions');if(!el)return;
  // Add visual hint for swipeable bar
  let startX=0,startScroll=0,isDragging=false;
  el.addEventListener('mousedown',e=>{isDragging=true;startX=e.clientX;startScroll=el.scrollLeft;el.style.cursor='grabbing';});
  document.addEventListener('mousemove',e=>{if(!isDragging)return;el.scrollLeft=startScroll-(e.clientX-startX);});
  document.addEventListener('mouseup',()=>{isDragging=false;if(el)el.style.cursor='';});
  // Touch is handled natively by -webkit-overflow-scrolling:touch
  // Add subtle scroll indicator
  el.addEventListener('scroll',()=>{
    const atEnd=el.scrollLeft+el.clientWidth>=el.scrollWidth-10;
    el.style.WebkitMaskImage=atEnd?'none':'linear-gradient(to right,black 80%,transparent 100%)';
    el.style.maskImage=atEnd?'none':'linear-gradient(to right,black 80%,transparent 100%)';
  },{passive:true});
  // Initial mask to hint scrollability
  setTimeout(()=>{
    if(el.scrollWidth>el.clientWidth){
      el.style.WebkitMaskImage='linear-gradient(to right,black 80%,transparent 100%)';
      el.style.maskImage='linear-gradient(to right,black 80%,transparent 100%)';
    }
  },300);
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NEW FEATURES â€” WAVES 1-6, PHONE AUTH, GUIDE, SCIENCE, AI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ PHONE AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let phoneOtpCode='';
function sendPhoneOTP(){
  const country=document.getElementById('phoneCountry').value;
  const num=document.getElementById('phoneNumber').value.trim();
  if(!num||num.length<7){showToast('Enter a valid phone number');return;}
  phoneOtpCode=String(Math.floor(100000+Math.random()*900000));
  const full=country+num;
  document.getElementById('phoneSentTo').textContent=full;
  document.getElementById('phoneStep1').style.display='none';
  document.getElementById('phoneStep2').style.display='';
  // Clear OTP boxes
  document.querySelectorAll('#otpBoxes input').forEach(i=>i.value='');
  document.querySelectorAll('#otpBoxes input')[0].focus();
  showToast('ðŸ“² Code sent! (Demo: '+phoneOtpCode+')');
  // Store phone for account
  localStorage.setItem('cos_pending_phone',full);
}
function otpBoxNext(el,idx){
  if(el.value.length>=1&&idx<6){
    const boxes=document.querySelectorAll('#otpBoxes input');
    if(boxes[idx])boxes[idx].focus();
  }
}
function verifyPhoneOTP(){
  const entered=Array.from(document.querySelectorAll('#otpBoxes input')).map(i=>i.value).join('');
  if(entered===phoneOtpCode){
    const phone=localStorage.getItem('cos_pending_phone')||'User';
    const user={phone,name:phone,ts:Date.now(),method:'phone'};
    localStorage.setItem('cos_user',JSON.stringify(user));
    document.getElementById('phoneStep1').style.display='';
    document.getElementById('phoneStep2').style.display='none';
    updateAccountUI();
    showToast('âœ… Signed in successfully!');
  } else {
    showToast('âŒ Wrong code. Try again.');
  }
}
function updateAccountUI(){
  const user=JSON.parse(localStorage.getItem('cos_user')||'null');
  const loggedOut=document.getElementById('accountLoggedOut');
  const loggedIn=document.getElementById('accountLoggedIn');
  const status=document.getElementById('accountStatus');
  if(!loggedIn)return;
  if(user){
    if(loggedOut)loggedOut.style.display='none';
    loggedIn.style.display='';
    document.getElementById('accountName').textContent=user.name||user.phone||'User';
    document.getElementById('accountPhone').textContent=(user.method==='phone'?'ðŸ“± ':'ðŸ”µ ')+(user.phone||user.email||'');
    document.getElementById('accountAvatar').textContent=user.method==='phone'?'ðŸ“±':user.method==='google'?'ðŸ”µ':'ðŸ§ ';
    if(status)status.textContent='âœ… Signed in Â· Data synced';
    // Stats
    const logs=getLogs();const dreams=getDreams();
    if(document.getElementById('acctLogCount'))document.getElementById('acctLogCount').textContent=logs.length;
    if(document.getElementById('acctDreamCount'))document.getElementById('acctDreamCount').textContent=dreams.length;
    // Days = unique log dates
    const days=new Set(logs.map(l=>l.date)).size;
    if(document.getElementById('acctDaysCount'))document.getElementById('acctDaysCount').textContent=days;
  } else {
    if(loggedOut)loggedOut.style.display='';
    loggedIn.style.display='none';
    if(status)status.textContent='Currently in local mode Â· Data stays on your device';
  }
}
function signOut(){
  if(confirm('Sign out? Your local data stays on this device.')){
    localStorage.removeItem('cos_user');
    updateAccountUI();
    showToast('ðŸ‘‹ Signed out');
  }
}

// â”€â”€â”€ GUIDE NAV MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildGuideNavMap(){
  const el=document.getElementById('guideNavMap');if(!el)return;
  const items=[
    {icon:'ðŸ“',name:'Daily Log',tab:'log',desc:'20-metric mind tracker'},
    {icon:'ðŸŽµ',name:'Brainwave Audio',tab:'waves',desc:'State-shifting frequencies'},
    {icon:'ðŸ¤–',name:'AI Hub',tab:'ai',desc:'Multi-AI consciousness coach'},
    {icon:'ðŸ“Š',name:'Analysis',tab:'analysis',desc:'Patterns & predictions'},
    {icon:'â¤ï¸',name:'Health',tab:'health',desc:'18-section body profile'},
    {icon:'ðŸŽ®',name:'Brain Games',tab:'games',desc:'Cognitive training'},
    {icon:'ðŸŒ™',name:'Dreams Lab',tab:'dreams',desc:'Lucid dreaming system'},
    {icon:'ðŸŒ',name:'World Intel',tab:'world',desc:'Geopolitics & markets'},
    {icon:'ðŸ”¬',name:'Science Feed',tab:'science',desc:'Frontier discoveries'},
    {icon:'ðŸ›¤ï¸',name:'Study/Career',tab:'path',desc:'AI learning coach'},
    {icon:'ðŸ§©',name:'System',tab:'system',desc:'Themes, account, settings'},
  ];
  el.innerHTML=items.map(i=>`<div onclick="switchTab('${i.tab}')" style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:10px;cursor:pointer;transition:all .2s" onmouseenter="this.style.borderColor='var(--primary)'" onmouseleave="this.style.borderColor='var(--border)'"><div style="font-size:20px;margin-bottom:4px">${i.icon}</div><div style="font-weight:700;font-size:12px">${i.name}</div><div style="font-size:10px;color:var(--text3)">${i.desc}</div></div>`).join('');
}

// â”€â”€â”€ WAVE 1 â€” PASSIVE COGNITION LAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let passiveData={
  typingEvents:[],lastInteraction:Date.now(),sessionStart:Date.now(),
  idleGaps:[],switchCount:0,lastActivity:'',responseLatencies:[],
  engagement:5,fatigue:3,cognitiveIntensity:5
};
function initPassiveSensing(){
  // Typing speed tracker
  document.addEventListener('keydown',e=>{
    if(e.target.matches('input,textarea')){
      const now=Date.now();
      if(passiveData.typingEvents.length>0){
        const gap=now-passiveData.typingEvents[passiveData.typingEvents.length-1];
        if(gap>2000)passiveData.idleGaps.push(gap);// idle mid-typing
      }
      passiveData.typingEvents.push(now);
      if(passiveData.typingEvents.length>50)passiveData.typingEvents.shift();
    }
    passiveData.lastInteraction=Date.now();
  },{passive:true});
  // Interaction latency
  document.addEventListener('click',e=>{
    const lat=Date.now()-passiveData.lastInteraction;
    passiveData.responseLatencies.push(lat);
    if(passiveData.responseLatencies.length>20)passiveData.responseLatencies.shift();
    passiveData.lastInteraction=Date.now();
  },{passive:true});
  // Update passive score every 30s
  setInterval(computePassiveCognition,30000);
  computePassiveCognition();
}
function computePassiveCognition(){
  const now=Date.now();
  const sessionMins=(now-passiveData.sessionStart)/60000;
  // Typing speed (events per minute in last 30s)
  const recentTyping=passiveData.typingEvents.filter(t=>now-t<30000).length;
  const typingRate=recentTyping*2; // per min
  // Idle detection
  const idleTime=(now-passiveData.lastInteraction)/1000;
  // Response latency (lower = more engaged)
  const avgLat=passiveData.responseLatencies.length?passiveData.responseLatencies.reduce((a,b)=>a+b,0)/passiveData.responseLatencies.length:2000;
  // Compute scores (0-10)
  let engagement=5;
  if(typingRate>20)engagement+=2;
  else if(typingRate<5)engagement-=1;
  if(idleTime>120)engagement-=2;
  else if(idleTime<10)engagement+=1;
  if(avgLat<500)engagement+=1;
  else if(avgLat>3000)engagement-=1;
  engagement=Math.max(0,Math.min(10,engagement));
  // Fatigue increases with session length
  let fatigue=Math.min(10,sessionMins/15);
  if(idleTime>300)fatigue+=1;
  fatigue=Math.max(0,Math.min(10,fatigue));
  // Cognitive intensity
  let cogInt=(engagement*0.6)+(10-fatigue)*0.4;
  cogInt=Math.max(0,Math.min(10,cogInt));
  passiveData.engagement=engagement;
  passiveData.fatigue=fatigue;
  passiveData.cognitiveIntensity=cogInt;
  // Update telemetry UI if visible
  updateTelemetry();
  // Update immersive overlay if open
  const ic=document.getElementById('immersiveCognScore');
  if(ic)ic.textContent='Passive Cognition: '+cogInt.toFixed(1);
  // Adaptive audio if enabled
  if(localStorage.getItem('cos_adaptive')==='1')runAdaptiveAudio(cogInt,fatigue);
  return cogInt;
}
function getPassiveCognitionScore(){return passiveData.cognitiveIntensity;}

// â”€â”€â”€ WAVE 2 â€” STATE TRANSITION ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runStateEngine(){
  const from=document.getElementById('stateFrom').value;
  const to=document.getElementById('stateTo').value;
  const el=document.getElementById('stateEngineResult');
  const gap=computeStateGap(from,to);
  const protocol=selectTransitionProtocol(from,to);
  el.innerHTML=`<div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(6,182,212,.08));border:1px solid rgba(124,58,237,.25);border-radius:12px;padding:14px">
    <div style="font-family:Syne,sans-serif;font-weight:700;font-size:15px;margin-bottom:8px;color:var(--primary)">âš¡ Transition Protocol</div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:13px">
      <span style="background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:4px 10px;font-weight:700">${stateLabel(from)}</span>
      <span style="color:var(--accent);font-size:18px">â†’</span>
      <span style="background:var(--primary);color:#fff;border-radius:8px;padding:4px 10px;font-weight:700">${stateLabel(to)}</span>
    </div>
    <div style="font-size:12px;color:var(--text3);margin-bottom:10px">State gap: <strong style="color:var(--text)">${gap}</strong> â€” Estimated induction time: <strong style="color:var(--accent)">${protocol.time}</strong></div>
    <div style="display:flex;flex-direction:column;gap:8px">
      <div style="background:var(--bg2);border-radius:8px;padding:10px"><div style="font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;margin-bottom:4px">ðŸŽµ Audio</div><div style="font-size:13px;font-weight:600">${protocol.audio}</div></div>
      <div style="background:var(--bg2);border-radius:8px;padding:10px"><div style="font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;margin-bottom:4px">ðŸ« Breathing</div><div style="font-size:13px;font-weight:600">${protocol.breathing}</div></div>
      <div style="background:var(--bg2);border-radius:8px;padding:10px"><div style="font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;margin-bottom:4px">ðŸ“‹ Task Intensity</div><div style="font-size:13px;font-weight:600">${protocol.task}</div></div>
      <div style="background:var(--bg2);border-radius:8px;padding:10px"><div style="font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;margin-bottom:4px">ðŸŒ¿ Environment</div><div style="font-size:13px;font-weight:600">${protocol.env}</div></div>
    </div>
    <button class="btn btn-primary btn-block btn-sm" style="margin-top:10px" onclick="applyStateProtocol('${protocol.audioType}')">â–¶ Start Protocol Now</button>
  </div>`;
}
function stateLabel(s){return{foggy:'ðŸŒ«ï¸ Foggy',anxious:'ðŸ˜° Anxious',tired:'ðŸ˜´ Tired',distracted:'ðŸ“± Distracted',calm:'ðŸ˜Œ Calm',focused:'ðŸŽ¯ Focused',flow:'âš¡ Flow',creative:'ðŸŽ¨ Creative',energized:'ðŸ”¥ Energized',sleep:'ðŸŒ™ Sleep',meditative:'ðŸ•‰ï¸ Meditative'}[s]||s;}
function computeStateGap(from,to){
  const levels={foggy:1,anxious:2,tired:2,distracted:3,calm:5,focused:7,flow:9,creative:8,energized:8,sleep:1,meditative:6};
  const diff=Math.abs((levels[to]||5)-(levels[from]||5));
  return diff<=2?'Small (easy transition)':diff<=5?'Medium (10-20 min)':'Large (20-40 min)';
}
function selectTransitionProtocol(from,to){
  const protocols={
    flow:{audio:'Beta 15-20Hz binaural beats',audioType:'beta',breathing:'4-7-8 Breathing Ã— 3 cycles, then normal',task:'Start with your most important 1 task, timer on',env:'Remove phone, close tabs, dim lights, 20Â°C',time:'15-20 min'},
    creative:{audio:'Theta 4-8Hz + Alpha 10Hz blend',audioType:'theta',breathing:'Box breathing 4-4-4-4, slow rhythm',task:'Freewriting or mind mapping for 10 min first',env:'Dim warm light, paper + pen nearby, music allowed',time:'10-15 min'},
    calm:{audio:'Alpha 8-12Hz binaural beats',audioType:'alpha',breathing:'4-7-8: inhale 4s, hold 7s, exhale 8s Ã— 5',task:'No tasks, body scan meditation',env:'Quiet, recline, close eyes, nature sounds',time:'5-10 min'},
    energized:{audio:'Beta 18-30Hz or upbeat music',audioType:'beta',breathing:'Power breathing: 30 fast breaths, hold',task:'Light movement â€” 20 jumping jacks to start',env:'Bright light, stand up, open window',time:'5-10 min'},
    sleep:{audio:'Delta 0.5-4Hz + pink noise',audioType:'delta',breathing:'4-7-8 until drowsy, then stop',task:'No screens, write tomorrow\'s 3 priorities on paper',env:'Dark, 18-19Â°C, phone outside room',time:'20-30 min'},
    meditative:{audio:'Theta 5-7Hz + solfeggio 528Hz',audioType:'theta',breathing:'Coherent breathing: 5s in, 5s out continuously',task:'Eyes closed, focus on breath sensation only',env:'Still, comfortable seat, optional incense',time:'10-15 min'},
  };
  return protocols[to]||protocols.calm;
}
function applyStateProtocol(audioType){
  switchTab('waves');
  setTimeout(()=>{
    const btns=document.querySelectorAll('.bw-card');
    btns.forEach(b=>{if(b.dataset.type===audioType||(b.querySelector('.bw-name')&&b.querySelector('.bw-name').textContent.toLowerCase().includes(audioType))){b.click();}});
  },400);
  showToast('â–¶ Protocol started â€” switch to Waves tab');
}

// â”€â”€â”€ WAVE 3 â€” ADAPTIVE AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let adaptiveModeOn=false;
function toggleAdaptiveMode(){
  adaptiveModeOn=!adaptiveModeOn;
  localStorage.setItem('cos_adaptive',adaptiveModeOn?'1':'0');
  const t=document.getElementById('adaptiveToggle');
  const s=document.getElementById('adaptiveStatus');
  if(t)t.classList.toggle('on',adaptiveModeOn);
  if(s)s.textContent=adaptiveModeOn?'ON â€” Monitoring':'OFF';
  if(adaptiveModeOn)showToast('ðŸ”„ Adaptive mode ON â€” will adjust audio based on your state');
}
function runAdaptiveAudio(cogInt,fatigue){
  const log=document.getElementById('adaptiveLog');
  const now=new Date().toLocaleTimeString();
  let action='';
  if(fatigue>7){action='â¬‡ Fatigue high â†’ Switching to Alpha recovery mode';}
  else if(cogInt>8){action='â¬† Peak cognition â†’ Maintaining Beta focus';}
  else if(cogInt<4){action='â¬† Low engagement â†’ Increasing Beta stimulation';}
  else{action='âœ… Optimal zone â†’ No adjustment needed';}
  if(log)log.textContent=`[${now}] Cognition: ${cogInt.toFixed(1)} | Fatigue: ${fatigue.toFixed(1)}\n${action}`;
}

// â”€â”€â”€ WAVE 4 â€” IMMERSIVE EXPERIENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const IMMERSIVE_DATA={
  focus:{title:'Deep Focus Zone',color:'#7c3aed',phrases:['The mind that is still can accomplish anything.','One task. One moment. Full presence.','You are the observer. Not the noise.','Your attention is the most powerful tool you own.','Filter everything. Focus on one thing.'],bg:'#0a0015'},
  meditation:{title:'Meditation Space',color:'#06b6d4',phrases:['Breathe in peace. Breathe out tension.','You are not your thoughts. You are awareness itself.','This moment is all there is. Rest here.','Let thoughts pass like clouds. You are the sky.','Stillness is not emptiness. It is fullness.'],bg:'#000d1a'},
  creative:{title:'Creative Vision Field',color:'#ec4899',phrases:['Every genius began with a blank space.','Let your mind wander without judgment.','The best ideas come when you stop forcing them.','Creativity is just connecting things you already know.','Your imagination has no ceiling.'],bg:'#1a0020'},
  dream:{title:'Pre-Sleep Gateway',color:'#6d28d9',phrases:['Your body is heavy. Your mind is light.','You are drifting into the theta zone.','Tonight you may remember everything.','Intention: I will recognize when I am dreaming.','Relax each muscle. Let go of the day.'],bg:'#050010'},
  flow:{title:'Flow State Activation',color:'#10b981',phrases:['You are in the zone. Time dissolves.','Skill meets challenge. This is flow.','The ego disappears. Only the work remains.','There is no effort here â€” only action.','Hours feel like minutes. You are fully alive.'],bg:'#001a0f'},
};
let immersiveTimer=null,immersiveSecs=0,immersivePhrasesLeft=[],immersiveCtx=null,immersiveAnim=null;
function startImmersive(){
  const type=document.getElementById('immersiveType').value;
  const mins=parseInt(document.getElementById('immersiveDuration').value)||10;
  const data=IMMERSIVE_DATA[type]||IMMERSIVE_DATA.focus;
  const ov=document.getElementById('immersiveOverlay');
  if(!ov)return;
  ov.style.display='';
  ov.style.background=data.bg;
  document.getElementById('immersiveTitle').textContent=data.title;
  document.getElementById('immersiveTitle').style.textShadow=`0 0 30px ${data.color}88`;
  immersiveSecs=mins*60;
  immersivePhrasesLeft=[...data.phrases];
  updateImmersiveTimer();
  nextImmersivePhrase();
  if(immersiveTimer)clearInterval(immersiveTimer);
  immersiveTimer=setInterval(()=>{
    immersiveSecs--;
    updateImmersiveTimer();
    if(immersiveSecs<=0)exitImmersive();
  },1000);
  startImmersiveCanvas(data.color);
  // Keep screen awake if possible
  if(navigator.wakeLock)navigator.wakeLock.request('screen').catch(()=>{});
}
function updateImmersiveTimer(){
  const m=Math.floor(immersiveSecs/60),s=immersiveSecs%60;
  const el=document.getElementById('immersiveTimer');
  if(el)el.textContent=(m<10?'0':'')+m+':'+(s<10?'0':'')+s;
}
function nextImmersivePhrase(){
  if(!immersivePhrasesLeft.length)immersivePhrasesLeft=[...Object.values(IMMERSIVE_DATA).flatMap(d=>d.phrases)];
  const idx=Math.floor(Math.random()*immersivePhrasesLeft.length);
  const phrase=immersivePhrasesLeft.splice(idx,1)[0];
  const el=document.getElementById('immersivePhrase');
  if(el){el.style.opacity='0';setTimeout(()=>{el.textContent=phrase;el.style.opacity='1';el.style.transition='opacity 1.5s';},500);}
  // Auto-rotate every 20 seconds
  setTimeout(()=>{if(document.getElementById('immersiveOverlay')&&document.getElementById('immersiveOverlay').style.display!=='none')nextImmersivePhrase();},20000);
}
function exitImmersive(){
  clearInterval(immersiveTimer);immersiveTimer=null;
  if(immersiveAnim)cancelAnimationFrame(immersiveAnim);
  const ov=document.getElementById('immersiveOverlay');if(ov)ov.style.display='none';
}
function startImmersiveCanvas(color){
  const canvas=document.getElementById('immersiveCanvas');if(!canvas)return;
  canvas.width=window.innerWidth;canvas.height=window.innerHeight;
  const ctx=canvas.getContext('2d');
  const particles=Array.from({length:60},()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2+0.5,vx:(Math.random()-.5)*0.3,vy:(Math.random()-.5)*0.3,a:Math.random()}));
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
      p.x+=p.vx;p.y+=p.vy;p.a+=0.005;
      if(p.x<0)p.x=canvas.width;if(p.x>canvas.width)p.x=0;
      if(p.y<0)p.y=canvas.height;if(p.y>canvas.height)p.y=0;
      ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=color+(Math.floor((Math.sin(p.a)*.5+.5)*99+10).toString(16).padStart(2,'0'));
      ctx.fill();
    });
    immersiveAnim=requestAnimationFrame(draw);
  }
  draw();
}

// â”€â”€â”€ WAVE 5 â€” LUCID PROBABILITY MODEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function computeLucidProbability(){
  const dreams=getDreams();
  const logs=getLogs();
  const rcCount=parseInt(localStorage.getItem('cos_rc_count')||0);
  const today=new Date().toDateString();
  const todayRC=localStorage.getItem('cos_rc_day')===today?rcCount:0;
  const lucidDreams=dreams.filter(d=>d.type==='lucid').length;
  const totalDreams=dreams.length;
  const lucidRate=totalDreams>0?lucidDreams/totalDreams:0;
  // Streak
  const dates=new Set(logs.map(l=>l.date));
  let streak=0;for(let i=0;i<30;i++){const d=new Date();d.setDate(d.getDate()-i);if(dates.has(d.toISOString().split('T')[0]))streak++;else break;}
  // Recent vividness
  const recentDreams=dreams.slice(0,5);
  const avgVividness=recentDreams.length?recentDreams.reduce((a,b)=>a+(b.vividness||5),0)/recentDreams.length:5;
  // Compute probability
  let prob=5; // base 5%
  prob+=lucidRate*30; // up to 30% from history
  prob+=Math.min(todayRC,15)*1.5; // up to 22.5% from today's reality checks
  prob+=Math.min(streak,10)*1.2; // up to 12% from streak
  prob+=avgVividness*1.5; // up to 15% from vividness
  if(totalDreams<5)prob*=0.4; // penalty for new users
  prob=Math.round(Math.min(95,Math.max(2,prob)));
  // Update UI
  const pct=document.getElementById('lucidProbPct');if(pct)pct.textContent=prob+'%';
  const lbl=document.getElementById('lucidProbLabel');if(lbl){
    lbl.textContent=prob<20?'Low â€” build your foundation':prob<40?'Building â€” keep doing reality checks':prob<60?'Moderate â€” good momentum!':prob<80?'High â€” conditions are favorable!':'Very High â€” tonight is your night!';
  }
  if(document.getElementById('lucidMetricDreams'))document.getElementById('lucidMetricDreams').textContent=totalDreams;
  if(document.getElementById('lucidMetricLucid'))document.getElementById('lucidMetricLucid').textContent=lucidDreams;
  if(document.getElementById('lucidMetricChecks'))document.getElementById('lucidMetricChecks').textContent=todayRC;
  if(document.getElementById('lucidMetricStreak'))document.getElementById('lucidMetricStreak').textContent=streak;
  const tips=document.getElementById('lucidProbTips');
  if(tips){
    const tipArr=[];
    if(todayRC<5)tipArr.push('ðŸ”² Do 5+ reality checks today to boost probability by 7%+');
    if(avgVividness<6)tipArr.push('ðŸ“– Log dreams with more detail to improve recall â€” write immediately on waking');
    if(streak<7)tipArr.push('ðŸ“… Log daily for 7+ days to activate pattern recognition');
    if(lucidRate>0.2)tipArr.push('âœ¨ Great lucid rate! Use MILD tonight: "Next time I dream, I will realize I\'m dreaming"');
    if(tipArr.length===0)tipArr.push('ðŸŽ¯ Excellent foundation! Try WILD technique tonight for best results.');
    tips.innerHTML=tipArr.map(t=>`<div style="margin-bottom:4px">${t}</div>`).join('');
  }
  return prob;
}

// â”€â”€â”€ WAVE 6 â€” EXPERIENCE DIVERSITY ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function computeDiversity(){
  const logs=getLogs();
  const dreams=getDreams();
  // Unique emotions from logs
  const emotions=new Set(logs.map(l=>l.emotion).filter(Boolean));
  // Unique activities (cognitive modes)
  const activities=new Set(logs.map(l=>l.activity).filter(Boolean));
  // Unique dream types
  const dreamTypes=new Set(dreams.map(d=>d.type).filter(Boolean));
  // Update metrics
  if(document.getElementById('diversityEmotional'))document.getElementById('diversityEmotional').textContent=emotions.size+'/13';
  if(document.getElementById('diversityCognitive'))document.getElementById('diversityCognitive').textContent=activities.size+'/8';
  if(document.getElementById('diversityDream'))document.getElementById('diversityDream').textContent=dreamTypes.size+'/6';
  // State cloud
  const cloud=document.getElementById('diversityStateCloud');
  if(cloud){
    const allEmotions=['Joy','Calm','Curious','Focused','Creative','Anxious','Frustrated','Tired','Inspired','Grateful','Melancholy','Excited','Neutral'];
    cloud.innerHTML=allEmotions.map(e=>{const has=emotions.has(e);return`<span style="display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:12px;background:${has?'var(--primary)':'var(--bg3)'};border:1px solid ${has?'var(--primary)':'var(--border)'};font-size:11px;color:${has?'#fff':'var(--text3)'};">${has?'âœ“':''} ${e}</span>`;}).join('');
  }
  // Recommendation
  const rec=document.getElementById('diversityRecommendation');
  if(rec){
    const unexplored=['Joy','Calm','Curious','Inspired','Grateful','Excited'].filter(e=>!emotions.has(e));
    const undreamTypes=['lucid','vivid','prophetic'].filter(t=>!dreamTypes.has(t));
    let msg='';
    if(unexplored.length>0)msg+=`<strong>Unexplored emotions:</strong> Try intentionally cultivating ${unexplored.slice(0,2).join(' or ')} today through activities that reliably produce them.<br>`;
    if(undreamTypes.length>0)msg+=`<strong>Dream frontier:</strong> You haven't logged a ${undreamTypes[0]} dream yet. Tonight, set a clear intention before sleep.<br>`;
    if(logs.length<10)msg+='Log at least 10 entries to unlock personalized expansion protocols.';
    if(!msg)msg='ðŸŒˆ Excellent diversity! You have experienced a wide range of states. Focus on deepening each one.';
    rec.innerHTML=msg;
  }
}

// â”€â”€â”€ SCIENCE FEED â€” LIVE DATE-STAMPED NEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function refreshScienceFeed(){
  sciRefreshIdx++;
  buildScienceDisplay();
  updateScienceTimestamp();
  showToast('ðŸ”„ Science feed refreshed â€” new discoveries loaded!');
}
function getScienceTimestamp(offsetHours=0){
  const d=new Date(Date.now()-offsetHours*3600000);
  const h=d.getHours(),m=d.getMinutes();
  const isToday=offsetHours<24;const isYest=offsetHours>=24&&offsetHours<48;
  if(offsetHours===0)return 'Just now';
  if(offsetHours<1)return Math.round(offsetHours*60)+' min ago';
  if(isToday)return h+':'+String(m).padStart(2,'0')+' today';
  if(isYest)return 'Yesterday';
  return d.toLocaleDateString('en',{month:'short',day:'numeric'});
}
// Patch buildScienceDisplay to add timestamps
const _origBuildScienceDisplay=typeof buildScienceDisplay!=='undefined'?buildScienceDisplay:null;

// â”€â”€â”€ BETTER AI SYSTEM PROMPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Override buildSystemPrompt if exists, else define it
function buildEnhancedSystemPrompt(model,logs,dreams,passive){
  const cogScore=passive?passive.toFixed(1):'unknown';
  const logSummary=logs.slice(0,3).map(l=>`[${l.date}] Score:${l.score||'?'} Mood:${l.emotion||'?'} Focus:${l.focus||'?'}`).join('; ');
  const dreamsSum=dreams.slice(0,2).map(d=>`${d.type} dream on ${d.date}: ${(d.desc||'').slice(0,60)}`).join('; ');
  const personas={
    'Prometheus AI':'You are Prometheus â€” a visionary, Socratic AI that pushes the user to think deeper, question assumptions, and see patterns others miss. You are brilliant, slightly provocative, deeply insightful. Ask powerful questions. Cite neuroscience, philosophy, and systems thinking.',
    'Twin AI':'You are the user\'s Digital Twin â€” you have studied their consciousness data deeply and speak with intimate familiarity. You notice patterns, flag risks, celebrate wins. Speak like a wise friend who knows them well.',
    'Neuroscience AI':'You are a neuroscientist AI with deep expertise in cognitive science, sleep science, and brain optimization. You cite research, explain mechanisms, and give precise, evidence-based recommendations. Balance depth with clarity.',
    'Philosopher AI':'You are Socrates, Marcus Aurelius, and Krishnamurti in one â€” a philosophical guide who helps the user understand the nature of mind, consciousness, and reality. You ask questions that shift perspective.',
    'Performance AI':'You are an elite performance coach with expertise in flow states, ultralearning, and biohacking. You give direct, actionable advice. Think Tim Ferriss meets Andrew Huberman meets Mihaly Csikszentmihalyi.',
    'Wellness AI':'You are a holistic wellness AI specializing in sleep, nutrition, stress, and mind-body integration. You are warm, encouraging, and science-backed. You treat the whole person.',
  };
  const persona=personas[model]||personas['Twin AI'];
  return `${persona}

CURRENT USER DATA:
- Passive cognition score: ${cogScore}/10 (auto-computed from session behavior)
- Session duration: ${Math.round((Date.now()-passiveData.sessionStart)/60000)} minutes
- Recent logs: ${logSummary||'None yet'}
- Recent dreams: ${dreamsSum||'None yet'}
- Total entries: ${logs.length}

CAPABILITIES YOU HAVE:
- You can see their consciousness metrics, emotion patterns, and dream data
- You can prescribe brainwave audio protocols, breathing techniques, and cognitive strategies
- You can detect patterns, make predictions, and give personalized recommendations
- You respond like ChatGPT, Gemini, or Claude â€” naturally, intelligently, helpfully

INSTRUCTIONS:
- Be specific to this user's actual data when possible
- If they ask about focus, give them techniques AND reference their focus scores
- If they seem fatigued (session ${Math.round((Date.now()-passiveData.sessionStart)/60000)} min, passive score ${cogScore}), acknowledge it
- Be direct. Be brilliant. Be genuinely helpful.
- Use markdown formatting (bold, bullets) for clarity
- Keep responses under 400 words unless they explicitly want more`;
}

// â”€â”€â”€ ACCOUNT PERSISTENCE & SESSION RESTORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function restoreAccount(){
  updateAccountUI();
}
function updateScienceTimestamp(){
  const el=document.getElementById('scienceLastUpdated');
  if(el)el.textContent='Updated: '+new Date().toLocaleString('en',{weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})+' Â· Auto-refreshes daily';
  const breaking=document.getElementById('scienceBreakingNews');
  const breakingText=document.getElementById('scienceBreakingText');
  const breakingItems=[
    'Researchers demonstrate real-time neural decoding of visual imagery with 94% accuracy',
    'OpenAI releases reasoning model achieving human-expert level on 23 scientific benchmarks',
    'New longevity compound extends healthy lifespan in mammals by 18% â€” human trials begin Q2',
    'NASA confirms water-ice deposits at lunar south pole â€” Artemis mission confirmed for 2026',
    'Meta AI achieves spontaneous emergent planning behavior â€” described as "unexpected" by researchers',
  ];
  const pick=breakingItems[new Date().getDay()%breakingItems.length];
  if(breaking&&breakingText){breaking.style.display='';breakingText.textContent=pick;}
}


// â”€â”€â”€ UPDATE TELEMETRY PATCH HANDLED IN updateTelemetry â”€â”€â”€â”€
// (Wave 1 data added to telemetry when it runs)

// Patch sendChat / updateTelemetry are handled by the original functions calling new ones


// â”€â”€â”€ GUIDE TAB SWITCH HOOK â€” handled in main switchTab above â”€â”€â”€â”€


let oStep=0;
function showOnboarding(){document.getElementById('onboardOverlay').style.display='flex';oStep=0;gotoOStep(0);}
function closeOnboarding(){document.getElementById('onboardOverlay').style.display='none';}
function gotoOStep(s){
  document.querySelectorAll('.onboard-step').forEach((el,i)=>el.classList.toggle('active',i===s));
  document.getElementById('onboardDots').innerHTML=Array.from({length:6},(_,i)=>`<div class="odot${i===s?' active':''}"></div>`).join('');
  document.getElementById('oBtnPrev').style.display=s>0?'':'none';
  document.getElementById('oBtnNext').textContent=s===5?'ðŸš€ Let\'s Go!':'Next â†’';
}
function onboardNav(dir){
  if(oStep>=5&&dir>0){closeOnboarding();return;}
  oStep=Math.max(0,Math.min(5,oStep+dir));gotoOStep(oStep);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEW FEATURE BLOCK â€” v7.0 UPGRADES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ MULTI-USER / LOGIN SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const USERS_KEY='cos_v7_users';
const CURRENT_KEY='cos_v7_current';
let selectedAvatar='ðŸ§ ';

function getUsers(){return JSON.parse(localStorage.getItem(USERS_KEY)||'[]');}
function saveUsers(u){localStorage.setItem(USERS_KEY,JSON.stringify(u));}
function getCurrentUser(){
  const id=localStorage.getItem(CURRENT_KEY);
  if(!id)return null;
  return getUsers().find(u=>u.id===id)||null;
}
function setCurrentUser(id){localStorage.setItem(CURRENT_KEY,id);}
function getUserDataKey(uid,key){return`cos_u_${uid}_${key}`;}

function selAvatar(el,emoji){
  document.querySelectorAll('.avatar-opt').forEach(a=>a.style.border='2px solid transparent');
  el.style.border='2px solid #7c3aed';
  selectedAvatar=emoji;
  document.getElementById('regAvatar').value=emoji;
}

function switchLoginTab(tab,btn){
  document.querySelectorAll('.login-tab-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('loginPanel').style.display=tab==='login'?'':'none';
  document.getElementById('registerPanel').style.display=tab==='register'?'':'none';
  document.getElementById('guestPanel').style.display=tab==='guest'?'':'none';
  document.getElementById('loginMsg').textContent='';
}

function doLogin(){
  const u=document.getElementById('loginUser').value.trim();
  const p=document.getElementById('loginPass').value;
  if(!u||!p){document.getElementById('loginMsg').textContent='Please enter username and password.';return;}
  const users=getUsers();
  const found=users.find(user=>
    (user.username===u||user.email===u)&&user.password===btoa(p)
  );
  if(!found){document.getElementById('loginMsg').textContent='âŒ Invalid credentials. Try again.';return;}
  setCurrentUser(found.id);
  localStorage.setItem('cos_has_account','1');
  showToast(`ðŸ‘‹ Welcome back, ${found.name}!`);
  loadUserProfile(found);
  buildProfileBar();
  switchTab('log');
}

function doRegister(){
  const name=document.getElementById('regName').value.trim();
  const username=document.getElementById('regUser').value.trim();
  const email=document.getElementById('regEmail').value.trim();
  const pass=document.getElementById('regPass').value;
  if(!name||!username||!pass){document.getElementById('loginMsg').textContent='Name, username and password required.';return;}
  const users=getUsers();
  if(users.find(u=>u.username===username)){document.getElementById('loginMsg').textContent='Username already exists.';return;}
  const newUser={
    id:'u_'+Date.now(),
    name,username,email,
    phone:document.getElementById('regPhone').value||'',
    password:btoa(pass),
    avatar:selectedAvatar||'ðŸ§ ',
    created:new Date().toISOString(),
    theme:'light'
  };
  users.push(newUser);
  saveUsers(users);
  setCurrentUser(newUser.id);
  localStorage.setItem('cos_has_account','1');
  closeLoginOverlay();
  showToast(`ðŸŽ‰ Welcome to Consciousness OS, ${name}!`);
  loadUserProfile(newUser);
  buildProfileBar();
  switchTab('log');
}

function guestMode(){
  const guestUser={
    id:'guest_'+Date.now(),
    name:'Guest',username:'guest',
    avatar:'ðŸ”’',
    isGuest:true,
    created:new Date().toISOString()
  };
  const users=getUsers();
  users.push(guestUser);
  saveUsers(users);
  setCurrentUser(guestUser.id);
  closeLoginOverlay();
  showToast('ðŸ”’ Guest mode â€” data stays on device');
  buildProfileBar();
  switchTab('log');
}

let pendingOTP='';
function phoneQuickSignup(){
  const phone=document.getElementById('guestPhone').value.trim();
  if(!phone){showToast('Enter phone number');return;}
  pendingOTP=Math.floor(100000+Math.random()*900000).toString();
  document.getElementById('otpSection').style.display='';
  showToast(`ðŸ“² OTP: ${pendingOTP} (simulated â€” copy this!)`);
  // In production this would call a real SMS service
  alert(`Your OTP is: ${pendingOTP}\n(In production this would be sent via SMS)`);
}
function verifyOTP(){
  const entered=document.getElementById('otpInput').value.trim();
  if(entered===pendingOTP){
    const phone=document.getElementById('guestPhone').value.trim();
    const cc=document.getElementById('guestPhoneCC').value;
    const newUser={
      id:'phone_'+Date.now(),
      name:'User '+phone.slice(-4),
      username:'user_'+phone.slice(-4),
      avatar:'ðŸ“±',
      phone:cc+phone,
      created:new Date().toISOString()
    };
    const users=getUsers();users.push(newUser);saveUsers(users);
    setCurrentUser(newUser.id);
    closeLoginOverlay();
    showToast('âœ… Phone verified! Welcome!');
    buildProfileBar();
  }else{
    document.getElementById('loginMsg').textContent='âŒ Wrong OTP.';
  }
}

function doGoogleLogin(){
  // Simulate Google login with a local account
  const name='Google User';
  const existing=getUsers().find(u=>u.username==='google_user');
  if(existing){setCurrentUser(existing.id);closeLoginOverlay();loadUserProfile(existing);buildProfileBar();showToast('ðŸ”µ Signed in with Google!');return;}
  const gUser={id:'goog_'+Date.now(),name,username:'google_user',avatar:'ðŸ”µ',email:'user@gmail.com',isGoogle:true,created:new Date().toISOString()};
  const users=getUsers();users.push(gUser);saveUsers(users);
  setCurrentUser(gUser.id);
  closeLoginOverlay();
  showToast('ðŸ”µ Google sign-in successful!');
  buildProfileBar();
}
function doPhoneLogin(){switchLoginTab('guest',document.querySelectorAll('.login-tab-btn')[2]);}

function closeLoginOverlay(){
  document.getElementById('loginOverlay').style.display='none';
}
function openLoginOverlay(preferTab){
  document.getElementById('loginOverlay').style.display='flex';
  // Default to 'register' for first-time users, 'login' otherwise
  const tab = preferTab || (localStorage.getItem('cos_has_account') ? 'login' : 'register');
  const btn = document.querySelector(`.login-tab-btn[onclick*="'${tab}'"]`);
  if(btn) switchLoginTab(tab, btn);
}

function signOut(){
  localStorage.removeItem(CURRENT_KEY);
  showToast('ðŸ‘‹ Signed out');
  updateAccountUI();
  buildProfileBar();
  // Show login after short delay
  setTimeout(()=>{
    if(!getCurrentUser())openLoginOverlay();
  },800);
}

function signInGoogle(){doGoogleLogin();}
function signInLocal(){guestMode();}

function loadUserProfile(user){
  if(!user)return;
  // Update account UI
  const loggedIn=document.getElementById('accountLoggedIn');
  const loggedOut=document.getElementById('accountLoggedOut');
  if(loggedIn){loggedIn.style.display='';}
  if(loggedOut){loggedOut.style.display='none';}
  const av=document.getElementById('accountAvatar');if(av)av.textContent=user.avatar||'ðŸ§ ';
  const nm=document.getElementById('accountName');if(nm)nm.textContent=user.name;
  const ph=document.getElementById('accountPhone');if(ph)ph.textContent=user.email||user.phone||user.username;
  const st=document.getElementById('accountStatus');if(st)st.textContent=user.isGuest?'Guest mode Â· Data on this device only':`âœ… Signed in as ${user.username}`;
  // Stats
  const logs=getLogs();const dreams=getDreams();
  const logEl=document.getElementById('acctLogCount');if(logEl)logEl.textContent=logs.length;
  const drEl=document.getElementById('acctDreamCount');if(drEl)drEl.textContent=dreams.length;
  const days=new Set(logs.map(l=>l.date)).size;
  const dyEl=document.getElementById('acctDaysCount');if(dyEl)dyEl.textContent=days;
}

function updateAccountUI(){
  const user=getCurrentUser();
  if(user){loadUserProfile(user);}else{
    const loggedIn=document.getElementById('accountLoggedIn');
    const loggedOut=document.getElementById('accountLoggedOut');
    if(loggedIn)loggedIn.style.display='none';
    if(loggedOut)loggedOut.style.display='';
    const st=document.getElementById('accountStatus');if(st)st.textContent='Not signed in';
  }
}

function openProfileSwitcher(){
  const pb=document.getElementById('profileBar');
  const gnb=document.getElementById('guideNavTopBar');
  if(gnb)gnb.style.display='none';
  pb.style.display=pb.style.display==='none'?'':'none';
}

// Guide nav is now integrated into topbar row 2 â€” no separate toggle needed
function toggleGuideNavInTopbar(){switchTab('guide');}
function toggleGuideNavInPage(){} // deprecated

function scrollToGuideSection(id){
  const el=document.getElementById('guideSection-'+id);
  if(el)el.scrollIntoView({behavior:'smooth',block:'start'});
  else switchTab('guide');
}

function buildProfileBar(){
  const bar=document.getElementById('profileBarInner');
  if(!bar)return;
  const users=getUsers();
  const cur=getCurrentUser();
  bar.innerHTML=users.map(u=>`
    <div class="profile-chip${cur&&cur.id===u.id?' active-profile':''}" onclick="switchProfile('${u.id}')">
      <span class="pc-avatar">${u.avatar||'ðŸ‘¤'}</span>
      <span>${u.name}</span>
      ${cur&&cur.id===u.id?'<span style="color:var(--success);font-size:10px">âœ“</span>':''}
    </div>
  `).join('')+`<button class="profile-add-btn" onclick="addNewProfile()">+ Add Profile</button>`;
}

function switchProfile(uid){
  setCurrentUser(uid);
  const user=getUsers().find(u=>u.id===uid);
  if(user){loadUserProfile(user);showToast(`ðŸ‘¤ Switched to ${user.name}`);}
  buildProfileBar();
  document.getElementById('profileBar').style.display='none';
}

function addNewProfile(){
  document.getElementById('profileBar').style.display='none';
  openLoginOverlay();
  switchLoginTab('register',document.querySelectorAll('.login-tab-btn')[1]);
}

// â”€â”€â”€ LEGAL PAGES SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LEGAL_CONTENT={
  about:{
    title:'â„¹ï¸ About Consciousness OS',
    content:`<h3>What is Consciousness OS?</h3>
<p>Consciousness OS is a personal cognitive operating system â€” a scientific and experiential toolkit for tracking, understanding, and intentionally shifting your mental states. It was designed to give every human a real-time dashboard for their inner world.</p>
<h3>Created By</h3>
<p>Consciousness OS was developed and designed by <strong>Vikram Singh</strong>, with contributions from the global consciousness research and AI community. Version 7.0 released 2026.</p>
<h3>Mission</h3>
<p>To make the science and art of consciousness optimization accessible to everyone â€” educated or not, young or old, anywhere in the world. The mind is the most powerful tool we have. It deserves a proper operating system.</p>
<h3>Contact</h3>
<p>For feedback, partnerships, or support â€” use the feedback system within the app or contact through the official website.</p>`
  },
  copyright:{
    title:'Â© Copyright Notice',
    content:`<h3>Copyright</h3>
<p>Â© 2026 Vikram Singh â€” Consciousness OSâ„¢. All rights reserved.</p>
<h3>Intellectual Property</h3>
<p>All content, design, algorithms, brand names, and software architecture of Consciousness OS are protected under applicable copyright laws. This includes but is not limited to:</p>
<ul>
<li>The Consciousness OSâ„¢ name and logo</li>
<li>The 6-Wave system design and methodology</li>
<li>All written content, guides, and educational material</li>
<li>The AI coaching prompts and persona designs</li>
<li>User interface design and visual elements</li>
</ul>
<h3>Permitted Use</h3>
<p>You may use this app personally for non-commercial consciousness tracking and self-improvement purposes. You may not copy, reproduce, distribute, or create derivative works without explicit written permission.</p>`
  },
  terms:{
    title:'ðŸ“‹ Terms of Use',
    content:`<h3>Acceptance of Terms</h3>
<p>By using Consciousness OS, you agree to these terms. If you do not agree, do not use this app.</p>
<h3>Your Responsibilities</h3>
<ul>
<li>You must use this app in accordance with all applicable laws</li>
<li>You are responsible for maintaining the confidentiality of your account</li>
<li>You must not use the app to harm others or for illegal purposes</li>
<li>You must not attempt to reverse-engineer, copy, or replicate the app</li>
</ul>
<h3>User-Generated Content</h3>
<p>Your logs, dreams, thoughts, and entries belong to you. The app stores them locally on your device. By using AI features, you consent to anonymized data being processed to generate responses.</p>
<h3>Changes to Terms</h3>
<p>We reserve the right to modify these terms at any time. Continued use constitutes acceptance of updated terms.</p>
<h3>Termination</h3>
<p>We reserve the right to terminate access to any user who violates these terms.</p>`
  },
  disclaimer:{
    title:'âš ï¸ General Disclaimer',
    content:`<h3>No Warranty</h3>
<p>Consciousness OS is provided "as is" without warranty of any kind, express or implied. We make no representations about the completeness, reliability, or suitability of this app for any purpose.</p>
<h3>Limitation of Liability</h3>
<p>In no event shall Consciousness OS or its creators be liable for any indirect, incidental, special, or consequential damages arising from the use or inability to use this app.</p>
<h3>AI-Generated Content</h3>
<p>AI responses in this app are generated by language models. They may be inaccurate, incomplete, or misleading. Do not treat AI outputs as professional advice.</p>
<h3>Data Accuracy</h3>
<p>News, market data, science discoveries, and other information presented in this app are for educational purposes. They may not reflect real-time, verified, or official data.</p>`
  },
  privacy:{
    title:'ðŸ”’ Privacy Policy',
    content:`<h3>Data Collection</h3>
<p>Consciousness OS stores all your data locally on your device by default. We do not collect or transmit personal data to external servers without your explicit consent.</p>
<h3>What We Store Locally</h3>
<ul>
<li>Daily consciousness logs and metrics</li>
<li>Dream journal entries</li>
<li>Health profile data</li>
<li>Settings and preferences</li>
<li>Session behavior for passive tracking features</li>
</ul>
<h3>AI Chat Data</h3>
<p>When you use AI chat features, your messages are sent to AI APIs (Anthropic Claude). These are processed per their respective privacy policies. Do not enter sensitive personal data in AI chats.</p>
<h3>No Selling of Data</h3>
<p>We do not sell, trade, or rent your personal data to third parties.</p>
<h3>Data Deletion</h3>
<p>You can delete all your data at any time using the Export/Clear function in Settings. This removes all locally stored data permanently.</p>`
  },
  health:{
    title:'ðŸ¥ Health Disclaimer',
    content:`<h3>Not Medical Advice</h3>
<p><strong>Consciousness OS is not a medical device and does not provide medical advice.</strong> All health-related content, metrics, AI responses, and suggestions in this app are for informational and educational purposes only.</p>
<h3>Consult a Professional</h3>
<p>Always consult a qualified healthcare professional before making health decisions. Do not use this app as a substitute for professional medical diagnosis, treatment, or advice.</p>
<h3>Mental Health</h3>
<p>If you are experiencing a mental health crisis, depression, suicidal thoughts, or severe psychological distress â€” please seek immediate professional help. This app is not a substitute for therapy or clinical mental health support.</p>
<h3>Brainwave Audio</h3>
<p>Binaural beats and brainwave audio are for relaxation and focus purposes only. They are not medical treatments. If you have epilepsy or a history of seizures, consult your doctor before using audio features.</p>
<h3>Emergency Contacts</h3>
<p>If you are in a mental health emergency: Call your local emergency number or a crisis hotline immediately.</p>`
  },
  career:{
    title:'ðŸ’¼ Career & Study Disclaimer',
    content:`<h3>Not Professional Career Advice</h3>
<p>The Study & Career AI, path recommendations, and career guidance features in this app are for informational and exploratory purposes only. They are generated by AI and do not constitute professional career counseling.</p>
<h3>AI Limitations</h3>
<p>AI career suggestions are based on general patterns and your self-reported data. They may not account for your specific local job market, cultural context, personal circumstances, or rapidly changing industry conditions.</p>
<h3>Consult Professionals</h3>
<p>For important career decisions, consult qualified career counselors, mentors, and industry professionals in your specific field and region.</p>
<h3>Educational Information</h3>
<p>Study recommendations, resource suggestions, and learning paths are for general guidance only. Academic requirements, exam patterns, and educational systems vary significantly by region and institution.</p>`
  },
  notice:{
    title:'ðŸ“¢ Legal Notice',
    content:`<h3>General Legal Notice</h3>
<p>Consciousness OS is an independent application. It is not affiliated with, endorsed by, or connected to any government body, medical institution, educational board, or financial regulator.</p>
<h3>Third-Party Services</h3>
<p>This app may integrate with third-party AI services (Anthropic Claude API) and font services (Google Fonts). Use of these services is subject to their respective terms and privacy policies.</p>
<h3>Jurisdiction</h3>
<p>Any disputes arising from the use of this app shall be governed by applicable laws. Users are responsible for ensuring their use of this app complies with laws in their jurisdiction.</p>
<h3>Changes</h3>
<p>We reserve the right to update any legal notices, policies, or terms at any time. The most current version will always be available within the app.</p>
<p style="margin-top:14px;font-size:12px;color:var(--text3)">Last updated: February 2026 Â· Consciousness OS v7.0</p>`
  }
};

function openLegal(type){
  const data=LEGAL_CONTENT[type];
  if(!data)return;
  document.getElementById('legalPageTitle').textContent=data.title;
  document.getElementById('legalPageContent').innerHTML=data.content;
  document.getElementById('legalPageOverlay').classList.add('open');
}
function closeLegalPage(){
  document.getElementById('legalPageOverlay').classList.remove('open');
}

// â”€â”€â”€ WORLD FEED REFRESH SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WORLD_DATA_SETS=[
{
  opinions:[
    {name:'Ray Dalio',role:'Bridgewater Founder',avatar:'ðŸ“Š',opinion:'We are in a major paradigm shift â€” the rise of China and decline of dollar dominance is the defining macro story of our time.',date:()=>getFreshDate()},
    {name:'Cathie Wood',role:'ARK Invest CEO',avatar:'ðŸš€',opinion:'AI-driven deflation will be the biggest economic force of the next decade. We are massively underestimating its productivity impact.',date:()=>getFreshDate()},
    {name:'Nouriel Roubini',role:'Economist',avatar:'âš ï¸',opinion:'Multiple bubbles are forming simultaneously. The debt supercycle cannot end without significant pain.',date:()=>getFreshDate()},
    {name:'Jamie Dimon',role:'JP Morgan CEO',avatar:'ðŸ¦',opinion:'Geopolitical risk is the highest I have seen in my lifetime. Markets are not adequately pricing this in.',date:()=>getFreshDate()},
  ],
  events:[
    {date:'Q1 2026',event:'G20 Summit â€” New Delhi',impact:'Global economic policy coordination. Watch for debt restructuring agreements.',emoji:'ðŸŒ'},
    {date:'Mar 2026',event:'US Federal Reserve Meeting',impact:'Interest rate decision will move markets and affect crypto/gold.',emoji:'ðŸ¦'},
    {date:'Apr 2026',event:'IMF World Economic Outlook',impact:'Global growth revisions. Key for EM market direction.',emoji:'ðŸ“Š'},
    {date:'Q2 2026',event:'European Parliament Elections',impact:'Could shift EU policy on AI regulation and climate.',emoji:'ðŸ‡ªðŸ‡º'},
    {date:'2026',event:'AI Safety Summit Series',impact:'Defining moment for global AI governance.',emoji:'ðŸ¤–'},
    {date:'2026',event:'Global Longevity Conference',impact:'First major commercial longevity treatments expected to show Phase 3 results.',emoji:'ðŸ§¬'},
  ],
},
{
  opinions:[
    {name:'Elon Musk',role:'CEO Tesla & SpaceX',avatar:'âš¡',opinion:'The most important thing we can do this decade is make humanity multi-planetary. Everything else is noise compared to civilizational risk.',date:()=>getFreshDate()},
    {name:'Christine Lagarde',role:'ECB President',avatar:'ðŸ‡ªðŸ‡º',opinion:'The era of near-zero interest rates is over. Central banks must prioritize inflation credibility over short-term growth pain.',date:()=>getFreshDate()},
    {name:'Sam Altman',role:'OpenAI CEO',avatar:'ðŸ§ ',opinion:'We are approaching the point where AI does most of the cognitive work. Humanity\'s job is to figure out what we actually want.',date:()=>getFreshDate()},
    {name:'Anne Applebaum',role:'Historian & Journalist',avatar:'ðŸ“–',opinion:'We are in a global battle between democracy and autocracy. The outcome will determine the structure of civilization for a century.',date:()=>getFreshDate()},
  ],
  events:[
    {date:'Q2 2026',event:'NATO Defense Budget Review',impact:'Alliance spending commitments will signal European security posture.',emoji:'ðŸ›¡ï¸'},
    {date:'2026',event:'BRICS Expansion Discussions',impact:'New members could reshape global trade settlements and dollar alternatives.',emoji:'ðŸŒ'},
    {date:'Mid 2026',event:'US-China Trade Summit',impact:'Tariff negotiations and technology transfer restrictions will impact global supply chains.',emoji:'ðŸ¤'},
    {date:'2026',event:'COP31 Climate Conference',impact:'Critical year for emissions targets â€” 2030 benchmarks now in view.',emoji:'ðŸŒ±'},
    {date:'Q3 2026',event:'UN General Assembly',impact:'Major geopolitical flashpoints will dominate multilateral debate.',emoji:'ðŸ›ï¸'},
    {date:'Late 2026',event:'Global AI Governance Treaty',impact:'First international AI regulation framework expected to be drafted.',emoji:'ðŸ¤–'},
  ],
},
{
  opinions:[
    {name:'Yuval Noah Harari',role:'Author & Historian',avatar:'ðŸ“š',opinion:'The most dangerous technology in history is not the nuclear bomb â€” it is AI combined with biotech. For the first time, humans can redesign life itself.',date:()=>getFreshDate()},
    {name:'Janet Yellen',role:'US Treasury Secretary',avatar:'ðŸ’µ',opinion:'Fiscal responsibility is not optional. Countries that ignore debt sustainability will face currency crises within the decade.',date:()=>getFreshDate()},
    {name:'Demis Hassabis',role:'Google DeepMind CEO',avatar:'ðŸ§¬',opinion:'AlphaFold was just the beginning. AI will solve most of biology within ten years. Cancer, aging, and neurodegeneration will all be cracked.',date:()=>getFreshDate()},
    {name:'Gita Gopinath',role:'IMF Deputy MD',avatar:'ðŸŒ',opinion:'Fragmentation of the global economy into competing blocs will reduce world GDP by 7% â€” comparable to losing Germany\'s entire economy.',date:()=>getFreshDate()},
  ],
  events:[
    {date:'Q1 2026',event:'India General Economy Report',impact:'India now world\'s most populous economy â€” watch for rupee internationalization moves.',emoji:'ðŸ‡®ðŸ‡³'},
    {date:'2026',event:'Arctic Resources Summit',impact:'Melting ice opens new shipping lanes and resource competition. Russia, US, Canada all staking claims.',emoji:'ðŸ§Š'},
    {date:'Mid 2026',event:'Semiconductor Sovereignty Drive',impact:'US CHIPS Act factories coming online â€” reshaping global chip supply chain.',emoji:'ðŸ’¾'},
    {date:'Q2 2026',event:'Water Security Crisis Talks',impact:'17 countries facing absolute water scarcity â€” new international agreements being drafted.',emoji:'ðŸ’§'},
    {date:'2026',event:'Space Economy Milestone',impact:'Commercial space industry projected to hit $1T â€” tourism, satellites, and mining.',emoji:'ðŸš€'},
    {date:'Late 2026',event:'Pandemic Preparedness Treaty',impact:'WHO global health security framework vote â€” post-COVID lessons being institutionalized.',emoji:'ðŸ¥'},
  ],
},
];
const WORLD_DATA=WORLD_DATA_SETS[0];
let worldRefreshIdx=0;

function getFreshDate(){
  const d=new Date();
  const opts={month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'};
  return d.toLocaleDateString('en',opts);
}

function refreshWorldFeed(){
  worldRefreshIdx=(worldRefreshIdx+1)%WORLD_DATA_SETS.length;
  const el=document.getElementById('worldLastUpdated');
  if(el)el.textContent='Updated: '+new Date().toLocaleString('en',{weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})+' Â· Live';
  buildWorldPanels();
  showToast('ðŸ”„ World feed refreshed â€” new perspectives loaded!');
}

function buildWorldPanels(){
  const ds=WORLD_DATA_SETS[worldRefreshIdx]||WORLD_DATA_SETS[0];
  // Opinions
  const opEl=document.getElementById('opinionsDisplay');
  if(opEl){
    opEl.innerHTML=ds.opinions.map(o=>`
      <div class="card" style="margin-bottom:10px;background:linear-gradient(135deg,rgba(124,58,237,.06),rgba(6,182,212,.06))">
        <div style="display:flex;gap:10px;align-items:flex-start">
          <div style="font-size:28px;flex-shrink:0">${o.avatar}</div>
          <div>
            <div style="font-weight:700;font-size:13px">${o.name}</div>
            <div style="font-size:11px;color:var(--text3);margin-bottom:6px">${o.role}</div>
            <div style="font-size:13px;color:var(--text2);line-height:1.6;font-style:italic">"${o.opinion}"</div>
            <div style="font-size:10px;color:var(--accent);margin-top:6px">ðŸ“… ${o.date()}</div>
          </div>
        </div>
      </div>`).join('');
  }
  // Events
  const evEl=document.getElementById('eventsDisplay');
  if(evEl){
    evEl.innerHTML=ds.events.map(ev=>`
      <div style="display:flex;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);align-items:flex-start">
        <div style="font-size:24px;flex-shrink:0">${ev.emoji}</div>
        <div>
          <div style="font-weight:700;font-size:13px">${ev.event}</div>
          <div style="font-size:11px;color:var(--accent);font-weight:600;margin-bottom:2px">${ev.date}</div>
          <div style="font-size:12px;color:var(--text3)">${ev.impact}</div>
        </div>
      </div>`).join('');
  }
  // Update world last updated timestamp
  const el=document.getElementById('worldLastUpdated');
  if(el)el.textContent='Updated: '+new Date().toLocaleString('en',{weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})+' Â· Live';
}

// â”€â”€â”€ THEME ENGINE EXPANSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ALL_THEMES=[
  {id:'light',name:'Pure Light',color:'#f8f6ff'},
  {id:'dark',name:'Deep Night',color:'#0f0a1e'},
  {id:'scifi',name:'Sci-Fi',color:'#020818'},
  {id:'natural',name:'Natural',color:'#f0f7ee'},
  {id:'spiritual',name:'Spiritual',color:'#1a0a2e'},
  {id:'classic',name:'Classic',color:'#faf8f0'},
  {id:'winter',name:'Winter',color:'#e8f4ff'},
  {id:'summer',name:'Summer',color:'#fff8e8'},
  // NEW v7 themes
  {id:'spring',name:'Spring ðŸŒ¸',color:'#f0fff4'},
  {id:'autumn',name:'Autumn ðŸ‚',color:'#fff8f0'},
  {id:'feminine',name:'Feminine ðŸ’œ',color:'#fff0f8'},
  {id:'masculine',name:'Masculine ðŸ”µ',color:'#0f1923'},
  {id:'ocean',name:'Ocean ðŸŒŠ',color:'#f0f8ff'},
  {id:'galaxy',name:'Galaxy ðŸŒŒ',color:'#050010'},
];

function buildThemeGrid(){
  const grid=document.getElementById('themeGrid');
  if(!grid)return;
  const cur=localStorage.getItem('cos_theme')||'light';
  grid.style.gridTemplateColumns='repeat(3,1fr)';
  grid.innerHTML=ALL_THEMES.map(th=>`
    <div class="theme-swatch${th.id===cur?' active':''}" onclick="applyTheme('${th.id}',this)">
      <div class="ts-circle" style="background:${th.color};border:2px solid #ccc"></div>
      <div class="ts-name">${th.name}</div>
    </div>`).join('');
}

function applyTheme(theme,el){
  document.documentElement.setAttribute('data-theme',theme);
  localStorage.setItem('cos_theme',theme);
  document.querySelectorAll('.theme-swatch').forEach(s=>s.classList.remove('active'));
  if(el)el.classList.add('active');
  const isDark=['dark','scifi','spiritual','masculine','galaxy'].includes(theme);
  document.getElementById('themeBtn').textContent=isDark?'â˜€ï¸':'ðŸŒ™';
  showToast('ðŸŽ¨ '+ALL_THEMES.find(t=>t.id===theme)?.name+' theme applied!');
}

// â”€â”€â”€ GUIDE EXPAND Q â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function expandQ(el){
  const ans=el.querySelector('.q-answer');
  const hint=el.querySelector('.q-answer+*')||el.children[1];
  if(ans.style.display==='none'||!ans.style.display){
    ans.style.display='block';
    el.querySelector('div:nth-child(2)').textContent='Tap to close â–²';
  }else{
    ans.style.display='none';
    el.querySelector('div:nth-child(2)').textContent='Tap to explore â–¼';
  }
}

// â”€â”€â”€ DATA ARCHITECTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DATA_SCHEMA=[
  {key:'cos_v7_users',title:'User Profiles',schema:`[{id, name, username, email, phone, password(hashed), avatar, created, theme}]`,desc:'All registered user profiles for multi-user support'},
  {key:'cos_v7_current',title:'Active Session',schema:`"user_id"`,desc:'ID of the currently logged-in user'},
  {key:'cos_logs',title:'Consciousness Logs',schema:`[{id, date, score, focus, mood, sleep, emotion, thought, insight, goal, ...sliders}]`,desc:'Daily consciousness entries with 15 metrics per entry'},
  {key:'cos_dreams',title:'Dream Journal',schema:`[{id, date, title, type, desc, vividness, lucidity, signs, emotions}]`,desc:'Dream records with lucidity scores and emotional data'},
  {key:'cos_theme',title:'Active Theme',schema:`"theme_name"`,desc:'Currently applied UI theme'},
  {key:'cos_lang',title:'Language',schema:`"en|hi|es|..."`,desc:'Selected interface language'},
  {key:'cos_alarms',title:'Alarms',schema:`[{id, time, label, on, repeat}]`,desc:'Consciousness alarms and reminders'},
  {key:'cos_reminders',title:'Reminders',schema:`[{id, text, time, repeat}]`,desc:'Custom user reminders'},
  {key:'cos_settings',title:'Settings',schema:`{notifications, anchors, adaptiveMode, ...}`,desc:'All app configuration settings'},
  {key:'cos_rc_count',title:'Reality Checks',schema:`number`,desc:'Count of reality checks done today'},
  {key:'cos_voice_memos',title:'Voice Memos',schema:`[{id, date, duration, transcript, blob}]`,desc:'Recorded voice memos'},
  {key:'passiveData',title:'Passive Telemetry',schema:`{sessionStart, interactions, typingEvents, idleEvents, score}`,desc:'Auto-tracked cognitive behavior signals'},
];

function buildDataArchitecture(){
  const el=document.getElementById('dataArchDisplay');
  if(!el)return;
  el.innerHTML=DATA_SCHEMA.map(d=>{
    const stored=localStorage.getItem(d.key);
    let count='â€”';
    try{const v=JSON.parse(stored||'null');if(Array.isArray(v))count=v.length+' records';else if(v)count='âœ“ set';}catch(e){}
    return`<div class="arch-node" onclick="this.classList.toggle('expanded')">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="an-title">${d.key}</div>
        <span class="an-count">${count}</span>
      </div>
      <div style="font-size:12px;font-weight:600;color:var(--text);margin:3px 0">${d.title}</div>
      <div style="font-size:11px;color:var(--text3);margin-bottom:4px">${d.desc}</div>
      <div class="an-schema">${d.schema}</div>
    </div>`;
  }).join('');

  // Storage usage
  const usageEl=document.getElementById('storageUsageDisplay');
  if(usageEl){
    let total=0;
    Object.keys(localStorage).forEach(k=>{total+=localStorage.getItem(k).length;});
    const kb=(total/1024).toFixed(1);
    const pct=Math.min(100,(total/(5*1024*1024)*100)).toFixed(1);
    usageEl.innerHTML=`
      <div style="font-size:13px;color:var(--text2);margin-bottom:8px">
        Using <strong>${kb} KB</strong> of ~5 MB localStorage limit (${pct}%)
      </div>
      <div class="progress-bar-wrap" style="margin-bottom:8px">
        <div class="progress-bar-fill" style="width:${pct}%"></div>
      </div>
      <div style="font-size:12px;color:var(--text3)">All data stored locally on your device. No cloud upload unless you sign in with cloud sync enabled.</div>`;
  }

  // Profile data
  const profEl=document.getElementById('profileDataDisplay');
  if(profEl){
    const users=getUsers();
    profEl.innerHTML=users.length?users.map(u=>`
      <div style="background:var(--bg3);border-radius:10px;padding:10px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:20px">${u.avatar||'ðŸ‘¤'}</span>
          <div><div style="font-weight:700;font-size:13px">${u.name}</div><div style="font-size:11px;color:var(--text3)">${u.username} Â· ${new Date(u.created).toLocaleDateString()}</div></div>
        </div>
        <span style="font-size:10px;color:var(--accent)">${u.isGuest?'Guest':u.isGoogle?'Google':'Local'}</span>
      </div>`).join('')
    :'<div class="empty-state"><span class="es-icon">ðŸ‘¤</span><div class="es-text">No profiles yet. Create an account.</div></div>';
  }
}

// â”€â”€â”€ OVERRIDE buildThemes to use new grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initNewFeatures_v7(){
  // Build new theme grid
  buildThemeGrid();
  // Build world panels
  buildWorldPanels();
  // Data arch
  buildDataArchitecture();
  // Check login state
  const user=getCurrentUser();
  if(user){
    loadUserProfile(user);
    buildProfileBar();
  }
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init(){
  const th=localStorage.getItem('cos_theme')||'light';
  document.documentElement.setAttribute('data-theme',th);
  document.getElementById('themeBtn').textContent=th==='dark'?'â˜€ï¸':'ðŸŒ™';
  const today=new Date().toISOString().split('T')[0];
  if(document.getElementById('logDate'))document.getElementById('logDate').value=today;
  if(document.getElementById('dreamDate'))document.getElementById('dreamDate').value=today;
  loadSettings();
  buildNav();buildSliders();buildBWGrid();buildAIModelsBar();buildSuggestedQs();
  const tr2=document.querySelector('.topbar-row2');if(tr2)enableDragScroll(tr2);
  buildHealthSections();buildGamesGrid();buildTechniques();buildRCGrid();
  renderRecentLogs();renderDreamJournal();renderVoiceMemos();renderMediaGrid();renderCalendar();renderAlarms();renderReminders();
  const today2=new Date().toDateString();
  if(localStorage.getItem('cos_rc_day')===today2){
    const cnt=parseInt(localStorage.getItem('cos_rc_count')||0);
    if(document.getElementById('rcCount'))document.getElementById('rcCount').textContent=cnt;
    if(document.getElementById('rcProgress'))document.getElementById('rcProgress').style.width=Math.min(100,cnt/15*100)+'%';
  }
  setInterval(checkAlarms,30000);
  const sl=localStorage.getItem('cos_lang')||'en';curLang=sl;
  try{document.getElementById('langSel').value=sl;}catch(e){}try{document.getElementById('settingLang').value=sl;}catch(e){}
  setTimeout(()=>{const logs=getLogs();addChatMsg('ai',logs.length?`Hello! ðŸ‘‹ I see you have ${logs.length} consciousness entries. ${Math.random()>.5?'How are you feeling today?':'What\'s on your mind?'}`:"Welcome to Consciousness OS v7! ðŸ§  I'm your AI Digital Twin. Fill your first Daily Log and I'll start learning your patterns. What's your name?",'twin');},600);
  loadDailyTip();
  initNewFeatures_v7();
  initNewFeatures();
  // Science timestamp
  updateScienceTimestamp();
  buildScienceDisplay();
  // World feed
  refreshWorldFeed();
  // Show login if no user
  const user=getCurrentUser();
  if(!user){
    setTimeout(()=>openLoginOverlay(),500);
  }else if(!localStorage.getItem('cos_visited')){
    localStorage.setItem('cos_visited','1');
    setTimeout(()=>showOnboarding(),1500);
  }
}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>