<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Consciousness OS v7.0</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=DM+Sans:wght@300;400;500;600&family=Space+Mono&display=swap" rel="stylesheet">
<style>
:root{--bg:#f8f6ff;--bg2:#ffffff;--bg3:#f0eeff;--bg4:#e8e4ff;--text:#1a1035;--text2:#4a4070;--text3:#8878b0;--border:#e0d8f8;--border2:#c8bcf0;--primary:#7c3aed;--primary2:#6d28d9;--primary-glow:rgba(124,58,237,.22);--accent:#06b6d4;--accent2:#0891b2;--secondary:#ec4899;--secondary2:#db2777;--success:#10b981;--danger:#ef4444;--warning:#f59e0b;--nav-bg:#ffffff;--nav-border:rgba(124,58,237,.12);--card-shadow:0 2px 16px rgba(124,58,237,.08);--font-head:'Syne',sans-serif;--font-body:'DM Sans',sans-serif;--font-mono:'Space Mono',monospace;--radius:14px;--radius-sm:8px;--radius-lg:20px;--topbar-h:52px;--nav-h:62px}
[data-theme="dark"]{--bg:#0e0b1a;--bg2:#16102a;--bg3:#1e1638;--bg4:#261e48;--text:#f0eeff;--text2:#b8a8e8;--text3:#7060a8;--border:#2a2050;--border2:#3a2870;--primary:#a78bfa;--primary2:#7c3aed;--primary-glow:rgba(167,139,250,.2);--accent:#22d3ee;--secondary:#f472b6;--nav-bg:#16102a;--nav-border:rgba(167,139,250,.15);--card-shadow:0 2px 20px rgba(0,0,0,.4)}
[data-theme="scifi"]{--bg:#000d1a;--bg2:#001428;--bg3:#001f3d;--bg4:#002a52;--text:#00ffff;--text2:#00cccc;--text3:#007777;--border:#003366;--border2:#004488;--primary:#00ffff;--primary2:#00aaaa;--primary-glow:rgba(0,255,255,.2);--accent:#ff00ff;--secondary:#ffff00;--success:#00ff88;--danger:#ff3366;--nav-bg:#001428;--nav-border:rgba(0,255,255,.2);--card-shadow:0 0 20px rgba(0,255,255,.07);--font-head:'Space Mono',monospace;--font-body:'Space Mono',monospace}
[data-theme="natural"]{--bg:#f0f7f0;--bg2:#ffffff;--bg3:#e4f0e4;--bg4:#d4e8d4;--text:#1a2e1a;--text2:#3a5c3a;--text3:#6a8c6a;--border:#c0d8c0;--border2:#a0c0a0;--primary:#2d7a2d;--primary2:#1f5a1f;--primary-glow:rgba(45,122,45,.2);--accent:#5ba85b;--secondary:#cd853f;--nav-bg:#ffffff;--nav-border:rgba(45,122,45,.12);--card-shadow:0 2px 16px rgba(45,122,45,.08)}
[data-theme="spiritual"]{--bg:#faf5eb;--bg2:#fffef9;--bg3:#f5f0e0;--bg4:#ede5cc;--text:#2c1810;--text2:#6b4c30;--text3:#9b7c5c;--border:#ddd0b0;--border2:#c8b890;--primary:#b8860b;--primary2:#9a6e00;--primary-glow:rgba(184,134,11,.2);--accent:#800080;--secondary:#dc143c;--success:#228b22;--nav-bg:#fffef9;--nav-border:rgba(184,134,11,.12);--card-shadow:0 2px 16px rgba(184,134,11,.1)}
[data-theme="classic"]{--bg:#fafaf8;--bg2:#ffffff;--bg3:#f5f5f0;--bg4:#eeeeea;--text:#1a1a1a;--text2:#444444;--text3:#888888;--border:#e0e0e0;--border2:#cccccc;--primary:#1a1a6e;--primary2:#12125a;--primary-glow:rgba(26,26,110,.15);--accent:#8b0000;--secondary:#006400;--nav-bg:#ffffff;--nav-border:rgba(0,0,0,.1);--card-shadow:0 1px 8px rgba(0,0,0,.06)}
[data-theme="winter"]{--bg:#e8f4fc;--bg2:#f0f8ff;--bg3:#dceef8;--bg4:#c8e4f4;--text:#0a1a2e;--text2:#1e4060;--text3:#507898;--border:#b8d8f0;--border2:#90c0e8;--primary:#1565c0;--primary2:#0d47a1;--primary-glow:rgba(21,101,192,.2);--accent:#42a5f5;--secondary:#7e57c2;--nav-bg:#f0f8ff;--nav-border:rgba(21,101,192,.15);--card-shadow:0 2px 16px rgba(21,101,192,.08)}
[data-theme="summer"]{--bg:#fff9e8;--bg2:#fffef5;--bg3:#fff3d0;--bg4:#ffe8b0;--text:#2a1500;--text2:#5c3a00;--text3:#9c6a20;--border:#f0d880;--border2:#e8c840;--primary:#f59e0b;--primary2:#d97706;--primary-glow:rgba(245,158,11,.25);--accent:#ef4444;--secondary:#10b981;--nav-bg:#fffef5;--nav-border:rgba(245,158,11,.2);--card-shadow:0 2px 16px rgba(245,158,11,.1)}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;padding-top:var(--topbar-h);padding-bottom:calc(var(--nav-h)+8px);transition:background .3s,color .3s}
h1,h2,h3,.h-font{font-family:var(--font-head)}
button{font-family:var(--font-body);cursor:pointer}
input,textarea,select{font-family:var(--font-body)}
[data-theme="scifi"] .card{border:1px solid rgba(0,255,255,.2)!important}
[data-theme="scifi"] .topbar-logo{-webkit-text-fill-color:unset;color:#00ffff;text-shadow:0 0 10px rgba(0,255,255,.4)}
[data-theme="scifi"] .nav-tab.active{color:#00ffff;text-shadow:0 0 8px rgba(0,255,255,.4)}
[data-theme="scifi"] .btn-primary{background:transparent;border:1px solid #00ffff;color:#00ffff;box-shadow:0 0 10px rgba(0,255,255,.2)}
/* TOPBAR */
.topbar{position:fixed;top:0;left:0;right:0;height:var(--topbar-h);background:var(--nav-bg);border-bottom:1px solid var(--nav-border);display:flex;align-items:center;justify-content:space-between;padding:0 12px;z-index:200;backdrop-filter:blur(10px)}
.topbar-logo{font-family:var(--font-head);font-weight:800;font-size:15px;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap}
.topbar-right{display:flex;align-items:center;gap:5px}
.icon-btn{background:none;border:1px solid var(--border);border-radius:8px;padding:5px 7px;font-size:13px;color:var(--text2);transition:all .2s}
.icon-btn:hover{background:var(--bg3);border-color:var(--primary)}
.lang-sel{font-size:12px;border:1px solid var(--border);border-radius:8px;padding:4px 7px;background:var(--bg2);color:var(--text);cursor:pointer}
/* BOTTOM NAV */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:var(--nav-h);background:var(--nav-bg);border-top:1px solid var(--nav-border);display:flex;z-index:200;backdrop-filter:blur(10px)}
.nav-tab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;border:none;background:none;color:var(--text3);font-size:10px;font-family:var(--font-body);font-weight:500;padding:6px 2px;transition:all .2s;border-top:2px solid transparent}
.nav-tab.active{color:var(--primary);border-top-color:var(--primary)}
.nav-tab .ni{font-size:18px;line-height:1}
/* PANELS */
.tab-panel{display:none;min-height:calc(100vh - var(--topbar-h) - var(--nav-h))}
.tab-panel.active{display:block}
/* SUB-NAV */
.sub-nav{display:flex;gap:6px;overflow-x:auto;padding:10px 12px 8px;background:var(--bg2);border-bottom:1px solid var(--border);position:sticky;top:var(--topbar-h);z-index:100;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.sub-nav::-webkit-scrollbar{display:none}
.sub-btn{flex-shrink:0;padding:7px 16px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg2);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.sub-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.sub-section{display:none}.sub-section.active{display:block}
.section-content{padding:12px;max-width:680px;margin:0 auto}
/* CARDS */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:12px;box-shadow:var(--card-shadow);transition:all .3s}
.card-title{font-family:var(--font-head);font-weight:700;font-size:15px;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.card-title .emoji{font-size:20px}
/* SCORE RING */
.score-ring-wrap{display:flex;flex-direction:column;align-items:center;margin:4px 0 8px}
.score-ring{position:relative;width:100px;height:100px}
.score-ring svg{width:100px;height:100px;transform:rotate(-90deg)}
.score-ring circle{fill:none;stroke:var(--bg3);stroke-width:8}
#scoreCircle{stroke:var(--primary);stroke-dasharray:263;stroke-dashoffset:132;stroke-linecap:round;transition:stroke-dashoffset .5s,stroke .5s}
.score-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.score-val{font-family:var(--font-head);font-weight:800;font-size:24px;color:var(--primary)}
.score-lbl{font-size:9px;color:var(--text3);font-weight:600}
/* SLIDERS */
.slider-group{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-bottom:8px}
.slider-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.slider-label{font-weight:600;font-size:13px}
.slider-value-badge{background:var(--primary);color:#fff;width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;font-family:var(--font-head)}
.slider-track{width:100%;height:6px;-webkit-appearance:none;border-radius:6px;background:linear-gradient(to right,var(--primary) var(--pct,50%),var(--bg3) var(--pct,50%));outline:none;cursor:pointer;margin:4px 0}
.slider-track::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--primary);border:3px solid var(--bg2);box-shadow:0 2px 8px var(--primary-glow);cursor:pointer}
.slider-dots{display:flex;justify-content:space-between;margin:6px 0 4px}
.slider-dot{width:22px;height:22px;border-radius:50%;background:var(--bg3);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;cursor:pointer;transition:all .2s;color:var(--text3)}
.slider-dot.active{background:var(--primary);border-color:var(--primary);color:#fff;transform:scale(1.2);box-shadow:0 2px 8px var(--primary-glow)}
.slider-dot.near{background:rgba(124,58,237,.15);border-color:var(--primary);color:var(--primary)}
.slider-pair-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--text3);margin-top:2px;padding:0 2px}
.slider-anchor-text{font-size:11px;color:var(--primary);font-weight:500;margin-top:4px;padding:4px 8px;background:rgba(124,58,237,.06);border-radius:6px}
/* SLIDER CAT NAV */
.slider-cat-nav{display:flex;gap:6px;overflow-x:auto;padding:8px 12px;background:var(--bg2);border-bottom:1px solid var(--border);-webkit-overflow-scrolling:touch;scrollbar-width:none}
.slider-cat-nav::-webkit-scrollbar{display:none}
.scat-btn{flex-shrink:0;padding:6px 14px;border-radius:16px;border:1.5px solid var(--border);background:var(--bg2);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.scat-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.slider-cat-group{display:none;padding:8px 12px}
.slider-cat-group.active{display:block}
/* FORMS */
.form-group{margin-bottom:10px}
.form-label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:4px}
.form-input,.form-select,.form-textarea{width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:var(--radius-sm);background:var(--bg);color:var(--text);font-size:14px;transition:border-color .2s;outline:none}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow)}
.form-textarea{resize:vertical;min-height:70px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
/* BUTTONS */
.btn{padding:9px 18px;border-radius:var(--radius-sm);font-weight:600;font-size:13px;border:none;transition:all .2s;display:inline-flex;align-items:center;gap:6px;cursor:pointer;font-family:var(--font-body)}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary2));color:#fff;box-shadow:0 3px 12px var(--primary-glow)}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 5px 16px var(--primary-glow)}
.btn-secondary{background:var(--bg3);color:var(--text);border:1px solid var(--border)}
.btn-accent{background:linear-gradient(135deg,var(--accent),var(--accent2,#0891b2));color:#fff}
.btn-danger{background:rgba(239,68,68,.12);color:var(--danger);border:1px solid rgba(239,68,68,.2)}
.btn-sm{padding:6px 12px;font-size:12px;border-radius:6px}
.btn-block{width:100%;justify-content:center}
/* BADGES */
.badge{padding:3px 8px;border-radius:20px;font-size:10px;font-weight:700}
.badge-primary{background:rgba(124,58,237,.12);color:var(--primary)}
.badge-success{background:rgba(16,185,129,.12);color:var(--success)}
.badge-danger{background:rgba(239,68,68,.12);color:var(--danger)}
.badge-warning{background:rgba(245,158,11,.12);color:var(--warning)}
.badge-accent{background:rgba(6,182,212,.12);color:var(--accent)}
.chip{display:inline-flex;align-items:center;padding:4px 10px;border-radius:20px;background:var(--bg3);border:1px solid var(--border);font-size:12px;margin:3px;cursor:pointer;transition:all .2s}
.chip:hover,.chip.active{background:var(--primary);color:#fff;border-color:var(--primary)}
/* BW */
.bw-card{background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--radius);padding:12px;cursor:pointer;transition:all .2s}
.bw-card:hover{border-color:var(--primary)}.bw-card.playing{background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(6,182,212,.06));border-color:var(--primary)}
.bw-emoji{font-size:22px}.bw-name{font-family:var(--font-head);font-weight:700;font-size:13px;margin-top:4px}
.bw-desc{font-size:11px;color:var(--text3);margin-top:2px}.bw-freq{font-size:10px;color:var(--primary);font-weight:700;margin-top:4px}
.bw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.bw-bar{width:5px;border-radius:3px;background:linear-gradient(var(--primary),var(--accent));display:inline-block}
.bw-bar.animating{animation:barPulse var(--dur,.5s) ease-in-out infinite alternate}
@keyframes barPulse{from{height:6px;opacity:.4}to{height:38px;opacity:1}}
.wave-btn{padding:6px 12px;border-radius:6px;border:1.5px solid var(--border);background:var(--bg2);color:var(--text2);font-size:12px;cursor:pointer;transition:all .2s}
.wave-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.bw-visualizer{display:flex;align-items:flex-end;gap:3px;height:46px;justify-content:center}
/* CHAT */
.chat-messages{min-height:180px;max-height:380px;overflow-y:auto;padding:8px;display:flex;flex-direction:column;gap:8px;background:var(--bg);border-radius:var(--radius-sm)}
.chat-msg{max-width:85%;padding:10px 12px;border-radius:12px;font-size:13px;line-height:1.6;word-break:break-word}
.chat-msg.user{align-self:flex-end;background:linear-gradient(135deg,var(--primary),var(--primary2));color:#fff;border-radius:12px 12px 2px 12px}
.chat-msg.ai{align-self:flex-start;background:var(--bg2);border:1px solid var(--border);border-radius:12px 12px 12px 2px}
.ai-tag{font-size:10px;font-weight:700;color:var(--primary);margin-bottom:4px;letter-spacing:.5px}
.ai-loading{display:flex;gap:4px;align-items:center;padding:2px 0}
.ai-loading span{width:7px;height:7px;border-radius:50%;background:var(--text3);animation:ldot .9s ease infinite}
.ai-loading span:nth-child(2){animation-delay:.15s}.ai-loading span:nth-child(3){animation-delay:.3s}
@keyframes ldot{0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1}}
.chat-input-row{display:flex;gap:8px;margin-top:8px}
.chat-input-row textarea{flex:1;resize:none;height:40px;padding:8px 12px;font-size:14px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--bg);color:var(--text);outline:none;transition:border-color .2s}
.chat-input-row textarea:focus{border-color:var(--primary)}
.ai-model-btn{flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:2px;padding:7px 10px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--bg2);cursor:pointer;transition:all .2s;min-width:60px}
.ai-model-btn.active{border-color:var(--primary);background:rgba(124,58,237,.08)}
.ai-logo{font-size:16px}.ai-name{font-size:10px;font-weight:600;color:var(--text2)}
.sq-btn{padding:6px 12px;border-radius:20px;border:1px solid var(--border);background:var(--bg2);color:var(--text2);font-size:12px;cursor:pointer;transition:all .2s;white-space:nowrap;flex-shrink:0}
.sq-btn:hover{border-color:var(--primary);color:var(--primary)}
.suggested-qs{display:flex;gap:6px;overflow-x:auto;padding:4px 0;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.suggested-qs::-webkit-scrollbar{display:none}
/* GAMES */
.games-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.game-card{background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--radius);padding:12px;cursor:pointer;transition:all .2s;text-align:center}
.game-card:hover{border-color:var(--primary);transform:translateY(-2px);box-shadow:0 6px 20px var(--primary-glow)}
.g-emoji{font-size:26px}.g-name{font-family:var(--font-head);font-weight:700;font-size:13px;margin-top:4px}
.g-desc{font-size:11px;color:var(--text3);margin-top:2px}.g-tag{font-size:10px;color:var(--primary);font-weight:600;margin-top:3px}
.game-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;padding:10px 0 0}
.game-score-bar{display:flex;gap:12px;margin-bottom:12px}
.gs{background:var(--bg3);border-radius:var(--radius-sm);padding:8px 14px;flex:1;text-align:center}
.gsv{font-family:var(--font-head);font-weight:800;font-size:22px;color:var(--primary)}.gsl{font-size:10px;color:var(--text3)}
.sudoku-cell{aspect-ratio:1;background:var(--bg2);display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;cursor:pointer;border:1px solid var(--border);transition:background .15s}
.sudoku-cell.given{color:var(--text3);cursor:default}.sudoku-cell.selected{background:rgba(124,58,237,.15)}
.sudoku-num{background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:8px 4px;text-align:center;font-weight:700;font-size:16px;cursor:pointer;transition:all .2s}
.sudoku-num:hover{background:var(--primary);color:#fff}
/* DREAMS */
.technique-card{background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--radius);margin-bottom:8px;overflow:hidden}
.tc-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;cursor:pointer}
.tc-title{font-weight:700;font-size:13px}.tc-chevron{transition:transform .3s;font-size:12px;color:var(--text3)}
.technique-card.open .tc-chevron{transform:rotate(180deg)}
.tc-body{display:none;padding:0 14px 12px;font-size:13px;color:var(--text2);line-height:1.7;border-top:1px solid var(--border)}
.technique-card.open .tc-body{display:block}
.rc-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.rc-btn{background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--radius);padding:12px 8px;text-align:center;cursor:pointer;transition:all .2s}
.rc-btn:hover{border-color:var(--primary)}.rc-btn.done{background:rgba(16,185,129,.08);border-color:var(--success)}
.rc-icon{font-size:22px}.rc-name{font-size:12px;font-weight:700;margin-top:3px}
.dream-type-btn{padding:7px 14px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.dream-type-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.dream-ai-box{background:linear-gradient(135deg,rgba(124,58,237,.06),rgba(6,182,212,.04));border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-top:10px;font-size:13px;line-height:1.7}
/* HEALTH */
.health-section{display:none}.health-section.active{display:block}
.section-jump{flex-shrink:0;padding:5px 10px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg2);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.section-jump.active{background:var(--primary);color:#fff;border-color:var(--primary)}
/* MEDIA */
.media-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.media-thumb{aspect-ratio:1;border-radius:var(--radius-sm);overflow:hidden;background:var(--bg3)}
.media-thumb img,.media-thumb video{width:100%;height:100%;object-fit:cover}
.memo-item{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px;margin-bottom:8px}
.memo-meta{display:flex;justify-content:space-between;font-size:11px;color:var(--text3);margin-bottom:6px}
.rec-btn{width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;font-size:28px;border:none;cursor:pointer;transition:all .3s;box-shadow:0 4px 16px var(--primary-glow)}
.rec-btn.recording{background:linear-gradient(135deg,var(--danger),#dc2626);animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.4)}50%{box-shadow:0 0 0 12px rgba(239,68,68,0)}}
/* CALENDAR */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px}
.cal-day-header{text-align:center;font-size:10px;font-weight:700;color:var(--text3);padding:4px 0}
.cal-day{text-align:center;padding:6px 2px;border-radius:6px;font-size:12px;cursor:pointer;transition:all .2s;position:relative}
.cal-day.today{background:var(--primary);color:#fff;font-weight:700}
.cal-day.has-log::after{content:'';position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:var(--accent)}
.cal-day.has-dream::before{content:'';position:absolute;top:2px;right:2px;width:4px;height:4px;border-radius:50%;background:var(--secondary)}
.cal-day:hover:not(.today){background:var(--bg3)}
/* ALARMS */
.alarm-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:var(--bg3);border-radius:var(--radius-sm);margin-bottom:6px}
.alarm-toggle{width:44px;height:24px;border-radius:12px;background:var(--bg3);border:2px solid var(--border);position:relative;cursor:pointer;transition:all .3s}
.alarm-toggle.on{background:var(--success);border-color:var(--success)}
.alarm-toggle::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:#fff;top:1px;left:1px;transition:left .3s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.alarm-toggle.on::after{left:21px}
/* ONBOARDING */
#onboardOverlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:1000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.onboard-box{background:var(--bg2);border-radius:var(--radius-lg);padding:24px;max-width:360px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.onboard-step{display:none}.onboard-step.active{display:block}
.odot{width:8px;height:8px;border-radius:50%;background:var(--border);display:inline-block;margin:0 3px;transition:background .2s}
.odot.active{background:var(--primary)}
/* MODALS */
#modalOverlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:500;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(2px)}
#modalOverlay.open{display:flex}
.modal-box{background:var(--bg2);border-radius:20px 20px 0 0;width:100%;max-width:600px;max-height:85vh;overflow-y:auto;padding:20px;box-shadow:0 -8px 40px rgba(0,0,0,.2);animation:slideUp .25s ease}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.modal-title{font-family:var(--font-head);font-weight:800;font-size:18px}
.modal-close{background:var(--bg3);border:none;border-radius:50%;width:32px;height:32px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text2)}
/* THEME GRID */
.theme-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.theme-card{border-radius:var(--radius-sm);overflow:hidden;cursor:pointer;border:2px solid transparent;transition:all .2s}
.theme-card:hover{transform:scale(1.04)}.theme-card.active{border-color:var(--primary)}
.theme-preview{height:48px;display:flex;align-items:center;justify-content:center;gap:6px}
.theme-name{font-size:10px;font-weight:700;text-align:center;padding:4px;background:var(--bg2);color:var(--text2)}
/* WORLD */
.world-stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.world-stat{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:12px;cursor:pointer;transition:all .2s}
.world-stat:hover{border-color:var(--primary);transform:translateY(-1px)}
.ws-icon{font-size:20px;margin-bottom:4px}.ws-label{font-size:11px;color:var(--text3);font-weight:600}
.ws-value{font-family:var(--font-head);font-weight:800;font-size:20px;color:var(--primary)}
.ws-change.up{color:var(--success)}.ws-change.down{color:var(--danger)}
.world-event{padding:12px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .2s}
.world-event:hover{background:var(--bg3)}
.we-title{font-weight:700;font-size:13px}
.we-impact{font-size:12px;color:var(--text2);margin-top:4px;line-height:1.6}
.causal-chain{background:var(--bg3);border-radius:var(--radius);padding:12px;font-size:13px}
.chain-step{display:flex;align-items:flex-start;gap:8px;padding:5px 0}
.chain-arrow{color:var(--primary);font-weight:800;flex-shrink:0;margin-top:2px}
.chain-box{background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:6px 10px;flex:1;font-size:12px;line-height:1.5}
.ticker-item{flex-shrink:0;background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:8px 12px;cursor:pointer;transition:all .2s;text-align:center}
.ticker-item:hover{border-color:var(--primary)}
.tk-sym{font-family:var(--font-head);font-weight:800;font-size:13px}
.tk-val{font-size:11px;color:var(--text2)}.tk-chg{font-size:11px;font-weight:700}
.market-ticker{display:flex;gap:6px;overflow-x:auto;padding:6px 0;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.market-ticker::-webkit-scrollbar{display:none}
/* SCIENCE */
.discovery-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:10px;cursor:pointer;transition:all .2s}
.discovery-card:hover{border-color:var(--primary);transform:translateY(-1px);box-shadow:0 6px 20px var(--primary-glow)}
.dc-cat{font-size:10px;font-weight:700;padding:2px 10px;border-radius:10px;display:inline-block;margin-bottom:8px}
.dc-title{font-family:var(--font-head);font-weight:700;font-size:14px;margin-bottom:6px}
.dc-desc{font-size:12px;color:var(--text2);line-height:1.6}
.dc-wow{font-size:11px;color:var(--primary);font-weight:600;margin-top:6px;background:var(--primary-glow);padding:4px 10px;border-radius:20px;display:inline-block}
.sci-cat-btn{flex-shrink:0;padding:6px 14px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg2);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.sci-cat-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.science-cats{display:flex;gap:6px;overflow-x:auto;padding:6px 0;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.science-cats::-webkit-scrollbar{display:none}
/* PATH */
.path-step{display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)}
.path-num{width:28px;height:28px;border-radius:50%;background:var(--primary);color:#fff;font-weight:800;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-family:var(--font-head)}
.skill-tag{padding:4px 10px;border-radius:20px;border:1px solid var(--border);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;display:inline-block;margin:3px}
.skill-tag.selected{background:var(--primary);color:#fff;border-color:var(--primary)}
/* GUIDE */
.guide-q{font-family:var(--font-head);font-weight:800;font-size:17px;color:var(--primary);margin-bottom:8px;line-height:1.4}
.guide-body{font-size:13px;color:var(--text2);line-height:1.8}
.guide-highlight{background:linear-gradient(135deg,rgba(124,58,237,.06),rgba(6,182,212,.04));border-left:3px solid var(--primary);padding:10px 14px;border-radius:0 8px 8px 0;margin:10px 0;font-size:13px;font-style:italic;color:var(--text2)}
.layer-bar{padding:10px 14px;border-radius:var(--radius-sm);font-size:12px;font-weight:700;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:4px}
/* SETTINGS */
.setting-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border)}
.setting-info{flex:1;padding-right:12px}
.setting-label{font-weight:600;font-size:14px}.setting-sub{font-size:11px;color:var(--text3);margin-top:2px}
.toggle-sw{width:44px;height:24px;border-radius:12px;background:var(--bg3);border:2px solid var(--border);position:relative;cursor:pointer;transition:all .3s;flex-shrink:0}
.toggle-sw.on{background:var(--success);border-color:var(--success)}
.toggle-sw::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:#fff;top:1px;left:1px;transition:left .3s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.toggle-sw.on::after{left:21px}
#settingHelpOverlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:600;display:none;align-items:center;justify-content:center;backdrop-filter:blur(3px)}
#settingHelpOverlay.open{display:flex}
.setting-help-box{background:var(--bg2);border-radius:var(--radius-lg);padding:20px;max-width:320px;width:90%;box-shadow:0 10px 40px rgba(0,0,0,.2)}
/* LEGAL */
.legal-nav{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}
.legal-btn{padding:6px 14px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg2);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.legal-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.legal-page{display:none}.legal-page.active{display:block}
.legal-body{font-size:13px;color:var(--text2);line-height:1.9}
.legal-body h3{font-family:var(--font-head);font-size:15px;font-weight:700;color:var(--text);margin:14px 0 6px}
/* PASSIVE */
.passive-stat{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-bottom:8px;cursor:pointer;transition:all .2s}
.passive-stat:hover{border-color:var(--primary)}
.ps-label{font-size:11px;color:var(--text3);font-weight:600;margin-bottom:4px}
.ps-value{font-family:var(--font-head);font-weight:800;font-size:22px;color:var(--primary)}
.ps-insight{font-size:11px;color:var(--text2);margin-top:4px}
/* STATS */
.stats-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:10px}
.stat-box{background:var(--bg3);border-radius:var(--radius-sm);padding:10px;text-align:center;cursor:pointer;transition:all .2s}
.stat-box:hover{background:var(--bg4)}.sv{font-family:var(--font-head);font-weight:800;font-size:20px;color:var(--primary)}.sl{font-size:10px;color:var(--text3)}
.comparison-box{background:var(--bg3);border-radius:var(--radius-sm);padding:12px;text-align:center}
.cv{font-family:var(--font-head);font-weight:800;font-size:26px}.cl{font-size:11px;color:var(--text3);margin-top:4px}
.trend-item{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--border);font-size:13px;cursor:pointer;transition:background .2s;border-radius:4px}
.trend-item:hover{background:var(--bg3);padding:7px 8px;margin:0 -8px}
/* AI INSIGHT */
.ai-insight-box{background:linear-gradient(135deg,rgba(124,58,237,.06),rgba(6,182,212,.04));border:1px solid var(--border);border-radius:var(--radius);padding:14px;font-size:13px;line-height:1.7}
/* ACCOUNT */
.account-avatar{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 12px;border:3px solid var(--bg2);box-shadow:0 4px 20px var(--primary-glow)}
/* EMPTY */
.empty-state{text-align:center;padding:32px 16px;color:var(--text3)}
.es-icon{font-size:48px;display:block;margin-bottom:8px}.es-text{font-size:14px;font-weight:500}
/* TOAST */
#toast{position:fixed;bottom:calc(var(--nav-h)+12px);left:50%;transform:translateX(-50%) translateY(20px);background:var(--text);color:var(--bg2);padding:10px 20px;border-radius:24px;font-size:13px;font-weight:600;opacity:0;transition:all .3s;z-index:9999;white-space:nowrap;max-width:90vw;overflow:hidden;text-overflow:ellipsis;pointer-events:none}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
@media(min-width:600px){.bw-grid{grid-template-columns:repeat(3,1fr)}.games-grid{grid-template-columns:repeat(3,1fr)}.world-stat-grid{grid-template-columns:repeat(4,1fr)}.form-row{grid-template-columns:1fr 1fr 1fr}.rc-grid{grid-template-columns:repeat(6,1fr)}}
</style>
</head>
<body>
<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-logo">üß† Consciousness OS</div>
  <div class="topbar-right">
    <select class="lang-sel" id="langSel" onchange="setLang(this.value)">
      <option value="en">EN</option><option value="hi">‡§π‡§ø</option><option value="es">ES</option>
      <option value="fr">FR</option><option value="de">DE</option><option value="pt">PT</option>
      <option value="zh">‰∏≠</option><option value="ar">ÿπ</option><option value="ja">Êó•</option><option value="ru">RU</option>
    </select>
    <button class="icon-btn" onclick="showOnboarding()" title="Guide">‚ùì</button>
    <button class="icon-btn" id="themeBtn" onclick="toggleTheme()">üåô</button>
  </div>
</div>
<div id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: SELF
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel active" id="tab-self">
  <!-- Slider Category Nav -->
  <div class="slider-cat-nav" id="sliderCatNav">
    <button class="scat-btn active" onclick="showSliderCat('core',this)">üåü Core</button>
    <button class="scat-btn" onclick="showSliderCat('energy',this)">‚ö° Energy</button>
    <button class="scat-btn" onclick="showSliderCat('mind',this)">üß† Mind</button>
    <button class="scat-btn" onclick="showSliderCat('emotion',this)">üíú Emotion</button>
    <button class="scat-btn" onclick="showSliderCat('advanced',this)">üî¨ Advanced</button>
  </div>
  <div style="padding:10px 12px;max-width:680px;margin:0 auto">
    <!-- Score -->
    <div class="card" style="text-align:center">
      <div class="score-ring-wrap">
        <div class="score-ring">
          <svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="42"/><circle id="scoreCircle" cx="50" cy="50" r="42"/></svg>
          <div class="score-inner"><span class="score-val" id="scoreValue">5.0</span><span class="score-lbl">CONSCIOUSNESS</span></div>
        </div>
      </div>
      <div style="font-size:12px;color:var(--text3);margin-bottom:8px">Today's Reading</div>
    </div>
    <!-- Entry Info -->
    <div class="card">
      <div class="card-title"><span class="emoji">üìã</span> Entry Info</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="logDate"></div>
        <div class="form-group"><label class="form-label">Time of Day</label>
          <select class="form-select" id="logTime"><option>üåÖ Early Morning</option><option>‚òÄÔ∏è Morning</option><option>üå§ Midday</option><option>üåá Afternoon</option><option>üåÜ Evening</option><option>üåô Night</option><option>üåå Late Night</option></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Activity</label><input type="text" class="form-input" id="logActivity" placeholder="Meditation, work, exercise..."></div>
        <div class="form-group"><label class="form-label">Dominant Emotion</label><input type="text" class="form-input" id="logEmotion" placeholder="Calm, excited, anxious..."></div>
      </div>
    </div>
    <!-- Sliders by Category -->
    <div id="slidersContainer">
      <div class="slider-cat-group active" id="scat-core"></div>
      <div class="slider-cat-group" id="scat-energy"></div>
      <div class="slider-cat-group" id="scat-mind"></div>
      <div class="slider-cat-group" id="scat-emotion"></div>
      <div class="slider-cat-group" id="scat-advanced"></div>
    </div>
    <!-- Log details -->
    <div class="card">
      <div class="card-title"><span class="emoji">üí¨</span> Deeper Notes</div>
      <div class="form-group"><label class="form-label">Current Thought Pattern</label><textarea class="form-textarea" id="logThought" placeholder="What's circling in your mind?"></textarea></div>
      <div class="form-group"><label class="form-label">Insight or Realization</label><textarea class="form-textarea" id="logInsight" placeholder="Any breakthrough or new understanding?"></textarea></div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Today's Goal</label><input type="text" class="form-input" id="logGoal" placeholder="What matters most today?"></div>
        <div class="form-group"><label class="form-label">Obstacle</label><input type="text" class="form-input" id="logObstacle" placeholder="What's blocking you?"></div>
      </div>
      <div class="form-group"><label class="form-label">Gratitude</label><input type="text" class="form-input" id="logGratitude" placeholder="3 things you're grateful for..."></div>
    </div>
    <button class="btn btn-primary btn-block" onclick="saveLog()">‚ú® Save Entry</button>
    <!-- Recent Logs -->
    <div class="card" style="margin-top:12px">
      <div class="card-title"><span class="emoji">üìú</span> Recent Entries</div>
      <div id="recentLogs"><div class="empty-state"><span class="es-icon">üìù</span><div class="es-text">No entries yet</div></div></div>
    </div>
    <!-- Passive Tracking -->
    <div class="card">
      <div class="card-title"><span class="emoji">üì°</span> Passive Telemetry</div>
      <div id="passiveStats"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: WORLD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-world">
  <div class="sub-nav" id="worldSubNav">
    <button class="sub-btn active" onclick="showWorldSub('finance',this)">üí∞ Finance</button>
    <button class="sub-btn" onclick="showWorldSub('geo',this)">üåç Geopolitics</button>
    <button class="sub-btn" onclick="showWorldSub('markets',this)">üìà Markets</button>
    <button class="sub-btn" onclick="showWorldSub('crypto',this)">‚Çø Crypto</button>
    <button class="sub-btn" onclick="showWorldSub('commodities',this)">‚ö° Commodities</button>
    <button class="sub-btn" onclick="showWorldSub('worldai',this)">ü§ñ World AI</button>
  </div>
  <!-- Finance -->
  <div class="sub-section active section-content" id="wsub-finance">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üí∞ World Intelligence Panel</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:12px">Understanding forces shaping reality ‚Äî 8D world chess thinking</div>
    <!-- Market tickers -->
    <div class="market-ticker" id="marketTicker"></div>
    <!-- World stats -->
    <div class="world-stat-grid" id="worldStatsGrid"></div>
    <!-- Key events -->
    <div class="card">
      <div class="card-title"><span class="emoji">‚ö°</span> Key Economic Drivers</div>
      <div id="econEvents"></div>
    </div>
    <!-- AI chat about finance -->
    <div class="card">
      <div class="card-title"><span class="emoji">ü§ñ</span> Ask World Intelligence AI</div>
      <div style="font-size:12px;color:var(--text2);margin-bottom:8px">Ask about causal chains: "Will war increase gold?" "How do interest rates affect crypto?"</div>
      <div class="suggested-qs" id="worldSuggested"></div>
      <div class="chat-messages" id="worldChat" style="max-height:280px;margin-top:8px"></div>
      <div class="chat-input-row" style="margin-top:8px">
        <textarea id="worldChatInput" placeholder="Ask about economics, geopolitics..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendWorldChat()}"></textarea>
        <button class="btn btn-primary btn-sm" onclick="sendWorldChat()">‚Üí</button>
      </div>
    </div>
    <!-- Causal chain viz -->
    <div class="card" id="causalChainCard" style="display:none">
      <div class="card-title"><span class="emoji">üîó</span> Causal Chain Analysis</div>
      <div id="causalChainViz"></div>
    </div>
  </div>
  <!-- Geopolitics -->
  <div class="sub-section section-content" id="wsub-geo">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üåç Geopolitical Intelligence</div>
    <div id="geoEvents"></div>
    <div class="card">
      <div class="card-title"><span class="emoji">üó∫Ô∏è</span> Geopolitics ‚Üí Markets Link</div>
      <div id="geoMarketLinks"></div>
    </div>
  </div>
  <!-- Markets -->
  <div class="sub-section section-content" id="wsub-markets">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üìà Markets Overview</div>
    <div id="marketsContent"></div>
    <div class="card">
      <div class="card-title"><span class="emoji">üìä</span> Interest Rates & You</div>
      <div id="ratesContent"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">üå°Ô∏è</span> Inflation Effects</div>
      <div id="inflationContent"></div>
    </div>
  </div>
  <!-- Crypto -->
  <div class="sub-section section-content" id="wsub-crypto">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">‚Çø Crypto Intelligence</div>
    <div id="cryptoContent"></div>
    <div class="card">
      <div class="card-title"><span class="emoji">üîÑ</span> Crypto Cycles</div>
      <div id="cryptoCycles"></div>
    </div>
  </div>
  <!-- Commodities -->
  <div class="sub-section section-content" id="wsub-commodities">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">‚ö° Commodities Cycles</div>
    <div id="commoditiesContent"></div>
  </div>
  <!-- World AI -->
  <div class="sub-section section-content" id="wsub-worldai">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">ü§ñ AI Chat ‚Äî World Intelligence</div>
    <div class="card">
      <div class="card-title"><span class="emoji">üß†</span> Multi-AI Personas for World Analysis</div>
      <div id="worldAIModels" style="display:flex;gap:8px;overflow-x:auto;padding:4px 0;scrollbar-width:none;margin-bottom:10px"></div>
      <div class="chat-messages" id="worldAIChat"></div>
      <div class="chat-input-row">
        <textarea id="worldAIChatInput" placeholder="How do AI companies affect geopolitics? What happens if China invades Taiwan?" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendWorldAIChat()}"></textarea>
        <button class="btn btn-primary btn-sm" onclick="sendWorldAIChat()">‚Üí</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: PATH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-path">
  <div class="sub-nav">
    <button class="sub-btn active" onclick="showPathSub('study',this)">üìö Study</button>
    <button class="sub-btn" onclick="showPathSub('career',this)">üöÄ Career AI</button>
    <button class="sub-btn" onclick="showPathSub('skills',this)">‚ö° Skills</button>
    <button class="sub-btn" onclick="showPathSub('learning',this)">üéØ Strategy</button>
  </div>
  <!-- Study -->
  <div class="sub-section active section-content" id="psub-study">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üìö Cognitive Trajectory Optimizer</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:12px">Connect your self-model to your life direction</div>
    <div class="card">
      <div class="card-title"><span class="emoji">üß≠</span> Your Current Stage</div>
      <div class="form-group"><label class="form-label">Education Stage</label>
        <select class="form-select" id="pathEduStage">
          <option>High School</option><option>Undergraduate</option><option>Postgraduate</option>
          <option>PhD / Research</option><option>Self-directed learning</option><option>Working professional</option><option>Career change</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Primary Domain Interest</label>
        <select class="form-select" id="pathDomain">
          <option>Technology / AI / CS</option><option>Neuroscience / Psychology</option><option>Finance / Economics</option>
          <option>Creative / Arts / Design</option><option>Medicine / Biotech</option><option>Physics / Mathematics</option>
          <option>Philosophy / Consciousness</option><option>Entrepreneurship</option><option>Social Sciences</option><option>Other</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Your Deepest Goal (in 1 sentence)</label>
        <textarea class="form-textarea" id="pathGoal" placeholder="E.g. Understand consciousness and build AI systems that enhance human potential..."></textarea>
      </div>
      <div class="form-group"><label class="form-label">Energy Pattern (from your logs)</label>
        <select class="form-select" id="pathEnergy">
          <option>Morning peak (best thinking before noon)</option><option>Afternoon peak (productive 2-6pm)</option>
          <option>Evening peak (best after 7pm)</option><option>Consistent all day</option><option>Variable / unpredictable</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Cognitive Strengths (select all)</label>
        <div id="pathStrengths" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:4px">
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Pattern Recognition</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Abstract Reasoning</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Creativity</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Systems Thinking</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Deep Focus</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Social Intelligence</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Memory</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Verbal / Writing</span>
          <span class="skill-tag" onclick="this.classList.toggle('selected')">Math / Logic</span>
        </div>
      </div>
      <button class="btn btn-primary btn-block" onclick="generatePathAI()">ü§ñ Generate My Cognitive Trajectory</button>
    </div>
    <div id="pathAIOutput"></div>
  </div>
  <!-- Career -->
  <div class="sub-section section-content" id="psub-career">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üöÄ Career Intelligence</div>
    <div class="card">
      <div class="card-title"><span class="emoji">üéØ</span> Career Path AI</div>
      <div class="chat-messages" id="careerChat"></div>
      <div class="suggested-qs" id="careerSuggested" style="margin-top:8px"></div>
      <div class="chat-input-row" style="margin-top:8px">
        <textarea id="careerChatInput" placeholder="What career fits someone with high creativity and low stress tolerance?" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendCareerChat()}"></textarea>
        <button class="btn btn-primary btn-sm" onclick="sendCareerChat()">‚Üí</button>
      </div>
    </div>
  </div>
  <!-- Skills -->
  <div class="sub-section section-content" id="psub-skills">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">‚ö° Skill Stack Builder</div>
    <div class="card">
      <div class="card-title"><span class="emoji">üî®</span> Build Your Skill Stack</div>
      <div style="font-size:12px;color:var(--text2);margin-bottom:10px">Select domain for optimized skill sequence:</div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px" id="skillDomainBtns"></div>
      <div id="skillStackOutput"></div>
    </div>
  </div>
  <!-- Learning Strategy -->
  <div class="sub-section section-content" id="psub-learning">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üéØ Learning Strategy</div>
    <div id="learningStrategyContent"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: SCIENCE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-science">
  <div class="sub-nav">
    <button class="sub-btn active" onclick="showSciSub('discoveries',this)">üî≠ Discoveries</button>
    <button class="sub-btn" onclick="showSciSub('neuro',this)">üß† Neuroscience</button>
    <button class="sub-btn" onclick="showSciSub('ai',this)">ü§ñ AI Frontier</button>
    <button class="sub-btn" onclick="showSciSub('longevity',this)">‚è≥ Longevity</button>
    <button class="sub-btn" onclick="showSciSub('physics',this)">‚öõÔ∏è Physics</button>
    <button class="sub-btn" onclick="showSciSub('space',this)">üöÄ Space</button>
    <button class="sub-btn" onclick="showSciSub('biotech',this)">üß¨ Biotech</button>
  </div>
  <div class="sub-section active section-content" id="ssub-discoveries">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üî≠ Frontier Intelligence Feed</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:10px">Expanding your possibility space ‚Äî the most mind-bending discoveries shaping the future</div>
    <div class="science-cats" id="sciCatFilter"></div>
    <div id="discoveryFeed" style="margin-top:10px"></div>
  </div>
  <div class="sub-section section-content" id="ssub-neuro"><div id="neuroContent" class="section-content" style="padding:0"></div></div>
  <div class="sub-section section-content" id="ssub-ai"><div id="aiFrontierContent"></div></div>
  <div class="sub-section section-content" id="ssub-longevity"><div id="longevityContent"></div></div>
  <div class="sub-section section-content" id="ssub-physics"><div id="physicsContent"></div></div>
  <div class="sub-section section-content" id="ssub-space"><div id="spaceContent"></div></div>
  <div class="sub-section section-content" id="ssub-biotech"><div id="biotechContent"></div></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: SYSTEM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-system">
  <div class="sub-nav">
    <button class="sub-btn active" onclick="showSystemSub('themes',this)">üé® Themes</button>
    <button class="sub-btn" onclick="showSystemSub('account',this)">üë§ Account</button>
    <button class="sub-btn" onclick="showSystemSub('settings2',this)">‚öôÔ∏è Settings</button>
    <button class="sub-btn" onclick="showSystemSub('guide',this)">üìñ Guide</button>
    <button class="sub-btn" onclick="showSystemSub('legal',this)">‚öñÔ∏è Legal</button>
    <button class="sub-btn" onclick="showSystemSub('data',this)">üíæ Data</button>
    <button class="sub-btn" onclick="showSystemSub('about',this)">‚ÑπÔ∏è About</button>
  </div>
  <!-- Themes -->
  <div class="sub-section active section-content" id="syssub-themes">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 8px">üé® Theme Engine</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:14px">Each theme changes colors, typography, and visual atmosphere to match your consciousness state</div>
    <div class="theme-grid" id="themeGrid"></div>
  </div>
  <!-- Account -->
  <div class="sub-section section-content" id="syssub-account">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 8px">üë§ Identity Layer</div>
    <div id="accountSection"></div>
  </div>
  <!-- Settings -->
  <div class="sub-section section-content" id="syssub-settings2">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 8px">‚öôÔ∏è Settings</div>
    <div class="card">
      <div class="card-title"><span class="emoji">üåê</span> Language</div>
      <select class="form-select" id="settingLang" onchange="setLang(this.value)">
        <option value="en">English</option><option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option><option value="es">Espa√±ol</option>
        <option value="fr">Fran√ßais</option><option value="de">Deutsch</option><option value="pt">Portugu√™s</option>
        <option value="zh">‰∏≠Êñá</option><option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option><option value="ja">Êó•Êú¨Ë™û</option><option value="ru">–†—É—Å—Å–∫–∏–π</option>
      </select>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">üîß</span> Preferences</div>
      <div class="setting-row"><div class="setting-info"><div class="setting-label">Slider Anchors</div><div class="setting-sub">Show descriptions for each slider value</div></div><div style="display:flex;gap:8px;align-items:center"><button class="icon-btn" onclick="showSettingHelp('anchors')">‚ùì</button><div class="toggle-sw" id="settingAnchors" onclick="toggleSetting('anchors')"></div></div></div>
      <div class="setting-row"><div class="setting-info"><div class="setting-label">Auto-Analyze on Save</div><div class="setting-sub">Run AI analysis when you save an entry</div></div><div style="display:flex;gap:8px;align-items:center"><button class="icon-btn" onclick="showSettingHelp('autoAnalyze')">‚ùì</button><div class="toggle-sw" id="settingAutoAnalyze" onclick="toggleSetting('autoAnalyze')"></div></div></div>
      <div class="setting-row"><div class="setting-info"><div class="setting-label">Conversational AI Mode</div><div class="setting-sub">AI asks you questions and remembers context</div></div><div style="display:flex;gap:8px;align-items:center"><button class="icon-btn" onclick="showSettingHelp('convMode')">‚ùì</button><div class="toggle-sw" id="settingConvMode" onclick="toggleSetting('convMode')"></div></div></div>
      <div class="setting-row"><div class="setting-info"><div class="setting-label">Auto-Transcribe Voice</div><div class="setting-sub">Convert voice memos to text automatically</div></div><div style="display:flex;gap:8px;align-items:center"><button class="icon-btn" onclick="showSettingHelp('autoTranscribe')">‚ùì</button><div class="toggle-sw" id="settingAutoTranscribe" onclick="toggleSetting('autoTranscribe')"></div></div></div>
      <div class="setting-row"><div class="setting-info"><div class="setting-label">Reality Check Alerts</div><div class="setting-sub">Notifications every 2 hours</div></div><div style="display:flex;gap:8px;align-items:center"><button class="icon-btn" onclick="showSettingHelp('rc')">‚ùì</button><div class="toggle-sw" id="settingRc" onclick="toggleSetting('rc')"></div></div></div>
      <div class="setting-row"><div class="setting-info"><div class="setting-label">Prompt Enhancement</div><div class="setting-sub">AI improves your questions before sending</div></div><div style="display:flex;gap:8px;align-items:center"><button class="icon-btn" onclick="showSettingHelp('promptBoost')">‚ùì</button><div class="toggle-sw" id="settingPromptBoost" onclick="toggleSetting('promptBoost')"></div></div></div>
      <div class="setting-row"><div class="setting-info"><div class="setting-label">Dark Mode</div><div class="setting-sub">Use dark color scheme</div></div><div class="toggle-sw" id="settingDarkMode" onclick="toggleTheme()"></div></div>
    </div>
  </div>
  <!-- Guide -->
  <div class="sub-section section-content" id="syssub-guide">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 8px">üìñ Consciousness Guide</div>
    <div id="guideContent"></div>
  </div>
  <!-- Legal -->
  <div class="sub-section section-content" id="syssub-legal">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 8px">‚öñÔ∏è Legal & Policy</div>
    <div class="legal-nav" id="legalNav"></div>
    <div id="legalPages"></div>
  </div>
  <!-- Data -->
  <div class="sub-section section-content" id="syssub-data">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 8px">üíæ Your Data</div>
    <div class="card">
      <div class="card-title"><span class="emoji">üìä</span> Data Overview</div>
      <div id="dataOverview"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">üîÑ</span> Export / Import</div>
      <button class="btn btn-primary btn-block" onclick="exportData()" style="margin-bottom:8px">üíæ Export All Data (JSON)</button>
      <label class="btn btn-secondary btn-block" style="justify-content:center">üì• Import Data <input type="file" accept=".json" style="display:none" onchange="importData(event)"></label>
    </div>
    <div class="card">
      <div class="card-title" style="color:var(--danger)"><span class="emoji">‚ö†Ô∏è</span> Danger Zone</div>
      <button class="btn btn-danger btn-block" onclick="clearAllData()">üóë Clear All Data</button>
    </div>
  </div>
  <!-- About -->
  <div class="sub-section section-content" id="syssub-about">
    <div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 8px">‚ÑπÔ∏è About</div>
    <div id="aboutContent"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: MIND (AI Hub + Analysis)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-mind">
  <div class="sub-nav">
    <button class="sub-btn active" onclick="showMindSub('ai',this)">ü§ñ AI Twin</button>
    <button class="sub-btn" onclick="showMindSub('analysis',this)">üìä Analysis</button>
    <button class="sub-btn" onclick="showMindSub('predictions',this)">üîÆ Predictions</button>
    <button class="sub-btn" onclick="showMindSub('patterns',this)">üß© Patterns</button>
  </div>
  <!-- AI -->
  <div class="sub-section active section-content" id="msub-ai">
    <div class="card" style="margin-top:8px">
      <div class="card-title"><span class="emoji">ü§ñ</span> AI Digital Twin</div>
      <div style="font-size:12px;color:var(--text2);margin-bottom:8px">Choose a persona:</div>
      <div id="aiModelsBar" style="display:flex;gap:8px;overflow-x:auto;padding:4px 0;scrollbar-width:none;margin-bottom:10px"></div>
      <div style="background:rgba(124,58,237,.06);border-radius:8px;padding:8px 10px;font-size:12px;margin-bottom:8px">üí° <strong>Daily Insight:</strong> <span id="aiDailyTip">Loading...</span></div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="suggested-qs" id="suggestedQs" style="margin-top:8px"></div>
      <div class="chat-input-row" style="margin-top:8px">
        <textarea id="chatInput" placeholder="Ask your AI Twin anything..." onkeydown="handleChatKey(event)"></textarea>
        <button class="btn btn-primary btn-sm" onclick="sendChat()">‚Üí</button>
      </div>
      <div style="display:flex;gap:6px;margin-top:6px">
        <button class="btn btn-secondary btn-sm" onclick="clearAIChat()">üóë Clear</button>
        <button class="btn btn-secondary btn-sm" onclick="exportChat()">üì§ Export</button>
      </div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">üìä</span> AI Pattern Analysis</div>
      <div id="aiPatternDisplay"></div>
      <button class="btn btn-secondary btn-sm btn-block" onclick="refreshAIInsights()" style="margin-top:8px">üîÑ Refresh Analysis</button>
    </div>
  </div>
  <!-- Analysis -->
  <div class="sub-section section-content" id="msub-analysis">
    <div class="stats-grid" style="margin-top:8px">
      <div class="stat-box" onclick="openModal('Mood Detail','<p>Your mood data over time is recorded and averaged. Consistently above 7 indicates strong wellbeing baseline.</p>')"><div class="sv" id="statMood">‚Äî</div><div class="sl">Avg Mood</div></div>
      <div class="stat-box" onclick="openModal('Focus Detail','<p>Focus above 7 indicates you are frequently entering flow states. Try meditation to improve baseline.</p>')"><div class="sv" id="statFocus">‚Äî</div><div class="sl">Avg Focus</div></div>
      <div class="stat-box" onclick="openModal('Score Detail','<p>Your consciousness score is a weighted average of 20 dimensions. 7+ is excellent.</p>')"><div class="sv" id="statScore">‚Äî</div><div class="sl">Avg Score</div></div>
      <div class="stat-box" onclick="openModal('Flow Detail','<p>Flow state is the optimal experience. When you hit 8+ focus and 7+ creativity simultaneously.</p>')"><div class="sv" id="statFlow">‚Äî</div><div class="sl">Avg Flow</div></div>
      <div class="stat-box" onclick="openModal('Creativity Detail','<p>Creativity correlates strongly with sleep quality and low stress. Try morning sessions after good sleep.</p>')"><div class="sv" id="statCreativity">‚Äî</div><div class="sl">Avg Creativity</div></div>
      <div class="stat-box" onclick="openModal('Total Entries','<p>Each entry builds your self-model. The richer the data, the more accurate the AI predictions.</p>')"><div class="sv" id="statEntries">0</div><div class="sl">Entries</div></div>
    </div>
    <div class="card"><div class="card-title"><span class="emoji">üìà</span> Trends</div><div id="trendsArea"></div></div>
    <div class="card"><div class="card-title"><span class="emoji">üèÜ</span> Personal Records</div><div id="recordsArea"></div></div>
  </div>
  <!-- Predictions -->
  <div class="sub-section section-content" id="msub-predictions">
    <div class="card" style="margin-top:8px"><div class="card-title"><span class="emoji">üîÆ</span> AI Predictions</div><div id="predictionsArea"></div></div>
    <div class="card"><div class="card-title"><span class="emoji">üéØ</span> State Engineering</div><div id="stateEngArea"></div></div>
  </div>
  <!-- Patterns -->
  <div class="sub-section section-content" id="msub-patterns">
    <div class="card" style="margin-top:8px"><div class="card-title"><span class="emoji">üß©</span> Patterns Detected</div><div id="patternsArea"></div></div>
    <div class="card"><div class="card-title"><span class="emoji">üïê</span> Time of Day Heatmap</div><div id="timeHeatmap"></div></div>
    <div class="card"><div class="card-title"><span class="emoji">üì°</span> State Transitions</div><div id="stateTransitions"></div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: WAVES (Brainwave Lab)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-waves">
  <div style="padding:12px;max-width:680px;margin:0 auto">
    <div style="font-family:var(--font-head);font-weight:800;font-size:20px;padding:8px 0 4px">üéµ Brainwave Audio Lab</div>
    <!-- Now Playing -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><div id="bwNowName" style="font-family:var(--font-head);font-weight:800;font-size:16px">Select a session</div><div id="bwNowDesc" style="font-size:12px;color:var(--text2);margin-top:2px">Tap a card to load</div><div id="bwNowFreq" style="font-size:11px;color:var(--primary);font-weight:700;margin-top:3px"></div></div>
        <div style="text-align:center"><div id="bwTimer" style="font-family:var(--font-head);font-weight:800;font-size:22px;color:var(--primary)">00:00</div><div style="font-size:9px;color:var(--text3)">ELAPSED</div></div>
      </div>
      <div class="bw-visualizer" id="bwVisualizer"><div style="color:var(--text3);font-size:12px">‚ñ∂ Press Play to begin</div></div>
      <div style="display:flex;align-items:center;gap:10px;margin-top:10px">
        <button class="btn btn-secondary btn-sm" onclick="bwPrevTrack()">‚èÆ</button>
        <button class="btn btn-primary" id="bwPlayBtn" onclick="toggleBW()" style="flex:1;justify-content:center">‚ñ∂ Play</button>
        <button class="btn btn-secondary btn-sm" onclick="bwNextTrack()">‚è≠</button>
      </div>
      <div style="display:flex;align-items:center;gap:8px;margin-top:8px">
        <span style="font-size:12px;color:var(--text3)">üîà</span>
        <input type="range" id="bwVol" min="0" max="100" value="60" oninput="setBWVol(this.value)" style="flex:1;height:4px;accent-color:var(--primary)">
        <span style="font-size:12px;color:var(--text3)">üîä</span>
      </div>
      <div style="display:flex;gap:6px;margin-top:10px">
        <button class="wave-btn active" onclick="setBWType('binaural',this)">Binaural</button>
        <button class="wave-btn" onclick="setBWType('isochronic',this)">Isochronic</button>
        <button class="wave-btn" onclick="setBWType('solfeggio',this)">Solfeggio</button>
        <button class="wave-btn" onclick="setBWType('whitenoise',this)">White Noise</button>
      </div>
    </div>
    <!-- Session Grid -->
    <div class="bw-grid" id="bwGrid"></div>
    <!-- Education -->
    <div class="card">
      <div class="card-title"><span class="emoji">üì°</span> Brainwave Science</div>
      <div id="bwEducation"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: HEALTH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-health">
  <div style="padding:10px 12px 0;max-width:680px;margin:0 auto">
    <!-- Progress bar -->
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
      <button class="icon-btn btn-sm" id="hsPrevBtn" onclick="hsPrev()" style="display:none">‚Üê</button>
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text3);margin-bottom:4px"><span id="hsSectionName">Demographics</span><span><span id="hsCurrent">1</span>/18</span></div>
        <div style="background:var(--bg3);border-radius:6px;height:6px"><div id="hsProgressBar" style="background:var(--primary);height:6px;border-radius:6px;width:5%;transition:width .3s"></div></div>
      </div>
      <button class="btn btn-primary btn-sm" id="hsNextBtn" onclick="hsNext()">Next ‚Üí</button>
    </div>
    <!-- Jump bar -->
    <div style="display:flex;gap:4px;overflow-x:auto;padding:4px 0 8px;scrollbar-width:none" id="healthJumpBar"></div>
  </div>
  <div style="padding:0 12px;max-width:680px;margin:0 auto" id="healthSectionsContainer"></div>
  <!-- AI Doctor -->
  <div style="padding:0 12px 12px;max-width:680px;margin:0 auto">
    <div class="card" id="aiDoctorCard" style="display:none">
      <div class="card-title"><span class="emoji">üë®‚Äç‚öïÔ∏è</span> AI Doctor Analysis</div>
      <div id="aiDoctorOutput"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: GAMES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-games">
  <div style="padding:12px;max-width:680px;margin:0 auto">
    <div id="gamesMenu">
      <div style="font-family:var(--font-head);font-weight:800;font-size:20px;padding:8px 0 12px">üéÆ Brain Training Lab</div>
      <div class="games-grid" id="gamesGrid"></div>
    </div>
    <div id="gameContainer"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: DREAMS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-dreams">
  <div class="sub-nav">
    <button class="sub-btn active" onclick="showDreamSub('log',this)">üìì Log Dream</button>
    <button class="sub-btn" onclick="showDreamSub('journal',this)">üìö Journal</button>
    <button class="sub-btn" onclick="showDreamSub('techniques',this)">üéØ Techniques</button>
    <button class="sub-btn" onclick="showDreamSub('rc',this)">‚úã Reality Checks</button>
    <button class="sub-btn" onclick="showDreamSub('wbtb',this)">‚è∞ WBTB</button>
  </div>
  <!-- Log Dream -->
  <div class="sub-section active section-content" id="dsub-log">
    <div class="card" style="margin-top:8px">
      <div class="card-title"><span class="emoji">üåô</span> Log New Dream</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="dreamDate"></div>
        <div class="form-group"><label class="form-label">Dream Title</label><input type="text" class="form-input" id="dreamTitle" placeholder="Name this dream"></div>
      </div>
      <div class="form-group"><label class="form-label">Dream Type</label>
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          <button class="dream-type-btn active" onclick="setDreamType(this,'regular')">Regular</button>
          <button class="dream-type-btn" onclick="setDreamType(this,'lucid')">Lucid üí´</button>
          <button class="dream-type-btn" onclick="setDreamType(this,'vivid')">Vivid üé®</button>
          <button class="dream-type-btn" onclick="setDreamType(this,'nightmare')">Nightmare üò®</button>
          <button class="dream-type-btn" onclick="setDreamType(this,'recurring')">Recurring üîÑ</button>
        </div>
        <input type="hidden" id="dreamType" value="regular">
      </div>
      <div class="form-group"><label class="form-label">Dream Description</label><textarea class="form-textarea" id="dreamDesc" style="min-height:100px" placeholder="Describe your dream in as much detail as you can remember..."></textarea></div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Vividness (0-10)</label><input type="range" class="slider-track" id="dreamVividness" min="0" max="10" value="5" style="--pct:50%"><div style="text-align:center;font-size:13px;color:var(--primary);font-weight:700"><span id="dreamVividnessVal">5</span>/10</div></div>
        <div class="form-group"><label class="form-label">Lucidity Level (0-10)</label><input type="range" class="slider-track" id="dreamLucidity" min="0" max="10" value="0" style="--pct:0%"><div style="text-align:center;font-size:13px;color:var(--primary);font-weight:700"><span id="dreamLucidityVal">0</span>/10</div></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Dream Signs</label><input type="text" class="form-input" id="dreamSigns" placeholder="Flying, teeth falling, school..."></div>
        <div class="form-group"><label class="form-label">Emotions</label><input type="text" class="form-input" id="dreamEmotions" placeholder="Fear, joy, confusion..."></div>
      </div>
      <button class="btn btn-primary btn-block" onclick="saveDream()">üí§ Save & Analyze Dream</button>
      <div id="dreamAIAnalysis" style="margin-top:10px"></div>
    </div>
  </div>
  <!-- Journal -->
  <div class="sub-section section-content" id="dsub-journal">
    <div style="font-size:12px;color:var(--text3);margin:8px 0">Total: <span id="dreamCount">0</span> dreams logged</div>
    <div id="dreamJournal"></div>
  </div>
  <!-- Techniques -->
  <div class="sub-section section-content" id="dsub-techniques">
    <div style="font-size:13px;color:var(--text2);padding:8px 0 10px">Step-by-step guides ‚Äî all explained in plain language</div>
    <div id="techniquesContainer"></div>
  </div>
  <!-- Reality Checks -->
  <div class="sub-section section-content" id="dsub-rc">
    <div class="card" style="margin-top:8px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><div style="font-weight:700">Today's Reality Checks</div><div style="font-size:12px;color:var(--text3)"><span id="rcCount">0</span>/15 done</div></div>
        <button class="btn btn-secondary btn-sm" onclick="resetRC()">Reset</button>
      </div>
      <div style="background:var(--bg3);border-radius:6px;height:8px;margin-bottom:12px"><div id="rcProgress" style="background:linear-gradient(to right,var(--primary),var(--accent));height:8px;border-radius:6px;width:0%;transition:width .3s"></div></div>
      <div class="rc-grid" id="rcGrid"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="emoji">‚ùì</span> What Is a Reality Check?</div>
      <div style="font-size:13px;color:var(--text2);line-height:1.7">A reality check is a habit where you <strong>genuinely ask yourself: "Am I dreaming right now?"</strong><br><br>When you do this habitually during waking life, the habit carries into your dreams ‚Äî and at some point in a dream, something triggers the question, you do the check, and <strong>realize you're inside a dream</strong>. This is how lucid dreaming begins.<br><br>The key is to <em>actually try</em> each check, not just go through the motions.</div>
    </div>
  </div>
  <!-- WBTB -->
  <div class="sub-section section-content" id="dsub-wbtb">
    <div class="card" style="margin-top:8px">
      <div class="card-title"><span class="emoji">‚è∞</span> WBTB Calculator</div>
      <div style="font-size:13px;color:var(--text2);margin-bottom:12px">Wake Back To Bed is the most effective lucid dreaming technique. It exploits your natural REM cycle timing.</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Sleep Time</label><input type="time" class="form-input" id="wbtbSleep" value="23:00"></div>
        <div class="form-group"><label class="form-label">Wake Time</label><input type="time" class="form-input" id="wbtbWake" value="07:00"></div>
      </div>
      <button class="btn btn-primary btn-block" onclick="calcWBTB()">Calculate Optimal WBTB Times</button>
      <div id="wbtbResult" style="margin-top:10px"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: MEDIA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-media">
  <div class="sub-nav">
    <button class="sub-btn active" onclick="showMediaSub('voice',this)">üéôÔ∏è Voice</button>
    <button class="sub-btn" onclick="showMediaSub('photos',this)">üì∏ Media</button>
    <button class="sub-btn" onclick="showMediaSub('calview',this)">üìÖ Calendar</button>
    <button class="sub-btn" onclick="showMediaSub('alarms',this)">‚è∞ Alarms</button>
  </div>
  <!-- Voice -->
  <div class="sub-section active section-content" id="mediasub-voice">
    <div class="card" style="text-align:center;margin-top:8px">
      <button class="rec-btn" id="recorderBtn" onclick="toggleRecord()">üéôÔ∏è</button>
      <div id="recStatus" style="margin-top:8px;font-size:13px;color:var(--text2)">Tap to Start Recording</div>
      <div id="recTimer" style="font-family:var(--font-head);font-weight:800;font-size:20px;color:var(--primary);margin-top:4px">00:00</div>
      <div id="liveTranscript" style="font-size:12px;color:var(--text2);margin-top:8px;min-height:20px">Speak to see transcript here...</div>
    </div>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="card-title" style="margin-bottom:0">Voice Memos</div>
        <button class="btn btn-accent btn-sm" onclick="analyzeVoiceMemos()">ü§ñ Analyze</button>
      </div>
      <div id="voiceMemos"></div>
      <div id="voiceAIInsights" style="margin-top:8px"></div>
    </div>
  </div>
  <!-- Photos -->
  <div class="sub-section section-content" id="mediasub-photos">
    <div class="card" style="margin-top:8px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div class="card-title" style="margin-bottom:0">Media Archive</div>
        <div style="display:flex;gap:6px">
          <button class="btn btn-accent btn-sm" onclick="analyzeMedia()">ü§ñ AI Tips</button>
          <label class="btn btn-primary btn-sm">üì∏ Add <input type="file" accept="image/*,video/*" multiple style="display:none" onchange="uploadMedia(event)"></label>
        </div>
      </div>
      <div class="media-grid" id="mediaGrid"></div>
      <div id="mediaAIInsights" style="margin-top:10px"></div>
    </div>
  </div>
  <!-- Calendar -->
  <div class="sub-section section-content" id="mediasub-calview">
    <div class="card" style="margin-top:8px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <button class="btn btn-secondary btn-sm" onclick="calNav(-1)">‚Äπ</button>
        <div id="calTitle" style="font-family:var(--font-head);font-weight:700;font-size:15px"></div>
        <button class="btn btn-secondary btn-sm" onclick="calNav(1)">‚Ä∫</button>
      </div>
      <div class="cal-grid" id="calGrid"></div>
      <div style="display:flex;gap:12px;margin-top:8px;font-size:11px;color:var(--text3)">
        <span><span style="color:var(--accent)">‚óè</span> Log entry</span>
        <span><span style="color:var(--secondary)">‚óè</span> Dream</span>
      </div>
    </div>
    <!-- Alarms here too -->
    <div class="card">
      <div class="card-title"><span class="emoji">‚è∞</span> Reminders</div>
      <div class="form-row" style="margin-bottom:8px">
        <div class="form-group"><label class="form-label">Label</label><input type="text" class="form-input" id="reminderText" placeholder="Name..."></div>
        <div class="form-group"><label class="form-label">Date & Time</label><input type="datetime-local" class="form-input" id="reminderDateTime"></div>
      </div>
      <button class="btn btn-primary btn-sm btn-block" onclick="addReminder()">+ Add Reminder</button>
      <div id="remindersList" style="margin-top:8px"></div>
    </div>
  </div>
  <!-- Alarms -->
  <div class="sub-section section-content" id="mediasub-alarms">
    <div class="card" style="margin-top:8px">
      <div class="card-title"><span class="emoji">‚è∞</span> Set Alarm</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Time</label><input type="time" class="form-input" id="alarmTime"></div>
        <div class="form-group"><label class="form-label">Label</label><input type="text" class="form-input" id="alarmLabel" placeholder="Wake up, meditate..."></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Sound</label>
          <select class="form-select" id="alarmSound"><option value="bell">üîî Bell</option><option value="chime">üéµ Chime</option><option value="pulse">üíì Pulse</option><option value="om">üïâ Om</option><option value="birds">üê¶ Birds</option></select>
        </div>
        <div class="form-group"><label class="form-label">Repeat</label>
          <select class="form-select" id="alarmRepeat"><option value="once">Once</option><option value="daily">Daily</option><option value="weekdays">Weekdays</option><option value="weekends">Weekends</option></select>
        </div>
      </div>
      <button class="btn btn-primary btn-block" onclick="addAlarm()">+ Set Alarm</button>
    </div>
    <div class="card"><div class="card-title"><span class="emoji">üîî</span> Active Alarms</div><div id="alarmsList"></div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BOTTOM NAV
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav class="bottom-nav" id="bottomNav"></nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ONBOARDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="onboardOverlay" onclick="if(event.target===this)closeOnboarding()">
  <div class="onboard-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <div style="font-family:var(--font-head);font-weight:800;font-size:20px">üß† Consciousness OS</div>
      <button class="modal-close" onclick="closeOnboarding()">‚úï</button>
    </div>
    <div class="onboard-step active"><div style="font-size:56px;text-align:center;padding:12px 0">üß†</div><div style="font-family:var(--font-head);font-weight:800;font-size:22px;text-align:center;margin-bottom:8px">Welcome to v7.0</div><div style="font-size:13px;color:var(--text2);text-align:center;line-height:1.7">Your complete consciousness tracking system. Track your mind, understand the world, and engineer your optimal state.</div></div>
    <div class="onboard-step"><div style="font-size:48px;text-align:center;padding:12px 0">üåü</div><div style="font-family:var(--font-head);font-weight:700;font-size:18px;margin-bottom:12px">5 Core Modules</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center"><div style="font-size:24px">üß†</div><div style="font-size:12px;font-weight:700;margin-top:4px">SELF</div><div style="font-size:11px;color:var(--text3)">Daily logs, tracking, AI Twin</div></div><div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center"><div style="font-size:24px">üåç</div><div style="font-size:12px;font-weight:700;margin-top:4px">WORLD</div><div style="font-size:11px;color:var(--text3)">Finance, geopolitics, markets</div></div><div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center"><div style="font-size:24px">üöÄ</div><div style="font-size:12px;font-weight:700;margin-top:4px">PATH</div><div style="font-size:11px;color:var(--text3)">Career AI, skill direction</div></div><div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center"><div style="font-size:24px">üî≠</div><div style="font-size:12px;font-weight:700;margin-top:4px">SCIENCE</div><div style="font-size:11px;color:var(--text3)">Frontier discoveries feed</div></div></div></div>
    <div class="onboard-step"><div style="font-size:48px;text-align:center;padding:12px 0">üìä</div><div style="font-family:var(--font-head);font-weight:700;font-size:18px;margin-bottom:8px">20 Consciousness Metrics</div><div style="font-size:13px;color:var(--text2);line-height:1.7">Track Sleep, Mood, Focus, Energy, Stress, Creativity, Flow State and 13 more dimensions. Dot-slider navigation makes it fast. AI builds your cognitive profile.</div></div>
    <div class="onboard-step"><div style="font-size:48px;text-align:center;padding:12px 0">üéµ</div><div style="font-family:var(--font-head);font-weight:700;font-size:18px;margin-bottom:8px">Brainwave Audio Lab</div><div style="font-size:13px;color:var(--text2);line-height:1.7">12 binaural beat sessions to induce specific brain states: Deep Focus, Meditation, Lucid Dreams, Creative Flow. Built with Web Audio API ‚Äî no headphone jack needed for some modes.</div></div>
    <div class="onboard-step"><div style="font-size:48px;text-align:center;padding:12px 0">üåô</div><div style="font-family:var(--font-head);font-weight:700;font-size:18px;margin-bottom:8px">Lucid Dream Training</div><div style="font-size:13px;color:var(--text2);line-height:1.7">AI analyzes your dreams and gives personalized lucid dreaming coaching. Reality check tracker builds your awareness habit. WBTB calculator optimizes your training.</div></div>
    <div class="onboard-step"><div style="font-size:48px;text-align:center;padding:12px 0">üöÄ</div><div style="font-family:var(--font-head);font-weight:700;font-size:18px;margin-bottom:8px">You're Ready!</div><div style="font-size:13px;color:var(--text2);line-height:1.7">Start with your first Daily Log in SELF. Then explore WORLD for intelligence. Use PATH to align your career with your cognitive strengths.</div><button class="btn btn-primary btn-block" onclick="closeOnboarding()" style="margin-top:12px">üöÄ Start Exploring</button></div>
    <div style="text-align:center;margin:16px 0 8px" id="onboardDots"></div>
    <div style="display:flex;justify-content:space-between">
      <button class="btn btn-secondary btn-sm" id="oBtnPrev" onclick="onboardNav(-1)" style="display:none">‚Üê Back</button>
      <button class="btn btn-primary btn-sm" id="oBtnNext" onclick="onboardNav(1)" style="margin-left:auto">Next ‚Üí</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div id="modalOverlay" onclick="if(event.target===this)closeAllModals()">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle"></div>
      <button class="modal-close" onclick="closeAllModals()">‚úï</button>
    </div>
    <div id="modalBody" style="font-size:14px;color:var(--text2);line-height:1.7"></div>
  </div>
</div>

<!-- SETTING HELP -->
<div id="settingHelpOverlay" onclick="if(event.target===this)this.classList.remove('open')">
  <div class="setting-help-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div id="settingHelpTitle" style="font-family:var(--font-head);font-weight:700;font-size:16px"></div>
      <button class="modal-close" onclick="document.getElementById('settingHelpOverlay').classList.remove('open')">‚úï</button>
    </div>
    <div id="settingHelpBody" style="font-size:13px;color:var(--text2);line-height:1.7"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSCIOUSNESS OS v7.0 ‚Äî JAVASCRIPT ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LANGS={en:{nav_self:"Self",nav_world:"World",nav_path:"Path",nav_science:"Science",nav_system:"System",nav_waves:"Waves",nav_health:"Health",nav_games:"Games",nav_dreams:"Dreams",nav_media:"Media",nav_mind:"Mind",saved:"Entry saved!",cleared:"Data cleared"},hi:{nav_self:"‡§∏‡•ç‡§µ‡§Ø‡§Ç",nav_world:"‡§µ‡§ø‡§∂‡•ç‡§µ",nav_path:"‡§™‡§•",nav_science:"‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®",nav_system:"‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ",nav_waves:"‡§§‡§∞‡§Ç‡§ó‡•á‡§Ç",nav_health:"‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø",nav_games:"‡§ñ‡•á‡§≤",nav_dreams:"‡§∏‡§™‡§®‡•á",nav_media:"‡§Æ‡•Ä‡§°‡§ø‡§Ø‡§æ",nav_mind:"‡§Æ‡§®",saved:"‡§∏‡§π‡•á‡§ú‡§æ!",cleared:"‡§∏‡§æ‡§´!"},es:{nav_self:"Yo",nav_world:"Mundo",nav_path:"Camino",nav_science:"Ciencia",nav_system:"Sistema",nav_waves:"Ondas",nav_health:"Salud",nav_games:"Juegos",nav_dreams:"Sue√±os",nav_media:"Media",nav_mind:"Mente",saved:"¬°Guardado!",cleared:"¬°Limpiado!"},fr:{nav_self:"Soi",nav_world:"Monde",nav_path:"Voie",nav_science:"Science",nav_system:"Syst√®me",nav_waves:"Ondes",nav_health:"Sant√©",nav_games:"Jeux",nav_dreams:"R√™ves",nav_media:"M√©dias",nav_mind:"Esprit",saved:"Sauvegard√©!",cleared:"Effac√©!"},de:{nav_self:"Selbst",nav_world:"Welt",nav_path:"Pfad",nav_science:"Wissenschaft",nav_system:"System",nav_waves:"Wellen",nav_health:"Gesundheit",nav_games:"Spiele",nav_dreams:"Tr√§ume",nav_media:"Medien",nav_mind:"Geist",saved:"Gespeichert!",cleared:"Gel√∂scht!"},pt:{nav_self:"Eu",nav_world:"Mundo",nav_path:"Caminho",nav_science:"Ci√™ncia",nav_system:"Sistema",nav_waves:"Ondas",nav_health:"Sa√∫de",nav_games:"Jogos",nav_dreams:"Sonhos",nav_media:"M√≠dia",nav_mind:"Mente",saved:"Salvo!",cleared:"Limpo!"},zh:{nav_self:"Ëá™Êàë",nav_world:"‰∏ñÁïå",nav_path:"Ë∑ØÂæÑ",nav_science:"ÁßëÂ≠¶",nav_system:"Á≥ªÁªü",nav_waves:"ËÑëÊ≥¢",nav_health:"ÂÅ•Â∫∑",nav_games:"Ê∏∏Êàè",nav_dreams:"Ê¢¶Â¢É",nav_media:"Â™í‰Ωì",nav_mind:"ÊÄùÁª¥",saved:"Â∑≤‰øùÂ≠òÔºÅ",cleared:"Â∑≤Ê∏ÖÈô§ÔºÅ"},ar:{nav_self:"ÿ∞ÿßÿ™",nav_world:"ÿπÿßŸÑŸÖ",nav_path:"ŸÖÿ≥ÿßÿ±",nav_science:"ÿπŸÑŸàŸÖ",nav_system:"ŸÜÿ∏ÿßŸÖ",nav_waves:"ŸÖŸàÿ¨ÿßÿ™",nav_health:"ÿµÿ≠ÿ©",nav_games:"ÿ£ŸÑÿπÿßÿ®",nav_dreams:"ÿ£ÿ≠ŸÑÿßŸÖ",nav_media:"Ÿàÿ≥ÿßÿ¶ÿ∑",nav_mind:"ÿπŸÇŸÑ",saved:"ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏!",cleared:"ÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ≠!"},ja:{nav_self:"Ëá™Â∑±",nav_world:"‰∏ñÁïå",nav_path:"ÈÅì",nav_science:"ÁßëÂ≠¶",nav_system:"„Ç∑„Çπ„ÉÜ„É†",nav_waves:"Ê≥¢Âãï",nav_health:"ÂÅ•Â∫∑",nav_games:"„Ç≤„Éº„É†",nav_dreams:"Â§¢",nav_media:"„É°„Éá„Ç£„Ç¢",nav_mind:"ÂøÉ",saved:"‰øùÂ≠òÔºÅ",cleared:"„ÇØ„É™„Ç¢ÔºÅ"},ru:{nav_self:"–Ø",nav_world:"–ú–∏—Ä",nav_path:"–ü—É—Ç—å",nav_science:"–ù–∞—É–∫–∞",nav_system:"–°–∏—Å—Ç–µ–º–∞",nav_waves:"–í–æ–ª–Ω—ã",nav_health:"–ó–¥–æ—Ä–æ–≤—å–µ",nav_games:"–ò–≥—Ä—ã",nav_dreams:"–°–Ω—ã",nav_media:"–ú–µ–¥–∏–∞",nav_mind:"–†–∞–∑—É–º",saved:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!",cleared:"–û—á–∏—â–µ–Ω–æ!"}};
let curLang=localStorage.getItem('cos_lang')||'en';
function t(k){return(LANGS[curLang]||LANGS.en)[k]||LANGS.en[k]||k;}
function setLang(lang){curLang=lang;localStorage.setItem('cos_lang',lang);try{document.getElementById('langSel').value=lang;}catch(e){}try{document.getElementById('settingLang').value=lang;}catch(e){}buildNav();}

// THEMES
const THEMES={light:{bg:'#f8f6ff',acc:'#7c3aed',dot:'#a78bfa',dot2:'#06b6d4',name:'‚ú® Light'},dark:{bg:'#0e0b1a',acc:'#a78bfa',dot:'#7c3aed',dot2:'#22d3ee',name:'üåô Dark'},scifi:{bg:'#000d1a',acc:'#00ffff',dot:'#00ffff',dot2:'#ff00ff',name:'ü§ñ Sci-Fi'},natural:{bg:'#f0f7f0',acc:'#2d7a2d',dot:'#2d7a2d',dot2:'#8fbc8f',name:'üåø Natural'},spiritual:{bg:'#faf5eb',acc:'#b8860b',dot:'#b8860b',dot2:'#800080',name:'üïâ Spiritual'},classic:{bg:'#fafaf8',acc:'#1a1a6e',dot:'#1a1a6e',dot2:'#8b0000',name:'üìú Classic'},winter:{bg:'#e8f4fc',acc:'#1565c0',dot:'#1565c0',dot2:'#42a5f5',name:'‚ùÑÔ∏è Winter'},summer:{bg:'#fff9e8',acc:'#f59e0b',dot:'#f59e0b',dot2:'#ef4444',name:'‚òÄÔ∏è Summer'}};
let curTheme=localStorage.getItem('cos_theme')||'light';
function applyTheme(th){curTheme=th;document.documentElement.setAttribute('data-theme',th);localStorage.setItem('cos_theme',th);const btn=document.getElementById('themeBtn');if(btn)btn.textContent=th==='dark'?'‚òÄÔ∏è':'üåô';const sw=document.getElementById('settingDarkMode');if(sw)sw.classList.toggle('on',th==='dark');buildThemeGrid();}
function toggleTheme(){const isDark=document.documentElement.getAttribute('data-theme')==='dark';applyTheme(isDark?'light':'dark');}
function buildThemeGrid(){const el=document.getElementById('themeGrid');if(!el)return;el.innerHTML=Object.entries(THEMES).map(([k,v])=>`<div class="theme-card${curTheme===k?' active':''}" onclick="applyTheme('${k}')"><div class="theme-preview" style="background:${v.bg}"><div style="width:14px;height:14px;border-radius:50%;background:${v.dot}"></div><div style="width:10px;height:10px;border-radius:50%;background:${v.dot2}"></div></div><div class="theme-name">${v.name}</div></div>`).join('');}

// NAV
const NAV_ITEMS=[{id:'self',icon:'üß†',key:'nav_self'},{id:'world',icon:'üåç',key:'nav_world'},{id:'path',icon:'üöÄ',key:'nav_path'},{id:'science',icon:'üî≠',key:'nav_science'},{id:'mind',icon:'üí´',key:'nav_mind'},{id:'waves',icon:'üéµ',key:'nav_waves'},{id:'health',icon:'‚ù§Ô∏è',key:'nav_health'},{id:'games',icon:'üéÆ',key:'nav_games'},{id:'dreams',icon:'üåô',key:'nav_dreams'},{id:'media',icon:'üéôÔ∏è',key:'nav_media'},{id:'system',icon:'‚öôÔ∏è',key:'nav_system'}];
let activeTab='self';
function buildNav(){const nav=document.getElementById('bottomNav');if(!nav)return;nav.innerHTML=NAV_ITEMS.map(n=>`<button class="nav-tab${activeTab===n.id?' active':''}" onclick="switchTab('${n.id}')"><span class="ni">${n.icon}</span><span>${t(n.key)}</span></button>`).join('');}
function switchTab(id){document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));const panel=document.getElementById('tab-'+id);if(panel)panel.classList.add('active');activeTab=id;buildNav();if(id==='mind'){refreshAIInsights();refreshAnalysis();}if(id==='world'){buildWorldPanel();}if(id==='science'){buildSciencePanel();}if(id==='system'){buildSystemPanel();}if(id==='path'){buildPathPanel();}}

// SUB-NAV handlers
function showSub(prefix,id,btn){document.querySelectorAll('[id^="'+prefix+'sub-"]').forEach(s=>s.classList.remove('active'));const el=document.getElementById(prefix+'sub-'+id);if(el)el.classList.add('active');const nav=btn.closest('.sub-nav');if(nav)nav.querySelectorAll('.sub-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
function showWorldSub(id,btn){showSub('w',id,btn);}
function showPathSub(id,btn){showSub('p',id,btn);}
function showSciSub(id,btn){showSub('s',id,btn);}
function showSystemSub(id,btn){document.querySelectorAll('[id^="syssub-"]').forEach(s=>s.classList.remove('active'));const el=document.getElementById('syssub-'+id);if(el)el.classList.add('active');const nav=btn.closest('.sub-nav');if(nav)nav.querySelectorAll('.sub-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
function showMindSub(id,btn){document.querySelectorAll('[id^="msub-"]').forEach(s=>s.classList.remove('active'));const el=document.getElementById('msub-'+id);if(el)el.classList.add('active');const nav=btn.closest('.sub-nav');if(nav)nav.querySelectorAll('.sub-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(id==='analysis')refreshAnalysis();if(id==='predictions')buildPredictions(getLogs());if(id==='patterns'){buildPatterns(getLogs());buildTimeHeatmap();}}
function showDreamSub(id,btn){document.querySelectorAll('[id^="dsub-"]').forEach(s=>s.classList.remove('active'));const el=document.getElementById('dsub-'+id);if(el)el.classList.add('active');const nav=btn.closest('.sub-nav');if(nav)nav.querySelectorAll('.sub-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(id==='journal')renderDreamJournal();}
function showMediaSub(id,btn){document.querySelectorAll('[id^="mediasub-"]').forEach(s=>s.classList.remove('active'));const el=document.getElementById('mediasub-'+id);if(el)el.classList.add('active');const nav=btn.closest('.sub-nav');if(nav)nav.querySelectorAll('.sub-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(id==='calview')renderCalendar();if(id==='voice')renderVoiceMemos();if(id==='photos')renderMediaGrid();}

// TOAST & MODALS
function showToast(msg,dur=2400){const el=document.getElementById('toast');el.textContent=msg;el.classList.add('show');setTimeout(()=>el.classList.remove('show'),dur);}
function openModal(title,html){document.getElementById('modalTitle').textContent=title;document.getElementById('modalBody').innerHTML=html;document.getElementById('modalOverlay').classList.add('open');}
function closeAllModals(){document.getElementById('modalOverlay').classList.remove('open');}
const SETTING_HELP={anchors:{title:'üéöÔ∏è Slider Anchors',text:'Shows detailed descriptions for each slider value so you always know exactly what each number means for your consciousness state.'},autoAnalyze:{title:'ü§ñ Auto-Analyze',text:'Automatically runs AI pattern analysis each time you save an entry.'},convMode:{title:'üí¨ Conversational AI',text:'AI Twin asks follow-up questions and remembers context within a session.'},autoTranscribe:{title:'üéôÔ∏è Auto-Transcribe',text:'Converts voice memos to text using your device\'s speech recognition.'},rc:{title:'‚úã Reality Check Alerts',text:'Sends browser notifications every 2 hours reminding you to do a reality check.'},promptBoost:{title:'‚ú® Prompt Enhancement',text:'AI rewrites your questions to be more specific and detailed before sending.'}};
function showSettingHelp(key){const info=SETTING_HELP[key]||{title:'Help',text:'More info coming.'};document.getElementById('settingHelpTitle').textContent=info.title;document.getElementById('settingHelpBody').innerHTML=info.text;document.getElementById('settingHelpOverlay').classList.add('open');}

// SETTINGS
const SETTINGS_STATE={};
function loadSettings(){const saved=JSON.parse(localStorage.getItem('cos_settings')||'{}');Object.assign(SETTINGS_STATE,{anchors:true,autoAnalyze:true,convMode:true,autoTranscribe:true,darkMode:false,rc:false,promptBoost:false,...saved});['anchors','autoAnalyze','convMode','autoTranscribe','rc','promptBoost'].forEach(k=>{const el=document.getElementById('setting'+k.charAt(0).toUpperCase()+k.slice(1));if(el)el.classList.toggle('on',!!SETTINGS_STATE[k]);});if(SETTINGS_STATE.darkMode&&curTheme==='light')applyTheme('dark');}
function toggleSetting(key){SETTINGS_STATE[key]=!SETTINGS_STATE[key];const el=document.getElementById('setting'+key.charAt(0).toUpperCase()+key.slice(1));if(el)el.classList.toggle('on',SETTINGS_STATE[key]);localStorage.setItem('cos_settings',JSON.stringify(SETTINGS_STATE));}

// SLIDERS
const SLIDERS=[{id:'sleep',cat:'core',label:'üò¥ Sleep Quality',low:'No sleep',high:'Perfect sleep',anchors:['Catastrophic','Very poor','Below avg','Slightly low','Acceptable','Good','Very good','Excellent','Outstanding','Perfect']},{id:'mood',cat:'core',label:'üòä Mood',low:'Severe distress',high:'Peak euphoria',anchors:['Severe crisis','Very low','Low','Below base','Neutral','Okay','Good','Great','Excellent','Euphoric']},{id:'physicalEnergy',cat:'energy',label:'‚ö° Physical Energy',low:'Depleted',high:'Peak vitality',anchors:['Bedridden','Barely moving','Low','Sluggish','Manageable','Good','High','Very high','Excellent','Peak vitality']},{id:'mentalEnergy',cat:'energy',label:'üß† Mental Energy',low:'Mental blackout',high:'Peak mental',anchors:['Blackout','Barely processing','Mental fog','Sluggish','Normal','Good','Sharp','Very sharp','Excellent','Peak mental']},{id:'focus',cat:'mind',label:'üéØ Focus',low:'Scattered',high:'Hyperfocus',anchors:['Scattered','Everywhere','Poor','Distracted','Moderate','Decent','Good','Strong','Excellent','Hyperfocus']},{id:'clarity',cat:'mind',label:'üíé Mental Clarity',low:'Total fog',high:'Crystal clear',anchors:['Total fog','Cloudy','Foggy','Below norm','Moderate','Good','Clear','Very clear','Excellent','Crystal clear']},{id:'creativity',cat:'mind',label:'üé® Creativity',low:'Blocked',high:'Genius flow',anchors:['Blocked','Almost none','Low','Below avg','Some ideas','Good flow','High','Excellent','Outstanding','Genius flow']},{id:'flow',cat:'mind',label:'üåä Flow State',low:'Not in flow',high:'Transcendent',anchors:['Not in flow','Far off','Distracted','Occasional','Intermittent','Some flow','Good flow','Strong flow','Excellent','Transcendent']},{id:'stress',cat:'emotion',label:'üò∞ Stress (inverse)',low:'No stress',high:'Crisis',anchors:['Perfectly calm','Very peaceful','Low stress','Slight','Moderate','Elevated','High','Very high','Severe','Crisis']},{id:'anxiety',cat:'emotion',label:'üò¨ Anxiety',low:'Calm',high:'Extreme',anchors:['Zero','Very serene','Minimal','Low worry','Moderate','Elevated','High','Severe','Very severe','Extreme']},{id:'stability',cat:'emotion',label:'üèîÔ∏è Emotional Stability',low:'Falling apart',high:'Unshakeable',anchors:['Falling apart','Very reactive','Easily overwhelmed','Unstable','Moderate','Fairly stable','Good','Very stable','Excellent','Unshakeable']},{id:'social',cat:'emotion',label:'üë• Social Energy',low:'Exhaustion',high:'Love connection',anchors:['Exhausted','Need isolation','Very low','Prefer alone','Short ok','Normal','Good','High','Very high','Peak social']},{id:'motivation',cat:'core',label:'üî• Motivation',low:'No drive',high:'Unstoppable',anchors:['No drive','Almost impossible','Very low','Below norm','Some','Good','High','Very high','Excellent','Unstoppable']},{id:'mindfulness',cat:'core',label:'üßò Mindfulness',low:'Autopilot',high:'Full presence',anchors:['Autopilot','Almost none','Very little','Below avg','Some','Moderate','Good','Strong','Excellent','Full presence']},{id:'willpower',cat:'mind',label:'üí™ Willpower',low:'Zero',high:'Iron discipline',anchors:['Zero','Impulses win','Very weak','Below avg','Moderate','Good','Strong','Very strong','Excellent','Iron discipline']},{id:'intuition',cat:'advanced',label:'üîÆ Intuition',low:'No gut sense',high:'Peak knowing',anchors:['None','Almost none','Rarely','Weak','Moderate','Decent','Good','Strong','Excellent','Peak knowing']},{id:'cogLoad',cat:'advanced',label:'üñ•Ô∏è Cognitive Load',low:'Empty',high:'Overloaded',anchors:['Empty mind','Almost none','Very light','Light','Moderate','Noticeable','High','Very high','Overwhelming','Overload']},{id:'resilience',cat:'advanced',label:'üõ°Ô∏è Resilience',low:'Shattered',high:'Thrives in chaos',anchors:['Shattered','Falls apart','Very fragile','Fragile','Moderate','Good','Strong','Very strong','Excellent','Thrives in chaos']},{id:'presence',cat:'advanced',label:'‚ú® Vitality / Presence',low:'Absent',high:'Fully alive',anchors:['Absent','Barely present','Very low','Below norm','Some','Good','High vitality','Very high','Excellent','Fully alive']},{id:'executiveFn',cat:'advanced',label:'üìã Executive Function',low:'Cannot plan',high:'Master-level',anchors:['Cannot plan','Barely deciding','Very poor','Below norm','Moderate','Good','Strong','Excellent','Outstanding','Master-level']}];
const SLIDER_CATS={core:['sleep','mood','motivation','mindfulness'],energy:['physicalEnergy','mentalEnergy'],mind:['focus','clarity','creativity','flow','willpower'],emotion:['stress','anxiety','stability','social'],advanced:['intuition','cogLoad','resilience','presence','executiveFn']};
function showSliderCat(cat,btn){document.querySelectorAll('.slider-cat-group').forEach(g=>g.classList.remove('active'));const g=document.getElementById('scat-'+cat);if(g)g.classList.add('active');document.querySelectorAll('.scat-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
function buildSliders(){Object.entries(SLIDER_CATS).forEach(([cat,ids])=>{const container=document.getElementById('scat-'+cat);if(!container)return;container.innerHTML=ids.map(id=>{const s=SLIDERS.find(sl=>sl.id===id);if(!s)return'';return`<div class="slider-group"><div class="slider-header"><span class="slider-label">${s.label}</span><span class="slider-value-badge" id="val_${s.id}">5</span></div><input type="range" class="slider-track" id="sl_${s.id}" min="0" max="10" value="5" oninput="onSliderMove('${s.id}',this.value)" style="--pct:50%"><div class="slider-dots" id="dots_${s.id}">${[0,1,2,3,4,5,6,7,8,9,10].map(n=>`<div class="slider-dot" id="dot_${s.id}_${n}" onclick="setSliderVal('${s.id}',${n})">${n}</div>`).join('')}</div><div class="slider-pair-labels"><span>${s.low||''}</span><span>${s.high||''}</span></div><div class="slider-anchor-text" id="anchor_${s.id}"></div></div>`;}).join('');});SLIDERS.forEach(s=>onSliderMove(s.id,5));}
function onSliderMove(id,val){val=parseInt(val);const sl=document.getElementById('sl_'+id);if(sl){sl.value=val;sl.style.setProperty('--pct',(val/10*100)+'%');}const badge=document.getElementById('val_'+id);if(badge)badge.textContent=val;const slider=SLIDERS.find(s=>s.id===id);for(let i=0;i<=10;i++){const dot=document.getElementById('dot_'+id+'_'+i);if(!dot)continue;dot.classList.remove('active','near');if(i===val)dot.classList.add('active');else if(Math.abs(i-val)===1)dot.classList.add('near');}const anchor=document.getElementById('anchor_'+id);if(anchor&&slider){const idx=Math.min(val,9);anchor.textContent=val+' ‚Äî '+(slider.anchors[idx]||'');anchor.style.display=SETTINGS_STATE.anchors?'block':'none';}updateScore();}
function setSliderVal(id,val){const sl=document.getElementById('sl_'+id);if(sl){sl.value=val;onSliderMove(id,val);}}
function getSliderVal(id){return parseInt(document.getElementById('sl_'+id)?.value||5);}
function updateScore(){const f=getSliderVal('focus'),me=getSliderVal('mentalEnergy'),pe=getSliderVal('physicalEnergy'),mo=getSliderVal('mood'),sl=getSliderVal('sleep'),cr=getSliderVal('creativity'),mt=getSliderVal('motivation'),fl=getSliderVal('flow'),cl=getSliderVal('clarity'),mf=getSliderVal('mindfulness'),wp=getSliderVal('willpower'),st=getSliderVal('stress'),rs=getSliderVal('resilience'),pr=getSliderVal('presence'),ef=getSliderVal('executiveFn');const raw=(f*2.5+me*2.2+pe*1.5+mo*1.8+sl*1.8+cr*1.3+mt*1.2+fl*1.5+cl*1.8+mf+wp+rs*1.2+pr+ef*1.2+(10-st)*1.5)/25;const score=Math.max(0,Math.min(10,raw));const sv=document.getElementById('scoreValue');if(sv)sv.textContent=score.toFixed(1);const circle=document.getElementById('scoreCircle');if(circle){const perim=264;circle.style.strokeDashoffset=perim-(perim*score/10);const hue=score<4?0:score<6?40:score<8?120:270;circle.style.stroke=`hsl(${hue},70%,50%)`;}return score;}

// LOG
function saveLog(){const score=updateScore();const entry={id:Date.now(),ts:new Date().toISOString(),date:document.getElementById('logDate')?.value||new Date().toISOString().split('T')[0],timeOfDay:document.getElementById('logTime')?.value,activity:document.getElementById('logActivity')?.value,emotion:document.getElementById('logEmotion')?.value,thought:document.getElementById('logThought')?.value,insight:document.getElementById('logInsight')?.value,goal:document.getElementById('logGoal')?.value,obstacle:document.getElementById('logObstacle')?.value,gratitude:document.getElementById('logGratitude')?.value,score:parseFloat(score.toFixed(2))};SLIDERS.forEach(s=>{entry[s.id]=getSliderVal(s.id);});const logs=getLogs();logs.unshift(entry);if(logs.length>500)logs.pop();localStorage.setItem('cos_logs',JSON.stringify(logs));showToast('‚ú® '+t('saved'));renderRecentLogs();updatePassiveTracking();}
function getLogs(){return JSON.parse(localStorage.getItem('cos_logs')||'[]');}
function renderRecentLogs(){const el=document.getElementById('recentLogs');if(!el)return;const logs=getLogs().slice(0,5);if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">üìù</span><div class="es-text">No entries yet. Save your first log!</div></div>';return;}el.innerHTML=logs.map(e=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);cursor:pointer" onclick="openEntryDetail('${e.id}')"><div><div style="font-weight:700;font-size:13px">${e.date} <span style="font-size:10px;color:var(--text3)">${e.timeOfDay||''}</span></div><div style="font-size:11px;color:var(--text3);margin-top:2px">${e.emotion||'‚Äî'} ¬∑ ${e.activity||'‚Äî'}</div></div><div style="text-align:right"><div style="font-family:var(--font-head);font-weight:800;font-size:18px;color:var(--primary)">${e.score}</div><div style="font-size:10px;color:var(--text3)">score</div></div></div>`).join('');}
function openEntryDetail(id){const log=getLogs().find(e=>String(e.id)===String(id));if(!log)return;const keys=['sleep','mood','physicalEnergy','mentalEnergy','focus','stress','creativity','motivation','clarity','flow'];openModal(log.date+' ‚Äî Score: '+log.score,`<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:12px">${keys.map(k=>`<div style="background:var(--bg3);border-radius:8px;padding:8px;text-align:center"><div style="font-weight:800;color:var(--primary)">${log[k]??'‚Äî'}</div><div style="font-size:10px;color:var(--text3)">${k}</div></div>`).join('')}</div>${log.thought?`<p><strong>Thoughts:</strong> ${log.thought}</p>`:''}${log.insight?`<p><strong>Insight:</strong> ${log.insight}</p>`:''}${log.gratitude?`<p><strong>Gratitude:</strong> ${log.gratitude}</p>`:''}`); }

// PASSIVE TRACKING
let sessionStart=Date.now(),interactionCount=0;
document.addEventListener('click',()=>interactionCount++);
function updatePassiveTracking(){const data={sessionStart,interactionCount,lastEntry:Date.now()};localStorage.setItem('cos_passive',JSON.stringify(data));renderPassiveStats();}
function renderPassiveStats(){const el=document.getElementById('passiveStats');if(!el)return;const logs=getLogs();const sessionMin=Math.round((Date.now()-sessionStart)/60000);const entryFreq=logs.length>1?Math.round((new Date(logs[0].ts)-new Date(logs[logs.length-1].ts))/1000/60/60/24/Math.max(1,logs.length-1)*10)/10:0;const tod=logs.reduce((acc,e)=>{if(!e.ts)return acc;const h=new Date(e.ts).getHours();const bucket=h<6?'Night':h<12?'Morning':h<17?'Afternoon':h<21?'Evening':'Night';acc[bucket]=(acc[bucket]||0)+1;return acc;},{});const topTod=Object.entries(tod).sort((a,b)=>b[1]-a[1])[0];const avgScore=logs.length?(logs.reduce((s,e)=>s+(e.score||0),0)/logs.length).toFixed(1):'‚Äî';el.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div class="passive-stat" onclick="openModal('Session','${sessionMin} minutes active ¬∑ ${interactionCount} interactions.')"><div class="ps-label">SESSION TIME</div><div class="ps-value">${sessionMin}m</div><div class="ps-insight">${interactionCount} interactions</div></div><div class="passive-stat" onclick="openModal('Frequency','Average ${entryFreq} days between entries.')"><div class="ps-label">ENTRY FREQUENCY</div><div class="ps-value">${entryFreq>0?entryFreq+'d':'‚Äî'}</div><div class="ps-insight">${logs.length} total entries</div></div><div class="passive-stat" onclick="openModal('Peak Time','${topTod?topTod[0]:'‚Äî'} is your most active period.')"><div class="ps-label">PEAK LOG TIME</div><div class="ps-value">${topTod?topTod[0]:'‚Äî'}</div><div class="ps-insight">Highest awareness</div></div><div class="passive-stat" onclick="openModal('Avg Score','Your cognitive baseline: ${avgScore}')"><div class="ps-label">AVG CONSCIOUSNESS</div><div class="ps-value">${avgScore}</div><div class="ps-insight">Cognitive baseline</div></div></div>`;}

// AI HUB
const AI_MODELS=[{id:'twin',name:'Your Twin',emoji:'üß†',persona:'You are the user\'s AI Digital Twin. Analyze their consciousness data. Be warm, insightful, deeply personal.'},{id:'coach',name:'Mind Coach',emoji:'üèÜ',persona:'You are an elite performance coach and neuroscientist. Give direct, actionable advice for peak mental performance.'},{id:'sage',name:'Sage',emoji:'üîÆ',persona:'You are a wise sage combining ancient wisdom with modern psychology. Use metaphors and philosophical insights.'},{id:'doctor',name:'Dr. Mind',emoji:'üë®‚Äç‚öïÔ∏è',persona:'You are a cognitive neuroscientist. Analyze patterns objectively. Be clinical but empathetic.'},{id:'friend',name:'Friend',emoji:'üòä',persona:'You are a supportive best friend. Be casual, encouraging, real. Use simple language.'}];
let curAIModel='twin',chatHistory=[];
const SUGGESTED_QS=['How\'s my mental performance trending?','What\'s my best time of day?','How do I enter flow state?','What patterns do you see in my stress?','Why does my creativity spike sometimes?','How is my sleep affecting my focus?','What habits should I build?','Am I improving over time?','How\'s my day going?','What should I focus on right now?','What\'s blocking my peak performance?','Am I close to burnout?','Give me a personal insight','What do my dreams reveal?','How\'s my emotional stability?','Predict my energy tomorrow'];
const DAILY_TIPS=['Start with your hardest task when your brain is in Beta ‚Äî usually 2-4 hours after waking.','Gamma brainwaves peak during insight. Try Alpha meditation before creative work.','Brain consolidates memories during NREM sleep. 7-9 hours optimizes learning retention.','Stress below 3 is optimal for creativity. Above 7 shrinks the hippocampus over time.','Dopamine triggers from small wins. Break large tasks into 25-minute achievements.','10 minutes of walking increases BDNF ‚Äî brain fertilizer ‚Äî improving mood for 2-3 hours.','Gratitude activates the prefrontal cortex and reduces amygdala reactivity.','Dehydration of just 2% impairs cognition by up to 20%. Keep drinking water.','Flow state occurs at skill + challenge sweet spot. Slightly above your comfort zone.','Cold shower (2 min) boosts dopamine 250% for up to 3 hours.'];
function buildAIModelsBar(){const bar=document.getElementById('aiModelsBar');if(!bar)return;bar.innerHTML=AI_MODELS.map(m=>`<div class="ai-model-btn${m.id===curAIModel?' active':''}" onclick="selectAIModel('${m.id}')"><span class="ai-logo">${m.emoji}</span><span class="ai-name">${m.name}</span></div>`).join('');}
function selectAIModel(id){curAIModel=id;document.querySelectorAll('.ai-model-btn').forEach((b,i)=>b.classList.toggle('active',AI_MODELS[i].id===id));const m=AI_MODELS.find(m=>m.id===id);addChatMsg('ai',`Switched to ${m.name}. ${m.id==='friend'?'Hey! What\'s up? üòä':m.id==='sage'?'What wisdom do you seek?':'How can I help?'}`,id);}
function loadDailyTip(){const el=document.getElementById('aiDailyTip');if(el)el.textContent=DAILY_TIPS[new Date().getDate()%DAILY_TIPS.length];}
function buildSuggestedQs(){const el=document.getElementById('suggestedQs');if(!el)return;el.innerHTML=[...SUGGESTED_QS].sort(()=>Math.random()-.5).slice(0,6).map(q=>`<button class="sq-btn" onclick="askSuggested('${q.replace(/'/g,"\\'")}')">${q}</button>`).join('');}
function askSuggested(q){document.getElementById('chatInput').value=q;sendChat();}
function addChatMsg(role,text,modelId){const msgs=document.getElementById('chatMessages');if(!msgs)return;const model=AI_MODELS.find(m=>m.id===(modelId||curAIModel));const div=document.createElement('div');div.className='chat-msg '+role;if(role==='ai')div.innerHTML=`<div class="ai-tag">${model?model.emoji+' '+model.name:'AI'}</div>${text}`;else div.textContent=text;msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;chatHistory.push({role,content:text,model:modelId||curAIModel});}
function clearAIChat(){chatHistory=[];document.getElementById('chatMessages').innerHTML='';showToast('Chat cleared');}
function exportChat(){const text=chatHistory.map(m=>`[${m.role.toUpperCase()}]: ${m.content}`).join('\n\n');const blob=new Blob([text],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='consciousness_chat.txt';a.click();}
function handleChatKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat();}}
async function sendChat(){const input=document.getElementById('chatInput');let msg=input.value.trim();if(!msg)return;input.value='';addChatMsg('user',msg);const model=AI_MODELS.find(m=>m.id===curAIModel);const msgs=document.getElementById('chatMessages');const loadDiv=document.createElement('div');loadDiv.className='chat-msg ai';loadDiv.innerHTML=`<div class="ai-tag">${model.emoji} ${model.name}</div><div class="ai-loading"><span></span><span></span><span></span></div>`;msgs.appendChild(loadDiv);msgs.scrollTop=msgs.scrollHeight;const logs=getLogs().slice(0,20),dreams=getDreams().slice(0,5);const ctx=[model.persona];if(logs.length){const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);ctx.push(`USER DATA (${logs.length} entries): mood:${avg('mood')} focus:${avg('focus')} energy:${avg('physicalEnergy')} stress:${avg('stress')} creativity:${avg('creativity')} flow:${avg('flow')} sleep:${avg('sleep')}\nLatest score:${logs[0].score}`);}if(dreams.length)ctx.push(`Recent dreams: ${dreams.map(d=>d.title+'('+d.type+')').join(', ')}`);ctx.push('Keep response concise under 150 words. Be genuine and personal.');try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:600,system:ctx.join('\n\n'),messages:[...chatHistory.filter(m=>m.role==='user'||m.role==='ai').slice(-8).map(m=>({role:m.role==='ai'?'assistant':m.role,content:m.content})),{role:'user',content:msg}]})});const data=await resp.json();loadDiv.remove();addChatMsg('ai',data.content?.[0]?.text||'Let me analyze more data!');}catch(e){loadDiv.remove();addChatMsg('ai',localAIResp(msg));}buildSuggestedQs();}
function localAIResp(msg){const logs=getLogs();if(!logs.length)return"I need your consciousness data first! Fill out your Daily Log in SELF.";const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);const lower=msg.toLowerCase();if(lower.includes('mood'))return`Your avg mood is ${avg('mood')}/10. ${parseFloat(avg('mood'))>6?'Great foundation!':'Morning sunlight and gratitude can lift it.'}`;if(lower.includes('focus'))return`Focus avg: ${avg('focus')}/10. ${parseFloat(avg('focus'))>6?'Strong!':'Try Pomodoros and no-phone zones.'}`;if(lower.includes('stress'))return`Stress avg: ${avg('stress')}/10. ${parseFloat(avg('stress'))>6?'High! Try 4-7-8 breathing.':'Well managed!'}`;return`From your ${logs.length} entries: Best dimension is ${getBestDim(logs)}, growth area is ${getWeakDim(logs)}.`;}
function getBestDim(logs){const dims=['mood','focus','physicalEnergy','creativity','flow'];let b=dims[0],bv=0;dims.forEach(d=>{const a=logs.reduce((s,e)=>s+(e[d]||0),0)/logs.length;if(a>bv){bv=a;b=d;}});return b+'('+bv.toFixed(1)+')';}
function getWeakDim(logs){const dims=['mood','focus','physicalEnergy','creativity','flow'];let w=dims[0],wv=10;dims.forEach(d=>{const a=logs.reduce((s,e)=>s+(e[d]||0),0)/logs.length;if(a<wv){wv=a;w=d;}});return w+'('+wv.toFixed(1)+')';}
function getAIGreeting(){const logs=getLogs();if(!logs.length)return'How are you feeling today?';const r=logs[0];return r.score>7?'You\'ve been performing well lately! What\'s your focus today?':r.score<4?'I see some tough days recently. Want to talk through it?':'How are you feeling today?';}
function refreshAIInsights(){const el=document.getElementById('aiPatternDisplay');if(!el)return;const logs=getLogs();if(logs.length<3){el.innerHTML='<div style="font-size:13px;color:var(--text2)">Log 3+ entries to see pattern analysis.</div>';return;}const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1);const trend=key=>{if(logs.length<2)return'‚û°Ô∏è';const recent=logs.slice(0,Math.min(5,logs.length)).reduce((s,e)=>s+(e[key]||0),0)/Math.min(5,logs.length);const prev=logs.length>5?logs.slice(5,10).reduce((s,e)=>s+(e[key]||0),0)/Math.min(5,logs.length-5):logs[logs.length-1][key]||5;const d=recent-prev;return d>0.5?'üìà':d<-0.5?'üìâ':'‚û°Ô∏è';};el.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px">${['mood','focus','stress','creativity','sleep','flow'].map(k=>`<div style="background:var(--bg3);border-radius:10px;padding:10px;text-align:center;cursor:pointer" onclick="openModal('${k} Analysis','Average ${k}: ${avg(k)}/10. ${trend(k)==='üìà'?'Trending up!':trend(k)==='üìâ'?'Trending down.':'Stable.'}')"><div style="font-size:18px;font-weight:800;color:var(--primary)">${avg(k)}</div><div style="font-size:10px;color:var(--text3)">${k} ${trend(k)}</div></div>`).join('')}</div><div style="margin-top:10px;font-size:13px;color:var(--text2);background:var(--bg3);border-radius:10px;padding:10px;cursor:pointer" onclick="switchTab('mind')">üí° <strong>AI Insight:</strong> ${logs.length} entries analyzed. Strongest: ${getBestDim(logs)}, Growth: ${getWeakDim(logs)}.</div>`;}

// ANALYSIS
function refreshAnalysis(){const logs=getLogs();const avg=key=>logs.length?(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length).toFixed(1):'‚Äî';['statMood','statFocus','statScore','statFlow','statCreativity'].forEach((id,i)=>{const keys=['mood','focus','score','flow','creativity'];const el=document.getElementById(id);if(el)el.textContent=avg(keys[i]);});const se=document.getElementById('statEntries');if(se)se.textContent=logs.length;buildTrends(logs);buildRecords(logs);const stEl=document.getElementById('stateEngArea');if(stEl){const avgMood=parseFloat(avg('mood')),avgStress=parseFloat(avg('stress')),avgFocus=parseFloat(avg('focus'));stEl.innerHTML=`<div style="font-size:13px;color:var(--text2);line-height:1.8"><p><strong>Current State:</strong> Mood ${avg('mood')} ¬∑ Focus ${avg('focus')} ¬∑ Stress ${avg('stress')}</p><p style="margin-top:8px"><strong>State Induction Recommendations:</strong></p><ul style="margin-left:16px;margin-top:4px">${avgFocus<6?'<li>Boost focus: 10min meditation + remove phone + binaural beta waves</li>':''}${avgStress>6?'<li>Reduce stress: 4-7-8 breathing, cold shower, journaling</li>':''}${avgMood<6?'<li>Lift mood: sunlight, exercise, connect with someone</li>':''}<li>Flow state: Start simple ‚Üí ramp to complex work at peak hour</li></ul></div>`;}}
function buildTrends(logs){const el=document.getElementById('trendsArea');if(!el)return;if(logs.length<5){el.innerHTML='<div style="font-size:13px;color:var(--text3)">Need 5+ entries.</div>';return;}const r=logs.slice(0,Math.min(10,logs.length)),p=logs.slice(10,20);el.innerHTML=['mood','focus','stress','creativity','flow','sleep','motivation','clarity'].map(k=>{const ra=r.reduce((s,e)=>s+(e[k]||0),0)/r.length;const pa=p.length?p.reduce((s,e)=>s+(e[k]||0),0)/p.length:ra;const d=(ra-pa).toFixed(1);const icon=parseFloat(d)>0.3?'üìà +':parseFloat(d)<-0.3?'üìâ ':'‚û°Ô∏è ';const color=parseFloat(d)>0.3?'var(--success)':parseFloat(d)<-0.3?'var(--danger)':'var(--text3)';return`<div class="trend-item" onclick="openModal('${k} trend','Recent: ${ra.toFixed(1)} vs previous: ${pa.toFixed(1)}.')"><span>${k}</span><span style="color:${color};font-weight:700">${icon}${Math.abs(parseFloat(d)).toFixed(1)}</span></div>`;}).join('');}
function buildRecords(logs){const el=document.getElementById('recordsArea');if(!el)return;if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">üèÜ</span><div class="es-text">Start logging</div></div>';return;}const max=key=>logs.reduce((m,e)=>Math.max(m,e[key]||0),0);el.innerHTML=`<div class="stats-grid"><div class="stat-box"><div class="sv">${max('score').toFixed(1)}</div><div class="sl">Best Score</div></div><div class="stat-box"><div class="sv">${max('focus')}</div><div class="sl">Peak Focus</div></div><div class="stat-box"><div class="sv">${max('flow')}</div><div class="sl">Peak Flow</div></div><div class="stat-box"><div class="sv">${max('creativity')}</div><div class="sl">Peak Create</div></div><div class="stat-box"><div class="sv">${max('mood')}</div><div class="sl">Best Mood</div></div><div class="stat-box"><div class="sv">${max('sleep')}</div><div class="sl">Best Sleep</div></div></div>`;}
function buildPredictions(logs){const el=document.getElementById('predictionsArea');if(!el)return;if(!logs.length){el.innerHTML='<div class="empty-state"><span class="es-icon">üîÆ</span><div class="es-text">Log entries to unlock</div></div>';return;}const avg=key=>(logs.reduce((s,e)=>s+(e[key]||0),0)/logs.length);const moodTrend=logs.length>1?logs[0].mood-logs[1].mood:0;el.innerHTML=`<div class="form-row" style="margin-bottom:10px"><div class="comparison-box"><div class="cv" style="color:var(--success)">${Math.min(10,Math.max(0,avg('focus')+moodTrend*0.5)).toFixed(1)}</div><div class="cl">Predicted Focus</div></div><div class="comparison-box"><div class="cv" style="color:var(--primary)">${Math.min(10,Math.max(0,avg('score')+moodTrend*0.3)).toFixed(1)}</div><div class="cl">Predicted Score</div></div></div><div style="font-size:12px;color:var(--text2);background:var(--bg3);border-radius:10px;padding:10px">${moodTrend>0.5?'‚úÖ Momentum building':'moodTrend<-0.5?‚ö†Ô∏è Recovery mode':'üìä Stable trajectory'} ‚Äî ${moodTrend>0.5?'Mood rising ‚Üí better performance coming!':moodTrend<-0.5?'Dipping ‚Üí prioritize recovery tonight.':'Maintain your routines.'}</div>`;}
function buildPatterns(logs){const el=document.getElementById('patternsArea');if(!el)return;if(logs.length<3){el.innerHTML='<div class="empty-state"><span class="es-icon">üß©</span><div class="es-text">Log 3+ entries</div></div>';return;}const emotions={};logs.forEach(e=>{if(e.emotion)emotions[e.emotion]=(emotions[e.emotion]||0)+1;});const top=Object.entries(emotions).sort((a,b)=>b[1]-a[1]).slice(0,8);const avgByTOD={};logs.forEach(e=>{if(!e.timeOfDay)return;if(!avgByTOD[e.timeOfDay])avgByTOD[e.timeOfDay]={total:0,count:0};avgByTOD[e.timeOfDay].total+=e.score||0;avgByTOD[e.timeOfDay].count++;});const bestTOD=Object.entries(avgByTOD).sort((a,b)=>b[1].total/b[1].count-a[1].total/a[1].count)[0];el.innerHTML=`<div style="margin-bottom:12px"><div style="font-weight:700;font-size:13px;margin-bottom:6px">Dominant Emotions:</div>${top.map(([em,n])=>`<span class="chip" onclick="filterByEmotion('${em}')">${em} √ó${n}</span>`).join('')}</div>${bestTOD?`<div style="background:var(--bg3);border-radius:10px;padding:10px;font-size:13px;cursor:pointer" onclick="openModal('Peak Time','${bestTOD[0]} scores ${(bestTOD[1].total/bestTOD[1].count).toFixed(1)}/10 avg.')">üèÜ <strong>Peak time:</strong> ${bestTOD[0]} (avg ${(bestTOD[1].total/bestTOD[1].count).toFixed(1)})</div>`:''}`;}
function filterByEmotion(em){const logs=getLogs().filter(e=>e.emotion===em);openModal('Entries: '+em,`${logs.length} entries when feeling "${em}". Avg score: ${logs.length?(logs.reduce((s,e)=>s+(e.score||0),0)/logs.length).toFixed(1):'‚Äî'}`);}
function buildTimeHeatmap(){const el=document.getElementById('timeHeatmap');if(!el)return;const logs=getLogs();const buckets=Array(24).fill(0);logs.forEach(e=>{const h=new Date(e.ts).getHours();buckets[h]++;});const max=Math.max(...buckets,1);el.innerHTML=`<div style="font-size:11px;color:var(--text3);margin-bottom:6px">Hour of day (entry frequency)</div><div style="display:flex;gap:1px">${buckets.map((n,h)=>`<div style="flex:1;height:36px;background:${n>0?`rgba(124,58,237,${0.1+0.9*n/max})`:'var(--bg3)'};border-radius:2px;cursor:pointer" onclick="openModal('${h}:00','${n} entries at this hour.')"></div>`).join('')}</div><div style="display:flex;justify-content:space-between;font-size:9px;color:var(--text3);margin-top:2px"><span>12am</span><span>6am</span><span>12pm</span><span>6pm</span><span>12am</span></div>`;}

// WORLD DATA ‚Äî static rich datasets
const MARKET_DATA=[{sym:'SPX',name:'S&P 500',val:'5,234',chg:'+0.8%',up:true},{sym:'BTC',name:'Bitcoin',val:'$67,420',chg:'+2.1%',up:true},{sym:'GOLD',name:'Gold',val:'$2,340',chg:'-0.3%',up:false},{sym:'OIL',name:'Crude Oil',val:'$82.10',chg:'+1.2%',up:true},{sym:'DXY',name:'US Dollar',val:'104.2',chg:'-0.4%',up:false},{sym:'ETH',name:'Ethereum',val:'$3,456',chg:'+3.2%',up:true},{sym:'BND',name:'10Y Bond',val:'4.28%',chg:'+0.05',up:true},{sym:'VIX',name:'Fear Index',val:'18.4',chg:'-5%',up:false}];
const WORLD_EVENTS=[{title:'Central Banks Signal Rate Cuts',tag:'Monetary',impact:'Lower rates ‚Üí bonds fall ‚Üí stocks rise ‚Üí crypto bullish ‚Üí gold mixed. Watch for dollar weakness which lifts commodities.',cat:'macro'},{title:'AI Chip Exports Restricted',tag:'Tech/Geo',impact:'Semiconductor shortage risk ‚Üí defense stocks up ‚Üí AI infrastructure costs rise ‚Üí productivity slowdown in affected regions.',cat:'geo'},{title:'Energy Transition Accelerates',tag:'Commodities',impact:'Renewable build-out ‚Üí copper/lithium demand surges ‚Üí oil plateaus ‚Üí utilities outperform. Long-term deflationary for energy.',cat:'commodities'},{title:'Dollar Strength Cycle Peaking',tag:'Forex',impact:'Strong dollar hurts emerging markets ‚Üí commodities fall in USD terms ‚Üí US exporters struggle ‚Üí multinational earnings compressed.',cat:'macro'},{title:'Geopolitical Tensions in Shipping Lanes',tag:'Geopolitics',impact:'Insurance costs rise ‚Üí supply chain inflation ‚Üí energy price volatility ‚Üí safe haven assets (gold, US bonds) strengthened.',cat:'geo'}];
const GEO_DATA=[{title:'Multipolar World Emerging',desc:'US, China, EU competing for influence. Semiconductor wars, currency alternatives (BRICS), AI dominance battles shaping next decade.',link:'Markets/Gold: safe havens benefit. Tech: dual supply chains forming. Energy: diversification accelerates.'},{title:'AI Arms Race: Nations vs Corporations',desc:'Governments regulating while racing to adopt AI. National AI strategies competing. Defense applications accelerating.',link:'Defense tech rising. AI infrastructure mega-cap demand surges. Regulatory uncertainty = volatility.'},{title:'Resource Nationalism Rising',desc:'Governments taking back control of critical minerals: lithium, copper, rare earths. Nationalization risk for mining companies.',link:'Commodity price floors elevated. Supply security premium. Reshoring manufacturing increases costs.'}];
const CRYPTO_DATA=[{name:'Bitcoin (BTC)',desc:'Digital gold narrative. Halving cycle (every 4 years) reduces supply. Institutional adoption through ETFs.',cycle:'Halving ‚Üí scarcity ‚Üí price discovery ‚Üí all-time high cycle. Post-halving bull run likely.',color:'#f59e0b'},{name:'Ethereum (ETH)',desc:'Programmable money. Smart contracts enable DeFi, NFTs, stablecoins. Proof-of-stake reduces energy 99%.',cycle:'Follows BTC with leverage. Alt-season typically follows BTC peak.',color:'#6366f1'},{name:'Stablecoins',desc:'Bridge between traditional and crypto finance. USDT, USDC pegged to dollar. Growing in emerging markets.',cycle:'Counter-cyclical during crypto bear markets. Growing utility in cross-border payments.',color:'#10b981'}];
const COMMODITIES=[{name:'
// ‚îÄ‚îÄ‚îÄ WORLD PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MARKET_DATA2=[{sym:'SPX',name:'S&P 500',val:'5,234',chg:'+0.8%',up:true},{sym:'BTC',name:'Bitcoin',val:'$67,420',chg:'+2.1%',up:true},{sym:'GOLD',name:'Gold',val:'$2,340',chg:'-0.3%',up:false},{sym:'OIL',name:'Crude',val:'$82.10',chg:'+1.2%',up:true},{sym:'DXY',name:'US Dollar',val:'104.2',chg:'-0.4%',up:false},{sym:'ETH',name:'Ethereum',val:'$3,456',chg:'+3.2%',up:true},{sym:'BND',name:'10Y Bond',val:'4.28%',chg:'+0.05',up:true},{sym:'VIX',name:'Fear Index',val:'18.4',chg:'-5%',up:false}];
const WORLD_EVENTS2=[{title:'Central Banks Signal Rate Cuts',tag:'Monetary',impact:'Lower rates ‚Üí bonds fall ‚Üí stocks rise ‚Üí crypto bullish. Watch for dollar weakness lifting commodities.',cat:'macro'},{title:'AI Chip Exports Restricted',tag:'Tech/Geo',impact:'Semiconductor shortage risk ‚Üí defense stocks up ‚Üí AI infrastructure costs rise ‚Üí productivity slowdown in affected regions.',cat:'geo'},{title:'Energy Transition Accelerates',tag:'Commodities',impact:'Renewable build-out ‚Üí copper/lithium demand surges ‚Üí oil plateaus ‚Üí utilities outperform.',cat:'commodities'},{title:'Dollar Cycle Peaking',tag:'Forex',impact:'Strong dollar hurts emerging markets ‚Üí commodities fall in USD terms ‚Üí US exporters struggle.',cat:'macro'},{title:'Shipping Lane Tensions',tag:'Geopolitics',impact:'Insurance costs rise ‚Üí supply chain inflation ‚Üí energy price volatility ‚Üí safe haven assets strengthened.',cat:'geo'}];
const GEO_DATA2=[{title:'Multipolar World Emerging',desc:'US, China, EU competing for influence. Semiconductor wars, BRICS alternatives, AI dominance battles shaping next decade.',link:'Gold/bonds benefit as safe havens. Tech: dual supply chains. Energy: diversification accelerates.'},{title:'AI Arms Race: Nations vs Corps',desc:'Governments regulating while racing to adopt. National AI strategies competing. Defense applications accelerating.',link:'Defense tech rising. AI infrastructure mega-cap demand surges. Regulatory uncertainty = volatility.'},{title:'Resource Nationalism Rising',desc:'Governments reclaiming control of lithium, copper, rare earths. Nationalization risk rising for mining companies.',link:'Commodity price floors elevated. Supply security premium. Reshoring increases costs.'}];
const CRYPTO_DATA2=[{name:'Bitcoin (BTC)',desc:'Digital gold. Halving cycle (every 4 years) reduces supply. Institutional adoption via ETFs.',cycle:'Halving ‚Üí scarcity ‚Üí price discovery ‚Üí ATH cycle. Post-halving bull run historically follows.',color:'#f59e0b'},{name:'Ethereum (ETH)',desc:'Programmable money. Smart contracts power DeFi, NFTs, stablecoins.',cycle:'Follows BTC with leverage. Alt-season typically follows BTC peak by ~3-6 months.',color:'#6366f1'},{name:'Stablecoins',desc:'Bridge between TradFi and crypto. USDT, USDC pegged to dollar.',cycle:'Counter-cyclical during bear markets. Growing in cross-border payments.',color:'#10b981'}];
const COMMODITIES2=[{name:'Gold',desc:'Safe haven. Rises during geopolitical uncertainty and dollar weakness.',driver:'War/conflict, dollar falls, central bank buying, inflation fears.',emoji:'ü•á'},{name:'Oil (WTI)',desc:'Economic indicator. Reflects global growth expectations.',driver:'OPEC+ decisions, China demand, geopolitical supply disruption.',emoji:'üõ¢Ô∏è'},{name:'Copper',desc:'Dr. Copper predicts economic health. Rising copper = growth ahead.',driver:'China manufacturing, EV production, infrastructure spending.',emoji:'‚ö°'},{name:'Lithium',desc:'Energy transition metal. EV battery demand driving secular trend.',driver:'EV adoption rate, battery tech improvements, mine supply.',emoji:'üîã'}];
const WORLD_SUGGESTED=['Will war increase gold?','How do interest rates affect crypto?','What happens when dollar weakens?','Why does oil price affect everything?','Explain the inflation-bond relationship','How does AI affect jobs and markets?','What drives Bitcoin halving cycles?','How do central banks create money?','Will BRICS replace the dollar?','How do geopolitics affect energy?'];

function buildWorldPanel(){
  buildMarketTicker();buildWorldStats();buildEconEvents();buildWorldSuggested();buildGeoContent();buildMarketsContent();buildCryptoContent();buildCommoditiesContent();buildWorldAIModels();
}
function buildMarketTicker(){
  const el=document.getElementById('marketTicker');if(!el)return;
  el.innerHTML=MARKET_DATA2.map(m=>`<div class="ticker-item" onclick="askWorldQuestion('Explain what ${m.name} (${m.sym}) moving to ${m.val} ${m.chg} means for the economy and other markets.')"><div class="tk-sym">${m.sym}</div><div class="tk-val">${m.val}</div><div class="tk-chg" style="color:${m.up?'var(--success)':'var(--danger)'}">${m.chg}</div></div>`).join('');
}
function buildWorldStats(){
  const el=document.getElementById('worldStatsGrid');if(!el)return;
  const stats=[{icon:'üí∞',label:'Fed Rate',value:'5.25%',change:'-0.25%',up:false},{icon:'üìà',label:'Inflation',value:'3.1%',change:'-0.2%',up:false},{icon:'üíº',label:'Unemployment',value:'3.9%',change:'+0.1%',up:true},{icon:'üìä',label:'GDP Growth',value:'2.8%',change:'+0.3%',up:true}];
  el.innerHTML=stats.map(s=>`<div class="world-stat" onclick="askWorldQuestion('Explain the current ${s.label} of ${s.value} and what it means for the economy, markets, and everyday life.')"><div class="ws-icon">${s.icon}</div><div class="ws-label">${s.label}</div><div class="ws-value">${s.value}</div><div class="ws-change ${s.up?'up':'down'}">${s.change}</div></div>`).join('');
}
function buildEconEvents(){
  const el=document.getElementById('econEvents');if(!el)return;
  el.innerHTML=WORLD_EVENTS2.map(e=>`<div class="world-event" onclick="showCausalChain('${e.title}','${e.impact}')"><div style="display:flex;align-items:center;gap:8px"><span class="badge badge-accent">${e.tag}</span><div class="we-title">${e.title}</div></div><div class="we-impact">${e.impact}</div></div>`).join('');
}
function buildWorldSuggested(){
  const el=document.getElementById('worldSuggested');if(!el)return;
  el.innerHTML=WORLD_SUGGESTED.map(q=>`<button class="sq-btn" onclick="askWorldQuestion('${q}')">${q}</button>`).join('');
}
function showCausalChain(title,chain){
  const chainCard=document.getElementById('causalChainCard');if(!chainCard)return;
  chainCard.style.display='block';
  const viz=document.getElementById('causalChainViz');if(!viz)return;
  const steps=chain.split('‚Üí').map(s=>s.trim()).filter(Boolean);
  viz.innerHTML=`<div style="font-weight:700;margin-bottom:10px">${title}</div>${steps.map((s,i)=>`<div class="chain-step">${i>0?'<div class="chain-arrow">‚Üí</div>':'<div class="chain-arrow">‚ñ∂</div>'}<div class="chain-box">${s}</div></div>`).join('')}`;
  chainCard.scrollIntoView({behavior:'smooth'});
}
function buildGeoContent(){
  const el=document.getElementById('geoEvents');if(!el)return;
  el.innerHTML=GEO_DATA2.map(g=>`<div class="card" style="cursor:pointer" onclick="askWorldQuestion('Explain in detail: ${g.title} ‚Äî how does this geopolitical development affect markets, currencies, and everyday people?')"><div class="card-title"><span class="emoji">üåç</span>${g.title}</div><p style="font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:8px">${g.desc}</p><div style="background:var(--bg3);border-radius:8px;padding:8px;font-size:12px;color:var(--primary)">üìä Market impact: ${g.link}</div></div>`).join('');
  const links=document.getElementById('geoMarketLinks');if(!links)return;
  links.innerHTML=`<div style="font-size:13px;color:var(--text2);line-height:1.9">${['War/conflict ‚Üí Gold ‚Üë, Oil ‚Üë, stocks uncertain, bonds down (flight to safety)','Trade wars ‚Üí Currency volatility, supply chain restructuring, inflation in affected goods','Election uncertainty ‚Üí VIX ‚Üë, flight to safe havens, sector rotation based on policies','Central bank policy ‚Üí Bond prices, currency strength, borrowing costs, all asset prices','Climate events ‚Üí Agricultural commodities, insurance sectors, energy transition acceleration'].map(l=>`<div class="chain-step"><div class="chain-arrow">‚ö°</div><div class="chain-box">${l}</div></div>`).join('')}</div>`;
}
function buildMarketsContent(){
  const el=document.getElementById('marketsContent');if(!el)return;
  el.innerHTML=`<div class="card"><div class="card-title"><span class="emoji">üìä</span> Market Cycle Visualization</div><div style="font-size:13px;color:var(--text2);line-height:1.8">${['Recovery ‚Üí Stocks rise, bonds fall, commodities trough','Expansion ‚Üí Growth peaks, earnings strong, sentiment bullish','Peak ‚Üí Valuations extended, central banks tighten, volatility creeps in','Contraction ‚Üí Stocks fall, bonds rally, commodities peak, flight to safety'].map((s,i)=>`<div class="path-step"><div class="path-num">${i+1}</div><div><div style="font-weight:700">${s.split('‚Üí')[0]}</div><div style="font-size:12px;color:var(--text3)">${s.split('‚Üí')[1]||''}</div></div></div>`).join('')}</div></div>`;
  const rates=document.getElementById('ratesContent');if(!rates)return;
  rates.innerHTML=`<div style="font-size:13px;color:var(--text2);line-height:1.9">${['Rate ‚Üë ‚Üí Mortgages cost more ‚Üí Housing slows ‚Üí Construction jobs fall','Rate ‚Üë ‚Üí Borrowing costs rise ‚Üí Corporate earnings compress ‚Üí P/E ratios fall','Rate ‚Üë ‚Üí Dollar strengthens ‚Üí Emerging markets struggle ‚Üí Commodity prices fall in USD','Rate ‚Üì ‚Üí Cheap money ‚Üí Risk assets boom ‚Üí Crypto and stocks rally','Rate ‚Üì ‚Üí Savings rates fall ‚Üí People seek yield ‚Üí Real estate and equities get bid up'].map(l=>`<div class="chain-step"><div class="chain-arrow">‚Üí</div><div class="chain-box">${l}</div></div>`).join('')}</div>`;
  const inf=document.getElementById('inflationContent');if(!inf)return;
  inf.innerHTML=`<div style="font-size:13px;color:var(--text2);line-height:1.9">${['High inflation ‚Üí Your purchasing power falls ‚Üí Real wages decline unless you negotiate','High inflation ‚Üí Central banks raise rates ‚Üí All asset prices compressed','Moderate inflation (2%) ‚Üí Healthy for growth ‚Üí Encourages spending over saving','Hyperinflation ‚Üí Currency collapse ‚Üí Flee to hard assets: gold, real estate, commodities','Deflation ‚Üí Prices fall ‚Üí Economy stalls ‚Üí Cash becomes king temporarily'].map(l=>`<div class="chain-step"><div class="chain-arrow">‚ö°</div><div class="chain-box">${l}</div></div>`).join('')}</div>`;
}
function buildCryptoContent(){
  const el=document.getElementById('cryptoContent');if(!el)return;
  el.innerHTML=CRYPTO_DATA2.map(c=>`<div class="card" style="cursor:pointer;border-left:3px solid ${c.color}" onclick="askWorldQuestion('Explain the ${c.name} investment thesis, risks, and where we are in the cycle.')"><div class="card-title">${c.name}</div><p style="font-size:13px;color:var(--text2);margin-bottom:8px">${c.desc}</p><div style="background:var(--bg3);border-radius:8px;padding:8px;font-size:12px;color:var(--primary)">üîÑ Cycle: ${c.cycle}</div></div>`).join('');
  const cycles=document.getElementById('cryptoCycles');if(!cycles)return;
  cycles.innerHTML=`<div style="font-size:13px;color:var(--text2);line-height:1.9">${['Bitcoin Halving (Apr 2024) ‚Üí Supply cut in half ‚Üí Scarcity narrative ‚Üí Institutional demand surge','FOMO cycle begins ‚Üí Retail enters ‚Üí Altcoins rally ‚Üí Meme coins peak ‚Üí Mania phase','Euphoria ‚Üí Media headlines ‚Üí Everyone talking crypto ‚Üí Peak sentiment','Correction ‚Üí 50-80% drawdown ‚Üí Weak hands sell ‚Üí Accumulation phase begins','Next halving cycle ‚Üí Repeat with higher high, higher low pattern'].map((s,i)=>`<div class="path-step"><div class="path-num">${i+1}</div><div><div style="font-size:13px;color:var(--text2)">${s}</div></div></div>`).join('')}</div>`;
}
function buildCommoditiesContent(){
  const el=document.getElementById('commoditiesContent');if(!el)return;
  el.innerHTML=COMMODITIES2.map(c=>`<div class="card" style="cursor:pointer" onclick="askWorldQuestion('Explain ${c.name} commodity dynamics ‚Äî what drives its price, who controls it, and how to think about it as an economic signal.')"><div class="card-title"><span class="emoji">${c.emoji}</span>${c.name}</div><p style="font-size:13px;color:var(--text2);margin-bottom:6px">${c.desc}</p><div style="font-size:12px;color:var(--primary);background:var(--bg3);border-radius:6px;padding:6px 10px">üìå Drivers: ${c.driver}</div></div>`).join('');
}
function buildWorldAIModels(){
  const el=document.getElementById('worldAIModels');if(!el)return;
  const models=[{id:'analyst',name:'Analyst',emoji:'üìä',persona:'You are a senior market analyst with 20 years of experience. Give data-driven market analysis.'},{id:'geopolitics',name:'Geopolitics',emoji:'üåç',persona:'You are a geopolitical intelligence expert. Connect world events to market outcomes.'},{id:'macro',name:'Macro',emoji:'üî≠',persona:'You are a macroeconomic strategist. Explain the big picture forces at play.'},{id:'crypto',name:'Crypto',emoji:'‚Çø',persona:'You are a crypto market expert with deep knowledge of blockchain dynamics and market cycles.'},{id:'historian',name:'Historian',emoji:'üìú',persona:'You are an economic historian. Connect current events to historical cycles and patterns.'}];
  el.innerHTML=models.map(m=>`<div class="ai-model-btn" onclick="selectWorldAIModel('${m.id}','${m.emoji} ${m.name}','${m.persona.replace(/'/g,"\\'")}')"><span class="ai-logo">${m.emoji}</span><span class="ai-name">${m.name}</span></div>`).join('');
}
let worldAIPersona='You are a senior financial intelligence analyst. Explain how global events connect to markets, currencies, and everyday life in clear causal chains.';
let worldAIName='üìä Analyst';
function selectWorldAIModel(id,name,persona){worldAIPersona=persona;worldAIName=name;document.querySelectorAll('#worldAIModels .ai-model-btn').forEach(b=>b.classList.remove('active'));event.currentTarget.classList.add('active');addWorldAIMsg('ai',`Switched to ${name} mode. What do you want to analyze?`);}
let worldAIChatHistory=[];
function addWorldAIMsg(role,text){const msgs=document.getElementById('worldAIChat');if(!msgs)return;const div=document.createElement('div');div.className='chat-msg '+role;if(role==='ai')div.innerHTML=`<div class="ai-tag">${worldAIName}</div>${text}`;else div.textContent=text;msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;worldAIChatHistory.push({role,content:text});}
async function sendWorldChat(){
  const input=document.getElementById('worldChatInput');const msg=input.value.trim();if(!msg)return;
  askWorldQuestion(msg);input.value='';
}
async function sendWorldAIChat(){
  const input=document.getElementById('worldAIChatInput');const msg=input.value.trim();if(!msg)return;
  input.value='';addWorldAIMsg('user',msg);
  const msgs=document.getElementById('worldAIChat');
  const loadDiv=document.createElement('div');loadDiv.className='chat-msg ai';loadDiv.innerHTML=`<div class="ai-tag">${worldAIName}</div><div class="ai-loading"><span></span><span></span><span></span></div>`;
  msgs.appendChild(loadDiv);msgs.scrollTop=msgs.scrollHeight;
  try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:600,system:worldAIPersona+' Be concise, explain causal chains clearly. Max 150 words.',messages:[...worldAIChatHistory.slice(-6).map(m=>({role:m.role==='ai'?'assistant':m.role,content:m.content})),{role:'user',content:msg}]})});const data=await resp.json();loadDiv.remove();addWorldAIMsg('ai',data.content?.[0]?.text||'Analysis unavailable ‚Äî check API key in settings.');}
  catch(e){loadDiv.remove();addWorldAIMsg('ai',localWorldResp(msg));}
}
async function askWorldQuestion(q){
  const chatEl=document.getElementById('worldChat');if(!chatEl)return;
  const userDiv=document.createElement('div');userDiv.className='chat-msg user';userDiv.textContent=q;chatEl.appendChild(userDiv);
  const loadDiv=document.createElement('div');loadDiv.className='chat-msg ai';loadDiv.innerHTML=`<div class="ai-tag">üåç World Intelligence</div><div class="ai-loading"><span></span><span></span><span></span></div>`;
  chatEl.appendChild(loadDiv);chatEl.scrollTop=chatEl.scrollHeight;
  const system='You are a World Intelligence AI. Explain economic and geopolitical causal chains in 3-5 clear steps. Start with the event, show each ripple effect. Use arrows ‚Üí to show cause/effect. Be educational and concise. Max 120 words.';
  try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:400,system,messages:[{role:'user',content:q}]})});const data=await resp.json();const text=data.content?.[0]?.text||localWorldResp(q);loadDiv.remove();const aiDiv=document.createElement('div');aiDiv.className='chat-msg ai';aiDiv.innerHTML=`<div class="ai-tag">üåç World Intelligence</div>${text}`;chatEl.appendChild(aiDiv);chatEl.scrollTop=chatEl.scrollHeight;}
  catch(e){loadDiv.remove();const aiDiv=document.createElement('div');aiDiv.className='chat-msg ai';aiDiv.innerHTML=`<div class="ai-tag">üåç World Intelligence</div>${localWorldResp(q)}`;chatEl.appendChild(aiDiv);chatEl.scrollTop=chatEl.scrollHeight;}
  if(q.toLowerCase().includes('gold')||q.toLowerCase().includes('war'))showCausalChain('Causal Analysis',`Event: ${q} ‚Üí Safe haven demand rises ‚Üí Gold prices spike ‚Üí Dollar may weaken ‚Üí Commodities reprice ‚Üí Stock markets volatile`);
}
function localWorldResp(q){const lower=q.toLowerCase();if(lower.includes('gold'))return'War/conflict ‚Üí geopolitical uncertainty ‚Üí investors flee to safety ‚Üí gold demand spikes ‚Üí gold prices rise. Gold also rises when: dollar weakens, inflation fears grow, central banks buy.';if(lower.includes('interest rate')||lower.includes('rates'))return'Higher rates ‚Üí borrowing costs up ‚Üí spending falls ‚Üí inflation cools. Also: bonds more attractive ‚Üí stocks less attractive ‚Üí dollar strengthens ‚Üí emerging markets struggle.';if(lower.includes('crypto')||lower.includes('bitcoin'))return'Bitcoin follows 4-year halving cycles. Supply cuts ‚Üí scarcity ‚Üí price discovery. Institutional ETF demand adds new buyers. Correlated with risk-on sentiment ‚Äî rises when fear falls.';if(lower.includes('inflation'))return'Inflation = too much money chasing too few goods. Causes: supply shocks, demand surge, money printing. Effect: purchasing power falls, rates rise, borrowers hurt, creditors benefit.';return'Key causal chain: global event ‚Üí affects supply/demand or confidence ‚Üí markets reprice ‚Üí currency moves ‚Üí commodities adjust ‚Üí real economy feels impact 6-18 months later.';}

// ‚îÄ‚îÄ‚îÄ SCIENCE PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DISCOVERIES=[{id:1,cat:'neuroscience',catColor:'#6366f1',title:'Neuroplasticity Rewritten: Adults Form New Neurons',desc:'Contrary to old dogma, the hippocampus continues producing new neurons throughout adult life. Exercise, learning, and sleep are the primary drivers.',wow:'üí° This means your brain is fundamentally changeable at any age.'},{id:2,cat:'AI',catColor:'#0891b2',title:'Large Language Models Develop Emergent Reasoning',desc:'AI systems crossing certain scale thresholds suddenly exhibit qualitatively new capabilities not present in smaller models ‚Äî chain-of-thought reasoning, analogical thinking.',wow:'üí° Intelligence may emerge from complexity ‚Äî not explicit programming.'},{id:3,cat:'longevity',catColor:'#10b981',title:'Rapamycin Extends Lifespan in Multiple Species',desc:'This mTOR inhibitor drug consistently extends healthy lifespan by 15-25% in mice. Clinical trials in humans show promising biomarker improvements.',wow:'üí° The first drug that may actually slow aging, not just treat symptoms.'},{id:4,cat:'physics',catColor:'#8b5cf6',title:'Quantum Entanglement at Room Temperature',desc:'Researchers demonstrated quantum entanglement between macroscopic objects at room temperature, defying the assumption that quantum effects require extreme cold.',wow:'üí° Opens door to room-temperature quantum computers within a decade.'},{id:5,cat:'space',catColor:'#ec4899',title:'Evidence of Subsurface Ocean on Enceladus',desc:'Saturn\'s moon Enceladus has a global liquid water ocean beneath its ice shell with complex organic chemistry ‚Äî possibly the most hospitable environment for life in the solar system.',wow:'üí° Life may be common in the universe if it exists in our own backyard.'},{id:6,cat:'biotech',catColor:'#f59e0b',title:'CRISPR-Cas9 Cures Genetic Diseases In Vivo',desc:'First successful in-body gene editing cured sickle cell disease and beta-thalassemia with a single treatment. Multiple trials underway for other genetic conditions.',wow:'üí° Single-letter DNA corrections could eliminate thousands of inherited diseases.'},{id:7,cat:'neuroscience',catColor:'#6366f1',title:'Default Mode Network and the Consciousness Switch',desc:'The brain\'s "idle" network (DMN) is now understood to be essential for self-referential thought, creativity, and ‚Äî possibly ‚Äî consciousness itself.',wow:'üí° Your most important thinking happens when you appear to be doing nothing.'},{id:8,cat:'AI',catColor:'#0891b2',title:'AI Discovers New Antibiotic Molecules',desc:'Machine learning systems screened hundreds of millions of molecular compounds and identified novel antibiotic candidates active against drug-resistant bacteria.',wow:'üí° AI is now doing original scientific discovery, not just analysis.'},{id:9,cat:'longevity',catColor:'#10b981',title:'Senolytics: Clearing "Zombie Cells" Reverses Aging',desc:'Senescent cells accumulate with age and drive inflammation. Senolytic drugs that selectively eliminate them reversed age-related decline in multiple animal studies.',wow:'üí° Aging may be a treatable condition, not an inevitable process.'},{id:10,cat:'physics',catColor:'#8b5cf6',title:'Room-Temperature Superconductivity Milestone',desc:'Materials that conduct electricity with zero resistance at room temperature would revolutionize energy grids, computing, and transportation.',wow:'üí° Solving this would be like discovering free energy ‚Äî it changes everything.'},{id:11,cat:'space',catColor:'#ec4899',title:'James Webb Reveals Galaxies Older Than Models Predict',desc:'JWST is finding massive, well-formed galaxies in the early universe that shouldn\'t exist according to current cosmological models.',wow:'üí° We may need to fundamentally rewrite our understanding of how galaxies form.'},{id:12,cat:'biotech',catColor:'#f59e0b',title:'mRNA Technology Beyond COVID: Cancer Vaccines',desc:'mRNA platforms are being adapted to create personalized cancer vaccines tailored to each patient\'s specific tumor mutations.',wow:'üí° The same technology that defeated COVID may defeat cancer within a decade.'}];
let sciFilter='all';
function buildSciencePanel(){buildDiscoveryFeed();buildSciCatFilter();buildNeuroContent();buildAIFrontierContent();buildLongevityContent();}
function buildSciCatFilter(){const el=document.getElementById('sciCatFilter');if(!el)return;const cats=['all','neuroscience','AI','longevity','physics','space','biotech'];el.innerHTML=cats.map(c=>`<button class="sci-cat-btn${sciFilter===c?' active':''}" onclick="setSciFilter('${c}')">${c==='all'?'üåü All':c}</button>`).join('');}
function setSciFilter(cat){sciFilter=cat;buildDiscoveryFeed();document.querySelectorAll('.sci-cat-btn').forEach(b=>{b.classList.toggle('active',b.textContent.includes(cat)||cat==='all'&&b.textContent.includes('All'));});}
function buildDiscoveryFeed(){const el=document.getElementById('discoveryFeed');if(!el)return;const filtered=sciFilter==='all'?DISCOVERIES:DISCOVERIES.filter(d=>d.cat===sciFilter);el.innerHTML=filtered.map(d=>`<div class="discovery-card" onclick="openModal('${d.title}','<p style=\\"margin-bottom:12px\\">${d.desc}</p><div style=\\"background:rgba(124,58,237,.08);border-radius:10px;padding:12px;font-weight:700\\">${d.wow}</div>')"><span class="dc-cat" style="background:${d.catColor}22;color:${d.catColor}">${d.cat}</span><div class="dc-title">${d.title}</div><div class="dc-desc">${d.desc.slice(0,120)}...</div><span class="dc-wow">${d.wow}</span></div>`).join('');}
function buildNeuroContent(){const el=document.getElementById('neuroContent');if(!el)return;const facts=[{icon:'üß†',title:'The Brain Uses 20% of Your Energy',body:'Despite being only 2% of body weight, the brain consumes 20% of your calories. Glucose is primary fuel. Sleep is when it clears toxic metabolic waste via the glymphatic system.'},{icon:'üîó',title:'100 Trillion Synaptic Connections',body:'Each neuron connects to ~7,000 others. The number of possible states exceeds atoms in the observable universe. Your unique connection pattern IS your unique consciousness.'},{icon:'üò¥',title:'Sleep is Active Neuroscience',body:'During deep sleep, the glymphatic system flushes amyloid-beta (Alzheimer\'s precursor) from the brain. Poor sleep = toxin accumulation. 7-9 hours is nonnegotiable.'},{icon:'üèÉ',title:'Exercise is the Best Nootropic',body:'Aerobic exercise increases BDNF (brain-derived neurotrophic factor) ‚Äî literally grows new neurons. 20-30 min cardio 3x/week measurably improves memory, mood, and processing speed.'}];el.innerHTML=`<div style="padding:12px">${facts.map(f=>`<div class="card" onclick="openModal('${f.title}','${f.body}')"><div class="card-title"><span class="emoji">${f.icon}</span>${f.title}</div><p style="font-size:13px;color:var(--text2)">${f.body.slice(0,100)}...</p></div>`).join('')}</div>`;}
function buildAIFrontierContent(){const el=document.getElementById('aiFrontierContent');if(!el)return;el.innerHTML=`<div class="card"><div class="card-title"><span class="emoji">ü§ñ</span>AI Frontier Developments</div>${['GPT-4/Claude-level reasoning now achieves PhD-level performance on domain-specific benchmarks ‚Äî 2024-2025','Multimodal AI: understanding images, audio, video simultaneously changing human-computer interfaces','AI agents autonomously complete multi-step software development tasks without human guidance','Drug discovery timelines shrinking from 15 years ‚Üí 5 years with AI-assisted molecular screening','AI vs human creativity: models now producing publishable scientific hypotheses autonomously'].map(f=>`<div class="chain-step"><div class="chain-arrow">‚ö°</div><div class="chain-box">${f}</div></div>`).join('')}</div>`;}
function buildLongevityContent(){const el=document.getElementById('longevityContent');if(!el)return;el.innerHTML=`<div class="card"><div class="card-title"><span class="emoji">‚è≥</span>Longevity Science Frontiers</div>${['Hallmarks of Aging: 12 identified mechanisms ‚Äî senescence, epigenetic drift, mitochondrial decay, proteostasis loss','Telomere length as aging biomarker ‚Äî shortened telomeres correlate with disease and lifespan','Yamanaka factors can partially reprogram cells to a younger epigenetic state ‚Äî first tested in mice','Caloric restriction extends lifespan in most species studied ‚Äî mimetic drugs under development','Biological age vs chronological age: now measurable via methylation clocks (Horvath clock)'].map(f=>`<div class="chain-step"><div class="chain-arrow">üî¨</div><div class="chain-box">${f}</div></div>`).join('')}</div>`;}

// ‚îÄ‚îÄ‚îÄ PATH MODULE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildPathPanel(){buildSkillDomains();buildLearningStrategy();buildCareerSuggested();}
function buildSkillDomains(){
  const el=document.getElementById('skillDomainBtns');if(!el)return;
  const domains=['AI / Machine Learning','Neuroscience','Entrepreneurship','Finance / Quant','Creative Technology','Biotech','Philosophy','Deep Tech'];
  el.innerHTML=domains.map(d=>`<button class="chip" onclick="showSkillStack('${d}')">${d}</button>`).join('');
}
function showSkillStack(domain){
  const el=document.getElementById('skillStackOutput');if(!el)return;
  const stacks={
    'AI / Machine Learning':['Linear Algebra & Statistics','Python Programming','Machine Learning Fundamentals','Deep Learning (PyTorch/TensorFlow)','Data Engineering','MLOps & Deployment','AI Research Papers','Specialization: NLP / Vision / RL'],
    'Neuroscience':['Biology Foundations','Neuroanatomy','Cellular Neuroscience','Systems Neuroscience','Cognitive Neuroscience','Research Methods (EEG, fMRI)','Statistics for Neuroscience','Specialization: Computational / Clinical'],
    'Entrepreneurship':['Market Research','Customer Discovery','Financial Modeling','Product Development','Sales & Marketing','Fundraising Mechanics','Operations & Scaling','Leadership & Management'],
    'Finance / Quant':['Mathematics & Statistics','Python / R Programming','Financial Markets Fundamentals','Asset Pricing Models','Derivatives & Options','Portfolio Theory','Algorithmic Trading','Risk Management']
  };
  const stack=stacks[domain]||['Foundation concepts','Core theory','Applied practice','Advanced techniques','Specialization','Integration','Mastery','Application to real problems'];
  el.innerHTML=`<div style="font-weight:700;margin-bottom:10px">Optimized skill path for ${domain}:</div>${stack.map((s,i)=>`<div class="path-step"><div class="path-num">${i+1}</div><div><div style="font-weight:600;font-size:13px">${s}</div></div></div>`).join('')}`;
}
function buildLearningStrategy(){
  const el=document.getElementById('learningStrategyContent');if(!el)return;
  const strategies=[{name:'Spaced Repetition',desc:'Review material at increasing intervals. Beat forgetting curve. Use Anki.',timing:'Daily 20min > Weekly 2hr cramming'},{name:'Interleaving',desc:'Mix topics/subjects within single session rather than block studying.',timing:'30min topic A ‚Üí 30min B ‚Üí return to A'},{name:'Retrieval Practice',desc:'Test yourself constantly. Close the book and write what you remember.',timing:'After each chapter, brain-dump without notes'},{name:'Feynman Technique',desc:'Explain concept in simple language as if teaching a 10-year-old.',timing:'After learning, teach it out loud or in writing'},{name:'Deep Work Blocks',desc:'4-hour focused sessions with zero distraction for complex skills.',timing:'Morning session in peak energy window'}];
  el.innerHTML=`<div style="font-family:var(--font-head);font-weight:800;font-size:18px;padding:10px 0 6px">üéØ Cognitive Learning Strategies</div>${strategies.map(s=>`<div class="card" onclick="openModal('${s.name}','<p>${s.desc}</p><br><strong>Optimal timing:</strong> ${s.timing}')"><div class="card-title"><span class="emoji">üìö</span>${s.name}</div><p style="font-size:12px;color:var(--text2)">${s.desc}</p><div style="font-size:11px;color:var(--primary);margin-top:4px">‚è±Ô∏è ${s.timing}</div></div>`).join('')}`;
}
function buildCareerSuggested(){
  const el=document.getElementById('careerSuggested');if(!el)return;
  const qs=['What career fits someone who peaks in creative flow?','How do I align work with my cognitive strengths?','Best environments for high introversion and high focus?','What high-impact careers need systems thinkers?','How do I monetize pattern recognition ability?'];
  el.innerHTML=qs.map(q=>`<button class="sq-btn" onclick="sendCareerChatMsg('${q}')">${q}</button>`).join('');
}
async function sendCareerChat(){const input=document.getElementById('careerChatInput');const msg=input.value.trim();if(!msg)return;input.value='';sendCareerChatMsg(msg);}
async function sendCareerChatMsg(msg){
  const msgs=document.getElementById('careerChat');if(!msgs)return;
  const userDiv=document.createElement('div');userDiv.className='chat-msg user';userDiv.textContent=msg;msgs.appendChild(userDiv);
  const loadDiv=document.createElement('div');loadDiv.className='chat-msg ai';loadDiv.innerHTML=`<div class="ai-tag">üöÄ Career AI</div><div class="ai-loading"><span></span><span></span><span></span></div>`;msgs.appendChild(loadDiv);msgs.scrollTop=msgs.scrollHeight;
  const logs=getLogs();const avgFocus=logs.length?(logs.reduce((s,e)=>s+(e.focus||0),0)/logs.length).toFixed(1):'unknown';const avgCreativity=logs.length?(logs.reduce((s,e)=>s+(e.creativity||0),0)/logs.length).toFixed(1):'unknown';
  const system=`You are a cognitive career strategist. The user has average focus: ${avgFocus}/10 and creativity: ${avgCreativity}/10. Give specific, actionable career alignment advice based on their cognitive profile and question. Max 120 words.`;
  try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:400,system,messages:[{role:'user',content:msg}]})});const data=await resp.json();loadDiv.remove();const aiDiv=document.createElement('div');aiDiv.className='chat-msg ai';aiDiv.innerHTML=`<div class="ai-tag">üöÄ Career AI</div>${data.content?.[0]?.text||'Check your API key in settings.'}`;msgs.appendChild(aiDiv);}
  catch(e){loadDiv.remove();const aiDiv=document.createElement('div');aiDiv.className='chat-msg ai';aiDiv.innerHTML=`<div class="ai-tag">üöÄ Career AI</div>High focus + high creativity ‚Üí knowledge work, research, creative tech, AI engineering, writing, design. Align with intrinsic curiosity over salary alone.`;msgs.appendChild(aiDiv);}
  msgs.scrollTop=msgs.scrollHeight;
}
async function generatePathAI(){
  const stage=document.getElementById('pathEduStage')?.value||'';
  const domain=document.getElementById('pathDomain')?.value||'';
  const goal=document.getElementById('pathGoal')?.value||'';
  const energy=document.getElementById('pathEnergy')?.value||'';
  const strengths=[...document.querySelectorAll('#pathStrengths .selected')].map(e=>e.textContent).join(', ');
  const el=document.getElementById('pathAIOutput');if(!el)return;
  el.innerHTML=`<div class="card"><div class="ai-loading" style="justify-content:center;padding:16px"><span></span><span></span><span></span></div></div>`;
  const system=`You are a cognitive trajectory optimizer. Based on user's cognitive profile, generate a specific 5-section response:
1. Your Cognitive Profile (3 sentences)
2. Recommended Career Paths (3 specific paths with brief explanation)
3. Priority Skill Stack (top 5 skills to build now)
4. Learning Environment Advice (based on energy pattern and strengths)
5. 90-Day Action Plan (3 concrete steps)
Keep total response under 250 words. Be specific, actionable, and personal.`;
  const userMsg=`Stage: ${stage}\nDomain: ${domain}\nGoal: ${goal}\nEnergy: ${energy}\nStrengths: ${strengths}`;
  try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:600,system,messages:[{role:'user',content:userMsg}]})});const data=await resp.json();const text=data.content?.[0]?.text||'API key needed. Add it in System ‚Üí Settings.';el.innerHTML=`<div class="card"><div class="card-title"><span class="emoji">üöÄ</span>Your Cognitive Trajectory</div><div class="ai-insight-box" style="white-space:pre-line">${text}</div></div>`;}
  catch(e){el.innerHTML=`<div class="card"><div class="card-title">üöÄ Trajectory Analysis</div><div class="ai-insight-box">Stage: ${stage} + Domain: ${domain} ‚Üí Focus on: core technical skills for ${domain}, building a portfolio of projects, networking within the ${domain} space, and finding mentors who embody your goal: "${goal}".</div></div>`;}
}

// ‚îÄ‚îÄ‚îÄ GUIDE / CONSCIOUSNESS PHILOSOPHY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildSystemPanel(){buildThemeGrid();buildAccountSection();buildGuideContent();buildLegalPages();buildDataOverview();buildAboutContent();}
function buildGuideContent(){
  const el=document.getElementById('guideContent');if(!el)return;
  const sections=[{q:'If my thoughts are mine, my body is mine, my brain is mine ‚Äî what is "me"?',body:'This is the hardest question in philosophy. Your thoughts arise from neural firing. Your body is a biological process. Your brain is the physical substrate. But the "observer" ‚Äî the one who seems to watch all this ‚Äî that is what philosophers call pure consciousness, or the witness. Most spiritual traditions and modern consciousness research point to the same paradox: you are not the content of awareness (thoughts, feelings, perceptions). <em>You are the awareness itself.</em>',highlight:'The witness cannot be observed, because it is the observer. The eye cannot see itself seeing.'},{q:'What is the difference between your state and your self?',body:'Your state is your current condition ‚Äî tired, anxious, creative, focused. States are temporary, impermanent, ever-changing. Your self is what persists through all states ‚Äî the continuity of experience across decades. Understanding this distinction is the foundation of consciousness work: <strong>states are what you feel, self is who you are.</strong> You can change states (with sleep, exercise, nutrition, meditation). The deeper self is what remains when all states change.',highlight:'States are the weather. Self is the sky. Weather passes. Sky remains.'},{q:'What is cognition versus identity?',body:'Cognition is how you process information ‚Äî perception, memory, reasoning, language. Identity is the story you tell about who you are. The fascinating insight: identity is itself a cognitive product. Your "self" is a narrative your brain constructs, updated continuously. This isn\'t a crisis ‚Äî it\'s liberation. If identity is constructed, it can be reconstructed. You can choose the story you inhabit.',highlight:'Your personality is not fixed. It is a habit pattern that can be updated like software.'},{q:'What is the observer ‚Äî and can you observe it?',body:'Throughout history, mystics and modern neuroscientists converge on the same finding: there exists in human experience a layer of pure witnessing awareness that is prior to thought. When you notice you\'re thinking ‚Äî who is doing the noticing? That noticing-awareness is what many traditions call the observer, pure consciousness, or witness consciousness. It cannot be caught thinking, because in the moment you try to observe it, it has already stepped back further.',highlight:'You cannot step outside your own awareness. But you can notice you\'re aware. That noticing is the whole game.'}];
  const layers=[{label:'üåä Body/Nervous System',bg:'rgba(16,185,129,.12)',color:'var(--success)',detail:'Physical substrate ‚Äî neurons, hormones, organs. Changeable via exercise, nutrition, sleep, breathwork.'},{label:'üí≠ Thoughts & Emotions',bg:'rgba(6,182,212,.12)',color:'var(--accent)',detail:'Content of mind ‚Äî beliefs, memories, desires, fears. Changeable via therapy, meditation, deliberate practice.'},{label:'üé≠ Roles & Identity',bg:'rgba(124,58,237,.12)',color:'var(--primary)',detail:'Constructed narratives ‚Äî who you think you are. Changeable via new experiences, reflection, meaning-making.'},{label:'‚ú® Witnessing Awareness',bg:'rgba(236,72,153,.12)',color:'var(--secondary)',detail:'The observer itself. Not changeable ‚Äî but can be recognized. This is the "you" behind everything else.'}];
  el.innerHTML=sections.map(s=>`<div style="margin-bottom:24px;padding-bottom:20px;border-bottom:1px solid var(--border)"><div class="guide-q">${s.q}</div><div class="guide-body">${s.body}</div><div class="guide-highlight">${s.highlight}</div></div>`).join('')+`<div style="margin-bottom:20px"><div class="guide-q">The Layers of Self</div><div style="display:flex;flex-direction:column;gap:6px">${layers.map(l=>`<div class="layer-bar" style="background:${l.bg};color:${l.color}" onclick="openModal('${l.label}','${l.detail}')">${l.label}</div>`).join('')}</div></div>`;
}
function buildLegalPages(){
  const el=document.getElementById('legalPages');const navEl=document.getElementById('legalNav');if(!el||!navEl)return;
  const pages=[{id:'about2',title:'About'},  {id:'terms',title:'Terms'},{id:'privacy',title:'Privacy'},{id:'health',title:'Health Disclaimer'},{id:'features',title:'Features'},{id:'copyright',title:'Copyright'}];
  navEl.innerHTML=pages.map((p,i)=>`<button class="legal-btn${i===0?' active':''}" onclick="showLegalPage('${p.id}',this)">${p.title}</button>`).join('');
  const content={about2:`<div class="legal-body"><h3>What is Consciousness OS?</h3><p>Consciousness OS is a personal cognitive monitoring and development platform. Its core mission is to help you observe, understand, and intentionally shape your mental states.</p><h3>The Philosophy</h3><p>Most people navigate life on autopilot ‚Äî their cognitive states driven by external circumstances rather than intentional design. Consciousness OS gives you the instruments to see clearly into your own mental operating system: what drives your focus, what creates your flow states, what patterns underlie your creativity.</p><h3>The Goal</h3><p>To create a detailed, growing model of your unique cognition ‚Äî and use that model to engineer more consistent access to your highest mental states.</p></div>`,terms:`<div class="legal-body"><h3>Terms of Use</h3><p>Consciousness OS is provided for personal, non-commercial use. By using this application, you agree to use it responsibly and legally.</p><h3>Data</h3><p>All data is stored locally on your device. We do not collect, store, or transmit your personal data to any servers.</p><h3>Modifications</h3><p>We reserve the right to update these terms. Continued use constitutes acceptance.</p></div>`,privacy:`<div class="legal-body"><h3>Privacy Policy</h3><p>Your privacy is fundamental. All data you enter is stored exclusively in your browser's localStorage ‚Äî on your device, under your control.</p><h3>What We Store</h3><p>Daily logs, health profile, dream journal, voice memo transcripts, and settings ‚Äî all stored locally, never transmitted.</p><h3>Third Parties</h3><p>If you use AI features, prompts are sent to Anthropic's API. No identifying information beyond your text is shared. Review Anthropic's privacy policy at anthropic.com.</p><h3>Your Rights</h3><p>Delete all data at any time via System ‚Üí Data ‚Üí Clear All Data.</p></div>`,health:`<div class="legal-body"><h3>Health Disclaimer</h3><p>Consciousness OS is a self-monitoring and educational tool, not a medical device or clinical service.</p><h3>Not Medical Advice</h3><p>AI-generated insights are for informational purposes only. They do not constitute medical, psychological, or psychiatric advice.</p><h3>Mental Health</h3><p>If you are experiencing mental health difficulties, please consult a qualified healthcare professional. This app is not a substitute for professional care.</p><h3>Brainwave Audio</h3><p>Binaural beats are experimental. If you have epilepsy or are prone to seizures, consult a doctor before use.</p></div>`,features:`<div class="legal-body"><h3>Feature Guide</h3><h3>SELF</h3><p>Daily consciousness logging with 20 metrics, passive behavioral tracking, AI pattern analysis, cognitive twin.</p><h3>WORLD</h3><p>Financial and geopolitical intelligence panel, market education, AI causal chain analysis.</p><h3>PATH</h3><p>Cognitive trajectory optimizer, career AI, skill stack builder, learning strategy guide.</p><h3>SCIENCE</h3><p>Frontier discoveries feed across neuroscience, AI, longevity, physics, space, and biotech.</p><h3>MIND</h3><p>AI Digital Twin with 5 personas, trend analysis, predictions, state engineering.</p><h3>WAVES</h3><p>12 binaural beat sessions, brainwave science education.</p><h3>HEALTH</h3><p>Comprehensive 18-section health profile, AI Doctor analysis.</p><h3>GAMES</h3><p>12 cognitive training games.</p><h3>DREAMS</h3><p>Dream journal, AI analysis, lucid dream training, reality checks.</p><h3>MEDIA</h3><p>Voice memos with transcription, media archive, calendar, alarms.</p><h3>SYSTEM</h3><p>8-theme engine, account layer, settings, legal pages, data management.</p></div>`,copyright:`<div class="legal-body"><h3>Copyright</h3><p>¬© 2025 Consciousness OS. All rights reserved.</p><h3>Open Source Spirit</h3><p>This application is built with vanilla JavaScript, HTML, and CSS ‚Äî no external frameworks. Educational use and personal modification is encouraged.</p><h3>AI Content</h3><p>Content generated by AI features is produced dynamically and is not claimed as original copyrighted work of this application.</p></div>`};
  el.innerHTML=pages.map((p,i)=>`<div class="legal-page${i===0?' active':''}" id="lp_${p.id}">${content[p.id]||''}</div>`).join('');
}
function showLegalPage(id,btn){document.querySelectorAll('.legal-page').forEach(p=>p.classList.remove('active'));const el=document.getElementById('lp_'+id);if(el)el.classList.add('active');document.querySelectorAll('.legal-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
function buildAccountSection(){
  const el=document.getElementById('accountSection');if(!el)return;
  const isLoggedIn=localStorage.getItem('cos_user_name');
  el.innerHTML=isLoggedIn?`<div class="card" style="text-align:center"><div class="account-avatar">üë§</div><div style="font-family:var(--font-head);font-weight:800;font-size:18px">${isLoggedIn}</div><div style="font-size:12px;color:var(--text3);margin-top:4px">Local Mode ‚Äî data stored on this device</div><button class="btn btn-danger btn-block" onclick="localStorage.removeItem('cos_user_name');buildAccountSection()" style="margin-top:12px">Sign Out</button></div>`:`<div class="card"><div class="card-title"><span class="emoji">üë§</span>Identity Layer</div><p style="font-size:13px;color:var(--text2);margin-bottom:12px">Set your name for personalized AI responses. All data stays local.</p><div class="form-group"><label class="form-label">Your Name</label><input type="text" class="form-input" id="userName" placeholder="What shall your AI Twin call you?"></div><button class="btn btn-primary btn-block" onclick="setUserName()">‚úÖ Set Name</button><div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border)"><div style="font-size:12px;color:var(--text3);margin-bottom:8px">‚ö†Ô∏è Cloud sync: Future feature ‚Äî requires backend setup. See System ‚Üí Legal ‚Üí Features for architecture docs.</div></div></div>`;
}
function setUserName(){const n=document.getElementById('userName')?.value?.trim();if(!n)return;localStorage.setItem('cos_user_name',n);buildAccountSection();showToast('‚úÖ Name set: '+n);}
function buildDataOverview(){
  const el=document.getElementById('dataOverview');if(!el)return;
  const logs=getLogs(),dreams=getDreams(),voice=JSON.parse(localStorage.getItem('cos_voice')||'[]'),media=JSON.parse(localStorage.getItem('cos_media')||'[]');
  el.innerHTML=`<div class="stats-grid"><div class="stat-box"><div class="sv">${logs.length}</div><div class="sl">Log Entries</div></div><div class="stat-box"><div class="sv">${dreams.length}</div><div class="sl">Dreams</div></div><div class="stat-box"><div class="sv">${voice.length}</div><div class="sl">Voice Memos</div></div><div class="stat-box"><div class="sv">${media.length}</div><div class="sl">Media Files</div></div><div class="stat-box"><div class="sv">${Math.round(JSON.stringify(localStorage).length/1024)}</div><div class="sl">KB Used</div></div><div class="stat-box"><div class="sv">${logs.length>0?logs[0].date:'‚Äî'}</div><div class="sl">Latest Entry</div></div></div>`;
}
function buildAboutContent(){
  const el=document.getElementById('aboutContent');if(!el)return;
  el.innerHTML=`<div class="card" style="text-align:center"><div style="font-size:56px">üß†</div><div style="font-family:var(--font-head);font-weight:800;font-size:22px;margin-top:8px">Consciousness OS</div><div class="badge badge-primary" style="margin-top:6px">v7.0</div><div style="font-size:13px;color:var(--text2);margin-top:12px;line-height:1.8">Your complete system for observing and engineering your mental states. Track cognition, understand the world, train lucid dreaming, and build your ideal cognitive trajectory.</div></div><div class="card"><div class="card-title"><span class="emoji">üåü</span>v7.0 Features</div><div style="font-size:13px;color:var(--text2);line-height:2">${['12 new features including World Intelligence Panel','8-theme engine: Sci-Fi, Natural, Spiritual, Classic, Winter, Summer, Light, Dark','Scrollable slider category navigation (no more overflow)','Path module: Career AI + Cognitive Trajectory Optimizer','Science Frontier Feed: 12 groundbreaking discoveries','Account/identity layer','Consciousness Guide: deep philosophy of observer and self','Passive behavioral telemetry','All elements clickable with detailed explanations','Legal pages with About, Terms, Privacy, Health Disclaimer'].map(f=>`<div>‚úÖ ${f}</div>`).join('')}</div></div>`;
}

// ‚îÄ‚îÄ‚îÄ HEALTH PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const HEALTH_SECTIONS=[{id:'demographics',title:'Demographics'},{id:'medical',title:'Medical History'},{id:'family',title:'Family History'},{id:'diet',title:'Diet & Nutrition'},{id:'substances',title:'Substance Use'},{id:'physical',title:'Physical Activity'},{id:'sleep2',title:'Sleep Health'},{id:'mental',title:'Mental Health'},{id:'hormonal',title:'Hormonal'},{id:'cardio',title:'Cardiometabolic'},{id:'digestive',title:'Digestive'},{id:'immune',title:'Immune & Allergy'},{id:'neuro',title:'Neurology'},{id:'environment',title:'Environment'},{id:'preventive',title:'Preventive Care'},{id:'functional',title:'Functional Capacity'},{id:'longevity2',title:'Longevity Markers'},{id:'goals',title:'Health Goals'}];
let hsCurrentIdx=0;
function buildHealthSections(){
  const container=document.getElementById('healthSectionsContainer');if(!container)return;
  container.innerHTML=HEALTH_SECTIONS.map((s,i)=>`<div class="health-section${i===0?' active':''}" id="hs_${s.id}"><div class="card"><div class="card-title"><span class="emoji">‚ù§Ô∏è</span>${s.title}</div><div id="hsFields_${s.id}"></div></div></div>`).join('');
  buildHFields();buildHealthJumpBar();updateHsNav();
}
function buildHFields(){
  const fields={'hs_demographics':[['text','Age','hs_age',''],['select','Biological Sex','hs_sex','Male,Female,Other'],['text','Height','hs_height','cm or ft"in'],['text','Weight','hs_weight','kg or lbs'],['select','Ethnicity','hs_eth','Prefer not to say,Asian,Black,Hispanic,Middle Eastern,White,Mixed,Other']],'hs_medical':[['textarea','Current diagnoses / conditions','hs_diagnoses','Diabetes, hypertension...'],['textarea','Current medications','hs_meds',''],['textarea','Past surgeries/procedures','hs_surgeries',''],['textarea','Allergies (drug/food/environmental)','hs_allergies','']],'hs_family':[['textarea','Family history of major conditions','hs_family','Heart disease, cancer, diabetes, Alzheimer\'s...'],['text','Mother\'s health','hs_mother',''],['text','Father\'s health','hs_father','']],'hs_diet':[['select','Diet type','hs_diettype','Omnivore,Vegetarian,Vegan,Keto,Paleo,Mediterranean,Intermittent Fasting,Other'],['text','Meals per day','hs_meals',''],['textarea','Foods you eat daily','hs_daily_foods',''],['textarea','Foods you avoid','hs_avoid',''],['text','Hydration (glasses/day)','hs_water','']],'hs_substances':[['select','Alcohol use','hs_alcohol','None,Rarely,1-2x/week,Daily,Heavy'],['select','Caffeine use','hs_caffeine','None,1 cup,2-3 cups,4+ cups'],['select','Nicotine use','hs_nicotine','None,Former,Occasional,Daily'],['select','Cannabis use','hs_cannabis','Never,Rarely,Weekly,Daily'],['textarea','Other substances/nootropics','hs_other_sub','']],'hs_physical':[['select','Exercise frequency','hs_exercise','None,1-2x/week,3-4x/week,5-7x/week,Twice daily'],['textarea','Types of exercise','hs_exercise_types','Running, weights, yoga...'],['text','Typical steps per day','hs_steps',''],['select','Job physical activity','hs_job_phys','Sedentary (desk),Light standing,Moderate,Heavy physical']],'hs_sleep2':[['select','Average sleep hours','hs_sleep_hrs','<5,5-6,6-7,7-8,8-9,9+'],['select','Sleep quality','hs_sleep_qual','Poor,Fair,Good,Excellent'],['text','Bedtime','hs_bedtime',''],['text','Wake time','hs_waketime',''],['select','Sleep disorders','hs_sleep_dis','None,Insomnia,Sleep apnea,Restless legs,Other'],['textarea','Sleep aids used','hs_sleep_aids','']],'hs_mental':[['select','Mood baseline','hs_mood_base','Often low,Variable,Neutral,Generally positive,High'],['textarea','Mental health conditions','hs_mh_conditions','Anxiety, depression, ADHD, bipolar...'],['textarea','Therapy/treatment','hs_therapy',''],['select','Stress level','hs_stress_base','Very low,Low,Moderate,High,Very high'],['textarea','Primary stressors','hs_stressors','']],'hs_hormonal':[['select','Thyroid issues','hs_thyroid','None,Hypothyroid,Hyperthyroid,Unknown'],['textarea','Other hormonal concerns','hs_hormones','PCOS, testosterone, cortisol...']],'hs_cardio':[['text','Resting heart rate','hs_hr','bpm'],['text','Blood pressure','hs_bp','120/80'],['select','Cardiovascular fitness','hs_cardio_fit','Very low,Low,Moderate,Good,Excellent'],['textarea','Cardiovascular conditions','hs_cardio_cond','']],'hs_digestive':[['select','Digestion quality','hs_digestion','Poor (frequent issues),Variable,Good,Excellent'],['textarea','Digestive conditions','hs_digest_cond','IBS, Crohn\'s, GERD...'],['select','Gut health supplements','hs_probiotics','None,Occasional,Daily probiotic,Multiple supplements']],'hs_immune':[['select','Immune system','hs_immune_str','Frequently ill,Average,Strong,Very strong'],['textarea','Autoimmune conditions','hs_autoimmune',''],['textarea','Food/environmental allergies','hs_allergies2','']],'hs_neuro':[['select','Neurological baseline','hs_neuro_base','No issues,Occasional headaches,Migraines,ADHD,Autism,Other'],['textarea','Neurological medications or supplements','hs_neuro_meds',''],['select','Brain training frequency','hs_brain_train','Never,Rarely,Weekly,Daily']],'hs_environment':[['select','Urban/rural','hs_location','Dense urban,Urban,Suburban,Rural'],['select','Sunlight exposure','hs_sun','Very low,Low,Moderate,High'],['select','Air quality','hs_air','Poor,Moderate,Good,Excellent'],['textarea','Environmental concerns','hs_env_concerns','Pollution, mold, chemicals...']],'hs_preventive':[['text','Last blood work date','hs_bloodwork',''],['textarea','Last screening results','hs_screening',''],['textarea','Supplements taken daily','hs_supplements',''],['textarea','Vaccinations up to date','hs_vaccines','']],'hs_functional':[['select','Cognitive function','hs_cog_func','Impaired,Below average,Average,Above average,Excellent'],['select','Energy consistency','hs_energy_cons','Crashes often,Variable,Consistent,Always high'],['select','Reaction time','hs_reaction','Slow,Average,Fast,Very fast']],'hs_longevity2':[['text','Parents\' longevity','hs_parent_lon',''],['select','Longevity interest','hs_longevity_int','Not interested,Somewhat,Very interested,Actively optimizing'],['textarea','Longevity protocols','hs_lon_protocols','Cold exposure, fasting, supplements...']],'hs_goals':[['textarea','Primary health goal','hs_goal_main',''],['textarea','5-year health vision','hs_goal_5yr',''],['select','Health priority','hs_priority','Longevity,Performance,Mental health,Energy,Weight,Relationships,All equally']]};
  Object.entries(fields).forEach(([sectionId,flds])=>{const container=document.getElementById('hsFields_'+sectionId.replace('hs_',''));if(!container)return;container.innerHTML=flds.map(([type,label,id,placeholder])=>{if(type==='select'){const opts=placeholder.split(',');return`<div class="form-group"><label class="form-label">${label}</label><select class="form-select" id="${id}">${opts.map(o=>`<option>${o}</option>`).join('')}</select></div>`;}if(type==='textarea')return`<div class="form-group"><label class="form-label">${label}</label><textarea class="form-textarea" id="${id}" placeholder="${placeholder}"></textarea></div>`;return`<div class="form-group"><label class="form-label">${label}</label><input type="text" class="form-input" id="${id}" placeholder="${placeholder}"></div>`;}).join('');});
  // Add AI doctor button to last section
  const goalsFields=document.getElementById('hsFields_goals');
  if(goalsFields)goalsFields.innerHTML+=`<button class="btn btn-accent btn-block" onclick="generateHealthAnalysis()">üë®‚Äç‚öïÔ∏è Generate AI Doctor Analysis</button>`;
}
function buildHealthJumpBar(){
  const el=document.getElementById('healthJumpBar');if(!el)return;
  el.innerHTML=HEALTH_SECTIONS.map((s,i)=>`<button class="section-jump${i===0?' active':''}" onclick="jumpToSection(${i})">${i+1}</button>`).join('');
}
function jumpToSection(idx){
  hsCurrentIdx=idx;document.querySelectorAll('.health-section').forEach((s,i)=>s.classList.toggle('active',i===idx));document.querySelectorAll('.section-jump').forEach((b,i)=>b.classList.toggle('active',i===idx));
  const name=document.getElementById('hsSectionName');if(name)name.textContent=HEALTH_SECTIONS[idx].title;
  const cur=document.getElementById('hsCurrent');if(cur)cur.textContent=idx+1;
  const bar=document.getElementById('hsProgressBar');if(bar)bar.style.width=((idx+1)/HEALTH_SECTIONS.length*100)+'%';
  updateHsNav();
}
function hsPrev(){if(hsCurrentIdx>0)jumpToSection(hsCurrentIdx-1);}
function hsNext(){if(hsCurrentIdx<HEALTH_SECTIONS.length-1)jumpToSection(hsCurrentIdx+1);}
function updateHsNav(){document.getElementById('hsPrevBtn').style.display=hsCurrentIdx===0?'none':'';document.getElementById('hsNextBtn').textContent=hsCurrentIdx===HEALTH_SECTIONS.length-1?'‚úÖ Done':'Next ‚Üí';}
async function generateHealthAnalysis(){
  const card=document.getElementById('aiDoctorCard');const out=document.getElementById('aiDoctorOutput');if(!card||!out)return;
  card.style.display='block';out.innerHTML='<div class="ai-loading" style="justify-content:center;padding:16px"><span></span><span></span><span></span></div>';card.scrollIntoView({behavior:'smooth'});
  const fields={age:document.getElementById('hs_age')?.value,sex:document.getElementById('hs_sex')?.value,meds:document.getElementById('hs_meds')?.value,conditions:document.getElementById('hs_diagnoses')?.value,diet:document.getElementById('hs_diettype')?.value,exercise:document.getElementById('hs_exercise')?.value,sleep:document.getElementById('hs_sleep_hrs')?.value,stress:document.getElementById('hs_stress_base')?.value,supplements:document.getElementById('hs_supplements')?.value,goal:document.getElementById('hs_goal_main')?.value};
  const system='You are a knowledgeable AI health analyst reviewing a personal health profile. Provide: 1) Brief assessment (2-3 sentences), 2) Top 3 priority recommendations, 3) Longevity tips based on profile, 4) What to monitor. Be helpful but always remind user to consult actual healthcare professionals. Max 200 words total.';
  try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:600,system,messages:[{role:'user',content:`Health Profile: Age:${fields.age}, Sex:${fields.sex}, Conditions:${fields.conditions}, Meds:${fields.meds}, Diet:${fields.diet}, Exercise:${fields.exercise}, Sleep:${fields.sleep}h, Stress:${fields.stress}, Supplements:${fields.supplements}, Goal:${fields.goal}`}]})});const data=await resp.json();out.innerHTML=`<div class="ai-insight-box">${data.content?.[0]?.text||'Analysis unavailable. Check API key in System settings.'}</div><div style="margin-top:8px;font-size:11px;color:var(--text3)">‚ö†Ô∏è For informational purposes only. Not medical advice. Consult a healthcare professional.</div>`;}
  catch(e){out.innerHTML=`<div class="ai-insight-box">Based on your profile: Focus on optimizing your top-reported concerns. Your strongest asset is your awareness ‚Äî tracking health data is already ahead of 90% of the population. Next step: get blood work done to establish biomarker baselines.</div><div style="margin-top:8px;font-size:11px;color:var(--text3)">‚ö†Ô∏è Not medical advice. Add your Anthropic API key for personalized AI analysis.</div>`;}
}

// ‚îÄ‚îÄ‚îÄ GAMES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GAMES=[{name:'Memory Match',desc:'Flip pairs',emoji:'üé¥',tag:'Memory'},{name:'Reaction Time',desc:'Test reflexes',emoji:'‚ö°',tag:'Reaction'},{name:'Stroop Challenge',desc:'Name ink color',emoji:'üé®',tag:'Inhibition'},{name:'N-Back Memory',desc:'Working memory',emoji:'üî¢',tag:'Working Mem'},{name:'Math Blitz',desc:'Arithmetic speed',emoji:'üî¢',tag:'Calculation'},{name:'Word Chain',desc:'Letter chains',emoji:'üìù',tag:'Verbal'},{name:'Color Sequence',desc:'Simon Says',emoji:'üü¶',tag:'Sequence'},{name:'Sudoku Lite',desc:'Logic puzzle',emoji:'üî¢',tag:'Logic'},{name:'Pattern Finder',desc:'Find the odd one',emoji:'üî∑',tag:'Pattern'},{name:'Speed Typing',desc:'Words per min',emoji:'‚å®Ô∏è',tag:'Processing'},{name:'Spatial Memory',desc:'Mental rotation',emoji:'üîÑ',tag:'Spatial'},{name:'Focus Breathing',desc:'4-7-8 breath',emoji:'üå¨Ô∏è',tag:'Focus'}];
function buildGamesGrid(){const grid=document.getElementById('gamesGrid');if(!grid)return;grid.innerHTML=GAMES.map((g,i)=>`<div class="game-card" onclick="launchGame(${i})"><div class="g-emoji">${g.emoji}</div><div class="g-name">${g.name}</div><div class="g-desc">${g.desc}</div><div class="g-tag">${g.tag}</div></div>`).join('');}
function launchGame(i){document.getElementById('gamesMenu').style.display='none';const c=document.getElementById('gameContainer');c.innerHTML='';const g=GAMES[i];const renders=[renderMemoryGame,renderReactionGame,renderStroopGame,renderNBackGame,renderMathGame,renderWordGame,renderColorGame,renderSudokuGame,renderPatternGame,renderTypingGame,renderSpatialGame,renderBreathingGame];if(renders[i])renders[i](c,g);}
function backToGames(){document.getElementById('gamesMenu').style.display='';document.getElementById('gameContainer').innerHTML='';}
function gameHeader(g){return`<div class="game-header"><button class="btn btn-secondary btn-sm" onclick="backToGames()">‚Üê Games</button><div style="font-family:var(--font-head);font-weight:700;font-size:16px">${g.emoji} ${g.name}</div></div>`;}
function renderMemoryGame(c,g){
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="matchScore">0</div><div class="gsl">Matches</div></div><div class="gs"><div class="gsv" id="matchMoves">0</div><div class="gsl">Moves</div></div><div class="gs"><div class="gsv" id="matchTime">0s</div><div class="gsl">Time</div></div></div><div id="memBoard" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px"></div>`;
  const emojis=['üåü','üéØ','üî•','üíé','üåä','üé®','üöÄ','üß†'];const cards=[...emojis,...emojis].sort(()=>Math.random()-.5);let flipped=[],matched=0,moves=0,startTime=Date.now();
  const board=document.getElementById('memBoard');
  cards.forEach((em,i)=>{const d=document.createElement('div');d.style=`aspect-ratio:1;background:var(--primary);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;transition:all .3s`;d.textContent='?';d.onclick=()=>{if(flipped.length===2||d.dataset.matched)return;d.textContent=em;flipped.push({el:d,em,i});if(flipped.length===2){moves++;document.getElementById('matchMoves').textContent=moves;if(flipped[0].em===flipped[1].em){flipped.forEach(f=>{f.el.style.background='var(--success)';f.el.dataset.matched='1';});matched++;document.getElementById('matchScore').textContent=matched;flipped=[];if(matched===8)showToast(`üèÜ Complete! ${moves} moves, ${Math.round((Date.now()-startTime)/1000)}s`);}else{setTimeout(()=>{flipped.forEach(f=>{f.el.textContent='?';f.el.style.background='var(--primary)';});flipped=[];},900);}}document.getElementById('matchTime').textContent=Math.round((Date.now()-startTime)/1000)+'s';};board.appendChild(d);});
}
function renderReactionGame(c,g){
  let waiting=false,trial=0,times=[],tig=null;
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="rtTrial">0/5</div><div class="gsl">Trial</div></div><div class="gs"><div class="gsv" id="rtAvg">‚Äî</div><div class="gsl">Avg (ms)</div></div></div><div id="rtTarget" style="height:200px;border-radius:var(--radius);background:var(--bg3);border:2px dashed var(--border);display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text2);cursor:pointer;transition:all .3s" onclick="rtClick()">Tap to Start</div><div id="rtLog" style="margin-top:12px;font-size:13px"></div>`;
  window.rtClick=()=>{
    const box=document.getElementById('rtTarget');
    if(!waiting){waiting=true;box.style.background='var(--danger)';box.textContent='Wait...';const delay=1500+Math.random()*2500;tig=setTimeout(()=>{const t=Date.now();box.style.background='var(--success)';box.textContent='TAP NOW!';waiting=false;window.rtStart=t;},delay);}
    else if(window.rtStart){const rt=Date.now()-window.rtStart;times.push(rt);trial++;document.getElementById('rtTrial').textContent=trial+'/5';document.getElementById('rtAvg').textContent=Math.round(times.reduce((a,b)=>a+b)/times.length);document.getElementById('rtLog').innerHTML=times.map((t,i)=>`Trial ${i+1}: <strong>${t}ms</strong>`).join(' ¬∑ ');box.style.background='var(--bg3)';box.textContent=trial<5?'Tap to start next...':'Done! '+Math.round(times.reduce((a,b)=>a+b)/times.length)+'ms avg';window.rtStart=null;if(trial===5){showToast('Average: '+Math.round(times.reduce((a,b)=>a+b)/times.length)+'ms');}}
  };
}
function renderStroopGame(c,g){
  const colors=[{name:'RED',color:'#ef4444'},{name:'BLUE',color:'#3b82f6'},{name:'GREEN',color:'#10b981'},{name:'YELLOW',color:'#f59e0b'},{name:'PURPLE',color:'#8b5cf6'}];
  let score=0,wrong=0,timer=60,tiv;
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="stroopScore">0</div><div class="gsl">Correct</div></div><div class="gs"><div class="gsv" id="stroopTimer">60</div><div class="gsl">Seconds</div></div><div class="gs"><div class="gsv" id="stroopWrong">0</div><div class="gsl">Wrong</div></div></div><div id="stroopWord" style="font-family:var(--font-head);font-size:48px;font-weight:800;text-align:center;padding:24px 0;min-height:100px"></div><div id="stroopButtons" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px"></div>`;
  function nextStroke(){const wordObj=colors[Math.floor(Math.random()*colors.length)];const inkObj=colors[Math.floor(Math.random()*colors.length)];document.getElementById('stroopWord').textContent=wordObj.name;document.getElementById('stroopWord').style.color=inkObj.color;window.correctInk=inkObj.name;const opts=[inkObj,...colors.filter(c=>c.name!==inkObj.name).sort(()=>Math.random()-.5).slice(0,2)].sort(()=>Math.random()-.5);document.getElementById('stroopButtons').innerHTML=opts.map(o=>`<button class="btn btn-secondary" style="font-weight:700" onclick="stroopAns('${o.name}')">${o.name}</button>`).join('');}
  window.stroopAns=ans=>{if(ans===window.correctInk){score++;document.getElementById('stroopScore').textContent=score;}else{wrong++;document.getElementById('stroopWrong').textContent=wrong;}nextStroke();};
  nextStroke();tiv=setInterval(()=>{timer--;document.getElementById('stroopTimer').textContent=timer;if(timer<=0){clearInterval(tiv);document.getElementById('stroopButtons').innerHTML='';document.getElementById('stroopWord').textContent='Done!';showToast('Stroop score: '+score+' correct');}},1000);
}
function renderNBackGame(c,g){
  const letters='ABCDEFGHJK';let seq=[],score=0,wrong=0,idx=0,iv;
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="nbScore">0</div><div class="gsl">Correct</div></div><div class="gs"><div class="gsv" id="nbIdx">0/20</div><div class="gsl">Trial</div></div></div><div id="nbLetter" style="font-family:var(--font-head);font-size:72px;font-weight:800;text-align:center;color:var(--primary);padding:20px">?</div><div style="text-align:center;font-size:13px;color:var(--text2);margin-bottom:12px">Press MATCH if same letter as 2 back</div><div style="display:flex;gap:12px;justify-content:center"><button class="btn btn-secondary" onclick="nbAnswer(false)">Not a Match</button><button class="btn btn-primary" onclick="nbAnswer(true)">Match!</button></div>`;
  window.nbAnswer=isMatch=>{if(idx<2)return;const correct=isMatch===(seq[idx-1]===seq[idx-3]);if(correct)score++;else wrong++;document.getElementById('nbScore').textContent=score;};
  iv=setInterval(()=>{if(idx>=20){clearInterval(iv);document.getElementById('nbLetter').textContent='Done!';showToast('N-Back: '+score+'/18 correct');return;}const l=letters[Math.floor(Math.random()*letters.length)];seq.push(l);document.getElementById('nbLetter').textContent=l;document.getElementById('nbIdx').textContent=idx+'/20';idx++;},2200);
}
function renderMathGame(c,g){
  let score=0,timer=90,tiv;
  function newQ(){const ops=['+','-','√ó'];const op=ops[Math.floor(Math.random()*3)];let a=Math.floor(Math.random()*20)+1,b=Math.floor(Math.random()*20)+1,ans;if(op==='+')ans=a+b;else if(op==='-'){if(b>a)[a,b]=[b,a];ans=a-b;}else{a=Math.floor(Math.random()*12)+1;b=Math.floor(Math.random()*12)+1;ans=a*b;}return{q:`${a} ${op} ${b} = ?`,ans};}
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="mathScore">0</div><div class="gsl">Correct</div></div><div class="gs"><div class="gsv" id="mathTimer">90</div><div class="gsl">Seconds</div></div></div><div id="mathQ" style="font-family:var(--font-head);font-size:36px;font-weight:800;text-align:center;padding:20px;color:var(--primary)"></div><div class="form-row" style="margin-top:8px"><input type="number" class="form-input" id="mathInput" placeholder="Answer..." style="font-size:18px;text-align:center" onkeydown="if(event.key==='Enter')mathCheck()"><button class="btn btn-primary" onclick="mathCheck()">OK</button></div>`;
  let cur=newQ();document.getElementById('mathQ').textContent=cur.q;
  window.mathCheck=()=>{const v=parseInt(document.getElementById('mathInput').value);if(v===cur.ans){score++;document.getElementById('mathScore').textContent=score;}cur=newQ();document.getElementById('mathQ').textContent=cur.q;document.getElementById('mathInput').value='';document.getElementById('mathInput').focus();};
  tiv=setInterval(()=>{timer--;document.getElementById('mathTimer').textContent=timer;if(timer<=0){clearInterval(tiv);showToast('Math score: '+score);}},1000);
}
function renderWordGame(c,g){
  let score=0,timer=60,lastWord='APPLE',tiv;
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="wordScore">0</div><div class="gsl">Words</div></div><div class="gs"><div class="gsv" id="wordTimer">60</div><div class="gsl">Seconds</div></div></div><div style="text-align:center;font-size:13px;color:var(--text2);margin-bottom:8px">Enter a word starting with the last letter of the previous word</div><div id="wordCur" style="font-family:var(--font-head);font-size:36px;font-weight:800;text-align:center;color:var(--primary);padding:12px">${lastWord}</div><div style="font-size:12px;text-align:center;color:var(--text3);margin-bottom:10px">Must start with: <strong id="wordStartLetter">E</strong></div><div class="form-row"><input type="text" class="form-input" id="wordInput" placeholder="Type word..." onkeydown="if(event.key==='Enter')wordSubmit()"><button class="btn btn-primary" onclick="wordSubmit()">Enter</button></div><div id="wordFeedback" style="text-align:center;margin-top:8px;font-size:13px"></div>`;
  window.wordSubmit=()=>{const val=document.getElementById('wordInput').value.trim().toUpperCase();const needed=lastWord[lastWord.length-1];if(!val){return;}if(val[0]!==needed){document.getElementById('wordFeedback').textContent='‚ùå Must start with '+needed;return;}lastWord=val;score++;document.getElementById('wordScore').textContent=score;document.getElementById('wordCur').textContent=val;document.getElementById('wordStartLetter').textContent=val[val.length-1];document.getElementById('wordInput').value='';document.getElementById('wordFeedback').textContent='‚úÖ Good!';};
  tiv=setInterval(()=>{timer--;document.getElementById('wordTimer').textContent=timer;if(timer<=0){clearInterval(tiv);showToast('Word chain: '+score+' words');}},1000);
}
function renderColorGame(c,g){
  const colors=['üü•','üü¶','üü©','üü®'];let seq=[],playerSeq=[],level=0,showing=false;
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="colorLevel">0</div><div class="gsl">Level</div></div></div><div id="colorBtns" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:280px;margin:20px auto"></div><div id="colorStatus" style="text-align:center;font-size:13px;margin-top:10px">Press Start</div><button class="btn btn-primary btn-block" onclick="colorStart()" style="margin-top:10px">‚ñ∂ Start</button>`;
  const btnEl=document.getElementById('colorBtns');
  colors.forEach((col,i)=>{const d=document.createElement('div');d.style=`aspect-ratio:1;border-radius:var(--radius);font-size:48px;display:flex;align-items:center;justify-content:center;cursor:pointer;background:var(--bg3);transition:all .15s`;d.textContent=col;d.onclick=()=>{if(showing)return;playerSeq.push(i);if(playerSeq[playerSeq.length-1]!==seq[playerSeq.length-1]){document.getElementById('colorStatus').textContent='‚ùå Game Over! Level '+level;return;}if(playerSeq.length===seq.length){level++;document.getElementById('colorLevel').textContent=level;playerSeq=[];setTimeout(addAndShow,600);}};btnEl.appendChild(d);});
  function addAndShow(){seq.push(Math.floor(Math.random()*4));showSeq();}
  function showSeq(){showing=true;document.getElementById('colorStatus').textContent='Watch...';let i=0;const iv=setInterval(()=>{if(i>=seq.length){clearInterval(iv);showing=false;document.getElementById('colorStatus').textContent='Your turn!';return;}btnEl.children[seq[i]].style.background='var(--primary)';setTimeout(()=>{btnEl.children[seq[i]].style.background='var(--bg3)';},400);i++;},700);}
  window.colorStart=()=>addAndShow();
}
function renderSudokuGame(c,g){
  const puzzle=[[5,3,0,0,7,0,0,0,0],[6,0,0,1,9,5,0,0,0],[0,9,8,0,0,0,0,6,0],[8,0,0,0,6,0,0,0,3],[4,0,0,8,0,3,0,0,1],[7,0,0,0,2,0,0,0,6],[0,6,0,0,0,0,2,8,0],[0,0,0,4,1,9,0,0,5],[0,0,0,0,8,0,0,7,9]];
  let selected=null;let board=puzzle.map(r=>[...r]);
  c.innerHTML=gameHeader(g)+`<div id="sudokuGrid" style="display:grid;grid-template-columns:repeat(9,1fr);gap:1px;background:var(--border);border:2px solid var(--primary);border-radius:8px;overflow:hidden;margin:8px 0"></div><div id="sudokuNums" style="display:grid;grid-template-columns:repeat(9,1fr);gap:4px;margin-top:8px"></div>`;
  function render(){const grid=document.getElementById('sudokuGrid');grid.innerHTML='';board.forEach((row,r)=>row.forEach((v,col)=>{const d=document.createElement('div');d.className='sudoku-cell'+(puzzle[r][col]?' given':selected&&selected[0]===r&&selected[1]===col?' selected':'');if(v)d.textContent=v;d.onclick=()=>{if(puzzle[r][col])return;selected=[r,col];render();};grid.appendChild(d);}));const nums=document.getElementById('sudokuNums');nums.innerHTML=[1,2,3,4,5,6,7,8,9].map(n=>`<div class="sudoku-num" onclick="sudokuNum(${n})">${n}</div>`).join('')+'<div class="sudoku-num" onclick="sudokuNum(0)" style="font-size:12px">‚úó</div>';}
  window.sudokuNum=n=>{if(!selected)return;board[selected[0]][selected[1]]=n;render();};render();
}
function renderPatternGame(c,g){
  let score=0,timer=60,tiv;
  const shapes=['üîµ','üü¶','üî∑','üí†'];
  function newRound(){const main=shapes[Math.floor(Math.random()*shapes.length)];const odd=shapes.filter(s=>s!==main)[Math.floor(Math.random()*3)];const total=16;const oddPos=Math.floor(Math.random()*total);const grid=Array(total).fill(main);grid[oddPos]=odd;document.getElementById('patGrid').innerHTML=grid.map((s,i)=>`<div style="font-size:28px;cursor:pointer;text-align:center;padding:4px" onclick="patClick(${i},${oddPos})">${s}</div>`).join('');}
  window.patClick=(i,odd)=>{if(i===odd){score++;document.getElementById('patScore').textContent=score;newRound();}else{document.getElementById('patFeedback').textContent='‚ùå';setTimeout(()=>document.getElementById('patFeedback').textContent='',800);}};
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="patScore">0</div><div class="gsl">Found</div></div><div class="gs"><div class="gsv" id="patTimer">60</div><div class="gsl">Seconds</div></div></div><div id="patFeedback" style="text-align:center;font-size:20px;height:24px"></div><div id="patGrid" style="display:grid;grid-template-columns:repeat(4,1fr)"></div>`;
  newRound();tiv=setInterval(()=>{timer--;document.getElementById('patTimer').textContent=timer;if(timer<=0){clearInterval(tiv);showToast('Patterns found: '+score);}},1000);
}
function renderTypingGame(c,g){
  const words=['the','quick','brown','fox','jumps','over','lazy','dog','consciousness','mind','focus','clarity','flow','state','awareness','present','energy','brain','waves','breath'];
  let score=0,timer=60,typed=0,chars=0,tiv,wordIdx=0;
  function nextWord(){wordIdx=Math.floor(Math.random()*words.length);document.getElementById('tyTarget').textContent=words[wordIdx];}
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="tyWPM">0</div><div class="gsl">WPM</div></div><div class="gs"><div class="gsv" id="tyTimer">60</div><div class="gsl">Seconds</div></div><div class="gs"><div class="gsv" id="tyScore">0</div><div class="gsl">Words</div></div></div><div id="tyTarget" style="font-family:var(--font-head);font-size:32px;font-weight:800;text-align:center;color:var(--primary);padding:20px"></div><input type="text" class="form-input" id="tyInput" placeholder="Type word..." style="font-size:18px;text-align:center" oninput="tyCheck()">`;
  nextWord();document.getElementById('tyInput').focus();
  window.tyCheck=()=>{const v=document.getElementById('tyInput').value;if(v===words[wordIdx]){score++;chars+=words[wordIdx].length;document.getElementById('tyScore').textContent=score;document.getElementById('tyWPM').textContent=Math.round(chars/5/((60-timer+0.001)/60));document.getElementById('tyInput').value='';nextWord();}};
  tiv=setInterval(()=>{timer--;document.getElementById('tyTimer').textContent=timer;if(timer<=0){clearInterval(tiv);showToast('WPM: '+document.getElementById('tyWPM').textContent);}},1000);
}
function renderSpatialGame(c,g){
  const shapes=[{name:'L-shape',rotations:['L','Œì','‚åê','J']},{name:'T-shape',rotations:['T','‚ä•','‚ä¢','‚ä£']},{name:'Z-shape',rotations:['Z','S','Z','S']},{name:'Arrow',rotations:['‚Üí','‚Üì','‚Üê','‚Üë']}];
  let score=0,wrong=0;
  function newQ(){const s=shapes[Math.floor(Math.random()*shapes.length)];const correctRot=Math.floor(Math.random()*4);const display=s.rotations[0];window.correctRotation=s.rotations[correctRot];const opts=[...s.rotations].sort(()=>Math.random()-.5).slice(0,4);document.getElementById('spatShape').textContent=display;document.getElementById('spatQuestion').textContent=`Which is the ${['base','90¬∞','180¬∞','270¬∞'][correctRot]} rotation?`;document.getElementById('spatOpts').innerHTML=opts.map(o=>`<button class="btn btn-secondary" style="font-size:22px;min-height:50px" onclick="spatAnswer('${o}')">${o}</button>`).join('');}
  window.spatAnswer=ans=>{if(ans===window.correctRotation){score++;document.getElementById('spatScore').textContent=score;}else{wrong++;document.getElementById('spatWrong').textContent=wrong;}newQ();};
  c.innerHTML=gameHeader(g)+`<div class="game-score-bar"><div class="gs"><div class="gsv" id="spatScore">0</div><div class="gsl">Correct</div></div><div class="gs"><div class="gsv" id="spatWrong">0</div><div class="gsl">Wrong</div></div></div><div id="spatShape" style="font-size:64px;text-align:center;padding:16px;color:var(--primary)"></div><div id="spatQuestion" style="text-align:center;font-size:13px;margin-bottom:10px"></div><div id="spatOpts" style="display:grid;grid-template-columns:1fr 1fr;gap:8px"></div>`;newQ();
}
function renderBreathingGame(c,g){
  let phase=0,timer=null;const phases=['Breathe In','Hold','Breathe Out','Hold'];const times=[4,7,8,4];let phaseTimer=0,phaseIdx=0;
  c.innerHTML=gameHeader(g)+`<div style="text-align:center;padding:16px 0"><div id="breathCircle" style="width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent));margin:0 auto;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff;transition:all 1s;box-shadow:0 0 0 0 var(--primary-glow)">Start</div></div><div id="breathPhase" style="font-family:var(--font-head);font-weight:800;font-size:24px;text-align:center;color:var(--primary)">4-7-8 Breathing</div><div id="breathCount" style="text-align:center;font-size:48px;font-weight:800;color:var(--accent);min-height:60px"></div><div style="font-size:12px;text-align:center;color:var(--text2);margin:8px 0">4 counts in ‚Üí 7 hold ‚Üí 8 out ‚Üí 4 hold</div><button class="btn btn-primary btn-block" onclick="breathStart()">‚ñ∂ Begin Session</button>`;
  window.breathStart=()=>{phaseIdx=0;phaseTimer=times[0];run();};
  function run(){const circle=document.getElementById('breathCircle');const phaseEl=document.getElementById('breathPhase');const countEl=document.getElementById('breathCount');timer=setInterval(()=>{countEl.textContent=phaseTimer;phaseEl.textContent=phases[phaseIdx];if(phaseIdx===0){circle.style.transform='scale(1.3)';circle.style.boxShadow=`0 0 40px var(--primary-glow)`;}else if(phaseIdx===2){circle.style.transform='scale(0.8)';circle.style.boxShadow='none';}phaseTimer--;if(phaseTimer<0){phaseIdx=(phaseIdx+1)%4;phaseTimer=times[phaseIdx];}},1000);}
}

// ‚îÄ‚îÄ‚îÄ LUCID DREAMS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let curDreamType='regular';
function setDreamType(btn,type){curDreamType=type;document.querySelectorAll('.dream-type-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');document.getElementById('dreamType').value=type;}
function getDreams(){return JSON.parse(localStorage.getItem('cos_dreams')||'[]');}
async function saveDream(){
  const dream={id:Date.now(),ts:new Date().toISOString(),date:document.getElementById('dreamDate')?.value||new Date().toISOString().split('T')[0],title:document.getElementById('dreamTitle')?.value||'Untitled',type:curDreamType,desc:document.getElementById('dreamDesc')?.value||'',vividness:parseInt(document.getElementById('dreamVividness')?.value||5),lucidity:parseInt(document.getElementById('dreamLucidity')?.value||0),signs:document.getElementById('dreamSigns')?.value||'',emotions:document.getElementById('dreamEmotions')?.value||''};
  if(!dream.desc){showToast('Add a description');return;}
  const dreams=getDreams();dreams.unshift(dream);if(dreams.length>200)dreams.pop();localStorage.setItem('cos_dreams',JSON.stringify(dreams));showToast('üí§ Dream saved!');
  const anaEl=document.getElementById('dreamAIAnalysis');
  if(anaEl){anaEl.innerHTML='<div class="dream-ai-box"><div class="ai-loading" style="justify-content:center"><span></span><span></span><span></span></div></div>';await analyzeDream(dream,anaEl);}
}
async function analyzeDream(dream,outputEl){
  const system='You are an expert dream analyst and lucid dreaming coach. For this dream, provide: 1) Key Symbols (2-3 symbols and their meaning), 2) Psychological Meaning (1 paragraph), 3) Lucid Dreaming Tip (one specific technique for this type of dream), 4) Reality Check Suggestion (one reality check that would have worked). Be insightful but concise. Max 150 words.';
  const prompt=`Dream: "${dream.desc}" Type: ${dream.type}, Vividness: ${dream.vividness}/10, Lucidity: ${dream.lucidity}/10, Signs: ${dream.signs}, Emotions: ${dream.emotions}`;
  try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:400,system,messages:[{role:'user',content:prompt}]})});const data=await resp.json();outputEl.innerHTML=`<div class="dream-ai-box"><div style="font-weight:700;margin-bottom:6px">üåô Dream Analysis</div>${data.content?.[0]?.text||'Analysis unavailable.'}</div>`;}
  catch(e){outputEl.innerHTML=`<div class="dream-ai-box"><div style="font-weight:700;margin-bottom:6px">üåô Dream Notes</div>Type: ${dream.type}. Vividness: ${dream.vividness}/10. ${dream.type==='lucid'?'Excellent! You achieved lucid awareness. Try the MILD technique to strengthen this.':'Try reality checks throughout the day ‚Äî the habit carries into dreams.'}</div>`;}
}
function renderDreamJournal(){
  const el=document.getElementById('dreamJournal');if(!el)return;
  const dreams=getDreams();
  const dc=document.getElementById('dreamCount');if(dc)dc.textContent=dreams.length;
  if(!dreams.length){el.innerHTML='<div class="empty-state"><span class="es-icon">üåô</span><div class="es-text">No dreams logged yet</div></div>';return;}
  el.innerHTML=dreams.map(d=>`<div class="card" style="cursor:pointer" onclick="openModal('${d.title||'Dream'}','<p><strong>Date:</strong> ${d.date}</p><p><strong>Type:</strong> ${d.type}</p><p><strong>Description:</strong> ${d.desc}</p><p><strong>Emotions:</strong> ${d.emotions}</p><p><strong>Vividness:</strong> ${d.vividness}/10</p><p><strong>Lucidity:</strong> ${d.lucidity}/10</p>')"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:700">${d.title||'Untitled'}</div><div style="font-size:11px;color:var(--text3)">${d.date} ¬∑ ${d.type}</div></div><div style="display:flex;gap:6px"><span class="badge badge-accent">V:${d.vividness}</span>${d.lucidity>0?`<span class="badge badge-primary">L:${d.lucidity}</span>`:''}</div></div></div>`).join('');
}
const TECHNIQUES=[{name:'MILD ‚Äî Mnemonic Induction of Lucid Dreams',rating:'‚≠ê‚≠ê',body:'Set intention before sleep: "I will recognize I am dreaming." When you wake from a dream, visualize returning to it with lucidity. Repeat mantras. Best combined with WBTB.'},{name:'WILD ‚Äî Wake Initiated Lucid Dream',rating:'‚≠ê‚≠ê‚≠ê‚≠ê',body:'Maintain consciousness while body falls asleep. Lie still, relax completely, observe hypnagogic imagery (lights, sounds). Don\'t react. When imagery solidifies, you\'re in a lucid dream. Requires significant practice.'},{name:'DILD ‚Äî Dream Initiated Lucid Dream',rating:'‚≠ê‚≠ê',body:'The most common type. You become lucid inside an already-occurring dream. Triggered by recognizing something impossible, doing a reality check, or noticing a dream sign.'},{name:'WBTB ‚Äî Wake Back To Bed',rating:'‚≠ê‚≠ê‚≠ê',body:'Sleep 5-6 hours, wake up for 20-60 minutes (read about lucid dreaming), then return to sleep. Your brain is in peak REM state. Most effective with MILD combined.'},{name:'Reality Testing',rating:'‚≠ê',body:'Throughout the day, genuinely question: "Am I dreaming right now?" Try pushing finger through palm. Check a clock twice (time is unstable in dreams). Read text (unreadable in dreams). The habit transfers to dreams.'}];
function buildTechniques(){const el=document.getElementById('techniquesContainer');if(!el)return;el.innerHTML=TECHNIQUES.map((t,i)=>`<div class="technique-card" id="tech_${i}"><div class="tc-header" onclick="togTech(${i})"><div><div class="tc-title">${t.name}</div><div style="font-size:11px;color:var(--text3)">Difficulty: ${t.rating}</div></div><span class="tc-chevron">‚ñº</span></div><div class="tc-body">${t.body}</div></div>`).join('');}
function togTech(i){const el=document.getElementById('tech_'+i);el.classList.toggle('open');}
const RC_CHECKS=[{name:'Palm Push',icon:'üñêÔ∏è',desc:'Try to push finger through palm'},{name:'Clock Check',icon:'üïê',desc:'Read a clock ‚Äî look away ‚Äî read again'},{name:'Text Test',icon:'üìñ',desc:'Read text ‚Äî look away ‚Äî read again'},{name:'Nose Plug',icon:'üëÉ',desc:'Pinch nose and try to breathe'},{name:'Finger Count',icon:'‚úã',desc:'Count your fingers carefully'},{name:'Light Switch',icon:'üí°',desc:'Try turning a light on/off'}];
let rcDone=new Set(JSON.parse(localStorage.getItem('cos_rc_done')||'[]'));
function buildRCGrid(){const el=document.getElementById('rcGrid');if(!el)return;el.innerHTML=RC_CHECKS.map((rc,i)=>`<div class="rc-btn${rcDone.has(i)?' done':''}" id="rc_${i}" onclick="doRC(${i})"><div class="rc-icon">${rc.icon}</div><div class="rc-name">${rc.name}</div><div style="font-size:10px;color:var(--text3);margin-top:4px">${rcDone.has(i)?'‚úÖ Done':''}</div></div>`).join('');const count=document.getElementById('rcCount');if(count)count.textContent=rcDone.size;const bar=document.getElementById('rcProgress');if(bar)bar.style.width=(rcDone.size/RC_CHECKS.length*100)+'%';}
function doRC(i){openModal(RC_CHECKS[i].name,`<p style="font-size:15px;margin-bottom:12px">${RC_CHECKS[i].desc}</p><p style="font-size:13px;color:var(--text2)">Genuinely ask yourself: <strong>Am I dreaming right now?</strong><br>Do the check slowly and deliberately. Look for inconsistencies.<br>In a dream, results will be strange or impossible.</p><button class="btn btn-primary btn-block" style="margin-top:12px" onclick="markRCDone(${i});closeAllModals()">‚úÖ Done ‚Äî Wasn't a Dream</button>`);}
function markRCDone(i){rcDone.add(i);localStorage.setItem('cos_rc_done',JSON.stringify([...rcDone]));buildRCGrid();}
function resetRC(){rcDone=new Set();localStorage.removeItem('cos_rc_done');buildRCGrid();}
function calcWBTB(){const sleep=document.getElementById('wbtbSleep')?.value;const wake=document.getElementById('wbtbWake')?.value;const el=document.getElementById('wbtbResult');if(!el||!sleep||!wake)return;const [sh,sm]=sleep.split(':').map(Number);const [wh,wm]=wake.split(':').map(Number);const totalMins=((wh*60+wm)-(sh*60+sm)+1440)%1440;const wbtbMin=sh*60+sm+Math.round(totalMins*0.6);const wbtbH=Math.floor(wbtbMin/60)%24;const wbtbM=wbtbMin%60;el.innerHTML=`<div class="dream-ai-box"><div style="font-weight:700;margin-bottom:8px">‚è∞ WBTB Schedule</div><p>Optimal wake time: <strong>${String(wbtbH).padStart(2,'0')}:${String(wbtbM).padStart(2,'0')}</strong></p><p style="margin-top:6px">Protocol: Wake at this time ‚Üí Stay awake 30-45 minutes (read lucid dreaming content) ‚Üí Return to sleep. You will enter REM almost immediately.</p></div>`;
}

// ‚îÄ‚îÄ‚îÄ VOICE & MEDIA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let mediaRec=null,recStream=null,recChunks=[],recTimer=null,recSecs=0,recognition=null;
function toggleRecord(){if(mediaRec&&mediaRec.state==='recording')stopRecord();else startRecord();}
async function startRecord(){
  try{recStream=await navigator.mediaDevices.getUserMedia({audio:true});mediaRec=new MediaRecorder(recStream);recChunks=[];mediaRec.ondataavailable=e=>recChunks.push(e.data);mediaRec.onstop=saveVoiceMemo;mediaRec.start();document.getElementById('recorderBtn').classList.add('recording');document.getElementById('recStatus').textContent='Recording...';recSecs=0;recTimer=setInterval(()=>{recSecs++;const m=Math.floor(recSecs/60),s=recSecs%60;document.getElementById('recTimer').textContent=(m<10?'0':'')+m+':'+(s<10?'0':'')+s;},1000);if(SETTINGS_STATE.autoTranscribe){recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition)();recognition.continuous=true;recognition.interimResults=true;recognition.onresult=e=>{const t=[...e.results].map(r=>r[0].transcript).join(' ');document.getElementById('liveTranscript').textContent=t;};recognition.start();}}catch(e){showToast('Microphone access denied');}
}
function stopRecord(){if(mediaRec)mediaRec.stop();if(recStream)recStream.getTracks().forEach(t=>t.stop());if(recognition)try{recognition.stop();}catch(e){}clearInterval(recTimer);document.getElementById('recorderBtn').classList.remove('recording');document.getElementById('recStatus').textContent='Tap to Start Recording';}
function saveVoiceMemo(){const blob=new Blob(recChunks,{type:'audio/webm'});const url=URL.createObjectURL(blob);const transcript=document.getElementById('liveTranscript').textContent||'';const memo={id:Date.now(),ts:new Date().toISOString(),duration:recSecs,transcript,url};const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]');memos.unshift(memo);if(memos.length>50)memos.pop();localStorage.setItem('cos_voice',JSON.stringify(memos));showToast('üéôÔ∏è Memo saved!');renderVoiceMemos();}
function renderVoiceMemos(){const el=document.getElementById('voiceMemos');if(!el)return;const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]');if(!memos.length){el.innerHTML='<div class="empty-state"><span class="es-icon">üéôÔ∏è</span><div class="es-text">No memos yet ‚Äî tap to record</div></div>';return;}el.innerHTML=memos.map(m=>`<div class="memo-item"><div class="memo-meta"><span>${new Date(m.ts).toLocaleDateString()} ${Math.floor(m.duration/60)}:${String(m.duration%60).padStart(2,'0')}</span><button class="btn btn-danger btn-sm" onclick="delMemo('${m.id}')">üóë</button></div>${m.transcript?`<div style="font-size:13px;color:var(--text2)">${m.transcript.slice(0,120)}${m.transcript.length>120?'...':''}</div>`:''}</div>`).join('');}
function delMemo(id){const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]').filter(m=>String(m.id)!==String(id));localStorage.setItem('cos_voice',JSON.stringify(memos));renderVoiceMemos();}
async function analyzeVoiceMemos(){const el=document.getElementById('voiceAIInsights');if(!el)return;const memos=JSON.parse(localStorage.getItem('cos_voice')||'[]');if(!memos.length){el.innerHTML='<div style="font-size:12px;color:var(--text3)">No memos to analyze yet.</div>';return;}el.innerHTML='<div class="ai-loading" style="justify-content:center;padding:12px"><span></span><span></span><span></span></div>';const texts=memos.slice(0,5).map(m=>m.transcript).filter(Boolean).join(' | ');const system='You are analyzing voice memo transcripts from a consciousness app. Identify recurring themes, emotional patterns, and suggest 2 specific voice memo topics that would help the user gain self-insight. Max 80 words.';try{const resp=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:200,system,messages:[{role:'user',content:texts||'User has voice memos but no transcripts.'}]})});const data=await resp.json();el.innerHTML=`<div class="dream-ai-box">ü§ñ ${data.content?.[0]?.text||'Analysis unavailable.'}</div>`;}catch(e){el.innerHTML=`<div class="dream-ai-box">üí° Voice memo tips: Try recording morning thoughts upon waking, post-meditation insights, and spontaneous creative ideas. These 3 windows capture your mind in distinct states.</div>`;}}
function uploadMedia(event){const files=[...event.target.files];const media=JSON.parse(localStorage.getItem('cos_media')||'[]');files.forEach(file=>{const reader=new FileReader();reader.onload=e=>{media.unshift({id:Date.now(),ts:new Date().toISOString(),name:file.name,type:file.type,data:e.target.result});if(media.length>50)media.pop();localStorage.setItem('cos_media',JSON.stringify(media));renderMediaGrid();};reader.readAsDataURL(file);});}
function renderMediaGrid(){const el=document.getElementById('mediaGrid');if(!el)return;const media=JSON.parse(localStorage.getItem('cos_media')||'[]');if(!media.length){el.innerHTML='<div class="empty-state"><span class="es-icon">üì∏</span><div class="es-text">No media yet</div></div>';return;}el.innerHTML=media.map(m=>`<div class="media-thumb" onclick="openModal('${m.name}','<img src=\\"${m.data}\\" style=\\"max-width:100%\\"><div style=\\"margin-top:8px;font-size:11px\\">${m.ts}</div>')">${m.type.startsWith('image')?`<img src="${m.data}" alt="">`:`<video src="${m.data}"></video>`}</div>`).join('');}
async function analyzeMedia(){const el=document.getElementById('mediaAIInsights');if(!el)return;el.innerHTML='<div class="dream-ai-box">üì∏ Consciousness photography tips: Capture your workspace in different mental states, pre/post-meditation selfies, the environments where you feel most alive. Visual patterns reveal subconscious patterns about your optimal environment.</div>';}

// ‚îÄ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let calYear=new Date().getFullYear(),calMonth=new Date().getMonth();
function renderCalendar(){const el=document.getElementById('calGrid');const title=document.getElementById('calTitle');if(!el)return;const logs=getLogs(),dreams=getDreams();const logDates=new Set(logs.map(e=>e.date));const dreamDates=new Set(dreams.map(d=>d.date));const now=new Date(),today=now.toISOString().split('T')[0];const months=['January','February','March','April','May','June','July','August','September','October','November','December'];if(title)title.textContent=months[calMonth]+' '+calYear;const days=['Su','Mo','Tu','We','Th','Fr','Sa'];const first=new Date(calYear,calMonth,1);const daysInMonth=new Date(calYear,calMonth+1,0).getDate();let html=days.map(d=>`<div class="cal-day-header">${d}</div>`).join('');for(let i=0;i<first.getDay();i++)html+='<div></div>';for(let d=1;d<=daysInMonth;d++){const ds=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;html+=`<div class="cal-day${ds===today?' today':''}${logDates.has(ds)?' has-log':''}${dreamDates.has(ds)?' has-dream':''}" onclick="openCalDay('${ds}')">${d}</div>`;}el.innerHTML=html;}
function calNav(dir){calMonth+=dir;if(calMonth>11){calMonth=0;calYear++;}if(calMonth<0){calMonth=11;calYear--;}renderCalendar();}
function openCalDay(date){const logs=getLogs().filter(e=>e.date===date);const dreams=getDreams().filter(d=>d.date===date);openModal(date,`<div>${logs.length?`<p><strong>üìä Log entries: ${logs.length}</strong></p>${logs.map(l=>`<div style="font-size:12px;color:var(--text2);margin:4px 0">Score: ${l.score} ¬∑ ${l.emotion||'?'} ¬∑ ${l.activity||'?'}</div>`).join('')}`:'<p style="color:var(--text3)">No log entry.</p>'}<br>${dreams.length?`<p><strong>üåô Dreams: ${dreams.length}</strong></p>${dreams.map(d=>`<div style="font-size:12px;color:var(--text2);margin:4px 0">${d.title||'Untitled'} (${d.type})</div>`).join('')}`:'<p style="color:var(--text3)">No dreams.</p>'}</div>`);}

// ‚îÄ‚îÄ‚îÄ ALARMS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addAlarm(){const time=document.getElementById('alarmTime')?.value;if(!time){showToast('Pick a time');return;}const alarm={id:Date.now(),time,label:document.getElementById('alarmLabel')?.value||'Alarm',sound:document.getElementById('alarmSound')?.value||'bell',repeat:document.getElementById('alarmRepeat')?.value||'once',active:true};const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');alarms.push(alarm);localStorage.setItem('cos_alarms',JSON.stringify(alarms));renderAlarms();showToast('‚è∞ Alarm set for '+time);}
function renderAlarms(){const el=document.getElementById('alarmsList');if(!el)return;const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');if(!alarms.length){el.innerHTML='<div class="empty-state"><span class="es-icon">‚è∞</span><div class="es-text">No alarms set</div></div>';return;}el.innerHTML=alarms.map(a=>`<div class="alarm-item"><div><div style="font-weight:700;font-size:16px">${a.time}</div><div style="font-size:11px;color:var(--text3)">${a.label} ¬∑ ${a.repeat}</div></div><div style="display:flex;gap:8px;align-items:center"><div class="alarm-toggle${a.active?' on':''}" onclick="togAlarm('${a.id}')"></div><button class="btn btn-danger btn-sm" onclick="delAlarm('${a.id}')">üóë</button></div></div>`).join('');}
function togAlarm(id){const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');const a=alarms.find(x=>String(x.id)===String(id));if(a)a.active=!a.active;localStorage.setItem('cos_alarms',JSON.stringify(alarms));renderAlarms();}
function delAlarm(id){const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]').filter(a=>String(a.id)!==String(id));localStorage.setItem('cos_alarms',JSON.stringify(alarms));renderAlarms();}
function checkAlarms(){const now=new Date();const h=String(now.getHours()).padStart(2,'0');const m=String(now.getMinutes()).padStart(2,'0');const time=h+':'+m;const day=now.getDay();const alarms=JSON.parse(localStorage.getItem('cos_alarms')||'[]');alarms.forEach(a=>{if(!a.active||a.time!==time)return;if(a.repeat==='weekdays'&&(day===0||day===6))return;if(a.repeat==='weekends'&&day>0&&day<6)return;playAlarmSound(a.sound);showToast('‚è∞ '+a.label);if(Notification.permission==='granted')new Notification('‚è∞ '+a.label,{body:'Consciousness OS',icon:'üß†'});if(a.repeat==='once'){const alrs=JSON.parse(localStorage.getItem('cos_alarms')||'[]');const al=alrs.find(x=>x.id===a.id);if(al)al.active=false;localStorage.setItem('cos_alarms',JSON.stringify(alrs));}});}
function playAlarmSound(type){try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const osc=ctx.createOscillator();const gain=ctx.createGain();osc.connect(gain);gain.connect(ctx.destination);osc.frequency.value=type==='om'?136:type==='chime'?880:type==='birds'?1200:type==='pulse'?440:660;osc.type='sine';gain.gain.setValueAtTime(0.3,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+1.5);osc.start();osc.stop(ctx.currentTime+1.5);}catch(e){}}
function addReminder(){const txt=document.getElementById('reminderText')?.value;const dt=document.getElementById('reminderDateTime')?.value;if(!txt||!dt){showToast('Add text and time');return;}const rem={id:Date.now(),text:txt,datetime:dt};const rems=JSON.parse(localStorage.getItem('cos_reminders')||'[]');rems.push(rem);localStorage.setItem('cos_reminders',JSON.stringify(rems));renderReminders();showToast('üìå Reminder set!');}
function renderReminders(){const el=document.getElementById('remindersList');if(!el)return;const rems=JSON.parse(localStorage.getItem('cos_reminders')||'[]');if(!rems.length){el.innerHTML='<div style="font-size:12px;color:var(--text3)">No reminders set.</div>';return;}el.innerHTML=rems.map(r=>`<div class="alarm-item"><div><div style="font-weight:700;font-size:13px">${r.text}</div><div style="font-size:11px;color:var(--text3)">${new Date(r.datetime).toLocaleString()}</div></div><button class="btn btn-danger btn-sm" onclick="delRem('${r.id}')">üóë</button></div>`).join('');}
function delRem(id){const rems=JSON.parse(localStorage.getItem('cos_reminders')||'[]').filter(r=>String(r.id)!==String(id));localStorage.setItem('cos_reminders',JSON.stringify(rems));renderReminders();}

// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function exportData(){const data={logs:getLogs(),dreams:getDreams(),voice:JSON.parse(localStorage.getItem('cos_voice')||'[]'),alarms:JSON.parse(localStorage.getItem('cos_alarms')||'[]'),settings:SETTINGS_STATE,health:JSON.parse(localStorage.getItem('cos_health2')||'{}'),exportDate:new Date().toISOString()};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='consciousness_os_data.json';a.click();showToast('‚úÖ Data exported!');}
function importData(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=e=>{try{const data=JSON.parse(e.target.result);if(data.logs)localStorage.setItem('cos_logs',JSON.stringify(data.logs));if(data.dreams)localStorage.setItem('cos_dreams',JSON.stringify(data.dreams));showToast('‚úÖ Data imported!');renderRecentLogs();renderDreamJournal();}catch(err){showToast('‚ùå Invalid file');}};reader.readAsText(file);}
function clearAllData(){if(!confirm('Delete ALL data? This cannot be undone.'))return;['cos_logs','cos_dreams','cos_voice','cos_media','cos_alarms','cos_reminders','cos_settings','cos_health2','cos_rc_done'].forEach(k=>localStorage.removeItem(k));showToast('üóë '+t('cleared'));renderRecentLogs();}

// ‚îÄ‚îÄ‚îÄ ONBOARDING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let oStep=0;const oTotalSteps=6;
function showOnboarding(){oStep=0;document.getElementById('onboardOverlay').style.display='flex';updateOnboard();}
function closeOnboarding(){document.getElementById('onboardOverlay').style.display='none';localStorage.setItem('cos_visited','1');}
function onboardNav(dir){oStep=Math.max(0,Math.min(oTotalSteps-1,oStep+dir));updateOnboard();}
function gotoOStep(n){oStep=n;updateOnboard();}
function updateOnboard(){document.querySelectorAll('.onboard-step').forEach((s,i)=>s.classList.toggle('active',i===oStep));const dotsEl=document.getElementById('onboardDots');if(dotsEl)dotsEl.innerHTML=Array.from({length:oTotalSteps},(_,i)=>`<span class="odot${i===oStep?' active':''}" onclick="gotoOStep(${i})"></span>`).join('');document.getElementById('oBtnPrev').style.display=oStep===0?'none':'';document.getElementById('oBtnNext').textContent=oStep===oTotalSteps-1?'Start!':'Next ‚Üí';document.getElementById('oBtnNext').onclick=oStep===oTotalSteps-1?closeOnboarding:()=>onboardNav(1);}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function init(){
  const today=new Date().toISOString().split('T')[0];const di=document.getElementById('logDate');if(di)di.value=today;const drDi=document.getElementById('dreamDate');if(drDi)drDi.value=today;
  buildNav();buildSliders();buildBWGrid();buildAIModelsBar();buildSuggestedQs();buildGamesGrid();buildTechniques();buildRCGrid();buildHealthSections();
  loadSettings();applyTheme(curTheme);setLang(curLang);
  renderRecentLogs();renderVoiceMemos();renderMediaGrid();renderAlarms();renderReminders();renderCalendar();updatePassiveTracking();
  loadDailyTip();buildSuggestedQs();
  // Dream slider handlers
  const dv=document.getElementById('dreamVividness');if(dv)dv.addEventListener('input',function(){document.getElementById('dreamVividnessVal').textContent=this.value;this.style.setProperty('--pct',this.value/10*100+'%');});
  const dl=document.getElementById('dreamLucidity');if(dl)dl.addEventListener('input',function(){document.getElementById('dreamLucidityVal').textContent=this.value;this.style.setProperty('--pct',this.value/10*100+'%');});
  setInterval(checkAlarms,30000);setInterval(updatePassiveTracking,60000);
  if(!localStorage.getItem('cos_visited'))setTimeout(showOnboarding,800);
}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
